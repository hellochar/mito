{"version":3,"sources":["common/useMousePosition.ts","evolution/species.ts","app/reducer.ts","common/perlin.ts","math/index.ts","sketches/mito/params.ts","math/shuffle.ts","common/capitalize.ts","evolution/traits.ts","sketches/mito/directions.ts","sketches/mito/inventory.ts","sketches/mito/game/canPullResources.ts","sketches/mito/game/temperature.ts","sketches/mito/game/entity.ts","sketches/mito/game/interactable.ts","sketches/mito/audio.ts","sketches/mito/game/player.ts","sketches/mito/game/world.ts","sketches/mito/game/tile.ts","sketches/mito/game/environment.ts","overworld/levelInfo.ts","overworld/hexTile.ts","overworld/hexStore.ts","overworld/overWorld.ts","app/state.ts","app/saveLoad.ts","common/Button.tsx","common/plantNames.ts","common/generateSpeciesName.ts","common/Character.tsx","global/ticker.ts","common/DynamicNumber.tsx","common/MP.tsx","common/Expand.tsx","evolution/TraitDisplay.tsx","evolution/GeneDisplay.tsx","evolution/GenesToTraits.tsx","evolution/mutation.ts","evolution/MutationScreen.tsx","common/LookAtMouse.tsx","evolution/SpeciesPopoverDetails.tsx","evolution/SpeciesNode.tsx","evolution/PhylogeneticTree.tsx","overworld/EpochUI.tsx","overworld/hexMath.ts","math/poissonDisc.ts","overworld/map/HexInfo.tsx","common/promise.ts","overworld/map/hexTileSprite.ts","overworld/map/OverWorldPopover.tsx","overworld/map/OverWorldMap.tsx","overworld/OverWorldScreen.tsx","sketches/sketch.ts","sketches/sketchComponent.tsx","sketches/fullPageSketch.tsx","common/vignette.ts","sketches/mito/keymap.ts","common/lazy.ts","sketches/mito/spritesheet.ts","sketches/mito/renderers/Renderer.tsx","sketches/mito/renderers/glsl.ts","sketches/mito/renderers/resourcePoints.ts","sketches/mito/renderers/InventoryRenderer.tsx","sketches/mito/renderers/PlayerRenderer.tsx","math/easing.ts","sketches/mito/renderers/CellEffectsRenderer.tsx","sketches/mito/renderers/tile/InstancedTileRenderer.tsx","sketches/mito/renderers/tile/tileBatcher.ts","sketches/mito/renderers/tile/TransportRenderer.tsx","sketches/mito/renderers/WorldRenderer.tsx","sketches/mito/ui/Instructions.tsx","sketches/mito/ui/GameStack.tsx","sketches/mito/ui/TileDetails.tsx","sketches/mito/renderers/TileRenderer.tsx","sketches/mito/ui/CellBar.tsx","sketches/mito/ui/SeasonsTracker.tsx","sketches/mito/ui/HUD.tsx","sketches/mito/tutorial/sceneObject.tsx","sketches/mito/ui/ParamsGUI.tsx","sketches/mito/tutorial/Animate.tsx","sketches/mito/tutorial/tileHighlight.tsx","sketches/mito/tutorial/PointHighlight.tsx","sketches/mito/ui/Hover.tsx","sketches/mito/WorldDOMElement.tsx","sketches/mito/index.tsx","sketches/mito/ui/GameResultsScreen.tsx","app/AppStateProvider.tsx","app/App.tsx","serviceWorker.ts","tests/TestStats.tsx","sketches/mito/game/worldUtils.ts","index.tsx","tests/TestWinScreen.tsx","assets/images/fruit.png","assets/audio/mito-base.mp3","assets/audio/mito-strings.mp3","assets/audio/mito-drums.mp3","assets/audio/footsteps.wav","assets/audio/build.wav","assets/audio/Blop-Mark_DiAngelo-79054334.mp3","assets/audio/suckwater.wav","assets/images/character.png","assets/images/test-vignette.png","assets/images/roguelikeSheet_transparent.png"],"names":["MousePositionContext","React","createContext","x","window","innerWidth","y","innerHeight","useMousePosition","useContext","SpeciesSchema","createSimpleSchema","id","identifier","name","primitive","genes","list","freeMutationPoints","totalMutationPoints","newBaseSpecies","arguments","length","undefined","uuid","descendants","props","object","parent","reference","AppReducerContext","useAppReducer","reducer","state","action","type","Object","objectSpread","populationAttempt","targetHex","sourceHex","info","visible","flora","console","error","actionPoints","activePopulationAttempt","handleStartPopulationAttempt","handlePopulationAttemptSuccess","overWorld","resetActionPoints","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","lineage","species","arr","push","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","Symbol","iterator","next","done","s","value","apply","toConsumableArray","err","return","rootSpecies","epoch","handleNextEpoch","Error","result","status","attempt","results","activeGameResult","handleGetGameResult","handleGameResultDone","_action$attempt","settlingSpecies","oldSpecies","mutationPointsPerEpoch","getMaxGenePool","hexNeighbors","Grad","z","classCallCheck","this","grad3","p","F2","Math","sqrt","G2","G3","Noise","seed","random","perm","Array","gradP","octaveNum","octaveFalloff","octaveMatrix2","cos","sin","createClass","key","floor","i","v","xin","yin","i1","j1","j","t","x0","y0","x1","y1","x2","y2","gi0","gi1","gi2","t0","t1","t2","dot2","sum","scalar","simplex2","newX","newY","zin","k1","i2","j2","k2","k","z0","z1","z2","x3","y3","z3","gi3","t3","dot3","simplex3","a","b","X","Y","n00","n01","n10","n11","u","fade","lerp","Z","n000","n001","n010","n011","n100","n101","n110","n111","w","lerp2","l","map","xStart","xStop","yStart","yStop","clamp","min","max","randRound","ix","fx","mod","m","PARAMS_DEFAULT","isRealtime","environment","cellEnergyMax","tissueInventoryCapacity","rootTurnsPerTransfer","leafReactionRate","leafSugarPerReaction","cellGestationTurns","cellDiffusionWater","cellDiffusionSugar","soilDarknessBase","soilDiffusionWater","veinDiffusion","soilMaxWater","droop","fountainTurnsPerWater","fountainAppearanceRate","transportTurnsPerMove","sunlightReintroduction","sunlightDiffusion","maxResources","params","search","parse","location","urlHashParams","JSON","assign","updateParamsHash","nonDefaultParams","_i","_keys","keys","stringified","stringify","shuffle","array","temporaryValue","randomIndex","currentIndex","capitalize","substr","toLocaleUpperCase","TRAIT_TYPES","carryCapacity","energyEfficiency","photosynthesis","rootAbsorption","structuralStability","activeTransportSugar","activeTransportWater","walkSpeed","diffuseWater","diffuseSugar","buildTime","heatTolerant","coldTolerant","fruitGrowthSpeed","fruitMutationPoints","fruitNeededResources","getTraits","traits","gene","tupleToTrait","DNA_TUPLE_TO_TRAIT_TYPE","AA","AC","AG","AT","CA","CC","CG","CT","GA","GC","GG","GT","TA","TC","TG","TT","TRAIT_TYPE_TO_DNA_TUPLE","traits_i","traits_Object$entries","entries","traits_ref3","traits_ref2","slicedToArray","tuple","dnaTuple","traitToTuple","trait","traitMod","val","base","exponent","pow","DIRECTIONS","nw","Vector2","sw","n","ne","e","se","DIRECTION_VALUES","o","fpref","round","Inventory","capacity","carrier","water","sugar","events","validate","other","amountWater","amountSugar","spaceNeeded","spaceAvailable","space","change","emit","fn","EventEmitter","on","off","newWater","newSugar","warn","concat","hasInventory","obj","inventory","canPullResources","receiver","giver","hasAncestry","constructor","areCells","Cell","isAirToSoil","recieverType","giverType","allowPull","Soil","Air","Temperature","StopStep","_Error","possibleConstructorReturn","getPrototypeOf","inherits","wrapNativeSuper","isInteractable","interact","mito","strings","drums","footsteps","build","blopBuffer","suckWaterBuffer","sourceElement","src","source","document","createElement","makeNodeOfAudioAsset","ctx","audio","autoplay","loop","_len","srcs","_key","_srcs","appendChild","createMediaElementSource","gain","createGain","connect","Player","posFloat","world","mapActions","baseSpeed","dtSinceLastStepped","get","currentTile","tempo","clone","actions","tile","tileAt","pos","droopY","event","cb","dt","mappedAction","actionSuccessful","attemptAction","maybeMoveWithTransports","Transport","add","dir","setLength","speed","attemptStill","attemptMove","attemptBuild","attemptDeconstruct","attemptDrop","attemptPickup","attemptMultiple","attemptInteract","target","isWalkable","Tile","isValidPosition","isObstacle","findEffectOfType","FreezeEffect","cellType","Tissue","verifyMove","cancelScheduledValues","linearRampToValueAtTime","context","currentTime","_dt","position","args","targetTile","Fruit","newTile","construct","exponentialRampToValueAtTime","args1","args2","_this","equals","every","_","index","argsEq","existingCell","cellAt","isMeaningfulBuild","force","cell","matureCell","tryConstructingNewCell","turnsToBuild","GrowingCell","setTileAt","maybeRemoveCellAt","refund","energy","give","multiple","allSuccess","interactable","StepStats","deleted","added","SEASON_NAMES","seasonDisplay","season","month","TIME_PER_YEAR","TIME_PER_SEASON","TIME_PER_MONTH","TIME_PER_DAY","World","time","frame","width","height","player","gridEnvironment","gridCells","neighborCache","wipResult","cachedEntities","stepStats","temperatureScale","0","day","night","1","2","3","fruits","diffusionWater","diffusionSugar","fill","__","FILL_FUNCTIONS","fillFunction","playerX","firstSoil","find","distanceTo","Rock","computeTileNeighbors","fillCachedEntities","tileEnvironment","step","tileCell","percent","xOrVec2","defineProperty","regenerator_default","mark","_callee","_x2","_y2","g","wrap","_context","prev","stop","oldTile","redistributeInventoryToNeighbors","oldCell","oldEnvironmentTile","handleTileUpdated","px","py","_this2","mapping","Map","DIRECTION_VALUES_RAND","forEach","set","_step3","newEntities","reverse","entities","entity","sDt","shouldStep","updateTemperatures","computeSunlight","stepWeather","climate","turnsBetweenRainfall","rainDuration","dropletSizeScalar","THREE","randInt","waterPerDroplet","_this$temperatureScal","sunAmount","sunAngle","directionalBias","PI","environmentTileAt","sunlight","tileUp","tileRight","tileLeft","upSunlight","sunlightCached","rightSunlight","leftSunlight","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_step4","_iterator3","cells","temperatureFloat","nextTemperature","DeadCell","matureFruit","filter","f","isMature","hasEnergy","self","_callee2","_iteratorNormalCompletion4","_didIteratorError4","_iteratorError4","_iterator4","_step5","row","_iteratorNormalCompletion5","_didIteratorError5","_iteratorError5","_iterator5","_step6","_context2","finish","atan","slice","darkness","Infinity","timeMade","getCurrentTemperature","Freezing","Cold","Mild","Hot","Scorching","fallAmount","neighbors","tileNeighbors","giveCandidates","from","values","isEmpty","neighbor","isMaxed","splice","stepDarkness","stepDiffusion","stepTemperature","stepGravity","minDarkness","_ref3","contrib","darknessFromNeighbor","canDiffuse","diffusionAmount","lowerNeighbor","displayName","noiseCo2","_Tile","call","_co2","assertThisInitialized","computeCo2","floorCo2","scaleX","offset","perlin3","stepDiffusionCheap","stepEvaporation","left","right","tryDiffuse","_Tile2","_this3","waterGravityPerTurn","esm_get","prototype","_this$world$environme","evaporationRate","evaporationBottom","evaporationHeightScalar","evaporationAmountScalar","_Tile3","_getPrototypeOf2","_this4","_Tile4","_getPrototypeOf3","_this5","_len3","_key3","Fountain","_Soil","_this6","turnsPerWater","cooldown","_CellEffect","_getPrototypeOf4","_this7","_len5","_key5","turnsToDie","percentFrozen","onFrozenChanged","temperature","die","remove","age","CellEffect","effects","indexOf","stacks","_Tile5","_this8","effect","attachTo","anyInteracted","interacted","isHungry","stepEatSugar","_neighbors","energeticNeighbors","stepEqualizeEnergy","stepDroop","hunger","energyToSugarConversion","sugarToEat","gotEnergy","difference","rate","energyTransfer","averageTemperature","size","chanceToFreeze","addEffect","chanceToLoseWater","below","belowLeft","belowRight","above","aboveLeft","aboveRight","droopAmount","hasSupportBelow","_i2","_arr","springNeighborCells","reduce","_Cell","completedCell","_this9","timeRemaining","timeToBuild","_Cell2","_this10","hasTilePairs","tilePairs","Leaf","_Cell3","_getPrototypeOf5","_this11","_len7","_key7","averageEfficiency","averageSpeed","sugarConverted","totalSugarProduced","numAir","_iteratorNormalCompletion6","_didIteratorError6","_iteratorError6","_iterator6","_ref6","_ref5","oppositeTile","air","tissue","efficiency","co2","bestEfficiencyWater","waterToConvert","chance","Root","_Cell4","_getPrototypeOf6","_this12","_len9","_key9","activeNeighbors","totalSucked","stepWaterTransfer","doneOnce","_iteratorNormalCompletion7","_didIteratorError7","_iteratorError7","_step7","_iterator7","_ref9","_ref8","_Cell5","_this13","neededResources","committedResources","timeMatured","turnsToMature","handleGetResources","ceil","maxResourceIntake","_iteratorNormalCompletion8","_didIteratorError8","_iteratorError8","_step8","_iterator8","_ref12","wantedWater","wantedSugar","commitResources","oneTurnCommitMax","r","isFractional","_Tissue","_this14","cooldownWater","cooldownSugar","waterToTransport","sugarToTransport","turnsPerSugar","getTarget","fromTile","getFrom","Vein","_Tissue2","_getPrototypeOf7","_this15","_len11","_key11","EnvironmentSchema","*","noiseWater","noiseRock","noiseHeight","Temperate","soilLevel","perlin2","rockThreshold","isRock","heightScalar","simplexValue","emitWaterScalar","Desert","Rocky","ALL_ENVIRONMENTS","LevelInfoSchema","rainfall","soilType","wind","C","HexTile","_dec","serializable","_dec2","_class","initializerDefineProperty","_descriptor","_descriptor2","_descriptor3","_descriptor4","abs","applyDecoratedDescriptor","configurable","enumerable","writable","initializer","HexStore","hexStore_dec","_Symbol$iterator","hexStore_class","hexStore_descriptor","tiles","hash","OverWorld","overWorld_dec","overWorld_dec2","overWorld_Symbol$iterator","overWorld_class","storage","startTile","overWorld_descriptor","overWorld_descriptor2","hex","populatedActiveNeighbors","hexes","pool","noise","_tile$cartesian","cartesian","noise3D","randomHeight","maxDist","SimplexNoise","populateLevelInfo","getDefaultStartTile","_tile$cartesian2","sort","magnitude","PopulationAttemptSchema","AppStateSchema","GAME_DATA_KEY","save","appState","json","serialize","stringToSave","localforage","setItem","string","getItem","sent","deserialize","abrupt","ACTIONS_TO_SAVE_ON","AAGameResultDone","AAGetGameResult","AAUpdateSpecies","AANextEpoch","AAPopulationAttemptSuccess","AAStartPopulationAttempt","Button","react_default","className","classNames","color","children","plantNames","generateSpeciesName","names","Character","otherProps","objectWithoutProperties","alt","characterSrc","Ticker","tickerId","tickers","_time","tickerLoop","toDelete","Number","_toDelete","removeAnimation","requestAnimationFrame","start","NUMBER_FORMATTER","Intl","NumberFormat","maximumFractionDigits","useGrouping","DynamicNumber","_ref","_ref$speed","_ref$formatter","formatter","_React$useState","useState","_React$useState2","setV","useEffect","addAnimation","Fragment","format","MP_NUMBER_FORMATTER","MP","amount","total","common_DynamicNumber","index_esm","Expand","shrunkElements","_useState","_useState2","expanded","setExpanded","onClick","Trait","green","red","splits","split","sortNames","localeCompare","TraitDisplay","_ref2","nonzeroTraits","nonzeroTraitElements","zeroTraits","zeroTraitElements","common_Expand","GeneComponent","title","GeneDisplay","geneContent","GenesToTraits","useMemo","evolution_GeneDisplay","evolution_TraitDisplay","mutatePosition","geneStr","join","strToGene","old","d","randomDNA","randomNewDNA","charAt","str","randomDNATuple","MutationScreen","onCommit","_useAppReducer","dispatch","setPool","arg","newSpecies","setNewSpecies","_React$useState3","_React$useState4","clickMode","setClickMode","isSwapping","isRerolling","newGeneCost","swap","gene1","position1","gene2","position2","geneIndex1","geneIndex2","newGenes","_mutateSwapDNA","gene1Str","gene2Str","dnaPosition1","dnaPosition2","newGeneStr1","newGeneStr2","mutateSwapDNA","_mutateSwapDNA2","newGene1","newGene2","isGenesChanged","genes1","genes2","some","click-mode-active","common_Character","common_MP","Button_Button","disabled","is-cancel","evolution_GenesToTraits","geneIndex","newGene","reroll","p1","onChange","LookAtMouse","mouse","useBoundingclientrectRef","ref","_props$zScale","zScale","restProps","style","midX","midY","top","ox","oy","rotY","rotX","transform","SpeciesPopoverDetails","onMutate","SpeciesNode","handleOnMutate","setPopoverIsOpen","popoverIsOpen","SpeciesNode_SpeciesNode","popoverBody","evolution_SpeciesPopoverDetails","react_popover_default","isOpen","preferPlace","onOuterAction","body","common_LookAtMouse","PhylogeneticTree","evolution_SpeciesNode","EpochUI","onNextEpoch","onFocusHex","_useAppReducer2$","transitioning","setTransitioning","unusedHexes","isReadyToAdvance","ready-to-advance","EPOCH_FORMATTER","setTimeout","Y_SQUISH_FACTOR","getClickedHexCoords","canvas","camera","scale","dX","dY","cX","cY","nativeEvent","offsetX","offsetY","rx","ry","rz","x_diff","y_diff","z_diff","roundCubeCoordinates","pixelPosition","getCameraPositionCenteredOn","_hex$cartesian","vectors","generateNaturalRandomHexagonPoints","radius","dropFirst","normSamples","_ref$width","_ref$height","_ref$radius","_ref$max","_ref$initialSample","initialSample","_ref$rng","rng","radius2","R","cellSize","SQRT1_2","gridWidth","gridHeight","grid","queue","queueSize","sampleSize","far","i0","j0","dx","dy","sample","sampler","samples","poissonDisc","isPointInHexagon","shift","HALF_HEIGHT","q2x","q2y","HexInfo","playSpecies","onClickPlay","_tile$info","playButtonElement","header","isHabitable","stringifyInfo","expand","fontSize","sleep","Promise","testVignette","Image","testVignetteUrl","COLOR_SCALE_HEIGHT","scaleLinear","domain","range","HexTileSprite","vignettePositions","isHovered","c","_pixelPosition","_pixelPosition2","lineWidth","isShadowed","globalAlpha","fillStyle","strokeStyle","drawHex","drawNumericHeight","drawActivePulse","drawVignettes","beginPath","moveTo","arc","stroke","drawCircle","drawPulse","tOffset","thickness","easePulse","now","font","textAlign","textBaseline","fillText","positions","asyncToGenerator","sizeScale","drawImage","highlightedHex","angle","lineTo","closePath","easeExpIn","OverWorldPopover","container","OverWorldMap","_React$PureComponent","hexTileSprites","rafId","handleCanvasRef","setState","handleResize","handleCanvasClick","coords","cameraState","clicked","hexAt","possibleMigrationSources","handleCanvasMouseLeave","hoveredHex","handleCanvasMouseMove","handleClickPlay","handleKeyDown","repeat","newPressedKeys","pressedKeys","code","handleKeyUp","handleWheel","delta","deltaX","deltaY","updateCanvas","updateCamera","_getCameraPositionCen","getStartTile","_getCameraPositionCen2","sprite","getContext","drawMap","drawMigrationArrows","drawPopulationAttempt","_this$state","clearRect","setIsHovered","sprites","zIndex","_sprites","draw","_this$state2","drawPossibleMigrationIntoArrows","drawPossibleMigrationOutOfArrows","drawMigrationArrow","addEventListener","removeEventListener","prevProps","focusedHex","focusHex","tStart","_getCameraPositionCen3","_getCameraPositionCen4","targetX","targetY","tabIndex","onMouseLeave","onMouseMove","maybeRenderPopover","possibleMigrationTargets","shadowBlur","shadowOffsetX","shadowOffsetY","shadowColor","lineCap","lineJoin","targetCenter","sourceCenter","arrowStart","arrowEnd","fromx","fromy","tox","toy","headlen","atan2","drawArrow","_this$state3","map_OverWorldPopover","map_HexInfo","PureComponent","contextType","OverWorldScreen","leftPanelOpen","setLeftPanelOpen","_useState3","_useState4","activelyMutatingSpecies","setActivelyMutatingSpecies","open","preventDefault","handleStartMutate","useCallback","handleCommit","newPool","_useState5","_useState6","setFocusedHex","handleFocusHex","OverWorldMap_OverWorldMap","evolution_PhylogeneticTree","maybeMutationScreen","evolution_MutationScreen","lib_default","ariaHideApp","onRequestClose","maybeRenderMutationModal","EpochUI_EpochUI","confirm","removeItem","then","reload","reject","UI_EVENTS","click","contextmenu","dblclick","mousedown","mouseup","mousemove","touchstart","touchmove","touchend","keyup","keydown","keypress","wheel","ISketch","renderer","audioContext","elements","timeElapsed","frameCount","domElement","SketchSuccessComponent","frameId","lastTimestamp","timestamp","millisElapsed","sketch","animate","handleWindowResize","updateRendererCanvasToMatchParent","resize","eventName","callback","eventsOnBody","sketchElementsWithKey","render","react","el","idx","destroy","dispose","parentElement","setSize","clientWidth","clientHeight","SketchComponent","_React$PureComponent2","volumeEnabled","localStorage","userVolume","handleContainerRef","AudioContextConstructor","AudioContext","webkitAudioContext","setContext","setValueAtTime","destination","handleVisibilityChange","alpha","preserveDrawingBuffer","antialias","otherArgs","sketchClass","close","handleVolumeButtonClick","hidden","suspend","resume","_this$props","containerProps","errorElement","classnames","renderSketchOrStatus","renderVolumeButton","sketchComponent_SketchSuccessComponent","renderDefaultErrorElement","message","fa_index_esm","FullPageSketch","handleDivRef","div","exitFullscreen","sketchComponent_SketchComponent","webkitExitFullscreen","mozCancelFullScreen","VignetteCapturer","pxPerTile","captureInterval","lastCaptureTime","renderTarget","rtBuffer","rtCanvas","picturesqueCells","_this$getBounds","getBounds","_this$getBounds2","minBounds","maxBounds","scene","Scene","tileRenderers","worldRenderer","createRendererFor","update","cameraEncompassingBounds","setRenderTarget","clear","readRenderTargetPixels","imageData","createImageData","imageBuffer","data","putImageData","boundsWidth","boundsHeight","maxDimension","roiWidth","roiHeight","roiTopLeft","dest","img","toDataURL","copy","subScalar","addScalar","center","largerDim","OrthographicCamera","WebGLRenderTarget","Uint8Array","ACTION_KEYMAP","KeyQ","KeyE","Space","MOVEMENT_KEYS","KeyW","KeyA","KeyS","KeyD","CELL_BAR_KEYS","Digit1","Digit2","Digit3","Digit4","Digit5","lazy","cache","spriteSize","spritesheetLoaded","SPRITESHEET","load","roguelikeSheet_transparentSrc","texture","magFilter","flipY","wrapS","wrapT","dispatchEvent","fruitTexture","fruitSrc","textureFromSpritesheet","backgroundColor","drawSpriteToCanvas","image","fillRect","needsUpdate","Renderer","glsl","ResourcePoints","_Points","geometry","material","newGeometry","ResourcePointsMaterial","frustumCulled","BufferGeometry","Float32Array","BUFFER_SIZE","sizes","addAttribute","BufferAttribute","setDynamic","attributes","setXYZ","setX","setDrawRange","Points","uniforms","opacity","sizeGlobal","vertexShader","fragmentShader","depthTest","transparent","ShaderMaterial","_templateObject","_templateObject2","InventoryRenderer","_Renderer","animationOffset","waters","sugars","wantedMeshes","sub","handleGiveResources","newParticle","WaterParticles","startFrame","SugarParticles","endFrame","resources","particles","resource","resourceArray","commit","fract","numWaters","numResources","vx","vy","goTowardsCenterStrength","playerY","mag2","avoidPlayerStrength","lengthSq","strength","updateNumParticles","simulateResourcePositions","commitParticles","Color","PlayerRenderer","mesh","Mesh","PlaneBufferGeometry","MeshBasicMaterial","depthWrite","side","DoubleSide","droopPosFloat","reversed","CellEffectsRenderer","renderers","createEffectRenderer","FreezeEffectRenderer","COLD_BLUE","newMesh","AnimationController","animation","timeStarted","InstancedTileRenderer","batchMesh","inventoryRenderer","originalColor","lastAudioValueTracker","pairsLines","Object3D","worldDomElement","cellEffectsRenderer","Vector3","instance","temperatureColor","TEMPERATURE_COLORS","currentLerp","getBatchInstance","materialInfo","Audio","audioListener","fruit","addWorldDOMElement","toFixed","getMaterialInfo","materialInfoMapping","commitCenter","commitTexturePosition","texturePosition","commitColor","commitScale","lightAmount","updateVisibility","updateSize","updateColor","respondToEvents","getPercentMatured","targetScale","ONE","colorIndex","AIR_COLORSCALE","startColorIndex","startColor","endColor","lerpColorTemperature","newAudioValueTracker","setBuffer","dist","distanceToSquared","volume","setVolume","play","growPulseAnimation","tColor","targetLerp","_this$pairsLines","pairColor","getHex","pairs","arrowDir","normalize","arrowHelper","makeLine","multiplyScalar","hasActiveNeighbors","_this$pairsLines2","lines","ArrowHelper","ease","easeCubic","setScalar","isArray","origin","line","Line","lineGeometry","LineBasicMaterial","quaternion","axis","radians","acos","setFromAxisAngle","updateMatrix","matrixAutoUpdate","removeWorldDOMElement","Float32BufferAttribute","materials","tileBatcher_templateObject","tileBatcher_templateObject2","TileShaderMaterial","RawShaderMaterial","roguelikeSheet","TileBatcher","maxTiles","centers","InstancedBufferAttribute","colors","scales","texturePositions","instances","updateMatrixWorld","referenceGeometry","InstancedBufferGeometry","isInteger","String","has","BatchInstance","checkout","BLACK","ZERO","batcher","inUse","numInUse","setXY","log","TransportRenderer","_InstancedTileRendere","arrow","WorldRenderer","tileBatcher","deleteDeadEntityRenderers","createSelector","stats","deletedEntities","delete","created","getLastStepStats","getOrCreateRenderer","Instructions","renderCredit","href","rel","GameStack","handlePlay","instructionsOpen","Instructions_Instructions","TileDetails","_React$Component","tileInfo","inventoryInfo","cellInfo","growingCellInfo","rootInfo","leafInfo","airInfo","fountainInfo","energyInfo","temperatureInfo","Bar","_ref$color","_ref$left","bottom","borderRight","Text","_ref2$fontWeight","fontWeight","fontFamily","border","waterInfo","sugarInfo","cellEffects","descriptors","TileMesh","_Mesh","materialMapping","TileRenderer","growingRenderer","mat","CellBarItem","hotkey","isSelected","getStyle","url","HTMLCanvasElement","backgroundImage","selected","HotkeyButton","getElementsByTagName","focus","ensureCanvasFocus","CellBar","bar","onIndexClicked","SeasonsTracker","yearDonePercent","BarMarker","SeasonBead","HUD","traitsPanelOpen","tutorialRef","isFinished","isMaxedEl","SeasonsTracker_SeasonsTracker","maybeRenderTraits","renderInventoryBar","renderInventory","ui_CellBar","cellBar","cellBarIndex","setCellBarIndex","waterPercent","sugarPercent","emptyPercent","waterStyles","sugarStyles","emptyStyles","SceneObject","Animate","rafid","Component","TILE_HIGHLIGHT","edgesGeometry","lineSegments","TileHighlight","Animate_Animate","sceneObject_SceneObject","POINT_HIGHLIGHT","PointHighlight","Hover","highlightedTile","highlightedPosition","getHighlightPosition","TileDetails_TileDetails","tutorial_PointHighlight","maybeRenderTileHighlight","tileHighlight","WorldDOMElement","positionFn","renderFn","worldPosition","worldToScreen","Mito","_ISketch","onWinLoss","mouseDown","mouseButton","firstActionTakenYet","keyMap","Set","clientX","clientY","button","shiftKey","newZoom","zoom","updateProjectionMatrix","vignetteCapturer","vignettes","worldDomElements","lookAt","numDone","oneMoreLoaded","mitoBaseSrc","oncanplaythrough","mitoStringsSrc","mitoDrumsSrc","footstepsSrc","buildSoundSrc","loader","blopSrc","audioBuffer","xhr","suckWaterSrc","hookUpAudio","updateAmbientAudio","attachWindowEvents","worldDomElementComponents","HUD_HUD","GameStack_GameStack","Hover_Hover","yPos","drumVolume","stringsVolume","memory","geometries","textures","programs","calls","points","triangles","yes","no","traverse","gameResult","maybeGetGameResult","getHighlightVector","_this$world$player$po","screen","project","moveAction","keysToMovement","setAction","handleLeftClick","handleRightClick","worldStep","getAction","getHighlightedTile","updateHover","mouseNorm","getCameraNormCoordinates","Boolean","debug","logRenderInfo","h","aspect","isBuildCandidate","selectedCell","roundedHighlightVector","expansionTiles","Glow","FruitInfo","GameWonScreen","GameLostScreen","GameResultsScreen","_ref4","onDone","AppStateProvider","reducerWithMiddleware","newState","hasOwnProperty","saveOnActionMiddleware","reducerTuple","useReducer","Provider","LocalForageStateProvider","_ref2$loadingComponen","loadingComponent","_load","catch","generateRectangle","newInitialAppState","AppComponent","handleMousePosition","mousePosition","handleWinLoss","handleResultsDone","otherArgsSelector","maybeRenderOverWorld","maybeRenderInGame","maybeRenderGameResult","src_overworld_OverWorldScreen","fullPageSketch_FullPageSketch","GameResultsScreen_GameResultsScreen","App","AppStateProvider_LocalForageStateProvider","App_AppComponent","hostname","match","Experiment","visitors","trials","trial","environmentTiles","_Object$entries","visitor","visit","ExperimentSuite","experiments","recordDataFor","runTests","environmentFn","suite","countAir","countSoil","countRock","countFountain","startAdjacentWaters","adjacentTiles","predicate","candidates","findBuildCandidateTiles","countWaters","timeEnd","divId","visitorNames","trace","getElementById","Plotly","newPlot","barmode","plotStackedBar","plotHistogram","layout","_loop","text","display","TestStats","script","ReactDOM","react_router_dom","react_router","path","f1","f2","f3","mockResults","tests_TestStats","exact","app_App","to","navigator","serviceWorker","ready","registration","unregister","module","exports","__webpack_require__"],"mappings":"0mBAEaA,EAAuBC,IAAMC,cAAc,CACtDC,EAAGC,OAAOC,WAAa,EACvBC,EAAGF,OAAOG,YAAc,IAOXC,MAJf,WACE,OAAOC,qBAAWT,4CCOPU,EAAgBC,YAA4B,CACvDC,GAAIC,cACJC,KAAMC,cACNC,MAAOC,YAAKA,YAAKF,gBACjBG,mBAAoBH,cACpBI,oBAAqBJ,gBAOhB,SAASK,IAAiD,IAAlCN,EAAkCO,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAA3B,iBACpC,MAAO,CACLT,GAAIY,MACJV,OAEAE,MAAO,GACPE,mBAAoB,EACpBC,oBAAqB,EACrBM,YAAa,IAXjBf,EAAcgB,MAAMD,YAAcR,YAAKU,YAAOjB,IAC9CA,EAAcgB,MAAME,OAASC,YAAUnB,GCjBhC,IAAMoB,EAAoB7B,IAAMC,cAAqC,MAErE,SAAS6B,IACd,OAAOtB,qBAAWqB,GAGb,SAASE,EAAQC,EAAiBC,GACvC,OAAQA,EAAOC,MACb,IAAK,kBACH,OAAOC,OAAAC,EAAA,EAAAD,CAAA,GACFH,GAMP,IAAK,2BACH,OA8BN,SAAsCA,EAAiBC,GACrD,IAAMI,EAAoBJ,EAAOI,kBACzBC,EAAyBD,EAAzBC,UAAWC,EAAcF,EAAdE,UAEnB,IAAKD,EAAUE,KAAKC,QAClB,OAAOT,EAET,GAAiB,MAAbO,EAAmB,CACrB,GAA4B,MAAxBA,EAAUC,KAAKE,MAEjB,OADAC,QAAQC,MAAM,8CACPZ,EAET,GAAIO,EAAUC,KAAKE,MAAMG,aAAe,EAEtC,OADAF,QAAQC,MAAM,uEACPZ,EAGTO,EAAUC,KAAKE,MAAMG,aAAe,EAGtC,OAAOV,OAAAC,EAAA,EAAAD,CAAA,GACFH,EADL,CAEEc,wBAAyBb,EAAOI,oBApDvBU,CAA6Bf,EAAOC,GAC7C,IAAK,6BACH,OAAOe,EAA+BhB,EAAOC,GAC/C,IAAK,cACH,OAuGN,SAAyBD,EAAiBC,GAGxCD,EAAMiB,UAAUC,oBAHuD,IAAAC,GAAA,EAAAC,GAAA,EAAAC,OAAA/B,EAAA,IAKvE,QAAAgC,EAAAC,EDlGK,SAASC,EAAQC,GACtB,IAAMC,EAAM,GACZA,EAAIC,KAAKF,GAF0C,IAAAG,GAAA,EAAAC,GAAA,EAAAC,OAAAxC,EAAA,IAGnD,QAAAyC,EAAAC,EAAgBP,EAAQjC,YAAxByC,OAAAC,cAAAN,GAAAG,EAAAC,EAAAG,QAAAC,MAAAR,GAAA,EAAqC,KAA1BS,EAA0BN,EAAAO,MACnCZ,EAAIC,KAAJY,MAAAb,EAAGvB,OAAAqC,EAAA,EAAArC,CAASqB,EAAQa,MAJ6B,MAAAI,GAAAZ,GAAA,EAAAC,EAAAW,EAAA,YAAAb,GAAA,MAAAI,EAAAU,QAAAV,EAAAU,SAAA,WAAAb,EAAA,MAAAC,GAMnD,OAAOJ,EC4FeF,CAAQxB,EAAM2C,aAApCV,OAAAC,cAAAf,GAAAG,EAAAC,EAAAY,QAAAC,MAAAjB,GAAA,EAAkD,KAAvCM,EAAuCH,EAAAgB,MAChDb,EAAQxC,mBAAqBwC,EAAQvC,qBANgC,MAAAuD,GAAArB,GAAA,EAAAC,EAAAoB,EAAA,YAAAtB,GAAA,MAAAI,EAAAmB,QAAAnB,EAAAmB,SAAA,WAAAtB,EAAA,MAAAC,GAQvE,OAAOlB,OAAAC,EAAA,EAAAD,CAAA,GACFH,EADL,CAEE4C,MAAO5C,EAAM4C,MAAQ,IAjHZC,CAAgB7C,GACzB,IAAK,kBACH,OAwHN,SAA6BA,EAAiBC,GAC5C,GAAqC,MAAjCD,EAAMc,wBACR,MAAM,IAAIgC,MAAM,kEAEW,QAAzB7C,EAAO8C,OAAOC,SAChBhD,EAAQgB,EAA+BhB,EAAO,CAC5CE,KAAM,6BACN+C,QAASjD,EAAMc,wBACfoC,QAASjD,EAAO8C,UAGpB,OAAO5C,OAAAC,EAAA,EAAAD,CAAA,GACFH,EADL,CAEEmD,iBAAkBlD,EAAO8C,SArIhBK,CAAoBpD,EAAOC,GACpC,IAAK,mBACH,OA2IN,SAA8BD,EAAiBC,GAC7C,OAAOE,OAAAC,EAAA,EAAAD,CAAA,GACFH,EADL,CAEEc,6BAAyBxB,EACzB6D,sBAAkB7D,IA/IT+D,CAAqBrD,IA6DlC,SAASgB,EAA+BhB,EAAiBC,GAA8C,IAAAqD,EACvCrD,EAAtDgD,eAD6F,IAAAK,EACnFtD,EAAMc,wBAD6EwC,EACnDJ,EAAYjD,EAAZiD,QAC1C5C,EAA+B2C,EAA/B3C,UAAWiD,EAAoBN,EAApBM,gBAGfC,OAAkClE,EACV,MAAxBgB,EAAUE,KAAKE,QACjB8C,EAAalD,EAAUE,KAAKE,MAAMe,SAEpCnB,EAAUE,KAAKE,MAAQ,CACrBe,QAAS8B,EACTE,uBAAwBP,EAAQO,uBAChC5C,aAAc,GAEhB0C,EAAgBrE,oBAAsBc,EAAMiB,UAAUyC,eAAeH,GACjEC,IAEFA,EAAWtE,oBAAsBc,EAAMiB,UAAUyC,eAAeF,IAjBmC,IAAA5B,GAAA,EAAAC,GAAA,EAAAC,OAAAxC,EAAA,IAqBrG,QAAAyC,EAAAC,EAAgBhC,EAAMiB,UAAU0C,aAAarD,GAA7C2B,OAAAC,cAAAN,GAAAG,EAAAC,EAAAG,QAAAC,MAAAR,GAAA,EAAyD,CAAAG,EAAAO,MACrD9B,KAAKC,SAAU,GAtBkF,MAAAgC,GAAAZ,GAAA,EAAAC,EAAAW,EAAA,YAAAb,GAAA,MAAAI,EAAAU,QAAAV,EAAAU,SAAA,WAAAb,EAAA,MAAAC,GA+BrG,OAAO3B,OAAAC,EAAA,EAAAD,CAAA,GAAKH,uBC1GR4D,oBACJ,SAAAA,EAAmB1F,EAAkBG,EAAkBwF,GAAY1D,OAAA2D,EAAA,EAAA3D,CAAA4D,KAAAH,GAAAG,KAAA7F,IAAA6F,KAAA1F,IAAA0F,KAAAF,qDAE9D3F,EAAWG,GACd,OAAO0F,KAAK7F,EAAIA,EAAI6F,KAAK1F,EAAIA,+BAG1BH,EAAWG,EAAWwF,GACzB,OAAOE,KAAK7F,EAAIA,EAAI6F,KAAK1F,EAAIA,EAAI0F,KAAKF,EAAIA,YAIxCG,EAAQ,CACZ,IAAIJ,EAAK,EAAG,EAAG,GACf,IAAIA,GAAM,EAAG,EAAG,GAChB,IAAIA,EAAK,GAAI,EAAG,GAChB,IAAIA,GAAM,GAAI,EAAG,GACjB,IAAIA,EAAK,EAAG,EAAG,GACf,IAAIA,GAAM,EAAG,EAAG,GAChB,IAAIA,EAAK,EAAG,GAAI,GAChB,IAAIA,GAAM,EAAG,GAAI,GACjB,IAAIA,EAAK,EAAG,EAAG,GACf,IAAIA,EAAK,GAAI,EAAG,GAChB,IAAIA,EAAK,EAAG,GAAI,GAChB,IAAIA,EAAK,GAAI,GAAI,IAGbK,EAAI,CACR,IACA,IACA,IACA,GACA,GACA,GACA,IACA,GACA,IACA,GACA,GACA,GACA,IACA,IACA,EACA,IACA,IACA,GACA,IACA,GACA,GACA,IACA,EACA,GACA,GACA,IACA,GACA,GACA,GACA,IACA,EACA,IACA,IACA,IACA,IACA,GACA,EACA,GACA,IACA,GACA,GACA,IACA,IACA,IACA,IACA,GACA,GACA,GACA,GACA,IACA,GACA,GACA,IACA,IACA,GACA,GACA,IACA,GACA,IACA,IACA,IACA,IACA,GACA,IACA,GACA,IACA,GACA,IACA,IACA,GACA,GACA,IACA,GACA,IACA,IACA,IACA,GACA,IACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,IACA,GACA,GACA,GACA,GACA,IACA,GACA,IACA,IACA,IACA,GACA,GACA,GACA,GACA,IACA,EACA,IACA,GACA,GACA,IACA,GACA,IACA,IACA,IACA,GACA,GACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,IACA,IACA,EACA,GACA,GACA,IACA,IACA,IACA,IACA,IACA,EACA,IACA,GACA,IACA,IACA,IACA,IACA,GACA,GACA,IACA,IACA,IACA,GACA,IACA,GACA,GACA,GACA,GACA,IACA,IACA,GACA,GACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,EACA,GACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,IACA,GACA,IACA,EACA,IACA,GACA,GACA,IACA,GACA,GACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,GACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,GACA,GACA,IACA,IACA,IACA,GACA,IACA,IACA,GACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,GACA,GACA,IACA,EACA,IACA,IA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,KAAW,SAAU12B,EAAMy2B,UAAWz2B,EAAM22B,OAAS,YAChF32B,EAAM42B,UCRE,IAAAC,GAAA,CACb,iBACA,QACA,kBACA,oBACA,kBACA,oBACA,eACA,eACA,oBACA,eACA,oBACA,oBACA,gBACA,mBACA,sBACA,wBACA,kBACA,uBACA,iBACA,iBACA,WACA,eACA,iBACA,yBACA,qBACA,qBACA,yBACA,eACA,yBACA,yBACA,yBACA,qBACA,eACA,yBACA,SACA,qBACA,YACA,WACA,YACA,eACA,kBACA,oBACA,gBACA,gBACA,qBACA,SACA,eACA,eACA,oBACA,oBACA,eACA,iBACA,iBACA,wBACA,eACA,oBACA,eACA,eACA,eACA,oBACA,eACA,eACA,eACA,iBACA,oBACA,iBACA,wBACA,oBACA,oBACA,oBACA,oBACA,oBACA,oBACA,WACA,0BACA,oBACA,kBACA,QACA,sBACA,qBACA,iBACA,sBACA,iBACA,qBACA,kBACA,oBACA,uBACA,kBACA,0BACA,4BACA,mBACA,mBACA,QACA,iBACA,eACA,QACA,iBACA,iBACA,sBACA,mBACA,iBACA,kBACA,kBACA,oBACA,mBACA,gBACA,oBACA,qBACA,oBACA,wBACA,wBACA,wBACA,aACA,wBACA,oBACA,qBACA,uBACA,gBACA,gBACA,0BACA,iBACA,2BACA,oBACA,mBACA,SACA,kBACA,kBACA,kBACA,kBACA,eACA,kBACA,kBACA,qBACA,2BACA,KACA,2BACA,mBACA,uBACA,SACA,oBACA,wBACA,qBACA,oBACA,oBACA,sBACA,oBACA,sBACA,oBACA,sBACA,oBACA,oBACA,gBACA,gBACA,iBACA,iBACA,YACA,4BACA,kBACA,oBACA,yBACA,yBACA,kBACA,oBACA,YACA,qBACA,iBACA,iBACA,iBACA,iBACA,oBACA,oBACA,iBACA,oBACA,iBACA,oBACA,iBACA,wBACA,gBACA,wBACA,kBACA,kBACA,SACA,sBACA,mBACA,mBACA,kBACA,sBACA,sBACA,gBACA,iBACA,iBACA,mBACA,SACA,iBACA,iBACA,iBACA,eACA,eACA,mBACA,mBACA,gBACA,gBACA,kBACA,iBACA,mBACA,sBACA,qBACA,mBACA,eACA,cACA,uBACA,kBACA,WACA,kBACA,kBACA,kBACA,aACA,mBACA,YACA,cACA,oBACA,qBACA,oBACA,oBACA,oBACA,qBACA,uBACA,6BACA,sBACA,yBACA,qBACA,cACA,qBACA,sBACA,oBACA,uBACA,oBACA,QACA,eACA,sBACA,iBACA,oBACA,qBACA,qBACA,oBACA,cACA,uBACA,cACA,mBACA,qBACA,qBACA,sBACA,sBACA,sBACA,sBACA,sBACA,sBACA,oBACA,WACA,sBACA,kBACA,uBACA,oBACA,QACA,iBACA,iBACA,iBACA,mBACA,oBACA,yBACA,oBACA,0BACA,oBACA,iBACA,mBACA,aACA,kBACA,kBACA,kBACA,iBACA,iBACA,kBACA,kBACA,iBACA,kBACA,WACA,kBACA,sBACA,iBACA,oBACA,0BACA,OACA,eACA,oBACA,kBACA,cACA,eACA,eACA,oBACA,gBACA,mBACA,iBACA,YACA,mBACA,wBACA,uBACA,sBACA,kBACA,sBACA,aACA,mBACA,qBACA,qBACA,cACA,uBACA,uBACA,mBACA,kBACA,SACA,qBACA,qBACA,sBACA,mBACA,kBACA,sBACA,yBACA,qBACA,mBACA,gBACA,kBACA,sBACA,eACA,mBACA,sBACA,gBACA,qBACA,oBACA,sBACA,iBACA,kBACA,qBACA,YACA,SACA,mBACA,qBACA,cACA,sBACA,eACA,uBACA,sBACA,OACA,eACA,cACA,mBACA,eACA,eACA,qBACA,eACA,mBACA,mBACA,mBACA,mBACA,qBACA,iBACA,gBACA,kBACA,mBACA,mBACA,mBACA,WACA,sBACA,qBACA,uBACA,YACA,oBACA,0BACA,oBACA,yBACA,qBACA,sBACA,sBACA,yBACA,qBACA,oBACA,qBACA,iBACA,iBACA,qBACA,sBACA,eACA,QACA,cACA,aACA,qBACA,2BACA,gBACA,sBACA,sBACA,sBACA,aACA,uBACA,qBACA,oBACA,iBACA,qBACA,oBACA,iBACA,iBACA,oBACA,oBACA,oBACA,mBACA,qBACA,uBACA,UACA,oBACA,qBACA,gBACA,mBACA,mBACA,gBACA,sBACA,qBACA,gBACA,gBACA,oBACA,gBACA,mBACA,mBACA,qBACA,kBACA,mBACA,gBACA,mBACA,oBACA,kBACA,oBACA,kBACA,eACA,mBACA,SACA,mBACA,iBACA,mBACA,mBACA,mBACA,mBACA,qBACA,mBACA,QACA,SACA,gBACA,mBACA,gBACA,oBACA,oBACA,oBACA,qBACA,wBACA,mBACA,uBACA,WACA,iBACA,iBACA,iBACA,iBACA,iBACA,iBACA,qBACA,uBACA,yBACA,oBACA,oBACA,uBACA,kBACA,uBACA,uBACA,wBACA,wBACA,kBACA,qBACA,UACA,eACA,eACA,mBACA,gBACA,wBACA,mBACA,sBACA,WACA,0BACA,mBACA,mBACA,UACA,mBACA,sBACA,oBACA,oBACA,oBACA,gBACA,QACA,qBACA,qBACA,gBACA,SACA,sBACA,uBACA,uBACA,sBACA,iBACA,eACA,mBACA,iBACA,sBACA,sBACA,oBACA,oBACA,oBACA,OACA,kBACA,kBACA,kBACA,kBACA,kBACA,kBACA,kBACA,uBACA,wBACA,qBACA,oBACA,uBACA,qBACA,kBACA,iBACA,cACA,sBACA,sBACA,yBACA,yBACA,yBACA,2BACA,oBACA,sBACA,oBACA,wBACA,oBACA,YACA,SACA,oBACA,oBACA,yBACA,oBACA,gBACA,0BACA,oBACA,0BACA,gBACA,qBACA,oBACA,oBACA,oBACA,yBACA,uBACA,uBACA,qBACA,oBACA,kBACA,kBACA,oBACA,WACA,oBACA,wBACA,kBACA,uBACA,oBACA,oBACA,0BACA,oBACA,cACA,qBACA,sBACA,uBACA,uBACA,0BACA,oBACA,kBACA,kBACA,kBACA,mBACA,kBACA,kBACA,mBACA,kBACA,kBACA,oBACA,oBACA,iBACA,kBACA,kBACA,gBACA,kBACA,gBACA,gBACA,mBACA,mBACA,kBACA,SACA,kBACA,kBACA,YACA,wBACA,wBACA,wBACA,qBACA,oBACA,gBACA,oBACA,sBACA,sBACA,mBACA,WACA,qBACA,kBACA,0BACA,wBACA,UACA,0BACA,kBACA,WACA,uBACA,0BACA,QACA,cACA,sBACA,sBACA,yBACA,oBACA,uBACA,sBACA,sBACA,uBACA,SACA,iBACA,iBACA,iBACA,qBACA,sBACA,oBACA,YACA,qBACA,uBACA,sBACA,oBACA,oBACA,uBACA,oBACA,uBACA,sBACA,sBACA,sBACA,QACA,eACA,mBACA,gBACA,gBACA,qBACA,uBACA,oBACA,oBACA,cACA,oBACA,oBACA,iBACA,sBACA,mBACA,0BACA,yBACA,oBACA,WACA,uBACA,yBACA,oBACA,qBACA,qBACA,mBACA,mBACA,qBACA,YACA,uBACA,2BACA,oBC5qBaC,GAJa,WAC1B,OxBa6BxuB,EwBbVyuB,IxBcVryB,KAAKiB,MAAMjB,KAAKM,SAAWsD,EAAE1I,SADjC,IAAwB0I,sCyBLhB0uB,OALf,SAAmBh3B,GAAsF,IAC/FoqB,EAAwBpqB,EAAxBoqB,KAAS6M,EADsFv2B,OAAAw2B,GAAA,EAAAx2B,CACvEV,EADuE,UAEvG,OAAOw2B,EAAAluB,EAAA6M,cAAA,MAAAzU,OAAA4L,OAAA,CAAKmqB,UAAWC,KAAW,YAAatM,GAAO+M,IAAI,GAAGniB,IAAKoiB,MAAkBH,cCqChFI,GAAS,gEA5CLC,SAAW,OAEXC,QAA0C,QAE1CC,MAAQ,OAMhBC,WAAa,SAACzb,GACZnC,EAAK2d,MAAQxb,EACb,IAAM0b,EAAqB,GAC3B,IAAK,IAAMx4B,KAAM2a,EAAK0d,QAAS,EAGR,KADAhV,EADX1I,EAAK0d,QAAQr4B,IACA8c,IAErB0b,EAASx1B,KAAKy1B,OAAOz4B,IAGzB,QAAAuN,EAAA,EAAAmrB,EAAiBF,EAAjBjrB,EAAAmrB,EAAAh4B,OAAA6M,IAA2B,CAAtB,IAAMvN,EAAE04B,EAAAnrB,GACXoN,EAAKge,gBAAgB34B,GAEvB44B,sBAAsBje,EAAK4d,sEAMTllB,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","file":"static/js/main.403a13ae.chunk.js","sourcesContent":["import React, { useContext } from \"react\";\n\nexport const MousePositionContext = React.createContext({\n  x: window.innerWidth / 2,\n  y: window.innerHeight / 2,\n});\n\nfunction useMousePosition() {\n  return useContext(MousePositionContext);\n}\n\nexport default useMousePosition;\n","import { createSimpleSchema, identifier, list, object, primitive, reference } from \"serializr\";\nimport uuid from \"uuid\";\nimport { Gene } from \"./gene\";\n\nexport interface Species {\n  id: string;\n  name: string;\n  genes: Gene[];\n  // cells: Cell[];\n  freeMutationPoints: number;\n  totalMutationPoints: number;\n  descendants: Species[];\n  parent?: Species;\n}\n\nexport const SpeciesSchema = createSimpleSchema<Species>({\n  id: identifier(),\n  name: primitive(),\n  genes: list(list(primitive())),\n  freeMutationPoints: primitive(),\n  totalMutationPoints: primitive(),\n  // descendants: reference(SpeciesSchema),\n  // parent: reference(SpeciesSchema),\n});\nSpeciesSchema.props.descendants = list(object(SpeciesSchema));\nSpeciesSchema.props.parent = reference(SpeciesSchema);\n\nexport function newBaseSpecies(name = \"newBaseSpecies\"): Species {\n  return {\n    id: uuid(),\n    name,\n    // genes: [mutateRandomNewGene(), mutateRandomNewGene(), mutateRandomNewGene()],\n    genes: [],\n    freeMutationPoints: 0,\n    totalMutationPoints: 0,\n    descendants: [],\n  };\n}\n\nexport function lineage(species: Species): Species[] {\n  const arr = [];\n  arr.push(species);\n  for (const s of species.descendants) {\n    arr.push(...lineage(s));\n  }\n  return arr;\n}\n\nexport interface Cell {\n  genes: Gene[];\n}\n","import { lineage, Species } from \"evolution/species\";\nimport { HexTile } from \"overworld/hexTile\";\nimport React, { useContext } from \"react\";\nimport { GameResult } from \"sketches/mito\";\nimport { AppState, PopulationAttempt } from \"./state\";\n\ntype AppReducerContextType = [AppState, React.Dispatch<AppActions>];\n\nexport const AppReducerContext = React.createContext<AppReducerContextType>(null!);\n\nexport function useAppReducer(): AppReducerContextType {\n  return useContext(AppReducerContext);\n}\n\nexport function reducer(state: AppState, action: AppActions): AppState {\n  switch (action.type) {\n    case \"AAUpdateSpecies\":\n      return {\n        ...state,\n        // species: {\n        //   ...state.species,\n        //   [action.species.id]: action.species,\n        // },\n      };\n    case \"AAStartPopulationAttempt\":\n      return handleStartPopulationAttempt(state, action);\n    case \"AAPopulationAttemptSuccess\":\n      return handlePopulationAttemptSuccess(state, action);\n    case \"AANextEpoch\":\n      return handleNextEpoch(state, action);\n    case \"AAGetGameResult\":\n      return handleGetGameResult(state, action);\n    case \"AAGameResultDone\":\n      return handleGameResultDone(state, action);\n  }\n}\n\nexport type AppActions =\n  | AAUpdateSpecies\n  | AAStartPopulationAttempt\n  | AAPopulationAttemptSuccess\n  | AANextEpoch\n  | AAGetGameResult\n  | AAGameResultDone;\n\nexport interface AAUpdateSpecies {\n  type: \"AAUpdateSpecies\";\n  species: Species;\n}\n\nexport interface AAStartPopulationAttempt {\n  type: \"AAStartPopulationAttempt\";\n  populationAttempt: PopulationAttempt;\n}\n\nfunction handleStartPopulationAttempt(state: AppState, action: AAStartPopulationAttempt): AppState {\n  const populationAttempt = action.populationAttempt;\n  const { targetHex, sourceHex } = populationAttempt;\n\n  if (!targetHex.info.visible) {\n    return state;\n  }\n  if (sourceHex != null) {\n    if (sourceHex.info.flora == null) {\n      console.error(\"sourceHex isn't null but the flora is null\");\n      return state;\n    }\n    if (sourceHex.info.flora.actionPoints < 1) {\n      console.error(\"tried population attempt with a source hex that has no action point\");\n      return state;\n    }\n    // remove the action point\n    sourceHex.info.flora.actionPoints = 0;\n  }\n\n  return {\n    ...state,\n    activePopulationAttempt: action.populationAttempt,\n  };\n}\n\nexport interface AAFinishLevel {\n  type: \"AAFinishLevel\";\n  level: HexTile;\n  species: Species;\n  result: GameResult;\n}\n\nexport interface AAPopulationAttemptSuccess {\n  type: \"AAPopulationAttemptSuccess\";\n  attempt?: PopulationAttempt;\n  results: GameResult;\n}\n\nfunction handlePopulationAttemptSuccess(state: AppState, action: AAPopulationAttemptSuccess): AppState {\n  const { attempt = state.activePopulationAttempt!, results } = action;\n  const { targetHex, settlingSpecies } = attempt;\n\n  // populate target hex\n  let oldSpecies: Species | undefined = undefined;\n  if (targetHex.info.flora != null) {\n    oldSpecies = targetHex.info.flora.species;\n  }\n  targetHex.info.flora = {\n    species: settlingSpecies,\n    mutationPointsPerEpoch: results.mutationPointsPerEpoch,\n    actionPoints: 0,\n  };\n  settlingSpecies.totalMutationPoints = state.overWorld.getMaxGenePool(settlingSpecies);\n  if (oldSpecies) {\n    // update old species mutation point pool cache\n    oldSpecies.totalMutationPoints = state.overWorld.getMaxGenePool(oldSpecies);\n  }\n\n  // bump visibility\n  for (const n of state.overWorld.hexNeighbors(targetHex)) {\n    n.info.visible = true;\n  }\n\n  // things we changed:\n  // sourceHex\n  // targetHex\n  // oldSpecies\n  // settlingSpecies\n  // targetHex.neighbors\n  return { ...state };\n}\n\nexport interface AANextEpoch {\n  type: \"AANextEpoch\";\n}\n\nfunction handleNextEpoch(state: AppState, action: AANextEpoch): AppState {\n  // +1 epoch:\n  // reset action points of all habited tiles to 1\n  state.overWorld.resetActionPoints();\n  // reset all species pools to max\n  for (const species of lineage(state.rootSpecies)) {\n    species.freeMutationPoints = species.totalMutationPoints;\n  }\n  return {\n    ...state,\n    epoch: state.epoch + 1,\n  };\n}\n\nexport interface AAGetGameResult {\n  type: \"AAGetGameResult\";\n  result: GameResult;\n}\n\nfunction handleGetGameResult(state: AppState, action: AAGetGameResult): AppState {\n  if (state.activePopulationAttempt == null) {\n    throw new Error(\"activePopulationAttempt shouldn't be null during handleWinLoss\");\n  }\n  if (action.result.status === \"won\") {\n    state = handlePopulationAttemptSuccess(state, {\n      type: \"AAPopulationAttemptSuccess\",\n      attempt: state.activePopulationAttempt,\n      results: action.result,\n    });\n  }\n  return {\n    ...state,\n    activeGameResult: action.result,\n  };\n}\n\nexport interface AAGameResultDone {\n  type: \"AAGameResultDone\";\n}\n\nfunction handleGameResultDone(state: AppState, action: AAGameResultDone): AppState {\n  return {\n    ...state,\n    activePopulationAttempt: undefined,\n    activeGameResult: undefined,\n  };\n}\n","// copy-pasted from https://raw.githubusercontent.com/josephg/noisejs/master/perlin.js\n// tslint:disable\n\n/*\n * A speed-improved perlin and simplex noise algorithms for 2D.\n *\n * Based on example code by Stefan Gustavson (stegu@itn.liu.se).\n * Optimisations by Peter Eastman (peastman@drizzle.stanford.edu).\n * Better rank ordering method by Stefan Gustavson in 2012.\n * Converted to Javascript by Joseph Gentle.\n *\n * Version 2012-03-09\n *\n * This code was placed in the public domain by its original author,\n * Stefan Gustavson. You may use it as you see fit, but\n * attribution is appreciated.\n *\n */\n\nclass Grad {\n  constructor(public x: number, public y: number, public z: number) {}\n\n  dot2(x: number, y: number) {\n    return this.x * x + this.y * y;\n  }\n\n  dot3(x: number, y: number, z: number) {\n    return this.x * x + this.y * y + this.z * z;\n  }\n}\n\nconst grad3 = [\n  new Grad(1, 1, 0),\n  new Grad(-1, 1, 0),\n  new Grad(1, -1, 0),\n  new Grad(-1, -1, 0),\n  new Grad(1, 0, 1),\n  new Grad(-1, 0, 1),\n  new Grad(1, 0, -1),\n  new Grad(-1, 0, -1),\n  new Grad(0, 1, 1),\n  new Grad(0, -1, 1),\n  new Grad(0, 1, -1),\n  new Grad(0, -1, -1),\n];\n\nconst p = [\n  151,\n  160,\n  137,\n  91,\n  90,\n  15,\n  131,\n  13,\n  201,\n  95,\n  96,\n  53,\n  194,\n  233,\n  7,\n  225,\n  140,\n  36,\n  103,\n  30,\n  69,\n  142,\n  8,\n  99,\n  37,\n  240,\n  21,\n  10,\n  23,\n  190,\n  6,\n  148,\n  247,\n  120,\n  234,\n  75,\n  0,\n  26,\n  197,\n  62,\n  94,\n  252,\n  219,\n  203,\n  117,\n  35,\n  11,\n  32,\n  57,\n  177,\n  33,\n  88,\n  237,\n  149,\n  56,\n  87,\n  174,\n  20,\n  125,\n  136,\n  171,\n  168,\n  68,\n  175,\n  74,\n  165,\n  71,\n  134,\n  139,\n  48,\n  27,\n  166,\n  77,\n  146,\n  158,\n  231,\n  83,\n  111,\n  229,\n  122,\n  60,\n  211,\n  133,\n  230,\n  220,\n  105,\n  92,\n  41,\n  55,\n  46,\n  245,\n  40,\n  244,\n  102,\n  143,\n  54,\n  65,\n  25,\n  63,\n  161,\n  1,\n  216,\n  80,\n  73,\n  209,\n  76,\n  132,\n  187,\n  208,\n  89,\n  18,\n  169,\n  200,\n  196,\n  135,\n  130,\n  116,\n  188,\n  159,\n  86,\n  164,\n  100,\n  109,\n  198,\n  173,\n  186,\n  3,\n  64,\n  52,\n  217,\n  226,\n  250,\n  124,\n  123,\n  5,\n  202,\n  38,\n  147,\n  118,\n  126,\n  255,\n  82,\n  85,\n  212,\n  207,\n  206,\n  59,\n  227,\n  47,\n  16,\n  58,\n  17,\n  182,\n  189,\n  28,\n  42,\n  223,\n  183,\n  170,\n  213,\n  119,\n  248,\n  152,\n  2,\n  44,\n  154,\n  163,\n  70,\n  221,\n  153,\n  101,\n  155,\n  167,\n  43,\n  172,\n  9,\n  129,\n  22,\n  39,\n  253,\n  19,\n  98,\n  108,\n  110,\n  79,\n  113,\n  224,\n  232,\n  178,\n  185,\n  112,\n  104,\n  218,\n  246,\n  97,\n  228,\n  251,\n  34,\n  242,\n  193,\n  238,\n  210,\n  144,\n  12,\n  191,\n  179,\n  162,\n  241,\n  81,\n  51,\n  145,\n  235,\n  249,\n  14,\n  239,\n  107,\n  49,\n  192,\n  214,\n  31,\n  181,\n  199,\n  106,\n  157,\n  184,\n  84,\n  204,\n  176,\n  115,\n  121,\n  50,\n  45,\n  127,\n  4,\n  150,\n  254,\n  138,\n  236,\n  205,\n  93,\n  222,\n  114,\n  67,\n  29,\n  24,\n  72,\n  243,\n  141,\n  128,\n  195,\n  78,\n  66,\n  215,\n  61,\n  156,\n  180,\n];\n\n/*\nfor(const i=0; i<256; i++) {\nperm[i] = perm[i + 256] = p[i];\ngradP[i] = gradP[i + 256] = grad3[perm[i] % 12];\n}*/\n\n// Skewing and unskewing factors for 2, 3, and 4 dimensions\nconst F2 = 0.5 * (Math.sqrt(3) - 1);\nconst G2 = (3 - Math.sqrt(3)) / 6;\n\nconst F3 = 1 / 3;\nconst G3 = 1 / 6;\n\nexport class Noise {\n  // To remove the need for index wrapping, double the permutation table length\n  public perm = new Array(512);\n  public gradP = new Array(512);\n\n  public octaveNum = 6;\n  public octaveFalloff = 0.5;\n  // rotate by 1 radians (~57 deg), scale by 2\n  public octaveMatrix2 = [Math.cos(1) * 2, -Math.sin(1) * 2, Math.sin(1) * 2, Math.cos(1) * 2];\n\n  // This isn't a very good seeding function, but it works ok. It supports 2^16\n  // different seed values. Write something better if you need more seeds.\n  public seed(seed: number) {\n    if (seed > 0 && seed < 1) {\n      // Scale the seed out\n      seed *= 65536;\n    }\n\n    seed = Math.floor(seed);\n    if (seed < 256) {\n      seed |= seed << 8;\n    }\n\n    for (let i = 0; i < 256; i++) {\n      let v;\n      if (i & 1) {\n        v = p[i] ^ (seed & 255);\n      } else {\n        v = p[i] ^ ((seed >> 8) & 255);\n      }\n\n      this.perm[i] = this.perm[i + 256] = v;\n      this.gradP[i] = this.gradP[i + 256] = grad3[v % 12];\n    }\n  }\n\n  constructor(seed: number = Math.random() * 2147483647) {\n    this.seed(seed);\n  }\n\n  // 2D simplex noise\n  public simplex2(xin: number, yin: number) {\n    let n0, n1, n2; // Noise contributions from the three corners\n    // Skew the input space to determine which simplex cell we're in\n    const s = (xin + yin) * F2; // Hairy factor for 2D\n    let i = Math.floor(xin + s);\n    let j = Math.floor(yin + s);\n    const t = (i + j) * G2;\n    let x0 = xin - i + t; // The x,y distances from the cell origin, unskewed.\n    let y0 = yin - j + t;\n    // For the 2D case, the simplex shape is an equilateral triangle.\n    // Determine which simplex we are in.\n    let i1, j1; // Offsets for second (middle) corner of simplex in (i,j) coords\n    if (x0 > y0) {\n      // lower triangle, XY order: (0,0)->(1,0)->(1,1)\n      i1 = 1;\n      j1 = 0;\n    } else {\n      // upper triangle, YX order: (0,0)->(0,1)->(1,1)\n      i1 = 0;\n      j1 = 1;\n    }\n    // A step of (1,0) in (i,j) means a step of (1-c,-c) in (x,y), and\n    // a step of (0,1) in (i,j) means a step of (-c,1-c) in (x,y), where\n    // c = (3-sqrt(3))/6\n    const x1 = x0 - i1 + G2; // Offsets for middle corner in (x,y) unskewed coords\n    const y1 = y0 - j1 + G2;\n    const x2 = x0 - 1 + 2 * G2; // Offsets for last corner in (x,y) unskewed coords\n    const y2 = y0 - 1 + 2 * G2;\n    // Work out the hashed gradient indices of the three simplex corners\n    i &= 255;\n    j &= 255;\n    const gi0 = this.gradP[i + this.perm[j]];\n    const gi1 = this.gradP[i + i1 + this.perm[j + j1]];\n    const gi2 = this.gradP[i + 1 + this.perm[j + 1]];\n    // Calculate the contribution from the three corners\n    let t0 = 0.5 - x0 * x0 - y0 * y0;\n    if (t0 < 0) {\n      n0 = 0;\n    } else {\n      t0 *= t0;\n      n0 = t0 * t0 * gi0.dot2(x0, y0); // (x,y) of grad3 used for 2D gradient\n    }\n    let t1 = 0.5 - x1 * x1 - y1 * y1;\n    if (t1 < 0) {\n      n1 = 0;\n    } else {\n      t1 *= t1;\n      n1 = t1 * t1 * gi1.dot2(x1, y1);\n    }\n    let t2 = 0.5 - x2 * x2 - y2 * y2;\n    if (t2 < 0) {\n      n2 = 0;\n    } else {\n      t2 *= t2;\n      n2 = t2 * t2 * gi2.dot2(x2, y2);\n    }\n    // Add contributions from each corner to get the final noise value.\n    // The result is scaled to return values in the interval [-1,1].\n    return 70 * (n0 + n1 + n2);\n  }\n\n  public octaveSimplex2(xin: number, yin: number, octaveNum = this.octaveNum, octaveFalloff = this.octaveFalloff) {\n    let sum = 0;\n    let x = xin;\n    let y = yin;\n    let scalar = 1;\n    for (let i = 0; i < octaveNum; i++) {\n      sum += this.simplex2(x, y) * scalar;\n      const newX = x * this.octaveMatrix2[0] + y * this.octaveMatrix2[1];\n      const newY = x * this.octaveMatrix2[2] + y * this.octaveMatrix2[3];\n      x = newX;\n      y = newY;\n      scalar *= octaveFalloff;\n    }\n    return sum;\n  }\n\n  // 3D simplex noise\n  public simplex3(xin: number, yin: number, zin: number) {\n    let n0, n1, n2, n3; // Noise contributions from the four corners\n\n    // Skew the input space to determine which simplex cell we're in\n    const s = (xin + yin + zin) * F3; // Hairy factor for 2D\n    let i = Math.floor(xin + s);\n    let j = Math.floor(yin + s);\n    let k = Math.floor(zin + s);\n\n    const t = (i + j + k) * G3;\n    const x0 = xin - i + t; // The x,y distances from the cell origin, unskewed.\n    const y0 = yin - j + t;\n    const z0 = zin - k + t;\n\n    // For the 3D case, the simplex shape is a slightly irregular tetrahedron.\n    // Determine which simplex we are in.\n    let i1, j1, k1; // Offsets for second corner of simplex in (i,j,k) coords\n    let i2, j2, k2; // Offsets for third corner of simplex in (i,j,k) coords\n    if (x0 >= y0) {\n      if (y0 >= z0) {\n        i1 = 1;\n        j1 = 0;\n        k1 = 0;\n        i2 = 1;\n        j2 = 1;\n        k2 = 0;\n      } else if (x0 >= z0) {\n        i1 = 1;\n        j1 = 0;\n        k1 = 0;\n        i2 = 1;\n        j2 = 0;\n        k2 = 1;\n      } else {\n        i1 = 0;\n        j1 = 0;\n        k1 = 1;\n        i2 = 1;\n        j2 = 0;\n        k2 = 1;\n      }\n    } else {\n      if (y0 < z0) {\n        i1 = 0;\n        j1 = 0;\n        k1 = 1;\n        i2 = 0;\n        j2 = 1;\n        k2 = 1;\n      } else if (x0 < z0) {\n        i1 = 0;\n        j1 = 1;\n        k1 = 0;\n        i2 = 0;\n        j2 = 1;\n        k2 = 1;\n      } else {\n        i1 = 0;\n        j1 = 1;\n        k1 = 0;\n        i2 = 1;\n        j2 = 1;\n        k2 = 0;\n      }\n    }\n    // A step of (1,0,0) in (i,j,k) means a step of (1-c,-c,-c) in (x,y,z),\n    // a step of (0,1,0) in (i,j,k) means a step of (-c,1-c,-c) in (x,y,z), and\n    // a step of (0,0,1) in (i,j,k) means a step of (-c,-c,1-c) in (x,y,z), where\n    // c = 1/6.\n    const x1 = x0 - i1 + G3; // Offsets for second corner\n    const y1 = y0 - j1 + G3;\n    const z1 = z0 - k1 + G3;\n\n    let x2 = x0 - i2 + 2 * G3; // Offsets for third corner\n    let y2 = y0 - j2 + 2 * G3;\n    let z2 = z0 - k2 + 2 * G3;\n\n    let x3 = x0 - 1 + 3 * G3; // Offsets for fourth corner\n    let y3 = y0 - 1 + 3 * G3;\n    let z3 = z0 - 1 + 3 * G3;\n\n    // Work out the hashed gradient indices of the four simplex corners\n    i &= 255;\n    j &= 255;\n    k &= 255;\n    const { gradP, perm } = this;\n    let gi0 = gradP[i + perm[j + perm[k]]];\n    let gi1 = gradP[i + i1 + perm[j + j1 + perm[k + k1]]];\n    let gi2 = gradP[i + i2 + perm[j + j2 + perm[k + k2]]];\n    let gi3 = gradP[i + 1 + perm[j + 1 + perm[k + 1]]];\n\n    // Calculate the contribution from the four corners\n    let t0 = 0.6 - x0 * x0 - y0 * y0 - z0 * z0;\n    if (t0 < 0) {\n      n0 = 0;\n    } else {\n      t0 *= t0;\n      n0 = t0 * t0 * gi0.dot3(x0, y0, z0); // (x,y) of grad3 used for 2D gradient\n    }\n    let t1 = 0.6 - x1 * x1 - y1 * y1 - z1 * z1;\n    if (t1 < 0) {\n      n1 = 0;\n    } else {\n      t1 *= t1;\n      n1 = t1 * t1 * gi1.dot3(x1, y1, z1);\n    }\n    let t2 = 0.6 - x2 * x2 - y2 * y2 - z2 * z2;\n    if (t2 < 0) {\n      n2 = 0;\n    } else {\n      t2 *= t2;\n      n2 = t2 * t2 * gi2.dot3(x2, y2, z2);\n    }\n    let t3 = 0.6 - x3 * x3 - y3 * y3 - z3 * z3;\n    if (t3 < 0) {\n      n3 = 0;\n    } else {\n      t3 *= t3;\n      n3 = t3 * t3 * gi3.dot3(x3, y3, z3);\n    }\n    // Add contributions from each corner to get the final noise value.\n    // The result is scaled to return values in the interval [-1,1].\n    return 32 * (n0 + n1 + n2 + n3);\n  }\n\n  public octaveSimplex3(\n    xin: number,\n    yin: number,\n    zin: number,\n    octaveNum = this.octaveNum,\n    octaveFalloff = this.octaveFalloff\n  ) {\n    let sum = 0;\n    let x = xin;\n    let y = yin;\n    let z = zin;\n    let scalar = 1;\n    for (let i = 0; i < octaveNum; i++) {\n      sum += this.simplex3(x, y, z) * scalar;\n      x *= 2;\n      y *= 2;\n      z *= 2;\n      scalar *= octaveFalloff;\n    }\n    return sum;\n  }\n\n  // ##### Perlin noise stuff\n\n  public fade(t: number) {\n    return t * t * t * (t * (t * 6 - 15) + 10);\n  }\n\n  public lerp(a: number, b: number, t: number) {\n    return (1 - t) * a + t * b;\n  }\n\n  // 2D Perlin Noise\n  public perlin2(x: number, y: number) {\n    // Find unit grid cell containing point\n    let X = Math.floor(x),\n      Y = Math.floor(y);\n    // Get relative xy coordinates of point within that cell\n    x = x - X;\n    y = y - Y;\n    // Wrap the integer cells at 255 (smaller integer period can be introduced here)\n    X = X & 255;\n    Y = Y & 255;\n\n    const { gradP, perm } = this;\n    // Calculate noise contributions from each of the four corners\n    let n00 = gradP[X + perm[Y]].dot2(x, y);\n    let n01 = gradP[X + perm[Y + 1]].dot2(x, y - 1);\n    let n10 = gradP[X + 1 + perm[Y]].dot2(x - 1, y);\n    let n11 = gradP[X + 1 + perm[Y + 1]].dot2(x - 1, y - 1);\n\n    // Compute the fade curve value for x\n    let u = this.fade(x);\n\n    // Interpolate the four results\n    return this.lerp(this.lerp(n00, n10, u), this.lerp(n01, n11, u), this.fade(y));\n  }\n\n  // 3D Perlin Noise\n  public perlin3(x: number, y: number, z: number) {\n    const { gradP, perm } = this;\n    // Find unit grid cell containing point\n    let X = Math.floor(x),\n      Y = Math.floor(y),\n      Z = Math.floor(z);\n    // Get relative xyz coordinates of point within that cell\n    x = x - X;\n    y = y - Y;\n    z = z - Z;\n    // Wrap the integer cells at 255 (smaller integer period can be introduced here)\n    X = X & 255;\n    Y = Y & 255;\n    Z = Z & 255;\n\n    // Calculate noise contributions from each of the eight corners\n    let n000 = gradP[X + perm[Y + perm[Z]]].dot3(x, y, z);\n    let n001 = gradP[X + perm[Y + perm[Z + 1]]].dot3(x, y, z - 1);\n    let n010 = gradP[X + perm[Y + 1 + perm[Z]]].dot3(x, y - 1, z);\n    let n011 = gradP[X + perm[Y + 1 + perm[Z + 1]]].dot3(x, y - 1, z - 1);\n    let n100 = gradP[X + 1 + perm[Y + perm[Z]]].dot3(x - 1, y, z);\n    let n101 = gradP[X + 1 + perm[Y + perm[Z + 1]]].dot3(x - 1, y, z - 1);\n    let n110 = gradP[X + 1 + perm[Y + 1 + perm[Z]]].dot3(x - 1, y - 1, z);\n    let n111 = gradP[X + 1 + perm[Y + 1 + perm[Z + 1]]].dot3(x - 1, y - 1, z - 1);\n\n    // Compute the fade curve value for x, y, z\n    let u = this.fade(x);\n    let v = this.fade(y);\n    let w = this.fade(z);\n\n    // Interpolate\n    return this.lerp(\n      this.lerp(this.lerp(n000, n100, u), this.lerp(n001, n101, u), w),\n      this.lerp(this.lerp(n010, n110, u), this.lerp(n011, n111, u), w),\n      v\n    );\n  }\n}\n","export function lerp(a: number, b: number, x: number) {\n  return a + (b - a) * x;\n}\n\nexport function lerp2(v: { x: number; y: number }, t: { x: number; y: number }, l: number) {\n  v.x = v.x * (1 - l) + t.x * l;\n  v.y = v.y * (1 - l) + t.y * l;\n}\n\nexport function map(x: number, xStart: number, xStop: number, yStart: number, yStop: number) {\n  return lerp(yStart, yStop, (x - xStart) / (xStop - xStart));\n}\n\nexport function clamp(x: number, min: number, max: number) {\n  return x < min ? min : x > max ? max : x;\n}\n\nexport function sampleArray<T>(a: T[]) {\n  return a[Math.floor(Math.random() * a.length)];\n}\n\nexport function triangleWaveApprox(t: number) {\n  return (8 / (Math.PI * Math.PI)) * (Math.sin(t) - (1 / 9) * Math.sin(3 * t) + (1 / 25) * Math.sin(5 * t));\n}\n\n/**\n * Get a random integer between floor(x) and ceil(x) such that, over many iterations,\n * randRound(x) gives an average of x.\n */\nexport function randRound(x: number) {\n  const ix = Math.floor(x);\n  const fx = x - ix;\n  return ix + (Math.random() < fx ? 1 : 0);\n}\n\n// mod account for negatives\nexport function mod(t: number, m: number) {\n  return ((t % m) + m) % m;\n}\n\n// perfect triangle wave that goes from [0, 1, 0] in x = [0, 1, 2]\nexport function mirroredRepeat(x: number) {\n  return (1 - (Math.abs(mod(x * 2, 4) - 2) - 1)) / 2;\n}\n\n// goes [0, 1] every integer\nexport function sawTooth(x: number) {\n  return mod(x, 1);\n}\n\nexport function logistic(x: number) {\n  if (x < -6) {\n    return 0;\n  } else if (x > 6) {\n    return 1;\n  }\n  return 1 / (1 + Math.exp(-x));\n}\n","import { parse, stringify } from \"query-string\";\nimport { ALL_ENVIRONMENTS } from \"./game/environment\";\n\nconst PARAMS_DEFAULT = {\n  isRealtime: true,\n  environment: \"Temperate\" as keyof typeof ALL_ENVIRONMENTS,\n  cellEnergyMax: 6750,\n  tissueInventoryCapacity: 6,\n  rootTurnsPerTransfer: 40,\n  leafReactionRate: 0.01,\n  leafSugarPerReaction: 1,\n  cellGestationTurns: 20,\n  cellDiffusionWater: 0.002,\n  cellDiffusionSugar: 0.002,\n  soilDarknessBase: 0.2,\n  soilDiffusionWater: 0.001,\n  veinDiffusion: 0.5,\n  soilMaxWater: 20,\n  droop: 0.03,\n  fountainTurnsPerWater: 11,\n  fountainAppearanceRate: 1.5,\n  transportTurnsPerMove: 5,\n  sunlightReintroduction: 0.15,\n  sunlightDiffusion: 0.0,\n  maxResources: 100,\n};\n\ntype Params = typeof PARAMS_DEFAULT;\n\nexport const params = { ...PARAMS_DEFAULT };\n\nconst search = parse(window.location.search);\nif (search.params != null) {\n  const urlHashParams: object = JSON.parse(search.params as string);\n  Object.assign(params, urlHashParams);\n}\n\nexport function updateParamsHash() {\n  const nonDefaultParams: Partial<Params> = {};\n  const keys = Object.keys(PARAMS_DEFAULT) as Array<keyof Params>;\n  for (const key of keys) {\n    const k = params[key];\n    if (k !== PARAMS_DEFAULT[key]) {\n      nonDefaultParams[key] = k as any;\n    }\n  }\n  if (Object.keys(nonDefaultParams).length > 0) {\n    const stringified = stringify({\n      ...parse(window.location.search),\n      params: JSON.stringify(nonDefaultParams),\n    });\n    window.location.search = stringified;\n  } else {\n  }\n}\nupdateParamsHash();\n","export default function shuffle<T>(array: T[]) {\n  let currentIndex = array.length,\n    temporaryValue,\n    randomIndex;\n  // While there remain elements to shuffle...\n  while (0 !== currentIndex) {\n    // Pick a remaining element...\n    randomIndex = Math.floor(Math.random() * currentIndex);\n    currentIndex -= 1;\n    // And swap it with the current element.\n    temporaryValue = array[currentIndex];\n    array[currentIndex] = array[randomIndex];\n    array[randomIndex] = temporaryValue;\n  }\n  return array;\n}\n","function capitalize(s: String) {\n  return s.substr(0, 1).toLocaleUpperCase() + s.substr(1);\n}\n\nexport default capitalize;\n","import capitalize from \"../common/capitalize\";\nimport { DNATuple, Gene } from \"./gene\";\n\nexport type TraitValue = -3 | -2 | -1 | 0 | 1 | 2 | 3;\n\nexport type Traits = {\n  /**\n   * How fast the cell walks across this tile. Higher is faster.\n   */\n  walkSpeed: TraitValue;\n  /**\n   * How slower the cell consumes energy. Higher is lower energy usage\n   * for the same behavior.\n   */\n  energyEfficiency: TraitValue;\n  /**\n   * How well this cell photosynthesizes. Higher is faster photosynthesis.\n   */\n  photosynthesis: TraitValue;\n  /**\n   * How well this cell absorbs nutrients and water from roots. Higher is\n   * faster absorption rate.\n   */\n  rootAbsorption: TraitValue;\n  /**\n   * How many resources this cell can carry.\n   */\n  carryCapacity: TraitValue;\n  /**\n   * Whether this cell actively transports water. Higher means faster\n   * water transport.\n   */\n  activeTransportWater: TraitValue;\n  /**\n   * Whether this cell actively transports sugar. Higher means faster\n   * sugar transport.\n   */\n  activeTransportSugar: TraitValue;\n  /**\n   * How stable this cell is against gravity, weight, and wind forces.\n   * Higher is more stable.\n   */\n  structuralStability: TraitValue;\n  /**\n   * How easily this cell passively diffuses water. Higher means faster diffusion.\n   */\n  diffuseWater: TraitValue;\n  /**\n   * How easily this cell passively diffuses sugar. Higher means faster diffusion.\n   */\n  diffuseSugar: TraitValue;\n  /**\n   * How quickly this cell builds.\n   */\n  buildTime: TraitValue;\n  /**\n   * How well this cell still works at high temperatures.\n   */\n  heatTolerant: TraitValue;\n  /**\n   * How well this cell still works at low temperatures.\n   */\n  coldTolerant: TraitValue;\n  /**\n   * How many resources a seed needs to be considered \"matured\". Lower is less resources.\n   */\n  fruitNeededResources: TraitValue;\n  /**\n   * How quickly a seed finishes growing. Higher is faster growth.\n   */\n  fruitGrowthSpeed: TraitValue;\n  /**\n   * How many mutation points a seed gives. Higher is more mutation.\n   */\n  fruitMutationPoints: TraitValue;\n};\n\nexport type TraitDiff = Partial<Traits> & {\n  [traitName: string]: TraitValue;\n};\n\nexport type TraitType = keyof Traits;\n\nexport function emptyTraits(): Traits {\n  return {\n    carryCapacity: 0,\n    energyEfficiency: 0,\n    photosynthesis: 0,\n    rootAbsorption: 0,\n    structuralStability: 0,\n    activeTransportSugar: 0,\n    activeTransportWater: 0,\n    walkSpeed: 0,\n    diffuseWater: 0,\n    diffuseSugar: 0,\n    buildTime: 0,\n    heatTolerant: 0,\n    coldTolerant: 0,\n    fruitGrowthSpeed: 0,\n    fruitMutationPoints: 0,\n    fruitNeededResources: 0,\n  };\n}\n\nexport function isInteresting(traits: Traits) {\n  return TRAIT_TYPES.some((name) => traits[name] !== 0);\n}\n\nexport const TRAIT_TYPES = Object.keys(emptyTraits()) as TraitType[];\n\nexport function displayName(trait: TraitType) {\n  const splits = trait.split(/([A-Z])+/g);\n  let displayName = capitalize(splits[0]);\n  for (let i = 1; i < splits.length; i += 2) {\n    displayName += \" \" + splits[i] + splits[i + 1];\n  }\n  return displayName;\n}\n\n// /**\n//  * Mutates source.\n//  * @param source source\n//  * @param modifier modifier\n//  */\n// export function addTraits(source: TraitDiff, modifier: TraitDiff) {\n//   for (const traitType in modifier) {\n//     source[traitType] = clampToTraitValue((source[traitType] || 0) + modifier[traitType]!);\n//   }\n// }\n\nexport function clampToTraitValue(t: number): TraitValue {\n  return (t < -3 ? -3 : t > 3 ? 3 : t) as TraitValue;\n}\n\nexport function getTraits(genes: Gene[]): Traits {\n  const traits: Traits = emptyTraits();\n  for (const gene of genes) {\n    const traitTypePlus = tupleToTrait(gene[0]);\n    traits[traitTypePlus] += 1;\n\n    const traitTypeMinus = tupleToTrait(gene[1]);\n    traits[traitTypeMinus] -= 1;\n    // const traitDiff = getTraitInfluence(gene);\n    // addTraits(traits, traitDiff);\n  }\n  return traits;\n}\n\n// export function getTraitInfluence(gene: Gene): TraitDiff {\n//   const traitDiff: TraitDiff = {};\n//   const traitTypePlus = tupleToTrait(gene[0]);\n//   traitDiff[traitTypePlus] = 1;\n\n//   const traitTypeMinus = tupleToTrait(gene[1]);\n//   traitDiff[traitTypeMinus] = -1;\n//   return traitDiff;\n// }\n\nconst DNA_TUPLE_TO_TRAIT_TYPE: { [K in DNATuple]: TraitType } = {\n  AA: \"walkSpeed\",\n  AC: \"energyEfficiency\",\n  AG: \"photosynthesis\",\n  AT: \"rootAbsorption\",\n  CA: \"carryCapacity\",\n  CC: \"activeTransportSugar\",\n  CG: \"activeTransportWater\",\n  CT: \"structuralStability\",\n  GA: \"diffuseSugar\",\n  GC: \"diffuseWater\",\n  GG: \"buildTime\",\n  GT: \"heatTolerant\",\n  TA: \"coldTolerant\",\n  TC: \"fruitGrowthSpeed\",\n  TG: \"fruitMutationPoints\",\n  TT: \"fruitNeededResources\",\n};\n\nconst TRAIT_TYPE_TO_DNA_TUPLE = {} as { [K in TraitType]: DNATuple };\nfor (const [tuple, type] of Object.entries(DNA_TUPLE_TO_TRAIT_TYPE)) {\n  TRAIT_TYPE_TO_DNA_TUPLE[type] = tuple as DNATuple;\n}\n\nexport function tupleToTrait(dnaTuple: DNATuple) {\n  return DNA_TUPLE_TO_TRAIT_TYPE[dnaTuple];\n}\n\nexport function traitToTuple(trait: TraitType) {\n  return TRAIT_TYPE_TO_DNA_TUPLE[trait];\n}\n\n/**\n * Use to easily modify a base value by a trait amount.\n *\n * Exponent > 1 means base goes up with trait.\n * Exponent < 1 means base goes down with trait.\n */\nexport function traitMod(val: TraitValue, base: number, exponent: number) {\n  return base * Math.pow(exponent, val);\n}\n","import { Vector2 } from \"three\";\n\nexport const DIRECTIONS = {\n  nw: new Vector2(-1, -1),\n  w: new Vector2(-1, 0),\n  sw: new Vector2(-1, +1),\n  n: new Vector2(0, -1),\n  // new Vector2( 0,  0),\n  s: new Vector2(0, +1),\n  ne: new Vector2(+1, -1),\n  e: new Vector2(+1, 0),\n  se: new Vector2(+1, +1),\n};\n\nexport type Directions = keyof typeof DIRECTIONS;\n\nexport const DIRECTION_NAMES = Object.keys(DIRECTIONS) as Directions[];\nexport const DIRECTION_VALUES: Vector2[] = DIRECTION_NAMES.map((o) => DIRECTIONS[o]);\n","import { EventEmitter } from \"events\";\nimport { Vector2 } from \"three\";\n\n// floating point rounding error fix\n// without: 0.8 - 0.1 = 0.7000000000000001\n// with: fpref(0.8 - 0.1) = 0.7\nfunction fpref(x: number) {\n  return Math.round(x * 1e12) / 1e12;\n}\n\ninterface HasPosition {\n  pos: Vector2;\n}\n\nexport class Inventory {\n  constructor(\n    public capacity: number,\n    public carrier: HasPosition,\n    public water: number = 0,\n    public sugar: number = 0\n  ) {\n    this.validate();\n  }\n\n  // public exchange(other: Inventory, giveWater: number, giveSugar: number, getWater: number, getSugar: number) {\n  //     giveWater = Math.min(giveWater, this.water);\n  //     giveSugar = Math.min(giveSugar, this.sugar);\n  //     getWater = Math.min(getWater, other.water);\n  //     getSugar = Math.min(getWater, other.sugar);\n\n  //     // positive = give this amount\n  //     // negative = other gives this amount\n  //     const wantedExchangedWater = giveWater - getWater;\n  //     const wantedExchangedSugar = giveSugar - getSugar;\n\n  //     const mySpace = fpref(this.space() + wantedExchangedSugar + wantedExchangedWater);\n  //     const otherSpace = fpref(other.space() - wantedExchangedSugar - wantedExchangedWater);\n\n  //     // const mySpace = fpref(this.capacity + giveWater + giveSugar - this.water - this.sugar);\n\n  //     // const otherSpace = fpref(other.capacity - other.water - other.sugar)\n\n  //     // const mySpaceNeeded = fpref(getWater + getSugar);\n  //     // const otherSpaceNeeded = fpref(giveWater + giveSugar);\n\n  //     // if (mySpace < mySpaceNeeded) {\n  //     //     // e.g. space = 2, needed = 4\n  //     //     // only get half\n  //     //     const weightedRatio = mySpace / mySpaceNeeded;\n  //     //     getWater = getWater * mySpace / mySpaceNeeded;\n  //     //     getSugar = getSugar * mySpace / mySpaceNeeded;\n  //     // }\n\n  //     // if (otherSpace < otherSpaceNeeded) {\n  //     //     giveWater = giveWater / otherSpace;\n  //     //     giveSugar = giveSugar / otherSpace;\n  //     // }\n  // }\n\n  public isEmpty() {\n    return this.water === 0 && this.sugar === 0;\n  }\n\n  public give(other: Inventory, amountWater: number, amountSugar: number) {\n    if (other === this) {\n      throw new Error(\"shouldn't give to self\");\n    }\n    // special case - don't emit events or anything since nothing actually changed\n    if (amountWater === 0 && amountSugar === 0) {\n      return { water: 0, sugar: 0 };\n    }\n    // to check:\n    // 1) we have enough water and sugar\n    //      if we don't, cap water and sugar to the amount available\n    // 2) other has enough space\n    //      if it doesn't, scale down to the amount that is available\n    let water = Math.min(amountWater, this.water);\n    let sugar = Math.min(amountSugar, this.sugar);\n    const spaceNeeded = fpref(water + sugar);\n    const spaceAvailable = other.space();\n    if (spaceNeeded > spaceAvailable) {\n      // scale down the amount to give\n      // give less than capacity\n      water = Math.floor((water / spaceNeeded) * spaceAvailable);\n      sugar = Math.floor((sugar / spaceNeeded) * spaceAvailable);\n    }\n    this.change(-water, -sugar);\n    other.change(water, sugar);\n    if (this.events) {\n      this.events.emit(\"give\", other, water, sugar);\n    }\n    if (other.events) {\n      other.events.emit(\"get\", this, water, sugar);\n    }\n    return { water, sugar };\n  }\n\n  private events?: EventEmitter;\n  public on(name: \"give\" | \"get\", fn: (other: Inventory, water: number, sugar: number) => void) {\n    this.events = this.events || new EventEmitter();\n    this.events.on(name, fn);\n  }\n  public off(name: \"give\" | \"get\", fn: (...args: any[]) => any) {\n    this.events = this.events || new EventEmitter();\n    this.events.off(name, fn);\n  }\n\n  public add(water: number, sugar: number) {\n    const spaceNeeded = fpref(water + sugar);\n    const spaceAvailable = this.space();\n    if (spaceNeeded > spaceAvailable) {\n      // scale down the amount to give\n      water = (water / spaceNeeded) * spaceAvailable;\n      sugar = (sugar / spaceNeeded) * spaceAvailable;\n    }\n    this.change(water, sugar);\n  }\n\n  private change(water: number, sugar: number) {\n    const newWater = fpref(this.water + water);\n    const newSugar = fpref(this.sugar + sugar);\n    this.validate(newWater, newSugar);\n    this.water = newWater;\n    this.sugar = newSugar;\n\n    // fixup if needed\n    if (this.water < 0) {\n      this.water = 0;\n    }\n    if (this.sugar < 0) {\n      this.sugar = 0;\n    }\n    if (this.water + this.sugar > this.capacity) {\n      if (this.water > this.sugar) {\n        this.water = this.capacity - this.sugar;\n      } else {\n        this.sugar = this.capacity - this.water;\n      }\n    }\n  }\n\n  public space() {\n    const { capacity, water, sugar } = this;\n    return fpref(capacity - water - sugar);\n  }\n\n  public isMaxed() {\n    return this.space() < 1;\n  }\n\n  validate(water: number = this.water, sugar: number = this.sugar) {\n    const { capacity } = this;\n    if (water < 0) {\n      console.warn(`water < 0: ${water}`);\n      // throw new Error(`water < 0: ${water}`);\n    }\n    if (sugar < 0) {\n      console.warn(`sugar < 0: ${sugar}`);\n      // throw new Error(`sugar < 0: ${sugar}`);\n    }\n    if (water + sugar > capacity) {\n      console.warn(`bad inventory: ${water} water + ${sugar} > ${capacity} max`);\n      // throw new Error(`bad inventory: ${water} water + ${sugar} > ${capacity} max`);\n    }\n  }\n}\n\nexport interface HasInventory {\n  inventory: Inventory;\n}\n\nexport function hasInventory<T>(obj?: T): obj is HasInventory & T {\n  return obj != null && (obj as any).inventory instanceof Inventory;\n}\n","import { Constructor } from \"../constructor\";\nimport { HasInventory } from \"../inventory\";\nimport { Air, Cell, Soil } from \"./tile\";\n\nexport function allowPull(receiver: any, recieverType: Constructor<any>, giver: any, giverType: Constructor<any>) {\n  return receiver instanceof recieverType && giver instanceof giverType;\n}\n\nexport function canPullResources(receiver: HasInventory, giver: HasInventory): boolean {\n  // allow ancestors and children to exchange resources with each other (e.g. Soil and Fountain)\n  const hasAncestry = receiver instanceof giver.constructor || giver instanceof receiver.constructor;\n\n  // allow all Cells to give to each other\n  const areCells = receiver instanceof Cell && giver instanceof Cell;\n\n  // specifically allow air to give to soil\n  const isAirToSoil = allowPull(receiver, Soil, giver, Air);\n\n  return hasAncestry || areCells || isAirToSoil;\n}\n","import { lerp } from \"math\";\nimport { Cell, Tile } from \"./tile\";\n\nexport enum Temperature {\n  Scorching = \"Scorching\",\n  Hot = \"Hot\",\n  Mild = \"Mild\",\n  Cold = \"Cold\",\n  Freezing = \"Freezing\",\n}\n\nexport function temperatureFor(t: number) {\n  if (t <= 0) {\n    return Temperature.Freezing;\n  } else if (t <= 32) {\n    return Temperature.Cold;\n  } else if (t <= 64) {\n    return Temperature.Mild;\n  } else if (t <= 96) {\n    return Temperature.Hot;\n  } else {\n    return Temperature.Scorching;\n  }\n}\n\nexport function nextTemperature(t: Cell, neighbors: Map<any, Tile>, dt: number): number {\n  const temperature = t.temperatureFloat;\n  let averageTemperature = temperature;\n  for (const tile of neighbors.values()) {\n    averageTemperature += tile.temperatureFloat;\n  }\n  averageTemperature /= neighbors.size + 1;\n  // TODO maybe overshoot issues?\n  return lerp(temperature, averageTemperature, 0.2 * dt);\n}\n","import { Player } from \"./player\";\nimport { Tile } from \"./tile\";\n\nexport type Entity = Tile | Player;\n\nexport interface Steppable {\n  dtSinceLastStepped: number;\n  shouldStep(dt: number): boolean;\n  step(dt: number): void;\n}\n\nexport class StopStep extends Error {}\n\nexport function isSteppable(obj: any): obj is Steppable {\n  return typeof obj.step === \"function\";\n}\n\nexport function step(s: Steppable, dt: number) {\n  const sDt = s.dtSinceLastStepped + dt;\n  if (s.shouldStep(sDt)) {\n    try {\n      s.step(sDt);\n    } catch (e) {\n      if (e instanceof StopStep) {\n        // no-op for exiting early\n      } else {\n        throw e;\n      }\n    } finally {\n      s.dtSinceLastStepped = 0;\n    }\n  } else {\n    s.dtSinceLastStepped = sDt;\n  }\n}\n","export interface Interactable {\n  /**\n   * Return true if an interaction was successful.\n   */\n  interact(dt: number): boolean;\n}\n\nexport function isInteractable<T>(e: T): e is Interactable & T {\n  return typeof (e as any).interact === \"function\";\n}\n","import * as THREE from \"three\";\n\nimport devlog from \"../../common/devlog\";\nimport { SketchAudioContext } from \"../sketch\";\n\nimport mitoBaseSrc from \"assets/audio/mito-base.mp3\";\nimport mitoStringsSrc from \"assets/audio/mito-strings.mp3\";\nimport mitoDrumsSrc from \"assets/audio/mito-drums.mp3\";\nimport footstepsSrc from \"assets/audio/footsteps.wav\";\nimport buildSoundSrc from \"assets/audio/build.wav\";\nimport blopSrc from \"assets/audio/Blop-Mark_DiAngelo-79054334.mp3\";\nimport suckWaterSrc from \"assets/audio/suckwater.wav\";\n\nfunction sourceElement(src: string) {\n  const type = src.substr(src.length - 3);\n  const source = document.createElement(\"source\");\n  source.src = src;\n  source.type = `audio/${type}`;\n  return source;\n}\nfunction makeNodeOfAudioAsset(ctx: SketchAudioContext, ...srcs: string[]): Unit {\n  const audio = document.createElement(\"audio\");\n  audio.autoplay = true;\n  audio.loop = true;\n  for (const src of srcs) {\n    audio.appendChild(sourceElement(src));\n  }\n  // audio.appendChild(sourceElement(assetName, \"mp3\"));\n  // audio.appendChild(sourceElement(assetName, \"wav\"));\n  const source = ctx.createMediaElementSource(audio);\n  const gain = ctx.createGain();\n  source.connect(gain);\n  return { audio, gain };\n}\n\ninterface Unit {\n  gain: GainNode;\n  audio: HTMLAudioElement;\n}\n\nexport let mito: Unit;\nexport let strings: Unit;\nexport let drums: Unit;\n\nexport let footsteps: Unit;\nexport let build: Unit;\n\nexport let blopBuffer: THREE.AudioBuffer;\nexport let suckWaterBuffer: THREE.AudioBuffer;\n\nexport function hookUpAudio(ctx: SketchAudioContext) {\n  let numDone = 0;\n  function oneMoreLoaded() {\n    numDone++;\n    if (numDone === 3) {\n      mito.audio.currentTime = 0;\n      strings.audio.currentTime = 0;\n      drums.audio.currentTime = 0;\n      mito.gain.connect(ctx.gain);\n      strings.gain.connect(ctx.gain);\n      drums.gain.connect(ctx.gain);\n    }\n  }\n  mito = makeNodeOfAudioAsset(ctx, mitoBaseSrc);\n  mito.audio.oncanplaythrough = oneMoreLoaded;\n  mito.gain.gain.value = 0.5;\n\n  strings = makeNodeOfAudioAsset(ctx, mitoStringsSrc);\n  strings.audio.oncanplaythrough = oneMoreLoaded;\n  strings.gain.gain.value = 0.0;\n\n  drums = makeNodeOfAudioAsset(ctx, mitoDrumsSrc);\n  drums.audio.oncanplaythrough = oneMoreLoaded;\n  drums.gain.gain.value = 0.0;\n\n  footsteps = makeNodeOfAudioAsset(ctx, footstepsSrc);\n  footsteps.gain.gain.value = 0;\n  footsteps.gain.connect(ctx.gain);\n\n  build = makeNodeOfAudioAsset(ctx, buildSoundSrc);\n  build.gain.gain.value = 0;\n  build.gain.connect(ctx.gain);\n\n  const loader = new THREE.AudioLoader();\n\n  loader.load(\n    blopSrc,\n    (audioBuffer: THREE.AudioBuffer) => {\n      blopBuffer = audioBuffer;\n    },\n    (xhr: ProgressEvent) => {\n      // devlog((xhr.loaded / xhr.total * 100) + '% loaded');\n    },\n    (err: any) => {\n      devlog(\"An error happened\");\n    }\n  );\n  loader.load(\n    suckWaterSrc,\n    (audioBuffer: THREE.AudioBuffer) => {\n      suckWaterBuffer = audioBuffer;\n    },\n    (xhr: ProgressEvent) => {\n      // devlog((xhr.loaded / xhr.total * 100) + '% loaded');\n    },\n    (err: any) => {\n      devlog(\"An error happened\");\n    }\n  );\n}\n","import { EventEmitter } from \"events\";\nimport { Vector2 } from \"three\";\nimport { traitMod } from \"../../../evolution/traits\";\nimport {\n  Action,\n  ActionBuild,\n  ActionDeconstruct,\n  ActionDrop,\n  ActionInteract,\n  ActionMove,\n  ActionMultiple,\n  ActionPickup,\n} from \"../action\";\nimport { build, footsteps } from \"../audio\";\nimport { Constructor } from \"../constructor\";\nimport { hasInventory, Inventory } from \"../inventory\";\nimport { params } from \"../params\";\nimport { Steppable } from \"./entity\";\nimport { Cell, FreezeEffect, Fruit, GrowingCell, Tile, Tissue, Transport } from \"./tile\";\nimport { World } from \"./world\";\n\nexport class Player implements Steppable {\n  public inventory = new Inventory(\n    params.maxResources,\n    this,\n    Math.round(params.maxResources / 3),\n    Math.round(params.maxResources / 3)\n  );\n  private action?: Action;\n  private events = new EventEmitter();\n  public mapActions?: (player: Player, action: Action) => Action | undefined;\n  // public speed: number;\n  // public dropWater = false;\n  // public dropSugar = false;\n  public baseSpeed: number;\n  public dtSinceLastStepped = 0;\n\n  public get speed() {\n    const t = this.currentTile();\n    return this.baseSpeed * (t instanceof Cell ? t.tempo : 1);\n  }\n\n  get pos() {\n    return this.posFloat.clone().round();\n  }\n\n  public constructor(public posFloat: Vector2, public world: World) {\n    this.baseSpeed = traitMod(world.traits.walkSpeed, 0.15, 1.5);\n  }\n\n  shouldStep() {\n    return true;\n  }\n\n  public setAction(action: Action) {\n    if (this.action != null) {\n      this.action = {\n        type: \"multiple\",\n        actions: [this.action, action],\n      };\n    } else {\n      this.action = action;\n    }\n  }\n\n  public getAction() {\n    return this.action;\n  }\n\n  public droopY() {\n    const tile = this.world.tileAt(this.pos.x, this.pos.y);\n    if (tile instanceof Cell) {\n      return tile.droopY;\n    } else {\n      return 0;\n    }\n  }\n\n  public droopPosFloat() {\n    const droopY = this.droopY();\n    if (droopY !== 0) {\n      const t = this.posFloat.clone();\n      t.y += droopY;\n      return t;\n    }\n    return this.posFloat;\n  }\n\n  public currentTile() {\n    return this.world.tileAt(this.pos)!;\n  }\n\n  public on(event: string, cb: (...args: any[]) => void) {\n    this.events.on(event, cb);\n  }\n\n  public step(dt: number) {\n    if (this.action === undefined) {\n      this.action = { type: \"none\" };\n    }\n    if (this.mapActions) {\n      const mappedAction = this.mapActions(this, this.action);\n      if (mappedAction != null) {\n        this.action = mappedAction;\n      } else {\n        this.action = { type: \"none\" };\n      }\n    }\n    const actionSuccessful = this.attemptAction(this.action, dt);\n    this.maybeMoveWithTransports(dt);\n    // this.posFloat.lerp(this.pos, 0.05 * dt);\n    // if (this.dropWater) {\n    //   this.attemptAction(ACTION_KEYMAP.q);\n    // }\n    // if (this.dropSugar) {\n    //   this.attemptAction(ACTION_KEYMAP.e);\n    // }\n    if (actionSuccessful) {\n      this.events.emit(\"action\", this.action);\n    }\n    this.action = undefined;\n  }\n\n  private maybeMoveWithTransports(dt: number) {\n    const tile = this.currentTile();\n    if (tile instanceof Transport) {\n      this.posFloat.add(tile.dir.clone().setLength(this.speed * 0.15 * dt));\n    }\n  }\n\n  public attemptAction(action: Action, dt: number): boolean {\n    switch (action.type) {\n      case \"none\":\n        // literally do nothing\n        return true;\n      case \"still\":\n        return this.attemptStill(dt);\n      case \"move\":\n        return this.attemptMove(action, dt);\n      case \"build\":\n        return this.attemptBuild(action, dt);\n      case \"deconstruct\":\n        return this.attemptDeconstruct(action, dt);\n      case \"drop\":\n        return this.attemptDrop(action, dt);\n      case \"pickup\":\n        return this.attemptPickup(action, dt);\n      case \"multiple\":\n        return this.attemptMultiple(action, dt);\n      case \"interact\":\n        return this.attemptInteract(action, dt);\n    }\n  }\n  public verifyMove(action: ActionMove, dt: number) {\n    const target = this.posFloat\n      .clone()\n      .add(action.dir.clone().setLength(this.speed * dt))\n      .round();\n    return this.isWalkable(target);\n  }\n\n  public isWalkable(pos: Tile | Vector2) {\n    if (pos instanceof Tile) {\n      pos = pos.pos;\n    }\n    if (!this.world.isValidPosition(pos.x, pos.y)) {\n      return false;\n    }\n    const tile = this.world.tileAt(pos.x, pos.y);\n    if (!(tile instanceof Cell) || tile == null || tile.isObstacle) {\n      // can't move!\n      return false;\n    }\n    if (tile instanceof Cell) {\n      return tile.findEffectOfType(FreezeEffect) == null;\n    }\n    return true;\n  }\n\n  public isBuildCandidate(tile: Tile | null, cellType: Constructor<Cell>): tile is Tile {\n    if (tile != null && !tile.isObstacle) {\n      if (tile instanceof Cell) {\n        const isFrozen = tile.findEffectOfType(FreezeEffect) != null;\n        if (isFrozen) {\n          return false;\n        }\n        const isTransportOnTissue = tile instanceof Tissue && cellType === Transport;\n        if (isTransportOnTissue) {\n          return true;\n        }\n        return false;\n      }\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  public attemptMove(action: ActionMove, dt: number) {\n    if (this.verifyMove(action, dt)) {\n      // const t = this.currentTile();\n      // if (t instanceof Cell) {\n      //   if (t.temperature < 40) {\n      //     t.nextTemperature += 0.2;\n      //   }\n      //   else if (t.temperature > 60) {\n      //     t.nextTemperature -= 0.2;\n      //   }\n      // }\n      footsteps.gain.gain.cancelScheduledValues(0);\n      footsteps.gain.gain.value = 0.5;\n      footsteps.gain.gain.linearRampToValueAtTime(0, footsteps.gain.context.currentTime + 0.05);\n      // do the move\n      this.posFloat.add(action.dir.clone().setLength(this.speed * dt));\n      // this._pos = this.posFloat.clone().round();\n      // this.autopickup();\n      return true;\n    } else {\n      return false;\n    }\n  }\n  public attemptStill(_dt: number) {\n    // this.autopickup();\n    return true;\n  }\n  // private autopickup() {\n  //   // autopickup resources in the position as possible\n  //   const cell = this.currentTile();\n  //   if (hasInventory(cell)) {\n  //     const inv = cell.inventory;\n  //     inv.give(this.inventory, this.suckWater ? inv.water : 0, this.suckSugar ? inv.sugar : 0);\n  //   }\n  // }\n  public tryConstructingNewCell<T extends Cell>(position: Vector2, cellType: Constructor<T>, args: any[]) {\n    position = position.clone();\n    const targetTile = this.world.tileAt(position.x, position.y);\n    if (targetTile == null) {\n      // out of bounds/out of map\n      return;\n    }\n    // disallow building over a seed\n    if (targetTile instanceof Fruit) {\n      return;\n    }\n    const waterCost = 1;\n    const sugarCost = 1;\n    const tileAlreadyExists =\n      targetTile instanceof cellType && !((cellType as any) === Transport && targetTile instanceof Transport);\n    if (\n      !tileAlreadyExists &&\n      !targetTile.isObstacle &&\n      this.inventory.water >= waterCost &&\n      this.inventory.sugar >= sugarCost\n    ) {\n      this.inventory.add(-waterCost, -sugarCost);\n      const newTile = new cellType(position, this.world, ...args);\n      newTile.args = args;\n      build.audio.currentTime = 0;\n      build.gain.gain.cancelScheduledValues(0);\n      build.gain.gain.value = 0.2;\n      build.gain.gain.exponentialRampToValueAtTime(0.0001, build.gain.context.currentTime + 0.5);\n      return newTile;\n    } else {\n      return undefined;\n    }\n  }\n\n  private argsEq(args1: any, args2: any) {\n    if (typeof args1 !== typeof args2) {\n      return false;\n    }\n    if (args1 == null && args2 == null) {\n      return true;\n    }\n    if (args1 instanceof Vector2 && args2 instanceof Vector2) {\n      return args1.equals(args2);\n    }\n    if (args1 instanceof Array && args2 instanceof Array) {\n      const allEq = args1.every((_, index) => this.argsEq(args1[index], args2[index]));\n      return allEq;\n    }\n  }\n\n  private isMeaningfulBuild(action: ActionBuild, existingCell: Cell) {\n    if (existingCell.constructor !== action.cellType) {\n      return true;\n    }\n\n    if (!this.argsEq(action.args, existingCell.args)) {\n      return true;\n    }\n\n    return false;\n  }\n\n  public attemptBuild(action: ActionBuild, dt: number) {\n    const existingCell = this.world.cellAt(action.position.x, action.position.y);\n    if (existingCell != null && !this.isMeaningfulBuild(action, existingCell)) {\n      // already built, whatever.\n      return true;\n    }\n    if (existingCell) {\n      this.attemptDeconstruct(\n        {\n          type: \"deconstruct\",\n          position: action.position,\n          force: true,\n        },\n        dt\n      );\n    }\n    const matureCell = this.tryConstructingNewCell(action.position, action.cellType, action.args);\n    if (matureCell != null) {\n      let cell: Cell;\n      if (action.cellType.turnsToBuild) {\n        cell = new GrowingCell(action.position, this.world, matureCell);\n      } else {\n        cell = matureCell;\n      }\n      cell.droopY = this.droopY();\n      this.world.setTileAt(action.position, cell);\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  public attemptDeconstruct(action: ActionDeconstruct, _dt: number): boolean {\n    if (!action.position.equals(this.pos) || action.force) {\n      const cell = this.world.maybeRemoveCellAt(action.position);\n      if (cell != null) {\n        // refund the resources back\n        const refund = cell.energy / params.cellEnergyMax;\n        this.inventory.add(refund, refund);\n        // if (hasInventory(cell)) {\n        //   cell.inventory.give(this.inventory, cell.inventory.water, cell.inventory.sugar);\n        // }\n        return true;\n      }\n    }\n    return false;\n  }\n\n  public attemptDrop(action: ActionDrop, dt: number) {\n    // drop as much as you can onto the current tile\n    const currentTile = this.currentTile();\n    if (hasInventory(currentTile)) {\n      const { water: waterRate, sugar: sugarRate } = action;\n      const water = waterRate * dt;\n      const sugar = sugarRate * dt;\n      // first, pick up the opposite of what you can from the tile to try and make space\n      currentTile.inventory.give(this.inventory, sugar, water);\n\n      // give as much as you can\n      this.inventory.give(currentTile.inventory, water, sugar);\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  public attemptPickup(action: ActionPickup, dt: number) {\n    const cell = this.currentTile();\n    if (hasInventory(cell)) {\n      const inv = cell.inventory;\n      inv.give(this.inventory, action.water * dt, action.sugar * dt);\n    }\n    return true;\n  }\n\n  public attemptMultiple(multiple: ActionMultiple, dt: number) {\n    let allSuccess = true;\n    for (const action of multiple.actions) {\n      allSuccess = this.attemptAction(action, dt) && allSuccess;\n    }\n    return allSuccess;\n  }\n\n  public attemptInteract(action: ActionInteract, dt: number) {\n    return action.interactable.interact(dt);\n  }\n}\n","import { map, randRound } from \"math\";\nimport * as THREE from \"three\";\nimport { Vector2 } from \"three\";\nimport { GameResult } from \"..\";\nimport devlog from \"../../../common/devlog\";\nimport { Species } from \"../../../evolution/species\";\nimport { getTraits, traitMod, Traits } from \"../../../evolution/traits\";\nimport shuffle from \"../../../math/shuffle\";\nimport { DIRECTION_VALUES } from \"../directions\";\nimport { hasInventory } from \"../inventory\";\nimport { params } from \"../params\";\nimport { Entity, isSteppable, step } from \"./entity\";\nimport { Environment, FILL_FUNCTIONS } from \"./environment\";\nimport { Player } from \"./player\";\nimport { Air, Cell, DeadCell, Fruit, hasEnergy, Rock, Soil, Tile, Tissue } from \"./tile\";\n\nexport class StepStats {\n  constructor(public deleted: Entity[] = [], public added: Entity[] = []) {}\n}\n\nexport interface Season {\n  percent: number;\n  season: 0 | 1 | 2 | 3;\n  month: number;\n}\n\nexport function seasonFromTime(time: number): Season {\n  const season = Math.floor(time / TIME_PER_SEASON) as Season[\"season\"];\n  const percent = (time % TIME_PER_SEASON) / TIME_PER_SEASON; // percent done with this season\n  const month = Math.floor((time % TIME_PER_SEASON) / TIME_PER_MONTH) + 1;\n  return {\n    season,\n    percent,\n    month,\n  };\n}\n\nconst SEASON_NAMES = [\"Spring\", \"Summer\", \"Fall\", \"Winter\"];\nexport function seasonDisplay(s: Season) {\n  return `${SEASON_NAMES[s.season]}, Month ${s.month}`;\n}\n\nexport const TIME_PER_YEAR = 30 * 60 * 15; // 30 fps * 60 seconds/minute * 15 minutes\nexport const TIME_PER_SEASON = TIME_PER_YEAR / 4;\nexport const TIME_PER_MONTH = TIME_PER_SEASON / 3;\nexport const TIME_PER_DAY = TIME_PER_MONTH / 3;\n\nexport class World {\n  public time: number = 0;\n  public frame: number = 0;\n  public readonly width = 50;\n  public readonly height = 100;\n  public readonly player: Player;\n  private readonly gridEnvironment: Tile[][];\n  private readonly gridCells: Array<Array<Cell | null>>;\n  private readonly neighborCache: Array<Array<Map<Vector2, Tile>>>;\n  public readonly wipResult: Omit<GameResult, \"status\" | \"mutationPointsPerEpoch\">;\n  public readonly species: Species;\n  public readonly traits: Traits;\n\n  get season(): Season {\n    return seasonFromTime(this.time);\n  }\n\n  constructor(public environment: Environment, species: Species) {\n    this.wipResult = {\n      fruits: [],\n      world: this,\n    };\n    this.species = species;\n    this.traits = getTraits(this.species.genes);\n    Cell.diffusionWater = traitMod(this.traits.diffuseWater, params.cellDiffusionWater, 2);\n    Cell.diffusionSugar = traitMod(this.traits.diffuseSugar, params.cellDiffusionSugar, 2);\n    Cell.turnsToBuild = Math.floor(traitMod(this.traits.buildTime, params.cellGestationTurns, 1 / 2));\n    this.player = new Player(new Vector2(this.width / 2, this.height / 2), this);\n    this.gridEnvironment = new Array(this.width).fill(undefined).map((_, x) =>\n      new Array(this.height).fill(undefined).map((__, y) => {\n        const pos = new Vector2(x, y);\n\n        let tile: Tile | undefined;\n        for (const fillFunction of FILL_FUNCTIONS[environment.fill]) {\n          const t = fillFunction(pos, this);\n          if (t != null) {\n            tile = t;\n            break;\n          }\n        }\n        if (tile == null) {\n          tile = new Air(pos, this);\n        }\n        return tile;\n      })\n    );\n\n    // always drop player on the Soil Air interface\n    const playerX = this.player.pos.x;\n    const firstSoil = this.gridEnvironment[playerX].find((t) => !(t instanceof Air));\n    if (firstSoil) {\n      this.player.posFloat.y = firstSoil.pos.y;\n    }\n\n    const radius = 2.5;\n    this.gridCells = new Array(this.width).fill(undefined).map((_, x) =>\n      new Array(this.height).fill(undefined).map((__, y) => {\n        const pos = new Vector2(x, y);\n        // add a \"seed\" of tissue around the player\n        if (this.player.pos.distanceTo(pos) < radius) {\n          // prevent Rocks underneath the seed\n          if (this.gridEnvironment instanceof Rock) {\n            this.gridEnvironment[x][y] = new Soil(new Vector2(x, y), 0, this);\n          }\n          return new Tissue(pos, this);\n        } else {\n          return null;\n        }\n      })\n    );\n    this.neighborCache = new Array(this.width).fill(undefined).map((_, x) =>\n      new Array(this.height).fill(undefined).map((__, y) => {\n        return this.computeTileNeighbors(x, y);\n      })\n    );\n    this.fillCachedEntities();\n\n    // step all tiles first with 0 timestep to trigger any initial state\n    for (let x = 0; x < this.width; x++) {\n      for (let y = 0; y < this.height; y++) {\n        const tileEnvironment = this.gridEnvironment[x][y];\n        tileEnvironment && tileEnvironment.step(0);\n\n        const tileCell = this.gridCells[x][y];\n        tileCell && tileCell.step(0);\n      }\n    }\n  }\n\n  public tileAt(v: Vector2): Tile | null;\n  public tileAt(x: number, y: number): Tile | null;\n  public tileAt(xOrVec2: number | Vector2, y?: number): Tile | null {\n    let x: number;\n    if (xOrVec2 instanceof Vector2) {\n      x = xOrVec2.x;\n      y = xOrVec2.y;\n    } else {\n      x = xOrVec2;\n      y = y!;\n    }\n\n    if (!this.isValidPosition(x, y)) {\n      return null;\n    }\n    const cell = this.gridCells[x][y];\n    if (cell != null) {\n      return cell;\n    } else {\n      return this.gridEnvironment[x][y];\n    }\n  }\n\n  public cells() {\n    const { gridCells, width, height } = this;\n    return {\n      *[Symbol.iterator]() {\n        for (let x = 0; x < width; x++) {\n          for (let y = 0; y < height; y++) {\n            const g = gridCells[x][y];\n            if (g != null) {\n              yield g;\n            }\n          }\n        }\n      },\n    };\n  }\n\n  public cellAt(x: number, y: number): Cell | null {\n    if (this.isValidPosition(x, y)) {\n      return this.gridCells[x][y];\n    } else {\n      return null;\n    }\n  }\n\n  public environmentTileAt(x: number, y: number): Tile | null {\n    if (this.isValidPosition(x, y)) {\n      return this.gridEnvironment[x][y];\n    } else {\n      return null;\n    }\n  }\n\n  // Rules for replacement:\n  // if tile is environment, clear out the gridCell and set the gridEnvironment.\n  // if tile is cell, set gridCell, leave gridEnvironment alone.\n  public setTileAt(position: Vector2, tile: Tile): any {\n    const { x, y } = position;\n    if (!this.isValidPosition(x, y)) {\n      throw new Error(`invalid position ${x}, ${y} `);\n    }\n    if (tile instanceof Fruit) {\n      this.wipResult.fruits.push(tile);\n    }\n    const oldTile = this.tileAt(x, y)!;\n    // if replacing a tile with inventory, try giving resources to neighbors of the same type\n    if (hasInventory(oldTile)) {\n      // // give resources if available to the new tile\n      // if (hasInventory(tile) && canPullResources(tile, oldTile)) {\n      //   oldTile.inventory.give(tile.inventory, oldTile.inventory.water, oldTile.inventory.sugar);\n      // }\n      oldTile.redistributeInventoryToNeighbors();\n      if (oldTile.inventory.water !== 0 || oldTile.inventory.sugar !== 0) {\n        console.warn(\"lost\", oldTile.inventory, \"resources to building\");\n        oldTile.inventory.add(-oldTile.inventory.water, -oldTile.inventory.sugar);\n      }\n    }\n\n    const oldCell = this.gridCells[x][y];\n    if (oldCell != null) {\n      this.stepStats.deleted.push(oldCell);\n    }\n\n    if (tile instanceof Cell) {\n      // set gridCell only\n      this.gridCells[x][y] = tile;\n    } else {\n      // hackhack - we should call .die() on gridCells[x][y] but we already have with the oldTile code above\n      this.gridCells[x][y] = null;\n\n      const oldEnvironmentTile = this.gridEnvironment[x][y];\n      if (oldEnvironmentTile != null) {\n        this.stepStats.deleted.push(oldEnvironmentTile);\n      }\n      this.gridEnvironment[x][y] = tile;\n    }\n    this.stepStats.added.push(tile);\n    this.handleTileUpdated(position);\n  }\n  public maybeRemoveCellAt(position: Vector2): Cell | null {\n    const cell = this.cellAt(position.x, position.y);\n    if (cell) {\n      cell.redistributeInventoryToNeighbors();\n      this.gridCells[position.x][position.y] = null;\n      this.stepStats.deleted.push(cell);\n    }\n    this.handleTileUpdated(position);\n    return cell;\n  }\n  public isValidPosition(x: number, y: number) {\n    if (x >= this.width || x < 0 || y >= this.height || y < 0) {\n      return false;\n    } else {\n      return true;\n    }\n  }\n\n  public tileNeighbors(pos: Vector2) {\n    return this.neighborCache[pos.x][pos.y];\n  }\n\n  private computeTileNeighbors(px: number, py: number) {\n    const mapping = new Map<Vector2, Tile>();\n    // randomize the neighbor array to reduce aliasing\n    const directions = DIRECTION_VALUES_RAND[this.frame % DIRECTION_VALUES_RAND.length];\n    directions.forEach((v) => {\n      const x = px + v.x;\n      const y = py + v.y;\n      const tile = this.tileAt(x, y);\n      if (tile != null) {\n        mapping.set(v, tile);\n      }\n    });\n    return mapping;\n  }\n  // only use for rendering\n  // private cachedRenderableEntities?: Entity[];\n  // public renderableEntities() {\n  //     if (this.cachedRenderableEntities == null) {\n  //         throw new Error(\"accessed renderable entities before filling\");\n  //     }\n  //     return this.cachedRenderableEntities;\n  // }\n\n  private cachedEntities?: Entity[];\n  public entities() {\n    if (this.cachedEntities == null) {\n      throw new Error(\"accessed entities before filling\");\n    }\n    return this.cachedEntities;\n  }\n\n  private handleTileUpdated(pos: Vector2) {\n    this.neighborCache[pos.x][pos.y] = this.computeTileNeighbors(pos.x, pos.y);\n    for (const dir of DIRECTION_VALUES) {\n      const x = pos.x + dir.x;\n      const y = pos.y + dir.y;\n      if (this.isValidPosition(x, y)) {\n        this.neighborCache[x][y] = this.computeTileNeighbors(x, y);\n      }\n    }\n    this.fillCachedEntities();\n  }\n  private fillCachedEntities() {\n    const newEntities: Entity[] = [];\n    // we do this super hacky thing for performance where we only run every other entity in\n    // a checkerboard pattern.\n    //\n    // also, entities can interact with other entities, there is no lock-step buffer state,\n    // which means you can get weird artifacts like \"water suddenly moves 20 squares\".\n    // to combat this we alternatingly reverse the tile iteration order.\n    let x = 0,\n      y = 0;\n    for (x = 0; x < this.width; x++) {\n      for (y = (x + this.frame) % 2; y < this.height; y += 2) {\n        // checkerboard\n        newEntities.push(this.tileAt(x, y)!);\n      }\n    }\n    for (x = 0; x < this.width; x++) {\n      for (y = (x + this.frame + 1) % 2; y < this.height; y += 2) {\n        // opposite checkerboard\n        newEntities.push(this.tileAt(x, y)!);\n      }\n    }\n    if (this.frame % 4 < 2) {\n      newEntities.reverse();\n    }\n    // add player at the end - this is important since Player is currently the only thing\n    // that modifies tiles. You can get into situations where tiles that should be dead\n    // are still left-over in the entities cache.\n    newEntities.push(this.player);\n    this.cachedEntities = newEntities;\n\n    // update renderable entities\n    // (() => {\n    //     const entities: Entity[] = [this.player];\n    //     for (x = 0; x < width; x++) {\n    //         for (y = 0; y < height; y++) {\n    //             entities.push(this.gridEnvironment[x][y]);\n    //             const cellMaybe = this.gridCells[x][y];\n    //             if (cellMaybe != null) {\n    //                 entities.push(cellMaybe);\n    //             }\n    //         }\n    //     }\n    //     this.cachedRenderableEntities = entities;\n    // })();\n  }\n  // iterate through all the actions\n  private stepStats: StepStats = new StepStats();\n  public step(dt: number): StepStats {\n    const entities = this.entities();\n    this.stepStats = new StepStats();\n    // dear god\n    entities.forEach((entity) => {\n      if (isSteppable(entity)) {\n        step(entity, dt);\n      }\n    });\n    this.updateTemperatures(dt);\n    this.computeSunlight(dt);\n    this.stepWeather(dt);\n    this.frame++;\n    this.time += dt;\n    this.fillCachedEntities();\n    return this.stepStats;\n    // this.checkResources();\n  }\n\n  public getLastStepStats() {\n    return this.stepStats;\n  }\n\n  public stepWeather(dt: number) {\n    // offset first rain event by 200 turns\n    const isRaining =\n      (this.time + this.environment.climate.turnsBetweenRainfall - 200) %\n        this.environment.climate.turnsBetweenRainfall <\n      this.environment.climate.rainDuration;\n    if (isRaining) {\n      // add multiple random droplets\n      while (dt > 0) {\n        const dropletSizeScalar = Math.min(dt, 1);\n        const x = THREE.Math.randInt(0, this.width - 1);\n        const t = this.tileAt(x, 0);\n        if (t instanceof Air) {\n          t.inventory.add(randRound(this.environment.climate.waterPerDroplet * dropletSizeScalar), 0);\n        }\n        dt -= 1;\n      }\n    }\n  }\n\n  private temperatureScale = {\n    0: {\n      day: 60,\n      night: 40,\n    },\n    1: {\n      day: 80,\n      night: 60,\n    },\n    2: {\n      day: 65,\n      night: 31,\n    },\n    3: {\n      day: 40,\n      night: 0,\n    },\n  };\n\n  /**\n   * 0 to 1, where\n   * 0 to 0.5: daytime\n   * 0.5 to 1: nighttime\n   */\n  get sunAngle() {\n    return (this.time * Math.PI * 2) / TIME_PER_DAY;\n  }\n\n  get dayOrNight() {\n    return this.sunAngle % (Math.PI * 2) < Math.PI ? \"day\" : \"night\";\n  }\n\n  get sunAmount() {\n    return (Math.atan(Math.sin(this.sunAngle) * 12) / (Math.PI / 2)) * 0.5 + 0.5;\n  }\n\n  getCurrentTemperature() {\n    const { season } = this.season;\n    const { day, night } = this.temperatureScale[season];\n    return map(this.sunAmount, 0, 1, night, day);\n  }\n\n  public computeSunlight(_dt: number) {\n    // sunlight is special - we step downards from the top; neighbors don't affect the calculation so\n    // we don't have buffering problems\n    const sunAngle = this.sunAngle;\n    const directionalBias = Math.sin(sunAngle + Math.PI / 2);\n    const sunAmount = this.sunAmount;\n    for (let y = 0; y <= this.height * 0.6; y++) {\n      for (let x = 0; x < this.width; x++) {\n        const t = this.environmentTileAt(x, y);\n        if (t instanceof Air) {\n          let sunlight = 0;\n          if (y === 0) {\n            sunlight = 1;\n          } else {\n            const tileUp = this.tileAt(x, y - 1);\n            const tileRight = this.tileAt(x + 1, y - 1);\n            const tileLeft = this.tileAt(x - 1, y - 1);\n            const upSunlight = tileUp instanceof Air ? tileUp.sunlightCached / sunAmount : tileUp == null ? 1 : 0;\n            const rightSunlight =\n              tileRight instanceof Air ? tileRight.sunlightCached / sunAmount : tileRight == null ? 1 : 0;\n            const leftSunlight =\n              tileLeft instanceof Air ? tileLeft.sunlightCached / sunAmount : tileLeft == null ? 1 : 0;\n            if (directionalBias > 0) {\n              // positive light travels to the right\n              sunlight = rightSunlight * directionalBias + upSunlight * (1 - directionalBias);\n            } else {\n              sunlight = leftSunlight * -directionalBias + upSunlight * (1 - -directionalBias);\n            }\n            sunlight =\n              sunlight * (1 - params.sunlightDiffusion) +\n              ((upSunlight + rightSunlight + leftSunlight) / 3) * params.sunlightDiffusion;\n          }\n          // have at least a bit\n          sunlight = params.sunlightReintroduction + sunlight * (1 - params.sunlightReintroduction);\n\n          sunlight *= sunAmount;\n          t.sunlightCached = sunlight;\n        }\n      }\n    }\n  }\n\n  public updateTemperatures(_dt: number) {\n    for (const t of this.cells()) {\n      t.temperatureFloat = t.nextTemperature;\n    }\n  }\n\n  public maybeGetGameResult(): GameResult | null {\n    // you lose if you're standing on a dead cell\n    if (this.tileAt(this.player.pos.x, this.player.pos.y) instanceof DeadCell) {\n      return {\n        ...this.wipResult,\n        mutationPointsPerEpoch: 0,\n        status: \"lost\",\n      };\n    }\n    if (this.time < TIME_PER_YEAR) {\n      return null;\n    }\n    // at the end of the year, we make a decision:\n    // you lose if you haven't made a single mature fruit\n    const matureFruit = this.wipResult.fruits.filter((f) => f.isMature());\n    if (matureFruit.length === 0) {\n      return {\n        ...this.wipResult,\n        mutationPointsPerEpoch: 0,\n        status: \"lost\",\n      };\n    }\n    // you win if there's a seed with full capacity\n    return {\n      ...this.wipResult,\n      mutationPointsPerEpoch: matureFruit.length * traitMod(this.traits.fruitMutationPoints, 1, 1.5),\n      status: \"won\",\n    };\n  }\n\n  public checkResources() {\n    let totalSugar = 0;\n    let totalWater = 0;\n    let totalEnergy = 0;\n    this.entities().forEach((e) => {\n      if (hasInventory(e)) {\n        totalSugar += e.inventory.sugar;\n        totalWater += e.inventory.water;\n      }\n      if (hasEnergy(e)) {\n        totalEnergy += e.energy;\n      }\n    });\n    devlog(\"sugar\", totalSugar, \"water\", totalWater, \"energy\", totalEnergy);\n  }\n\n  public environmentTiles() {\n    const self = this;\n    return {\n      *[Symbol.iterator]() {\n        for (const row of self.gridEnvironment) {\n          for (const t of row) {\n            yield t;\n          }\n        }\n      },\n    };\n  }\n}\n\nconst DIRECTION_VALUES_RAND = [\n  shuffle(DIRECTION_VALUES.slice()),\n  shuffle(DIRECTION_VALUES.slice()),\n  shuffle(DIRECTION_VALUES.slice()),\n  shuffle(DIRECTION_VALUES.slice()),\n  shuffle(DIRECTION_VALUES.slice()),\n];\n","import shuffle from \"math/shuffle\";\nimport { Vector2 } from \"three\";\nimport { Noise } from \"../../../common/perlin\";\nimport { traitMod } from \"../../../evolution/traits\";\nimport { clamp, map, randRound } from \"../../../math/index\";\nimport { Constructor } from \"../constructor\";\nimport { DIRECTIONS } from \"../directions\";\nimport { HasInventory, Inventory } from \"../inventory\";\nimport { params } from \"../params\";\nimport { canPullResources } from \"./canPullResources\";\nimport { Steppable, StopStep } from \"./entity\";\nimport { Interactable, isInteractable } from \"./interactable\";\nimport { nextTemperature, Temperature, temperatureFor } from \"./temperature\";\nimport { TIME_PER_SEASON, World } from \"./world\";\n\nexport interface HasEnergy {\n  energy: number;\n}\n\nexport function hasEnergy<T>(e: T): e is HasEnergy & T {\n  return typeof (e as any).energy === \"number\";\n}\n\nexport abstract class Tile implements Steppable, HasInventory {\n  static displayName = \"Tile\";\n  static fallAmount = 0;\n  public isObstacle = false;\n  public darkness = Infinity;\n  public temperatureFloat: number;\n  public dtSinceLastStepped = 0;\n  public abstract inventory: Inventory;\n  get temperature(): Temperature {\n    return temperatureFor(this.temperatureFloat);\n  }\n\n  get diffusionWater(): number {\n    return (this.constructor as any).diffusionWater;\n  }\n\n  get diffusionSugar(): number {\n    return (this.constructor as any).diffusionSugar;\n  }\n\n  get fallAmount(): number {\n    return (this.constructor as any).fallAmount;\n  }\n\n  public readonly timeMade: number;\n\n  public pos: Vector2;\n\n  public get age() {\n    return this.world.time - this.timeMade;\n  }\n\n  public constructor(pos: Vector2, public readonly world: World) {\n    this.pos = pos.clone();\n    if (world == null) {\n      throw new Error(\"null world!\");\n    }\n    this.timeMade = world.time;\n    this.temperatureFloat = this.world.getCurrentTemperature();\n  }\n\n  abstract shouldStep(dt: number): boolean;\n\n  public lightAmount() {\n    return Math.sqrt(Math.min(Math.max(map(1 - this.darkness, 0, 1, 0, 1), 0), 1));\n  }\n\n  /**\n   * Redistribute this tile's inventory to nearby tiles if possible, usually\n   * in preparation for removing this tile.\n   */\n  public redistributeInventoryToNeighbors() {\n    if (this.inventory.water > 0 || this.inventory.sugar > 0) {\n      // push resources to nearby tiles\n      const neighbors = this.world.tileNeighbors(this.pos);\n      const giveCandidates = Array.from(neighbors.values()).filter((n) => canPullResources(n, this));\n      while (!this.inventory.isEmpty() && giveCandidates.length > 0) {\n        shuffle(giveCandidates);\n        for (let i = 0; i < giveCandidates.length; i++) {\n          const neighbor = giveCandidates[i];\n          // give 1 to this neighbor\n          this.inventory.give(neighbor.inventory, 1, 1);\n          // delete this neighbor from candidates to give\n          if (neighbor.inventory.isMaxed) {\n            giveCandidates.splice(i, 1);\n          }\n          if (this.inventory.isEmpty()) {\n            // we're all done\n            break;\n          }\n        }\n      }\n    }\n  }\n\n  // test tiles diffusing water around on same-type tiles\n  public step(dt: number) {\n    // const cellHere = this.world.cellAt(this.pos.x, this.pos.y) != null;\n    // if (cellHere) {\n    //   console.error(\"stepping environmental tile even when a cell is on-top:\", cellHere);\n    // }\n    const neighbors = this.world.tileNeighbors(this.pos);\n    this.stepDarkness(neighbors, dt);\n    this.stepDiffusion(neighbors, dt);\n    this.stepTemperature(dt);\n    this.stepGravity(dt);\n  }\n\n  stepTemperature(_dt: number) {\n    this.temperatureFloat = this.world.getCurrentTemperature();\n  }\n\n  stepDarkness(neighbors: Map<Vector2, Tile>, _dt: number) {\n    if (this instanceof Cell) {\n      this.darkness = 0;\n    } else {\n      let minDarkness = this.darkness;\n      for (const [, t] of neighbors) {\n        const contrib = Math.max(\n          0.2,\n          map(this.pos.y, this.world.height / 2, this.world.height, params.soilDarknessBase, 1)\n        );\n        const darknessFromNeighbor = t instanceof Rock ? Infinity : t.darkness + contrib;\n        if (t instanceof Cell) {\n          minDarkness = 0;\n        } else {\n          minDarkness = Math.min(minDarkness, darknessFromNeighbor);\n        }\n      }\n      this.darkness = minDarkness;\n    }\n  }\n\n  stepDiffusion(neighbors: Map<Vector2, Tile>, dt: number) {\n    for (const tile of neighbors.values()) {\n      if (!this.canDiffuse(tile)) {\n        continue;\n      }\n      // take water from neighbors that have more water than you\n      if (this.diffusionWater != null) {\n        if (tile.inventory.water > this.inventory.water) {\n          this.diffuseWater(tile, dt);\n        }\n      }\n      if (this.diffusionSugar != null) {\n        if (tile.inventory.sugar > this.inventory.sugar) {\n          this.diffuseSugar(tile, dt);\n        }\n      }\n    }\n  }\n\n  canDiffuse(tile: Tile): tile is Tile & HasInventory {\n    return canPullResources(this, tile);\n  }\n\n  diffuseWater(giver: HasInventory, dt: number) {\n    const diffusionAmount = (giver.inventory.water - this.inventory.water) * this.diffusionWater * dt;\n    // if (params.soilDiffusionType === \"continuous\") {\n    //   giver.inventory.give(this.inventory, diffusionAmount, 0);\n    // } else {\n    giver.inventory.give(this.inventory, randRound(diffusionAmount), 0);\n    // }\n  }\n\n  diffuseSugar(giver: HasInventory, dt: number) {\n    const diffusionAmount = (giver.inventory.sugar - this.inventory.sugar) * this.diffusionSugar * dt;\n    // if (params.soilDiffusionType === \"continuous\") {\n    //   giver.inventory.give(this.inventory, 0, diffusionAmount);\n    // } else {\n    giver.inventory.give(this.inventory, 0, randRound(diffusionAmount));\n    // }\n  }\n\n  stepGravity(dt: number) {\n    const fallAmount = this.fallAmount * dt;\n    const lowerNeighbor = this.world.tileAt(this.pos.x, this.pos.y + 1);\n    // if (fallAmount > 0 && this.age % Math.floor(1 / fallAmount) < 1) {\n    //   if (hasInventory(lowerNeighbor) && canPullResources(lowerNeighbor, this)) {\n    //     this.inventory.give(lowerNeighbor.inventory, 1, 0);\n    //   }\n    // }\n    if (fallAmount > 0 && lowerNeighbor != null && canPullResources(lowerNeighbor, this)) {\n      this.inventory.give(lowerNeighbor.inventory, randRound(fallAmount), 0);\n    }\n  }\n}\n\nconst noiseCo2 = new Noise();\nexport class Air extends Tile {\n  static displayName = \"Air\";\n  static fallAmount = 1;\n  static diffusionWater = 0.1;\n  public sunlightCached: number = 1;\n  public _co2: number;\n  public inventory = new Inventory(20, this);\n  public constructor(public pos: Vector2, world: World) {\n    super(pos, world);\n    this.darkness = 0;\n    this._co2 = this.computeCo2();\n  }\n\n  // Air always steps every 3 tiles, otherwise rainfall and diffusion go much slower\n  // than intended\n  shouldStep(dt: number) {\n    // if (!this.inventory.isEmpty()) {\n    return dt > 3;\n    // } else {\n    //   return super.shouldStep(dt);\n    // }\n  }\n\n  private computeCo2() {\n    const base = map(this.pos.y, this.world.height / 2, 0, this.world.environment.floorCo2, 1.15);\n    const scaleX = map(this.pos.y, this.world.height / 2, 0, 4, 9);\n    // const offset = noiseCo2.perlin3(94.2321 - this.pos.x / scaleX, 3221 - this.pos.y / 2.5, world.time / 5 + 93.1) * 0.2;\n    const time = this.world == null ? 0 : this.world.time;\n    const offset =\n      noiseCo2.perlin3(\n        94.231 + (this.pos.x - this.world.width / 2) / scaleX,\n        2312 + this.pos.y / 8,\n        time / 1000 + 93.1\n      ) * 0.25;\n    return Math.max(Math.min(base + offset, 1), Math.min(0.4, this.world.environment.floorCo2 * 0.75));\n  }\n\n  public lightAmount() {\n    return this.sunlight();\n  }\n\n  step(dt: number) {\n    // we do NOT call super, to avoid stepping darkness and diffusion.\n    this.stepGravity(dt);\n    this.stepDiffusionCheap(dt);\n    this.stepEvaporation(dt);\n    this.stepTemperature(dt);\n    this._co2 = this.computeCo2();\n  }\n\n  stepDiffusionCheap(dt: number) {\n    // only take water from left and right\n    const left = this.world.tileAt(this.pos.x - 1, this.pos.y);\n    const right = this.world.tileAt(this.pos.x + 1, this.pos.y);\n    // randomize order to remove directional bias\n    if (Math.random() < 0.5) {\n      this.tryDiffuse(left, dt);\n      this.tryDiffuse(right, dt);\n    } else {\n      this.tryDiffuse(right, dt);\n      this.tryDiffuse(left, dt);\n    }\n  }\n\n  tryDiffuse(t: Tile | null, dt: number) {\n    if (t != null && this.canDiffuse(t)) {\n      if (t.inventory.water > this.inventory.water) {\n        this.diffuseWater(t, dt);\n      }\n    }\n  }\n\n  stepEvaporation(dt: number) {\n    if (Math.random() < 0.01 * this.inventory.water * dt) {\n      this.inventory.add(-1, 0);\n    }\n  }\n\n  public co2() {\n    return this._co2;\n  }\n\n  public sunlight() {\n    return this.sunlightCached;\n  }\n}\n\nexport class Soil extends Tile implements HasInventory {\n  static displayName = \"Soil\";\n  static diffusionWater = params.soilDiffusionWater;\n  public inventory = new Inventory(params.soilMaxWater, this);\n  // static fallAmount = params.waterGravityPerTurn;\n  get fallAmount() {\n    return this.world.environment.waterGravityPerTurn;\n  }\n\n  constructor(pos: Vector2, water: number = 0, world: World) {\n    super(pos, world);\n    this.inventory.add(water, 0);\n  }\n\n  shouldStep(dt: number) {\n    // test this out\n    return dt > 10;\n  }\n\n  step(dt: number) {\n    super.step(dt);\n    this.stepEvaporation(dt);\n  }\n\n  stepEvaporation(dt: number) {\n    const { evaporationRate, evaporationBottom } = this.world.environment;\n    const evaporationHeightScalar = map(this.pos.y, this.world.height / 2, this.world.height * evaporationBottom, 1, 0);\n    const evaporationAmountScalar = this.inventory.water;\n    if (Math.random() < evaporationRate * evaporationHeightScalar * evaporationAmountScalar * dt) {\n      this.inventory.add(-1, 0);\n    }\n  }\n}\n\nexport class Rock extends Tile {\n  static displayName = \"Rock\";\n  isObstacle = true;\n  inventory = new Inventory(0, this);\n  shouldStep(dt: number) {\n    return dt > 10;\n  }\n}\n\nexport class DeadCell extends Tile {\n  static displayName = \"Dead Cell\";\n  inventory = new Inventory(0, this);\n  shouldStep(dt: number) {\n    return dt > 10;\n  }\n}\n\nexport class Fountain extends Soil {\n  static displayName = \"Fountain\";\n  isObstacle = true;\n  private cooldown = 0;\n  constructor(pos: Vector2, water: number = 0, world: World, public turnsPerWater: number) {\n    super(pos, water, world);\n  }\n  step(dt: number) {\n    super.step(dt);\n    if (this.cooldown > 0) {\n      this.cooldown -= dt;\n    }\n    if (this.inventory.space() > 1 && this.cooldown <= 0) {\n      // just constantly give yourself water\n      this.inventory.add(1, 0);\n      this.cooldown = this.turnsPerWater;\n    }\n  }\n}\n\ninterface CellEffectConstructor extends Constructor<CellEffect> {\n  stacks?: boolean;\n}\nexport abstract class CellEffect {\n  private timeMade!: number;\n  public cell!: Cell;\n  get age() {\n    return this.cell.world.time - this.timeMade;\n  }\n\n  attachTo(cell: Cell) {\n    this.cell = cell;\n    this.timeMade = this.cell.world.time;\n  }\n\n  /**\n   * Return whether to step the next behavior in the chain\n   */\n  abstract step(dt: number): void;\n\n  remove() {\n    const index = this.cell.effects.indexOf(this);\n    this.cell.effects.splice(index, 1);\n  }\n}\n\nexport class FreezeEffect extends CellEffect implements Interactable {\n  static displayName = \"Frozen\";\n  static stacks = false;\n  public readonly turnsToDie = 2000;\n  public percentFrozen = 0.5;\n\n  get turnsUntilDeath() {\n    return this.turnsToDie - this.age;\n  }\n\n  interact(dt: number) {\n    this.percentFrozen -= (20 / this.turnsToDie) * dt;\n    this.onFrozenChanged();\n    return true;\n  }\n\n  step(dt: number) {\n    if (this.cell.temperature === Temperature.Cold) {\n      this.percentFrozen += (1 / this.turnsToDie) * dt;\n    } else if (this.cell.temperature === Temperature.Freezing) {\n      this.percentFrozen += (10 / this.turnsToDie) * dt;\n    } else {\n      this.percentFrozen -= (10 / this.turnsToDie) * dt;\n    }\n    this.onFrozenChanged();\n\n    throw new StopStep();\n  }\n\n  onFrozenChanged() {\n    if (this.percentFrozen > 1) {\n      this.cell.die();\n    } else if (this.percentFrozen < 0) {\n      this.remove();\n    }\n  }\n}\n\nexport abstract class Cell extends Tile implements HasEnergy, Interactable {\n  static displayName = \"Cell\";\n  static diffusionWater = params.cellDiffusionWater;\n  static diffusionSugar = params.cellDiffusionSugar;\n  static turnsToBuild = params.cellGestationTurns;\n  public energy: number = params.cellEnergyMax;\n  public darkness = 0;\n  public nextTemperature: number;\n  // offset [-0.5, 0.5] means you're still \"inside\" this cell, going out of it will break you\n  // public offset = new Vector2();\n  public droopY = 0;\n  public args: any[] = [];\n  public effects: CellEffect[] = [];\n\n  get tempo() {\n    if (this.temperatureFloat <= 0) {\n      // 50% slower - 1 / 2;\n      return 1 / 2;\n    } else if (this.temperatureFloat <= 32) {\n      // 33% slower - 2 / (2 / 3) = 3\n      return 2 / 3;\n    } else if (this.temperatureFloat <= 64) {\n      return 1;\n    } else if (this.temperatureFloat <= 96) {\n      // 50% faster\n      return 1.5;\n    } else {\n      // 100% faster\n      return 2;\n    }\n  }\n\n  constructor(pos: Vector2, world: World) {\n    super(pos, world);\n    this.temperatureFloat = 48;\n    this.nextTemperature = this.temperatureFloat;\n  }\n\n  addEffect(effect: CellEffect) {\n    const stacks = (effect.constructor as CellEffectConstructor).stacks;\n    if (!stacks) {\n      // exit early if we found another one and we don't stack\n      if (this.findEffectOfType(effect.constructor as CellEffectConstructor) != null) {\n        return;\n      }\n    }\n    effect.attachTo(this);\n    this.effects.push(effect);\n  }\n\n  findEffectOfType(type: CellEffectConstructor) {\n    return this.effects.find((e) => e.constructor === type);\n  }\n\n  interact(dt: number) {\n    let anyInteracted = false;\n    for (const e of this.effects) {\n      if (isInteractable(e)) {\n        const interacted = e.interact(dt);\n        anyInteracted = anyInteracted || interacted;\n      }\n    }\n    return anyInteracted;\n  }\n\n  die() {\n    this.world.setTileAt(this.pos, new DeadCell(this.pos, this.world));\n  }\n\n  isHungry() {\n    // eat below 95% energy\n    return this.energy < params.cellEnergyMax * 0.95;\n  }\n\n  // Step cells every 3 frames\n  shouldStep(dt: number) {\n    return dt > 3;\n  }\n\n  step(dt: number) {\n    const { tempo } = this;\n    super.step(dt);\n    this.energy -= 1 * tempo * dt;\n    for (const effect of this.effects) {\n      effect.step(dt);\n    }\n    const tileNeighbors = this.world.tileNeighbors(this.pos);\n    const neighbors = Array.from(tileNeighbors.values());\n\n    // eat from self\n    if (this.isHungry()) {\n      this.stepEatSugar(this);\n    }\n    // eat from neighbor's sugars\n    if (this.isHungry()) {\n      // const neighborsAndSelf = [this, ...neighbors];\n      for (const tile of neighbors) {\n        this.stepEatSugar(tile);\n        if (!this.isHungry()) {\n          break;\n        }\n      }\n    }\n    // still hungry; take neighbor's energy\n    if (this.isHungry()) {\n      const energeticNeighbors = (neighbors.filter((t) => hasEnergy(t)) as any) as HasEnergy[];\n      this.stepEqualizeEnergy(energeticNeighbors, tempo, dt);\n    }\n\n    // this.stepStress(tileNeighbors);\n    this.stepDroop(tileNeighbors, dt);\n    // TODO scale droop by dt\n    if (this.droopY > 0.5) {\n      if (this.pos.y < this.world.height - 1) {\n        // make the player ride the train!\n        if (this.world.player.pos.equals(this.pos)) {\n          this.world.player.pos.y += 1;\n        }\n        this.world.maybeRemoveCellAt(this.pos);\n        this.pos.y += 1;\n        this.droopY -= 1;\n        this.world.setTileAt(this.pos, this);\n      }\n    }\n\n    if (this.energy <= 0) {\n      this.die();\n    }\n  }\n\n  stepEatSugar(tile: Tile) {\n    if (!(tile instanceof Fruit)) {\n      const hunger = params.cellEnergyMax - this.energy;\n      // if this number goes up, we become less energy efficient\n      // if this number goes down, we are more energy efficient\n      const energyToSugarConversion = traitMod(this.world.traits.energyEfficiency, 1 / params.cellEnergyMax, 1 / 1.5);\n      const sugarToEat = Math.min(hunger * energyToSugarConversion, tile.inventory.sugar);\n      // eat if we're hungry\n      if (hunger > 100 && sugarToEat > 0) {\n        tile.inventory.add(0, -sugarToEat);\n        const gotEnergy = sugarToEat / energyToSugarConversion;\n        this.energy += gotEnergy;\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Take energy from neighbors who have more than you\n   */\n  stepEqualizeEnergy(neighbors: HasEnergy[], tempo: number, dt: number) {\n    for (const neighbor of neighbors) {\n      if (this.isHungry()) {\n        const difference = neighbor.energy - this.energy;\n        if (difference > 20) {\n          // safe method but lower upper bound on equalization rate\n          // energyTransfer = Math.floor((neighbor.energy - this.energy) / energeticNeighbors.length);\n\n          // this may be unstable w/o double buffering\n          const rate = 0.125 * tempo * dt;\n          const energyTransfer = Math.floor(difference * clamp(rate, 0, 0.5));\n          // if (rate > 0.5) {\n          //   console.warn(\"energy transfer rate wants to be unstable\", rate);\n          // }\n          this.energy += energyTransfer;\n          neighbor.energy -= energyTransfer;\n        }\n      } else {\n        break; // we're all full, eat no more\n      }\n    }\n  }\n\n  stepTemperature(dt: number) {\n    const neighbors = this.world.tileNeighbors(this.pos);\n    this.nextTemperature = nextTemperature(this, neighbors, dt);\n\n    // if we're cold, try to naturally heat ourselves\n    if (this.temperatureFloat <= 32) {\n      const chanceToFreeze =\n        traitMod(this.world.traits.coldTolerant, this.temperature === Temperature.Cold ? 0.001 : 0.01, 1 / 1.5) * dt;\n      if (Math.random() < chanceToFreeze) {\n        this.addEffect(new FreezeEffect());\n      }\n    } else if (this.temperatureFloat >= 64) {\n      const chanceToLoseWater =\n        traitMod(this.world.traits.heatTolerant, this.temperature === Temperature.Hot ? 0.001 : 0.01, 1 / 1.5) * dt;\n      if (Math.random() < chanceToLoseWater) {\n        this.inventory.add(Math.max(-1, this.inventory.water), 0);\n      }\n    }\n  }\n\n  stepDroop(tileNeighbors: Map<Vector2, Tile>, dt: number) {\n    const below = tileNeighbors.get(DIRECTIONS.s)!;\n    const belowLeft = tileNeighbors.get(DIRECTIONS.sw)!;\n    const belowRight = tileNeighbors.get(DIRECTIONS.se)!;\n\n    const left = tileNeighbors.get(DIRECTIONS.w)!;\n    const right = tileNeighbors.get(DIRECTIONS.e)!;\n\n    const above = tileNeighbors.get(DIRECTIONS.n)!;\n    const aboveLeft = tileNeighbors.get(DIRECTIONS.nw)!;\n    const aboveRight = tileNeighbors.get(DIRECTIONS.ne)!;\n\n    const droopAmount = traitMod(this.world.traits.structuralStability, params.droop, 1 / 1.5) * dt;\n    this.droopY += droopAmount;\n    if (this.energy < params.cellEnergyMax / 2) {\n      this.droopY += droopAmount;\n    }\n\n    let hasSupportBelow = false;\n    for (const cell of [below, belowLeft, belowRight]) {\n      if (cell instanceof Rock || cell instanceof Soil) {\n        this.droopY = Math.min(this.droopY, 0);\n        return;\n      } else if (cell instanceof Cell) {\n        this.droopY = Math.min(this.droopY, cell.droopY);\n        hasSupportBelow = true;\n        return;\n      }\n    }\n\n    const springNeighborCells = [aboveLeft, above, aboveRight, left, right, this].filter(\n      (n) => n instanceof Cell\n    ) as Cell[];\n\n    // special case - if there's no support and nothing below me, just start freefalling\n    if (!hasSupportBelow && springNeighborCells.length === 1) {\n      this.droopY += 1;\n    } else {\n      // TODO tighten springs scaled by dt\n      this.droopY = springNeighborCells.reduce((sum, n) => sum + n.droopY, 0) / springNeighborCells.length;\n    }\n  }\n}\n\nexport class GrowingCell extends Cell {\n  public isObstacle = true;\n  public timeRemaining: number;\n  public timeToBuild: number;\n  public inventory = new Inventory(0, this);\n  constructor(pos: Vector2, world: World, public completedCell: Cell) {\n    super(pos, world);\n    this.timeRemaining = this.timeToBuild = (completedCell.constructor as any).turnsToBuild || 0;\n  }\n  step(dt: number) {\n    super.step(dt);\n    this.timeRemaining -= 1 * this.tempo * dt;\n    if (this.timeRemaining <= 0) {\n      this.world.setTileAt(this.completedCell.pos, this.completedCell);\n    }\n  }\n}\n\nexport class Tissue extends Cell implements HasInventory {\n  static displayName = \"Tissue\";\n  public inventory: Inventory;\n  constructor(pos: Vector2, world: World) {\n    super(pos, world);\n    this.inventory = new Inventory(\n      Math.floor(traitMod(world.traits.carryCapacity, params.tissueInventoryCapacity, 1.5)),\n      this\n    );\n  }\n}\n\ninterface IHasTilePairs {\n  tilePairs: Vector2[];\n}\n\nexport function hasTilePairs(t: any): t is IHasTilePairs {\n  return t.tilePairs instanceof Array;\n}\n\nexport class Leaf extends Cell {\n  static displayName = \"Leaf\";\n  public isObstacle = true;\n  public averageEfficiency = 0;\n  public averageSpeed = 0;\n  public sugarConverted = 0;\n  public tilePairs: Vector2[] = []; // implied that the opposite direction is connected\n  public totalSugarProduced = 0;\n  public inventory = new Inventory(0, this);\n\n  public step(dt: number) {\n    super.step(dt);\n    const neighbors = this.world.tileNeighbors(this.pos);\n    this.averageEfficiency = 0;\n    this.averageSpeed = 0;\n    this.sugarConverted = 0;\n    let numAir = 0;\n    this.tilePairs = [];\n\n    for (const [dir, tile] of neighbors) {\n      const oppositeTile = this.world.tileAt(this.pos.x - dir.x, this.pos.y - dir.y);\n      if (tile instanceof Air && oppositeTile instanceof Tissue) {\n        numAir += 1;\n        this.tilePairs.push(dir);\n        const air = tile;\n        const tissue = oppositeTile;\n\n        // do the reaction slower in dark places\n        const speed = air.sunlight();\n\n        // gives much less sugar lower down\n        const efficiency = air.co2();\n\n        this.averageEfficiency += efficiency;\n        this.averageSpeed += speed;\n\n        const leafReactionRate = traitMod(this.world.traits.photosynthesis, 0.01, 1.5) * this.tempo;\n\n        // in prime conditions:\n        //      our rate of conversion is speed * params.leafReactionRate\n        //      we get 1 sugar at 1/efficiencyRatio (> 1) water\n        // if we have less than 1/efficiencyRatio water\n        //      our rate of conversion scales down proportionally\n        //      on conversion, we use up all the available water and get the corresponding amount of sugar\n        const bestEfficiencyWater = params.leafSugarPerReaction / efficiency;\n        const waterToConvert = Math.min(tissue.inventory.water, bestEfficiencyWater);\n        const chance = (speed * leafReactionRate * waterToConvert * dt) / bestEfficiencyWater;\n        if (Math.random() < chance) {\n          const sugarConverted = waterToConvert * efficiency;\n          tissue.inventory.add(-waterToConvert, sugarConverted);\n          this.sugarConverted += sugarConverted;\n          this.totalSugarProduced += sugarConverted;\n        }\n      }\n    }\n    if (numAir > 0) {\n      this.averageEfficiency /= numAir;\n      // this.averageSpeed /= numAir;\n    }\n  }\n}\n\nexport class Root extends Cell implements Interactable {\n  static displayName = \"Root\";\n  public isObstacle = true;\n  public activeNeighbors: Vector2[] = [];\n  public inventory = new Inventory(params.tissueInventoryCapacity, this);\n  cooldown = 0;\n  public totalSucked = 0;\n\n  interact(dt: number) {\n    super.interact(dt);\n    // give water to player\n    const player = this.world.player;\n    this.inventory.give(player.inventory, 0.25, 0);\n    return true;\n  }\n\n  public step(dt: number) {\n    super.step(dt);\n    if (this.cooldown <= 0) {\n      this.stepWaterTransfer(dt);\n      this.cooldown += traitMod(this.world.traits.rootAbsorption, params.rootTurnsPerTransfer, 1 / 1.5);\n    }\n    this.cooldown -= 1 * this.tempo * dt;\n  }\n\n  private stepWaterTransfer(_dt: number) {\n    this.activeNeighbors = [];\n    const neighbors = this.world.tileNeighbors(this.pos);\n    let doneOnce = false;\n    for (const [dir, tile] of neighbors) {\n      if (tile instanceof Soil) {\n        this.activeNeighbors.push(dir);\n        if (!doneOnce) {\n          const { water } = tile.inventory.give(this.inventory, 1, 0);\n          this.totalSucked += water;\n          if (water > 0) {\n            doneOnce = true;\n          }\n        }\n      }\n    }\n  }\n}\n\nexport class Fruit extends Cell {\n  static displayName = \"Fruit\";\n  public isObstacle = true;\n  public inventory = new Inventory(8, this);\n  public neededResources: number;\n  public committedResources: Inventory; // = new Inventory(Fruit.neededResources, this);\n  public timeMatured?: number;\n  static turnsToBuild = 0;\n  public turnsToMature: number; // = TIME_PER_SEASON / 3 * 2; // takes two months to mature\n  get oneTurnCommitMax() {\n    return this.neededResources / this.turnsToMature;\n  }\n\n  constructor(pos: Vector2, world: World) {\n    super(pos, world);\n    this.neededResources = Math.ceil(traitMod(world.traits.fruitNeededResources, 100, 1 / 1.5) / 2) * 2;\n    this.committedResources = new Inventory(this.neededResources, this);\n    this.committedResources.on(\"get\", this.handleGetResources);\n    this.turnsToMature = Math.ceil(traitMod(world.traits.fruitGrowthSpeed, (TIME_PER_SEASON / 3) * 2, 1 / 1.5));\n  }\n\n  handleGetResources = () => {\n    if (this.timeMatured == null && this.isMature()) {\n      this.timeMatured = this.world.time;\n      this.committedResources.off(\"get\", this.handleGetResources);\n    }\n  };\n\n  // aggressively take the inventory from neighbors\n  step(dt: number) {\n    super.step(dt);\n    // how fast Fruit takes resources from surrounding tiles and puts it onto itself\n    // to be committed\n    const maxResourceIntake = 1 * dt * this.tempo;\n    const neighbors = this.world.tileNeighbors(this.pos);\n    for (const [, neighbor] of neighbors) {\n      if (neighbor instanceof Cell && !(neighbor instanceof Fruit)) {\n        const wantedWater = Math.min(this.neededResources / 2 - this.committedResources.water, maxResourceIntake);\n        const wantedSugar = Math.min(this.neededResources / 2 - this.committedResources.sugar, maxResourceIntake);\n\n        neighbor.inventory.give(this.inventory, wantedWater, wantedSugar);\n      }\n    }\n    this.commitResources(dt);\n  }\n\n  commitResources(dt: number) {\n    const wantedWater = Math.min(\n      this.neededResources / 2 - this.committedResources.water,\n      (this.oneTurnCommitMax / 2) * dt * this.tempo\n    );\n    const wantedSugar = Math.min(\n      this.neededResources / 2 - this.committedResources.sugar,\n      (this.oneTurnCommitMax / 2) * dt * this.tempo\n    );\n    this.inventory.give(this.committedResources, wantedWater, wantedSugar);\n  }\n\n  getPercentMatured() {\n    const r = this.committedResources;\n    return (r.sugar + r.water) / r.capacity;\n  }\n\n  isMature() {\n    // add 1 buffer for fp errors\n    return this.committedResources.water + this.committedResources.sugar >= this.neededResources - 1;\n  }\n}\n\nfunction isFractional(x: number) {\n  return x % 1 !== 0;\n}\n\nexport class Transport extends Tissue {\n  static displayName = \"Transport\";\n  public cooldownWater = 0;\n  public cooldownSugar = 0;\n\n  constructor(pos: Vector2, world: World, public dir: Vector2) {\n    super(pos, world);\n    if (isFractional(dir.x) || isFractional(dir.y)) {\n      throw new Error(\"build transport with fractional dir \" + dir.x + \", \" + dir.y);\n    }\n  }\n\n  step(dt: number) {\n    super.step(dt);\n    // transport hungers at double speed\n    this.energy -= 1 * this.tempo * dt;\n    let waterToTransport = 0;\n    let sugarToTransport = 0;\n    if (this.cooldownWater <= 0) {\n      waterToTransport++;\n      const turnsPerWater = Math.floor(traitMod(this.world.traits.activeTransportWater, 20, 1 / 1.5));\n      this.cooldownWater += turnsPerWater;\n    }\n    if (this.cooldownSugar <= 0) {\n      sugarToTransport++;\n      const turnsPerSugar = Math.floor(traitMod(this.world.traits.activeTransportSugar, 20, 1 / 1.5));\n      this.cooldownSugar += turnsPerSugar;\n    }\n\n    if (waterToTransport > 0 || sugarToTransport > 0) {\n      const targetTile = this.getTarget();\n      if (targetTile) {\n        this.inventory.give(targetTile.inventory, waterToTransport, sugarToTransport);\n      }\n\n      const fromTile = this.getFrom();\n      if (fromTile) {\n        fromTile.inventory.give(this.inventory, waterToTransport, sugarToTransport);\n      }\n    }\n    this.cooldownWater -= 1 * dt * this.tempo;\n    this.cooldownSugar -= 1 * dt * this.tempo;\n  }\n\n  public getTarget() {\n    const targetTile = this.world.tileAt(this.pos.x + this.dir.x, this.pos.y + this.dir.y);\n    if (targetTile instanceof Cell) {\n      return targetTile;\n    }\n  }\n\n  public getFrom() {\n    const fromTile = this.world.tileAt(this.pos.x - this.dir.x, this.pos.y - this.dir.y);\n    if (fromTile instanceof Cell) {\n      return fromTile;\n    }\n  }\n}\n\nexport class Vein extends Tissue {\n  static displayName = \"Vein\";\n  // static diffusionWater = 0;\n  static get diffusionWater() {\n    return params.veinDiffusion;\n  }\n  static get diffusionSugar() {\n    return params.veinDiffusion;\n  }\n  public inventory = new Inventory(8, this);\n  // diffusionNeighbors(neighbors: Map<Vector2, Tile>) {\n  //     return super.diffusionNeighbors(neighbors).filter((t) => t instanceof Vein);\n  // }\n}\n","import { createSimpleSchema, object } from \"serializr\";\nimport { Vector2 } from \"three\";\nimport { Noise } from \"../../../common/perlin\";\nimport { map } from \"../../../math\";\nimport { params } from \"../params\";\nimport { Fountain, Rock, Soil, Tile } from \"./tile\";\nimport { World } from \"./world\";\n\nexport interface Environment {\n  climate: {\n    turnsBetweenRainfall: number;\n    rainDuration: number;\n    waterPerDroplet: number;\n  };\n  waterGravityPerTurn: number;\n  evaporationRate: number;\n  evaporationBottom: number;\n  floorCo2: number;\n  fill: FillFunctionName;\n}\n\nexport const EnvironmentSchema = createSimpleSchema<Environment>({\n  climate: object(createSimpleSchema({ \"*\": true })),\n  \"*\": true,\n});\n\nexport type FillFunction = (pos: Vector2, world: World) => Tile | undefined;\n\n// TODO put this somewhere\nconst noiseWater = new Noise(2);\nconst noiseRock = new Noise(2);\nconst noiseHeight = new Noise(2);\n\nexport const FILL_FUNCTIONS = {\n  Temperate: [\n    (pos, world) => {\n      const { x, y } = pos;\n      const soilLevel =\n        world.height / 2 - (4 * (noiseHeight.perlin2(0, x / 5) + 1)) / 2 - 16 * noiseHeight.perlin2(10, x / 20 + 10);\n      const rockThreshold = map(y - world.height / 2, 0, world.height / 2, -0.7, 0.3);\n      const isRock = noiseRock.simplex2(x / 5, y / 5) < rockThreshold;\n      if (y > soilLevel) {\n        if (isRock) {\n          const rock = new Rock(pos, world);\n          return rock;\n        } else {\n          const heightScalar = Math.pow(map(y - world.height / 2, 0, world.height / 2, 0.5, 1), 2);\n          const simplexScalar = 0.2;\n          // this 0.1 factor makes a *huge* difference\n          const simplexValue = noiseWater.simplex2(x * simplexScalar, y * simplexScalar) + 0.2;\n          const water = Math.round(\n            Math.max(\n              1,\n              Math.min(\n                // should be soil_max_water, isn't cuz of dependency cycles messing up instantiation\n                20,\n                simplexValue > 0.4 ? 20 * heightScalar : 0\n              )\n            )\n          );\n          if (heightScalar * simplexValue > 1 / params.fountainAppearanceRate) {\n            const emitWaterScalar = Math.min(heightScalar * simplexValue, 1);\n            return new Fountain(pos, water, world, Math.round(params.fountainTurnsPerWater / emitWaterScalar));\n          } else {\n            return new Soil(pos, water, world);\n          }\n        }\n      }\n    },\n  ] as FillFunction[],\n  Desert: [\n    (pos, world) => {\n      const { x, y } = pos;\n      const soilLevel =\n        world.height / 2 - (2 * (noiseHeight.perlin2(0, x / 20) + 1)) / 2 - 3 * noiseHeight.perlin2(10, x / 100 + 10);\n\n      const rockThreshold = map(y, world.height / 2, world.height, -0.8, -0.4);\n      const isRock = noiseRock.simplex2(x / 4, y / 4) < rockThreshold;\n      if (y > soilLevel) {\n        if (isRock) {\n          return new Rock(pos, world);\n        }\n        const water = Math.floor(Math.max(0, map(y, world.height * 0.75, world.height, 1, 9)));\n        return new Soil(pos, water, world);\n      }\n    },\n  ] as FillFunction[],\n  Rocky: [\n    (pos, world) => {\n      const { x, y } = pos;\n      const soilLevel =\n        world.height * 0.55 -\n        (4 * (noiseHeight.perlin2(0, x / 5) + 1)) / 2 -\n        16 * noiseHeight.perlin2(10, x / 20 + 10) -\n        map(x, 0, world.width, 10, -10);\n      const rockLevel = y - (6 * (noiseHeight.perlin2(0, x / 25) + 1)) / 2 - 20 * noiseHeight.perlin2(10, x / 150 + 10);\n      const rockThreshold = rockLevel < world.height * 0.5 ? -1 : -0.15;\n      const isRock = noiseRock.simplex2(x / 10, y / 10) < rockThreshold;\n      if (isRock) {\n        const rock = new Rock(pos, world);\n        return rock;\n      } else if (y > soilLevel) {\n        return new Soil(pos, 3, world);\n      }\n    },\n  ] as FillFunction[],\n};\n\nexport type FillFunctionName = keyof typeof FILL_FUNCTIONS;\n\nexport const Temperate = () => {\n  const environment: Environment = {\n    climate: {\n      turnsBetweenRainfall: 800,\n      rainDuration: 50,\n      waterPerDroplet: 2,\n    },\n    evaporationRate: 0.0002,\n    evaporationBottom: 0.6,\n    floorCo2: 0.3333,\n    waterGravityPerTurn: 0.005,\n    fill: \"Temperate\",\n  };\n  return environment;\n};\n\nexport const Desert = () => {\n  const e: Environment = {\n    climate: {\n      rainDuration: 220,\n      turnsBetweenRainfall: 3300,\n      waterPerDroplet: 8,\n    },\n    evaporationRate: 0.002,\n    evaporationBottom: 0.7,\n    waterGravityPerTurn: 0.02,\n    floorCo2: 0.95,\n    fill: \"Desert\",\n  };\n  return e;\n};\n\nexport const Rocky = () => {\n  const e: Environment = {\n    climate: {\n      turnsBetweenRainfall: 2500,\n      rainDuration: 120,\n      waterPerDroplet: 3,\n    },\n    waterGravityPerTurn: 0.1,\n    evaporationBottom: 0.6,\n    evaporationRate: 0.001,\n    floorCo2: 1,\n    fill: \"Rocky\",\n  };\n  return e;\n};\n\nexport const ALL_ENVIRONMENTS = {\n  Temperate,\n  Desert,\n  Rocky,\n};\n\nexport type EnvironmentName = keyof typeof ALL_ENVIRONMENTS;\n","import { createSimpleSchema, object, primitive, reference } from \"serializr\";\nimport { Species, SpeciesSchema } from \"../evolution/species\";\nimport { Environment, EnvironmentSchema } from \"../sketches/mito/game/environment\";\n\nexport interface LevelInfo {\n  height: number; // [-1 to 6], integers only\n  temperature?: \"cold\" | \"temperate\" | \"hot\";\n  rainfall?: \"low\" | \"medium\" | \"high\";\n  soilType?: \"barren\" | \"average\" | \"fertile\";\n  wind?: \"low\" | \"medium\" | \"high\";\n  visible: boolean;\n  environment?: Environment;\n  flora?: {\n    species: Species;\n    mutationPointsPerEpoch: number;\n    actionPoints: number;\n  };\n}\n\nexport const LevelInfoSchema = createSimpleSchema<LevelInfo>({\n  // \"*\": true,\n  height: primitive(),\n  temperature: primitive(),\n  rainfall: primitive(),\n  soilType: primitive(),\n  wind: primitive(),\n  visible: primitive(),\n  environment: object(EnvironmentSchema),\n\n  flora: object(\n    createSimpleSchema({\n      species: reference(SpeciesSchema),\n      mutationPointsPerEpoch: primitive(),\n      actionPoints: primitive(),\n    })\n  ),\n});\n","import { identifier, object, serializable } from \"serializr\";\nimport uuid from \"uuid\";\nimport { LevelInfo, LevelInfoSchema } from \"./levelInfo\";\n\nconst C = Math.sqrt(3) / 2;\n\nexport class HexTile {\n  @serializable(identifier())\n  private uuid = uuid();\n\n  @serializable(object(LevelInfoSchema))\n  info: LevelInfo = {\n    height: 0,\n    rainfall: \"medium\",\n    soilType: \"average\",\n    temperature: \"temperate\",\n    wind: \"low\",\n    visible: false,\n  };\n  @serializable\n  public i: number;\n  @serializable\n  public j: number;\n\n  // Handle 0 arg constructor from serializr\n  constructor(i?: number, j?: number) {\n    this.i = i!;\n    this.j = j!;\n  }\n\n  get cartesian() {\n    const { i, j } = this;\n    // simplified version:\n    // x = i - 0.5j - 0.5*-(i + j)\n    // x = i - 0.5j + 0.5i + 0.5j\n    // x = 1.5i\n    // y = Cj - C*-(i + j)\n    // y = Cj + Ci + Cj\n    // y = 2Cj + Ci\n    return {\n      x: 1.5 * i,\n      y: 2 * C * j + C * i,\n    };\n  }\n\n  get isHabitable() {\n    return this.info.height !== -1;\n  }\n\n  get k() {\n    return -(this.i + this.j);\n  }\n\n  get magnitude() {\n    return Math.abs(this.i) + Math.abs(this.j) + Math.abs(this.k);\n  }\n}\n","import { map, object, serializable } from \"serializr\";\nimport { HexTile } from \"./hexTile\";\n\nexport class HexStore {\n  @serializable(map(object(HexTile)))\n  tiles: { [k: string]: HexTile } = {};\n\n  private hash(i: number, j: number) {\n    return `${i},${j}`;\n  }\n\n  get(i: number, j: number) {\n    return this.tiles[this.hash(i, j)];\n  }\n\n  set(i: number, j: number, tile: HexTile) {\n    this.tiles[this.hash(i, j)] = tile;\n  }\n\n  *[Symbol.iterator]() {\n    for (const key in this.tiles) {\n      yield this.tiles[key];\n    }\n  }\n}\n","import { Species } from \"evolution/species\";\nimport { object, reference, serializable } from \"serializr\";\nimport SimplexNoise from \"simplex-noise\";\nimport { Desert, Rocky, Temperate } from \"../sketches/mito/game/environment\";\nimport { HexStore } from \"./hexStore\";\nimport { HexTile } from \"./hexTile\";\n\nexport class OverWorld {\n  @serializable(object(HexStore))\n  storage: HexStore;\n  @serializable(reference(HexTile))\n  startTile: HexTile;\n\n  constructor(storage?: HexStore, startTile?: HexTile) {\n    this.storage = storage!;\n    this.startTile = startTile!;\n\n    // ensure the start tile is visible\n    if (this.startTile) {\n      this.startTile.info.visible = true;\n    }\n  }\n\n  private static randomHeight(tile: HexTile, noise: SimplexNoise) {\n    const { x, y } = tile.cartesian;\n    let height = 0;\n    height += (noise.noise3D(x / 24, y / 24, 0) - 0.2) * 6;\n    height += noise.noise3D(x / 24, y / 24, 1.453) * 6;\n    height += noise.noise3D(x / 6, y / 6, 1.453) * 1.5;\n    height += 1;\n    // info.height += 4 - Math.abs(tile.magnitude * tile.magnitude) * 0.02;\n    height -= Math.abs(y * y) * 0.025;\n    if (height < 0 && height >= -1) {\n      height = 0;\n    }\n    height = Math.round(Math.max(Math.min(height, 6), -1));\n    return height;\n  }\n\n  private static populateLevelInfo(tile: HexTile, noise: SimplexNoise) {\n    const { info } = tile;\n    info.height = OverWorld.randomHeight(tile, noise);\n\n    info.environment = info.height < 2 ? Temperate() : info.height < 4 ? Rocky() : Desert();\n  }\n\n  static generateFilledHex(maxDist: number = 20): OverWorld {\n    const storage = new HexStore();\n    const noise = new SimplexNoise();\n    // the rule is: i + j + k = 0\n    // abs(i) <= maxDist\n    // abs(j) <= maxDist\n    // abs(k) <= maxDist\n    for (let i = -maxDist; i <= maxDist; i++) {\n      for (let j = -maxDist; j <= maxDist; j++) {\n        let k = -(i + j);\n        if (Math.abs(k) > maxDist) {\n          continue;\n        }\n        const tile = new HexTile(i, j);\n        OverWorld.populateLevelInfo(tile, noise);\n        storage.set(i, j, tile);\n      }\n    }\n    const startTile = OverWorld.getDefaultStartTile(storage);\n    return new OverWorld(storage, startTile);\n  }\n\n  static generateRectangle(width: number = 50, height: number = 25): OverWorld {\n    const storage = new HexStore();\n    const noise = new SimplexNoise();\n    // the rule is: i + j + k = 0\n    // abs(i) <= maxDist\n    // abs(j) <= maxDist\n    // abs(k) <= maxDist\n    const maxDist = Math.max(width / 2, height / 2);\n\n    for (let i = -maxDist; i <= maxDist; i++) {\n      for (let j = -maxDist; j <= maxDist; j++) {\n        let k = -(i + j);\n        if (Math.abs(k) > maxDist) {\n          continue;\n        }\n        const tile = new HexTile(i, j);\n        const { x, y } = tile.cartesian;\n        if (x < -width / 2 || x > width / 2 || y < -height / 2 || y > height / 2) {\n          continue;\n        }\n\n        OverWorld.populateLevelInfo(tile, noise);\n        storage.set(i, j, tile);\n      }\n    }\n\n    const startTile = OverWorld.getDefaultStartTile(storage);\n    return new OverWorld(storage, startTile);\n  }\n\n  static getDefaultStartTile(storage?: HexStore) {\n    if (storage == null) {\n      return undefined;\n    }\n    const tiles = Array.from(storage);\n    return tiles.filter((t) => t.info.height === 0).sort((t1, t2) => t1.magnitude - t2.magnitude)[0];\n  }\n\n  /**\n   * store neighbors at angles [30, 90, 150, 210, 270, 330]\n   *\n   * 30: (1, 0, -1)\n   *\n   * 90: (0, 1, -1)\n   *\n   * 150: (-1, 1, 0)\n   *\n   * 210: (-1, 0, 1)\n   *\n   * 270: (0, -1, 1)\n   *\n   * 330: (1, -1, 0)\n   */\n  public hexNeighbors(hex: HexTile) {\n    const { i, j } = hex;\n    const neighbors: HexTile[] = [];\n    neighbors[0] = this.storage.get(i + 1, j);\n    neighbors[1] = this.storage.get(i, j + 1);\n    neighbors[2] = this.storage.get(i - 1, j + 1);\n    neighbors[3] = this.storage.get(i - 1, j);\n    neighbors[4] = this.storage.get(i, j - 1);\n    neighbors[5] = this.storage.get(i + 1, j - 1);\n    return neighbors;\n  }\n\n  /**\n   * For a given target hex, find the source hexes that\n   * can migrate into it.\n   */\n  public possibleMigrationSources(target: HexTile) {\n    const populatedActiveNeighbors = this.hexNeighbors(target).filter((hex) => {\n      return hex.info.flora != null && hex.info.flora.actionPoints > 0;\n    });\n    if (target.info.flora == null) {\n      // if the target is unpopulated, allow any neighbor to migrate into it\n      return populatedActiveNeighbors;\n    } else {\n      // if the target is already populated, disallow \"migration\" from the same source species\n      return populatedActiveNeighbors.filter((s) => s.info.flora!.species !== target.info.flora!.species);\n    }\n  }\n\n  public possibleMigrationTargets(source: HexTile) {\n    if (source.info.flora == null) {\n      console.error(\"can't migrate from a null flora source\");\n      return [];\n    }\n    // can't migrate if you're out of points\n    if (source.info.flora.actionPoints < 1) {\n      return [];\n    }\n    const unpopulatedNeighbors = this.hexNeighbors(source).filter((hex) => {\n      // find neighbors that are either:\n      //  unpopulated, or\n      //  populated but with a different species\n      return hex.info.flora == null || hex.info.flora.species !== source.info.flora!.species;\n    });\n    return unpopulatedNeighbors;\n  }\n\n  public getStartTile() {\n    return this.startTile;\n  }\n\n  public hexAt(i: number, j: number) {\n    return this.storage.get(i, j);\n  }\n\n  *[Symbol.iterator]() {\n    for (const tile of this.storage) {\n      yield tile;\n    }\n  }\n\n  resetActionPoints() {\n    for (const tile of this.storage) {\n      if (tile.info.flora) {\n        tile.info.flora.actionPoints = 1;\n      }\n    }\n  }\n\n  unusedHexes() {\n    const hexes = [];\n    for (const tile of this.storage) {\n      if (tile.info.flora && tile.info.flora.actionPoints > 0) {\n        hexes.push(tile);\n      }\n    }\n    return hexes;\n  }\n\n  getMaxGenePool(species: Species) {\n    let pool = 0;\n    for (const tile of this.storage) {\n      const { flora } = tile.info;\n      if (flora && flora.species === species) {\n        pool += flora.mutationPointsPerEpoch;\n      }\n    }\n    return pool;\n  }\n}\n","import { createSimpleSchema, object, reference } from \"serializr\";\nimport { Species, SpeciesSchema } from \"../evolution/species\";\nimport { HexTile } from \"../overworld/hexTile\";\nimport { OverWorld } from \"../overworld/overWorld\";\nimport { GameResult } from \"../sketches/mito\";\n\n/**\n * For now, we mutate classes and manually call dummy placeholder\n * actions to get a state update.\n */\nexport interface AppState {\n  overWorld: OverWorld;\n  /**\n   * Determines whether we're in the game or in the overworld.\n   *\n   * Null activeLevel means we're in overworld.\n   * Non-null means we're in-game, or in the game results screen.\n   */\n  activePopulationAttempt?: PopulationAttempt;\n  /**\n   * Determines whether to show the game over screen. While non-null,\n   * we show a game result screen.\n   */\n  activeGameResult?: GameResult;\n  rootSpecies: Species;\n  // species: Record<string, Species>;\n  epoch: number;\n}\n\nexport interface PopulationAttempt {\n  sourceHex?: HexTile;\n  targetHex: HexTile;\n  settlingSpecies: Species;\n}\n\nconst PopulationAttemptSchema = createSimpleSchema<PopulationAttempt>({\n  sourceHex: reference(HexTile),\n  targetHex: reference(HexTile),\n  settlingSpecies: reference(SpeciesSchema),\n});\n\nexport const AppStateSchema = createSimpleSchema<AppState>({\n  overWorld: object(OverWorld),\n  activePopulationAttempt: object(PopulationAttemptSchema),\n  // no activeGameResult\n  rootSpecies: object(SpeciesSchema),\n  epoch: true,\n});\n","import localforage from \"localforage\";\nimport { deserialize, serialize } from \"serializr\";\nimport { AppActions } from \"./reducer\";\nimport { AppState, AppStateSchema } from \"./state\";\n\nconst GAME_DATA_KEY = \"gameData\";\n\nexport function save(appState: AppState) {\n  const json = serialize(AppStateSchema, appState);\n  const stringToSave = JSON.stringify(json);\n  return localforage.setItem(GAME_DATA_KEY, stringToSave);\n}\n\nexport async function load(): Promise<AppState> {\n  const string = await localforage.getItem<string>(GAME_DATA_KEY);\n  const json = JSON.parse(string);\n  const appState = deserialize(AppStateSchema, json);\n  return appState;\n}\n\nexport function resetGame() {\n  const confirm = window.confirm(\"Are you sure you want to reset your whole game?\");\n  if (confirm) {\n    return localforage.removeItem(GAME_DATA_KEY).then(() => {\n      window.location.reload();\n    });\n  } else {\n    return Promise.reject();\n  }\n}\n\nconst ACTIONS_TO_SAVE_ON: Partial<Record<AppActions[\"type\"], true>> = {\n  AAGameResultDone: true,\n  AAGetGameResult: true,\n  AAUpdateSpecies: true,\n  AANextEpoch: true,\n  AAPopulationAttemptSuccess: true,\n  AAStartPopulationAttempt: true,\n};\n\nexport function saveOnActionMiddleware(reducer: React.Reducer<AppState, AppActions>) {\n  console.log(\"new reducer made\");\n  return (state: AppState, action: AppActions) => {\n    const newState = reducer(state, action);\n    if (ACTIONS_TO_SAVE_ON.hasOwnProperty(action.type)) {\n      console.log(\"saved from\", action);\n      save(newState);\n    }\n    return newState;\n  };\n}\n","import React from \"react\";\nimport classNames from \"classnames\";\n\nimport \"./Button.scss\";\n\nexport function Button(props: JSX.IntrinsicElements[\"button\"] & { color?: \"purple\" | \"green\" }) {\n  return (\n    <button {...props} className={classNames(\"button\", props.className, props.color || \"purple\")}>\n      {props.children}\n    </button>\n  );\n}\n","export default [\n  \"Pentzia incana\",\n  \"Alnus\",\n  \"Alnus glutinosa\",\n  \"Ilex verticillata\",\n  \"Alnus glutinosa\",\n  \"Ilex verticillata\",\n  \"Alnus incana\",\n  \"Alnus incana\",\n  \"Ilex verticillata\",\n  \"Alnus incana\",\n  \"Alnus rhombifolia\",\n  \"Ilex verticillata\",\n  \"Prunus dulcis\",\n  \"Ambrosia trifida\",\n  \"Apocynum cannabinum\",\n  \"Brugmansia suaveolens\",\n  \"Malus domestica\",\n  \"Rhanterium epapposum\",\n  \"Cornus florida\",\n  \"Cornus florida\",\n  \"Fraxinus\",\n  \"Acer negundo\",\n  \"Fraxinus nigra\",\n  \"Fraxinus quadrangulata\",\n  \"Fraxinus americana\",\n  \"Fraxinus excelsior\",\n  \"Fraxinus pennsylvanica\",\n  \"Acer negundo\",\n  \"Fraxinus pennsylvanica\",\n  \"Fraxinus pennsylvanica\",\n  \"Fraxinus pennsylvanica\",\n  \"Fraxinus americana\",\n  \"Acer negundo\",\n  \"Fraxinus pennsylvanica\",\n  \"Azolla\",\n  \"Azolla caroliniana\",\n  \"Adansonia\",\n  \"Fabaceae\",\n  \"Phaseolus\",\n  \"Ilex decidua\",\n  \"Veratrum viride\",\n  \"Solanum dulcamara\",\n  \"Daucus carota\",\n  \"Daucus carota\",\n  \"Strelitzia reginae\",\n  \"Betula\",\n  \"Betula lenta\",\n  \"Betula nigra\",\n  \"Betula papyrifera\",\n  \"Betula papyrifera\",\n  \"Betula lenta\",\n  \"Betula pendula\",\n  \"Betula pendula\",\n  \"Betula alleghaniensis\",\n  \"Betula lenta\",\n  \"Betula papyrifera\",\n  \"Betula nigra\",\n  \"Betula nigra\",\n  \"Betula lenta\",\n  \"Betula papyrifera\",\n  \"Betula lenta\",\n  \"Betula lenta\",\n  \"Betula nigra\",\n  \"Betula pendula\",\n  \"Betula papyrifera\",\n  \"Betula pendula\",\n  \"Betula alleghaniensis\",\n  \"Barbarea vulgaris\",\n  \"Cardamine bulbosa\",\n  \"Cardamine hirsuta\",\n  \"Cardamine hirsuta\",\n  \"Solanum dulcamara\",\n  \"Solanum dulcamara\",\n  \"Ambrosia\",\n  \"Ambrosia artemisiifolia\",\n  \"Artemisia trifida\",\n  \"Helenium amarum\",\n  \"Rubus\",\n  \"Rubus pensilvanicus\",\n  \"Rubus occidentalis\",\n  \"Rubus hispidus\",\n  \"Rubus pensilvanicus\",\n  \"Rubus hispidus\",\n  \"Rubus occidentalis\",\n  \"Rudbeckia hirta\",\n  \"Rudbeckia fulgida\",\n  \"Viburnum prunifolium\",\n  \"Rudbeckia hirta\",\n  \"Ambrosia artemisiifolia\",\n  \"Hyacinthoides non-scripta\",\n  \"Allium caeruleum\",\n  \"Maclura pomifera\",\n  \"Buxus\",\n  \"Cornus florida\",\n  \"Acer negundo\",\n  \"Buxus\",\n  \"Cornus florida\",\n  \"Cornus florida\",\n  \"Solanum carolinense\",\n  \"Encelia farinosa\",\n  \"Plantago major\",\n  \"Rudbeckia hirta\",\n  \"Rudbeckia hirta\",\n  \"Rudbeckia triloba\",\n  \"Ambrosia trifida\",\n  \"Ajuga reptans\",\n  \"Asclepias syriaca\",\n  \"Asclepias tuberosa\",\n  \"Brassica oleracea\",\n  \"Symplocarpus foetidus\",\n  \"Symplocarpus foetidus\",\n  \"Symplocarpus foetidus\",\n  \"Lysichiton\",\n  \"Symplocarpus foetidus\",\n  \"Platanus racemosa\",\n  \"Asclepias tuberosa\",\n  \"Phytolacca americana\",\n  \"Daucus carota\",\n  \"Daucus carota\",\n  \"Ambrosia artemisiifolia\",\n  \"Plantago major\",\n  \"Lyonothamnus floribundus\",\n  \"Polygala calcarea\",\n  \"Sinapis arvensis\",\n  \"Prunus\",\n  \"Prunus serotina\",\n  \"Prunus serotina\",\n  \"Prunus serotina\",\n  \"Prunus serotina\",\n  \"Prunus avium\",\n  \"Prunus serotina\",\n  \"Prunus serotina\",\n  \"Asclepias tuberosa\",\n  \"Dendranthema grandiflora\",\n  \"vi\",\n  \"Chrysanthemum morifolium\",\n  \"Cinnamomum verum\",\n  \"Phytolacca americana\",\n  \"Coffea\",\n  \"Corydalis flavula\",\n  \"Symplocarpus foetidus\",\n  \"Aquilegia vulgaris\",\n  \"Sonchus oleraceus\",\n  \"Rudbeckia fulgida\",\n  \"Rudbeckia laciniata\",\n  \"Rudbeckia fulgida\",\n  \"Rudbeckia laciniata\",\n  \"Rudbeckia fulgida\",\n  \"Rudbeckia laciniata\",\n  \"Rudbeckia triloba\",\n  \"Rudbeckia triloba\",\n  \"Cornus amomum\",\n  \"Cornus amomum\",\n  \"Cornus florida\",\n  \"Cornus florida\",\n  \"Corydalis\",\n  \"Corydalis chelidoniifolia\",\n  \"Corydalis aurea\",\n  \"Corydalis flavula\",\n  \"Corydalis sempervirens\",\n  \"Corydalis sempervirens\",\n  \"Corydalis lutea\",\n  \"Corydalis flavula\",\n  \"Gossypium\",\n  \"Rorippa sylvestris\",\n  \"Barbarea verna\",\n  \"Barbarea verna\",\n  \"Barbarea verna\",\n  \"Barbarea verna\",\n  \"Cardamine bulbosa\",\n  \"Cardamine hirsuta\",\n  \"Barbarea verna\",\n  \"Cardamine hirsuta\",\n  \"Barbarea verna\",\n  \"Cardamine bulbosa\",\n  \"Barbarea verna\",\n  \"Cardamine concatenata\",\n  \"Daucus carota\",\n  \"Cardamine concatenata\",\n  \"Rudbeckia hirta\",\n  \"Bellis perennis\",\n  \"Lamium\",\n  \"Lamium amplexicaule\",\n  \"Lamium purpureum\",\n  \"Lamium maculatum\",\n  \"Veratrum viride\",\n  \"Clematis virginiana\",\n  \"Clematis virginiana\",\n  \"Daucus carota\",\n  \"Rubus hispidus\",\n  \"Rubus hispidus\",\n  \"Sonchus arvensis\",\n  \"Cornus\",\n  \"Cornus florida\",\n  \"Cornus florida\",\n  \"Cornus florida\",\n  \"Cornus kousa\",\n  \"Cornus kousa\",\n  \"Moringa oleifera\",\n  \"Cornus nuttallii\",\n  \"Cornus amomum\",\n  \"Cornus amomum\",\n  \"Veratrum viride\",\n  \"Solanum nigrum\",\n  \"Durio zibethinus\",\n  \"Durio testudinarius\",\n  \"Durio grandiflorus\",\n  \"Durio kutejensis\",\n  \"Durio dulcis\",\n  \"Ilex glabra\",\n  \"Cattleya schroederae\",\n  \"Veratrum viride\",\n  \"Sambucus\",\n  \"Lupinus elegans\",\n  \"Dillenia indica\",\n  \"Rudbeckia hirta\",\n  \"Eucalyptus\",\n  \"Vaccinium ovatum\",\n  \"Encalypta\",\n  \"Amphipappus\",\n  \"Achillea ptarmica\",\n  \"Azolla caroliniana\",\n  \"Solanum dulcamara\",\n  \"Solanum dulcamara\",\n  \"Solanum dulcamara\",\n  \"Foeniculum vulgare\",\n  \"Nephrolepis exaltata\",\n  \"Polystichum acrostichoides\",\n  \"Polypodium scouleri\",\n  \"Nephrolepis obliterata\",\n  \"Azolla caroliniana\",\n  \"Polystichum\",\n  \"Azolla caroliniana\",\n  \"Polystichum munitum\",\n  \"Ilex verticillata\",\n  \"Tanacetum parthenium\",\n  \"Myosotis arvensis\",\n  \"Ficus\",\n  \"Ficus carica\",\n  \"Linum usitatissimum\",\n  \"Phormium tenax\",\n  \"Phormium colensoi\",\n  \"Asclepias tuberosa\",\n  \"Digitalis purpurea\",\n  \"Corydalis flavula\",\n  \"Ilex glabra\",\n  \"Phytolacca americana\",\n  \"Allium moly\",\n  \"Allium canadense\",\n  \"Alliaria petiolata\",\n  \"Alliaria petiolata\",\n  \"Veronica chamaedrys\",\n  \"Hesperis matronalis\",\n  \"Hesperis matronalis\",\n  \"Hesperis matronalis\",\n  \"Hesperis matronalis\",\n  \"Hesperis matronalis\",\n  \"Tanacetum vulgare\",\n  \"Laburnum\",\n  \"Rudbeckia laciniata\",\n  \"Rudbeckia hirta\",\n  \"Achillea millefolium\",\n  \"Achillea ptarmica\",\n  \"Vitis\",\n  \"Solanum opacum\",\n  \"Rubus hispidus\",\n  \"Rubus hispidus\",\n  \"Sonchus arvensis\",\n  \"Curcuma domestica\",\n  \"Corydalis sempervirens\",\n  \"Corydalis flavula\",\n  \"Ambrosia artemisiifolia\",\n  \"Artemisia trifida\",\n  \"Plantago major\",\n  \"Maclura pomifera\",\n  \"Helleborus\",\n  \"Veratrum viride\",\n  \"Veratrum viride\",\n  \"Veratrum nigrum\",\n  \"Veratrum album\",\n  \"Veratrum album\",\n  \"Veratrum viride\",\n  \"Veratrum viride\",\n  \"Veratrum album\",\n  \"Veratrum viride\",\n  \"Cannabis\",\n  \"Cannabis sativa\",\n  \"Apocynum cannabinum\",\n  \"Plantago major\",\n  \"Barbarea vulgaris\",\n  \"Ambrosia artemisiifolia\",\n  \"Ilex\",\n  \"Ilex decidua\",\n  \"Ilex verticillata\",\n  \"Ilex aquifolium\",\n  \"Ilex glabra\",\n  \"Ilex decidua\",\n  \"Ilex decidua\",\n  \"Ilex verticillata\",\n  \"Lunaria annua\",\n  \"Ambrosia trifida\",\n  \"Solanum nigrum\",\n  \"Vaccinium\",\n  \"Vaccinium ovatum\",\n  \"Vaccinium parvifolium\",\n  \"Sempervivum tectorum\",\n  \"Apocynum cannabinum\",\n  \"Cannabis indica\",\n  \"Asclepias incarnata\",\n  \"Castilleja\",\n  \"Castilleja mutis\",\n  \"Asclepias tuberosa\",\n  \"Asclepias tuberosa\",\n  \"Ilex glabra\",\n  \"Phytolacca americana\",\n  \"Acacia estrophiolata\",\n  \"Coincya monensis\",\n  \"Veratrum viride\",\n  \"Hedera\",\n  \"Alliaria petiolata\",\n  \"Alliaria petiolata\",\n  \"Jasminum officinale\",\n  \"Ludisia discolor\",\n  \"Juncus kraussii\",\n  \"Adenanthos obovatus\",\n  \"Amelanchier canadensis\",\n  \"Rorippa sylvestris\",\n  \"Ptisana salicina\",\n  \"Cornus amomum\",\n  \"Veronica bullii\",\n  \"Reynoutria japonica\",\n  \"Cornus kousa\",\n  \"Pueraria montana\",\n  \"Pomaderris kumeraho\",\n  \"Daucus carota\",\n  \"Asparagus setaceus\",\n  \"Alchemilla mollis\",\n  \"Cardamine pratensis\",\n  \"Plantago major\",\n  \"Phoenicophorium\",\n  \"Magnolia splendens\",\n  \"Lavandula\",\n  \"Allium\",\n  \"Lilium catesbaei\",\n  \"Agapanthus praecox\",\n  \"Allium moly\",\n  \"Hesperis matronalis\",\n  \"Helianthella\",\n  \"Erigeron cavernensis\",\n  \"Clematis virginiana\",\n  \"Acer\",\n  \"Acer negundo\",\n  \"Acer nigrum\",\n  \"Acer saccharinum\",\n  \"Acer negundo\",\n  \"Acer negundo\",\n  \"Acer pensylvanicum\",\n  \"Acer negundo\",\n  \"Acer saccharinum\",\n  \"Acer saccharinum\",\n  \"Acer saccharinum\",\n  \"Acer saccharinum\",\n  \"Acer pensylvanicum\",\n  \"Acer saccharum\",\n  \"Acer barbatum\",\n  \"Acer leucoderme\",\n  \"Acer saccharinum\",\n  \"Acer saccharinum\",\n  \"Acer saccharinum\",\n  \"Prosopis\",\n  \"Prosopis glandulosa\",\n  \"Prosopis pubescens\",\n  \"Achillea millefolium\",\n  \"Asclepias\",\n  \"Sonchus oleraceus\",\n  \"Asclepias amplexicaulis\",\n  \"Asclepias syriaca\",\n  \"Asclepias verticillata\",\n  \"Asclepias tuberosa\",\n  \"Asclepias incarnata\",\n  \"Asclepias incarnata\",\n  \"Asclepias verticillata\",\n  \"Asclepias tuberosa\",\n  \"Sonchus oleraceus\",\n  \"Acer pensylvanicum\",\n  \"Solanum nigrum\",\n  \"Solanum opacum\",\n  \"Azolla caroliniana\",\n  \"Hesperis matronalis\",\n  \"Betula lenta\",\n  \"Morus\",\n  \"Morus rubra\",\n  \"Morus alba\",\n  \"Epacris longiflora\",\n  \"Asplenium flabellifolium\",\n  \"Urtica dioica\",\n  \"Solanum carolinense\",\n  \"Solanum carolinense\",\n  \"Solanum carolinense\",\n  \"Hylocereus\",\n  \"Phytolacca americana\",\n  \"Solanum americanum\",\n  \"Solanum dulcamara\",\n  \"Solanum nigrum\",\n  \"Solanum americanum\",\n  \"Solanum dulcamara\",\n  \"Solanum nigrum\",\n  \"Solanum nigrum\",\n  \"Solanum dulcamara\",\n  \"Solanum dulcamara\",\n  \"Solanum dulcamara\",\n  \"Trillium cernuum\",\n  \"Botrychium boreale\",\n  \"Achillea millefolium\",\n  \"Quercus\",\n  \"Quercus douglasii\",\n  \"Quercus macrocarpa\",\n  \"Quercus rubra\",\n  \"Quercus velutina\",\n  \"Quercus velutina\",\n  \"Quercus robur\",\n  \"Quercus canariensis\",\n  \"Quercus macrocarpa\",\n  \"Quercus rubra\",\n  \"Quercus robur\",\n  \"Quercus palustris\",\n  \"Quercus rubra\",\n  \"Quercus coccinea\",\n  \"Quercus coccinea\",\n  \"Quercus macrocarpa\",\n  \"Quercus petraea\",\n  \"Quercus coccinea\",\n  \"Quercus rubra\",\n  \"Quercus velutina\",\n  \"Quercus palustris\",\n  \"Quercus bicolor\",\n  \"Quercus palustris\",\n  \"Quercus bicolor\",\n  \"Quercus alba\",\n  \"Quercus velutina\",\n  \"Allium\",\n  \"Allium giganteum\",\n  \"Allium cernuum\",\n  \"Allium canadense\",\n  \"Allium canadense\",\n  \"Maclura pomifera\",\n  \"Maclura pomifera\",\n  \"Asclepias tuberosa\",\n  \"Maclura pomifera\",\n  \"Salix\",\n  \"Cornus\",\n  \"Cornus amomum\",\n  \"Pastinaca sativa\",\n  \"Daucus carota\",\n  \"Achillea ptarmica\",\n  \"Achillea ptarmica\",\n  \"Achillea ptarmica\",\n  \"Alliaria petiolata\",\n  \"Cardamine concatenata\",\n  \"Euphorbia peplus\",\n  \"Phytolacca americana\",\n  \"Platanus\",\n  \"Plantago major\",\n  \"Plantago major\",\n  \"Plantago major\",\n  \"Plantago major\",\n  \"Plantago major\",\n  \"Plantago major\",\n  \"Asclepias tuberosa\",\n  \"Phytolacca americana\",\n  \"Toxicodendron radicans\",\n  \"Solanum dulcamara\",\n  \"Solanum dulcamara\",\n  \"Phytolacca americana\",\n  \"Veratrum viride\",\n  \"Phytolacca americana\",\n  \"Phytolacca americana\",\n  \"Symplocarpus foetidus\",\n  \"Symplocarpus foetidus\",\n  \"Veratrum viride\",\n  \"Alliaria petiolata\",\n  \"Populus\",\n  \"Papaveraceae\",\n  \"Ilex decidua\",\n  \"Primula vulgaris\",\n  \"Daucus carota\",\n  \"Anthriscus sylvestris\",\n  \"Quercus velutina\",\n  \"Solanum carolinense\",\n  \"Ambrosia\",\n  \"Ambrosia artemisiifolia\",\n  \"Ambrosia trifida\",\n  \"Ambrosia trifida\",\n  \"Senecio\",\n  \"Senecio jacobaea\",\n  \"Senecio erucifolius\",\n  \"Senecio aquaticus\",\n  \"Senecio squalidus\",\n  \"Senecio cineraria\",\n  \"Daucus carota\",\n  \"Rubus\",\n  \"Rubus occidentalis\",\n  \"Rubus occidentalis\",\n  \"Cornus amomum\",\n  \"Cercis\",\n  \"Cercis siliquastrum\",\n  \"Phytolacca americana\",\n  \"Phytolacca americana\",\n  \"Apocynum cannabinum\",\n  \"Plantago major\",\n  \"Oryza sativa\",\n  \"Oryza glaberrima\",\n  \"Plantago major\",\n  \"Hesperis matronalis\",\n  \"Hesperis matronalis\",\n  \"Barbarea vulgaris\",\n  \"Barbarea vulgaris\",\n  \"Barbarea vulgaris\",\n  \"Rosa\",\n  \"Rosa multiflora\",\n  \"Rosa virginiana\",\n  \"Rosa virginiana\",\n  \"Rosa multiflora\",\n  \"Rosa virginiana\",\n  \"Rosa multiflora\",\n  \"Rosa virginiana\",\n  \"Achillea millefolium\",\n  \"Amelanchier alnifolia\",\n  \"Alliaria petiolata\",\n  \"Solanum dulcamara\",\n  \"Phytolacca americana\",\n  \"Rubus occidentalis\",\n  \"Corydalis aurea\",\n  \"Barbarea verna\",\n  \"Amelanchier\",\n  \"Amelanchier arborea\",\n  \"Amelanchier arborea\",\n  \"Amelanchier canadensis\",\n  \"Amelanchier canadensis\",\n  \"Amelanchier canadensis\",\n  \"Oncosiphon suffruticosum\",\n  \"Asclepias syriaca\",\n  \"Asclepias incarnata\",\n  \"Asclepias syriaca\",\n  \"Symplocarpus foetidus\",\n  \"Solanum dulcamara\",\n  \"Galanthus\",\n  \"Oxalis\",\n  \"Veronica arvensis\",\n  \"Veronica arvensis\",\n  \"Nardostachys jatamansi\",\n  \"Betula papyrifera\",\n  \"Cornus amomum\",\n  \"Ambrosia artemisiifolia\",\n  \"Allium cristophii\",\n  \"Ambrosia artemisiifolia\",\n  \"Arbutus unedo\",\n  \"Asclepias tuberosa\",\n  \"Asclepias syriaca\",\n  \"Achillea ptarmica\",\n  \"Achillea ptarmica\",\n  \"Amelanchier canadensis\",\n  \"Achillea millefolium\",\n  \"Viburnum prunifolium\",\n  \"Asclepias tuberosa\",\n  \"Asclepias syriaca\",\n  \"Ipomoea batatas\",\n  \"Ipomoea batatas\",\n  \"Sonchus oleraceus\",\n  \"Platanus\",\n  \"Platanus racemosa\",\n  \"Platanus occidentalis\",\n  \"Heritiera fomes\",\n  \"Excoecaria agallocha\",\n  \"Tanacetum vulgare\",\n  \"Achillea ptarmica\",\n  \"Ambrosia artemisiifolia\",\n  \"Camellia sinensis\",\n  \"Ilex glabra\",\n  \"Rubus occidentalis\",\n  \"Rudbeckia laciniata\",\n  \"Achillea millefolium\",\n  \"Achillea millefolium\",\n  \"Ambrosia artemisiifolia\",\n  \"Sonchus oleraceus\",\n  \"Cirsium arvense\",\n  \"Cirsium arvense\",\n  \"Cirsium arvense\",\n  \"Sonchus arvensis\",\n  \"Cirsium arvense\",\n  \"Cirsium arvense\",\n  \"Sonchus arvensis\",\n  \"Cirsium arvense\",\n  \"Cirsium arvense\",\n  \"Sonchus oleraceus\",\n  \"Sonchus oleraceus\",\n  \"Carduus nutans\",\n  \"Cirsium arvense\",\n  \"Cirsium arvense\",\n  \"Sonchus asper\",\n  \"Cirsium arvense\",\n  \"Sonchus asper\",\n  \"Sonchus asper\",\n  \"Sonchus arvensis\",\n  \"Sonchus arvensis\",\n  \"Cirsium arvense\",\n  \"Thymus\",\n  \"Thymus vulgaris\",\n  \"Veratrum viride\",\n  \"Nicotiana\",\n  \"Cardamine concatenata\",\n  \"Cardamine concatenata\",\n  \"Cardamine concatenata\",\n  \"Impatiens capensis\",\n  \"Impatiens pallida\",\n  \"Mimosa pudica\",\n  \"Cardamine hirsuta\",\n  \"Clematis virginiana\",\n  \"Solanum carolinense\",\n  \"Nicotiana glauca\",\n  \"Trillium\",\n  \"Asclepias tuberosa\",\n  \"Ocimum santalum\",\n  \"Hedyscepe canterburyana\",\n  \"Cyperus alternifolius\",\n  \"Vanilla\",\n  \"Koelreuteria paniculata\",\n  \"Mucuna pruriens\",\n  \"Viburnum\",\n  \"Viburnum prunifolium\",\n  \"Viburnum rhytidophyllum\",\n  \"Viola\",\n  \"Saintpaulia\",\n  \"Hesperis matronalis\",\n  \"Hesperis matronalis\",\n  \"Erythronium dens-canis\",\n  \"Solanum dulcamara\",\n  \"Scorzonera hispanica\",\n  \"Clematis virginiana\",\n  \"Clematis virginiana\",\n  \"Dracunculus vulgaris\",\n  \"Acacia\",\n  \"Acacia ammobia\",\n  \"Plantago major\",\n  \"Plantago major\",\n  \"Asclepias tuberosa\",\n  \"Apocynum cannabinum\",\n  \"Asclepias syriaca\",\n  \"Lambertia\",\n  \"Lambertia echinata\",\n  \"Lambertia ericifolia\",\n  \"Lambertia fairallii\",\n  \"Lambertia formosa\",\n  \"Lambertia formosa\",\n  \"Lambertia ilicifolia\",\n  \"Lambertia inermis\",\n  \"Lambertia multiflora\",\n  \"Lambertia orbifolia\",\n  \"Lambertia rariflora\",\n  \"Clematis virginiana\",\n  \"Salix\",\n  \"Salix exigua\",\n  \"Salix gooddingii\",\n  \"Cornus amomum\",\n  \"Cornus amomum\",\n  \"Asclepias tuberosa\",\n  \"Rubus phoenicolasius\",\n  \"Ilex verticillata\",\n  \"Ilex verticillata\",\n  \"Ilex glabra\",\n  \"Ilex verticillata\",\n  \"Barbarea vulgaris\",\n  \"Barbarea verna\",\n  \"Clematis virginiana\",\n  \"Argyreia nervosa\",\n  \"Ambrosia artemisiifolia\",\n  \"Corydalis sempervirens\",\n  \"Barbarea vulgaris\",\n  \"Achillea\",\n  \"Achillea millefolium\",\n  \"Achillea filipendulina\",\n  \"Achillea ptarmica\",\n  \"Achillea tomentosa\",\n  \"Rorippa sylvestris\",\n  \"Cladrastis lutea\",\n  \"Maclura pomifera\",\n  \"Echinacea paradoxa\",\n  \"Dioscorea\",\n  \"Camellia yunnanensis\",\n  \"Brachystegia spiciformis\",\n  \"Curcuma zedoaria\",\n];\n","import { sampleArray } from \"math\";\nimport names from \"./plantNames\";\n\nconst generateSpeciesName = () => {\n  return sampleArray(names);\n};\n\nexport default generateSpeciesName;\n","import classNames from \"classnames\";\nimport React from \"react\";\n\nimport characterSrc from \"assets/images/character.png\";\n\nimport \"./Character.scss\";\n\nfunction Character(props: JSX.IntrinsicElements[\"img\"] & { size?: \"xs\" | \"small\" | \"medium\" | \"large\" }) {\n  const { size, ...otherProps } = props;\n  return <img className={classNames(\"character\", size)} alt=\"\" src={characterSrc} {...otherProps} />;\n}\n\nexport default Character;\n","export type TickerCallback = (time: number) => boolean | void;\nclass TickerClass {\n  private tickerId = 1;\n\n  private tickers: Record<number, TickerCallback> = {};\n\n  private _time = 0;\n\n  get now() {\n    return this._time;\n  }\n\n  tickerLoop = (time: number) => {\n    this._time = time;\n    const toDelete: number[] = [];\n    for (const id in this.tickers) {\n      const f = this.tickers[id];\n      const shouldDelete = f(time);\n      if (shouldDelete === true) {\n        toDelete.push(Number(id));\n      }\n    }\n    for (const id of toDelete) {\n      this.removeAnimation(id);\n    }\n    requestAnimationFrame(this.tickerLoop);\n  };\n\n  /**\n   * Return true to kill the ticker.\n   */\n  public addAnimation(fn: TickerCallback) {\n    const id = this.tickerId++;\n    this.tickers[id] = fn;\n    return id;\n  }\n\n  public removeAnimation(id: number) {\n    return delete this.tickers[id];\n  }\n\n  public start() {\n    requestAnimationFrame(this.tickerLoop);\n  }\n}\n\nconst Ticker = new TickerClass();\nTicker.start();\n\nexport default Ticker;\n","import React from \"react\";\nimport Ticker from \"global/ticker\";\n\ninterface DynamicNumberProps {\n  value: number;\n  speed?: number;\n  formatter?: Intl.NumberFormat;\n}\n\nconst NUMBER_FORMATTER = new Intl.NumberFormat(undefined, {\n  maximumFractionDigits: 2,\n  useGrouping: true,\n});\n\nfunction DynamicNumber({ value, speed = 0.1, formatter = NUMBER_FORMATTER }: DynamicNumberProps) {\n  const [v, setV] = React.useState(value);\n\n  React.useEffect(() => {\n    const id = Ticker.addAnimation(() => {\n      setV((v) => {\n        if (Math.abs(v - value) < 5e-3) {\n          Ticker.removeAnimation(id);\n          return value;\n        } else {\n          return v * (1 - speed) + value * speed;\n        }\n      });\n    });\n    return () => {\n      Ticker.removeAnimation(id);\n    };\n  }, [value, speed]);\n\n  return <>{formatter.format(v)}</>;\n}\n\nexport default DynamicNumber;\n","import classNames from \"classnames\";\nimport React from \"react\";\nimport { GiDna1 } from \"react-icons/gi\";\nimport DynamicNumber from \"./DynamicNumber\";\nimport \"./MP.scss\";\n\nexport type MPProps = JSX.IntrinsicElements[\"div\"] & {\n  amount: number;\n  total?: number;\n};\n\nconst MP_NUMBER_FORMATTER = new Intl.NumberFormat(undefined, {\n  maximumFractionDigits: 0,\n  useGrouping: true,\n});\n\nfunction MP({ amount, total, ...props }: MPProps) {\n  return (\n    <span {...props} className={classNames(\"mp\", props.className)}>\n      <DynamicNumber speed={0.3} formatter={MP_NUMBER_FORMATTER} value={amount} />\n      {total != null ? <>/{total}</> : null}\n      <GiDna1 className=\"mp-icon\" />\n    </span>\n  );\n}\n\nexport default MP;\n","import React, { useState } from \"react\";\n\nimport \"./Expand.scss\";\nimport classNames from \"classnames\";\n\ninterface ExpandProps {\n  className?: string;\n  children: React.ReactNode;\n  shrunkElements: React.ReactNode;\n}\n\nfunction Expand({ className, children, shrunkElements }: ExpandProps) {\n  const [expanded, setExpanded] = useState(false);\n\n  const handleExpandClick = () => {\n    setExpanded(!expanded);\n  };\n\n  return (\n    <div className={classNames(className, \"expand\")}>\n      <div className=\"expand-button\" onClick={handleExpandClick}>\n        {shrunkElements}\n        <div className=\"expand-caret\">{expanded ? \"\" : \"\"}</div>\n      </div>\n      {expanded ? <div>{children}</div> : null}\n    </div>\n  );\n}\n\nexport default Expand;\n","import classNames from \"classnames\";\nimport React from \"react\";\nimport Expand from \"../common/Expand\";\nimport \"./TraitDisplay.scss\";\nimport { displayName, Traits, traitToTuple, TraitType, TraitValue, TRAIT_TYPES } from \"./traits\";\n\nfunction Trait({ name, value }: { name: TraitType; value: TraitValue }) {\n  return (\n    <div className={classNames(\"trait\", { green: value > 0, red: value < 0 })}>\n      <span className=\"tuple\">{traitToTuple(name)}</span> {displayName(name)}: {value}\n    </div>\n  );\n}\n\ninterface TraitDisplayProps {\n  traits: Traits;\n}\n\nfunction sortNames(traits: Traits, names: TraitType[]) {\n  // sort values first, then alphabetically\n  names.sort((a, b) => (traits[b] - traits[a]) * 1000 + traitToTuple(a).localeCompare(traitToTuple(b)));\n  return names;\n}\n\nfunction TraitDisplay({ traits }: TraitDisplayProps) {\n  const nonzeroTraits = sortNames(traits, TRAIT_TYPES.filter((name) => traits[name] !== 0));\n  const nonzeroTraitElements =\n    nonzeroTraits.length > 0 ? (\n      <div className=\"interesting-traits\">\n        {nonzeroTraits.map((trait) => (\n          <Trait key={trait} name={trait} value={traits[trait]} />\n        ))}\n      </div>\n    ) : (\n      <div className=\"no-interesting-traits\">All traits are zero.</div>\n    );\n\n  const zeroTraits = sortNames(traits, TRAIT_TYPES.filter((name) => traits[name] === 0));\n  const zeroTraitElements = (\n    <div className=\"zero-traits\">\n      {zeroTraits.map((trait) => (\n        <Trait key={trait} name={trait} value={traits[trait]} />\n      ))}\n    </div>\n  );\n  return (\n    <div className=\"trait-display\">\n      {nonzeroTraitElements}\n      <Expand shrunkElements={<div className=\"expand-toggle\">Show All</div>}>{zeroTraitElements}</Expand>\n    </div>\n  );\n}\n\nexport default TraitDisplay;\n","import React from \"react\";\nimport { Gene } from \"./gene\";\nimport \"./GeneDisplay.scss\";\nimport { tupleToTrait } from \"./traits\";\n\nfunction GeneComponent({ gene, onClick }: { gene: Gene; onClick: (position: number) => void }) {\n  return (\n    <div className=\"gene\">\n      <div className=\"gene-number\">\n        <span className=\"tuple-plus\" title={tupleToTrait(gene[0]) + \" +1\"}>\n          <span className=\"dna\" onClick={() => onClick(0)}>\n            {gene[0][0]}\n          </span>\n          <span className=\"dna\" onClick={() => onClick(1)}>\n            {gene[0][1]}\n          </span>\n        </span>\n        <span className=\"tuple-minus\" title={tupleToTrait(gene[1]) + \" -1\"}>\n          <span className=\"dna\" onClick={() => onClick(2)}>\n            {gene[1][0]}\n          </span>\n          <span className=\"dna\" onClick={() => onClick(3)}>\n            {gene[1][1]}\n          </span>\n        </span>\n      </div>\n      <div className=\"gene-visual\">\n        <img alt=\"\" src=\"https://media2.giphy.com/media/YlmI36YAWe7KScC7hK/giphy.gif\" width=\"44px\" />\n      </div>\n    </div>\n  );\n}\n\nexport interface GeneDisplayProps {\n  genes: Gene[];\n  onClick: (gene: Gene, position: number) => void;\n}\n\nfunction GeneDisplay({ genes, onClick }: GeneDisplayProps) {\n  const geneContent =\n    genes.length > 0 ? (\n      <div className=\"genes-container\">\n        {genes.map((gene, i) => (\n          <GeneComponent key={i} gene={gene} onClick={(p) => onClick(gene, p)} />\n        ))}\n      </div>\n    ) : (\n      <div className=\"genes-empty\">No genes.</div>\n    );\n  return <div className=\"gene-display\">{geneContent}</div>;\n}\n\nexport default GeneDisplay;\n","import React from \"react\";\nimport TraitDisplay from \"./TraitDisplay\";\nimport { getTraits } from \"./traits\";\nimport GeneDisplay, { GeneDisplayProps } from \"./GeneDisplay\";\n\nimport \"./GenesToTraits.scss\";\n\nimport { Gene } from \"./gene\";\n\nexport interface GenesToTraitsProps {\n  genes: Gene[];\n  onClick: GeneDisplayProps[\"onClick\"];\n}\n\nfunction GenesToTraits({ genes, onClick }: GenesToTraitsProps) {\n  const traits = React.useMemo(() => {\n    return getTraits(genes);\n  }, [genes]);\n\n  return (\n    <div className=\"genes-to-traits\">\n      <div className=\"genes-details\">\n        <h3>Genes</h3>\n        <GeneDisplay genes={genes} onClick={onClick} />\n      </div>\n      <div className=\"arrow\"></div>\n      <div className=\"traits-details\">\n        <h3>Traits</h3>\n        <TraitDisplay traits={traits} />\n      </div>\n    </div>\n  );\n}\n\nexport default GenesToTraits;\n","import { Gene, DNATuple, DNA } from \"./gene\";\n\nexport function mutateRandomNewGene(): Gene {\n  const tuplePlus = randomDNATuple();\n  const tupleMinus = randomDNATuple();\n  return [tuplePlus, tupleMinus];\n}\n\nexport function mutateSwapDNA(gene1: Gene, position1: number, gene2: Gene, position2: number): [Gene, Gene] {\n  const gene1Str = gene1.join(\"\");\n  const gene2Str = gene2.join(\"\");\n  const dnaPosition1 = gene1Str.charAt(position1);\n  const dnaPosition2 = gene2Str.charAt(position2);\n\n  const newGeneStr1 = gene1Str.substr(0, position1) + dnaPosition2 + gene1Str.substr(position1 + 1);\n  const newGeneStr2 = gene2Str.substr(0, position2) + dnaPosition1 + gene2Str.substr(position2 + 1);\n\n  const newGene1 = strToGene(newGeneStr1);\n  const newGene2 = strToGene(newGeneStr2);\n  return [newGene1, newGene2];\n}\n\nexport function mutatePosition(gene: Gene, position: number): Gene {\n  const geneStr = gene.join(\"\");\n  const newGeneStr =\n    geneStr.substr(0, position) + randomNewDNA(geneStr.charAt(position) as DNA) + geneStr.substr(position + 1);\n  const newGene = strToGene(newGeneStr);\n  return newGene;\n}\n\nfunction strToGene(str: string): Gene {\n  return [str.substr(0, 2), str.substr(2)] as Gene;\n}\n\nfunction randomDNATuple(): DNATuple {\n  const dna1 = randomDNA();\n  const dna2 = randomDNA();\n  return (dna1 + dna2) as DNATuple;\n}\n\nfunction randomNewDNA(old: DNA) {\n  let d: DNA;\n  do {\n    d = randomDNA();\n  } while (d === old);\n  return d;\n}\n\nfunction randomDNA(): DNA {\n  const r = Math.random();\n  if (r < 0.25) {\n    return \"A\";\n  } else if (r < 0.5) {\n    return \"C\";\n  } else if (r < 0.75) {\n    return \"G\";\n  } else {\n    return \"T\";\n  }\n}\n","import { useAppReducer } from \"app\";\nimport classNames from \"classnames\";\nimport generateSpeciesName from \"common/generateSpeciesName\";\nimport React from \"react\";\nimport uuid from \"uuid\";\nimport { Button } from \"../common/Button\";\nimport Character from \"../common/Character\";\nimport MP from \"../common/MP\";\nimport { Gene } from \"./gene\";\nimport GenesToTraits from \"./GenesToTraits\";\nimport { mutatePosition, mutateRandomNewGene, mutateSwapDNA } from \"./mutation\";\nimport \"./MutationScreen.scss\";\nimport { Species } from \"./species\";\n\nfunction MutationScreen({\n  species,\n  onCommit,\n}: {\n  species: Species;\n  onCommit: (newSpecies: Species, newPool: number) => void;\n}) {\n  const [, dispatch] = useAppReducer();\n  // const [pool, setPool] = React.useState(species.freeMutationPoints);\n  const pool = species.freeMutationPoints;\n  const setPool = (arg: number | ((p: number) => number)) => {\n    if (typeof arg === \"number\") {\n      species.freeMutationPoints = arg;\n    } else {\n      species.freeMutationPoints = arg(pool);\n    }\n    // TODO if user refreshes while mutating, they'll lose the mutation state!\n    // we should save the mutation state in the AppState\n    dispatch({\n      type: \"AAUpdateSpecies\",\n      species,\n    });\n  };\n\n  const [newSpecies, setNewSpecies] = React.useState<Species>({\n    id: uuid(),\n    descendants: [],\n    freeMutationPoints: 0,\n    totalMutationPoints: 0,\n    genes: [...species.genes],\n    name: generateSpeciesName(),\n    parent: species,\n  });\n\n  type ClickModeSwap = {\n    type: \"swap\";\n    p1?: { gene: Gene; position: number };\n  };\n  type ClickModeReroll = {\n    type: \"reroll\";\n  };\n  type ClickMode = ClickModeSwap | ClickModeReroll | undefined;\n  const [clickMode, setClickMode] = React.useState<ClickMode>();\n  const isSwapping = clickMode && clickMode.type === \"swap\";\n  const isRerolling = clickMode && clickMode.type === \"reroll\";\n\n  const newGeneCost = newSpecies.genes.length + 1;\n\n  const handleNewGene = () => {\n    setPool((p) => p - newGeneCost);\n    setNewSpecies((species) => ({\n      ...species,\n      genes: [...species.genes, mutateRandomNewGene()],\n    }));\n  };\n\n  const startSwapClickMode = () => {\n    if (isSwapping) {\n      setClickMode(undefined);\n    } else {\n      setClickMode({ type: \"swap\" });\n    }\n  };\n\n  const startRerollClickMode = () => {\n    if (isRerolling) {\n      setClickMode(undefined);\n    } else {\n      setClickMode({ type: \"reroll\" });\n    }\n  };\n\n  function reroll(gene: Gene, position: number) {\n    setPool((p) => p - 1);\n    setNewSpecies((species) => {\n      const geneIndex = species.genes.indexOf(gene);\n      const newGene = mutatePosition(gene, position);\n      const newGenes = [...species.genes.slice(0, geneIndex), newGene, ...species.genes.slice(geneIndex + 1)];\n      return {\n        ...species,\n        genes: newGenes,\n      };\n    });\n    setClickMode(undefined);\n  }\n\n  function swap(gene1: Gene, position1: number, gene2: Gene, position2: number) {\n    setPool((p) => p - 2);\n    setNewSpecies((species) => {\n      const geneIndex1 = species.genes.indexOf(gene1);\n      const geneIndex2 = species.genes.indexOf(gene2);\n\n      const newGenes = [...species.genes];\n\n      const [newGene1, newGene2] = mutateSwapDNA(gene1, position1, gene2, position2);\n      newGenes[geneIndex1] = newGene1;\n      newGenes[geneIndex2] = newGene2;\n\n      return {\n        ...species,\n        genes: newGenes,\n      };\n    });\n    setClickMode(undefined);\n  }\n\n  const handleGeneClick = (gene: Gene, position: number) => {\n    if (clickMode) {\n      if (clickMode.type === \"reroll\") {\n        reroll(gene, position);\n      } else if (clickMode.type === \"swap\") {\n        if (clickMode.p1 == null) {\n          clickMode.p1 = { gene, position };\n        } else {\n          swap(clickMode.p1.gene, clickMode.p1.position, gene, position);\n        }\n      }\n    }\n  };\n\n  const handleNewSpeciesName = (e: React.ChangeEvent<HTMLInputElement>) => {\n    setNewSpecies((s) => ({\n      ...s,\n      name: e.target.value,\n    }));\n  };\n\n  const handleCommit = () => {\n    onCommit(newSpecies, pool);\n  };\n\n  const isGenesChanged = React.useMemo(() => {\n    const genes1 = species.genes;\n    const genes2 = newSpecies.genes;\n\n    const isDifferentLengths = genes1.length !== genes2.length;\n    return isDifferentLengths || genes1.some((_, i) => genes1[i] !== genes2[i]);\n  }, [newSpecies.genes, species.genes]);\n\n  return (\n    <div className={classNames(\"mutation-screen\", { \"click-mode-active\": clickMode != null })}>\n      <div className=\"mutation-screen-content\">\n        <h1>\n          <Character size=\"medium\" />\n          <span className=\"name\">{species.name}</span>\n        </h1>\n\n        <div className=\"buttons\">\n          <MP className=\"pool\" amount={pool} total={species.totalMutationPoints} />\n          <Button onClick={handleNewGene} disabled={pool < newGeneCost}>\n            New Gene (<MP amount={newGeneCost} />)\n          </Button>\n\n          <Button\n            className={classNames({ \"is-cancel\": isSwapping })}\n            onClick={startSwapClickMode}\n            disabled={(!isSwapping && pool < 2) || newSpecies.genes.length === 0}\n          >\n            {isSwapping ? (\n              \"Cancel\"\n            ) : (\n              <>\n                Swap DNA (<MP amount={2} />)\n              </>\n            )}\n          </Button>\n\n          <Button\n            className={classNames({ \"is-cancel\": isRerolling })}\n            onClick={startRerollClickMode}\n            disabled={(!isRerolling && pool < 1) || newSpecies.genes.length === 0}\n          >\n            {isRerolling ? (\n              \"Cancel\"\n            ) : (\n              <>\n                Re-roll DNA (<MP amount={1} />)\n              </>\n            )}\n          </Button>\n        </div>\n\n        <GenesToTraits genes={newSpecies.genes} onClick={handleGeneClick} />\n        {isGenesChanged ? (\n          <>\n            <div className=\"arrow\"></div>\n            <h1>\n              <Character size=\"medium\" />\n              <input type=\"text\" className=\"name\" value={newSpecies.name} onChange={handleNewSpeciesName} />\n            </h1>\n            <Button className=\"commit\" color=\"green\" onClick={handleCommit}>\n              Commit\n            </Button>\n          </>\n        ) : null}\n      </div>\n    </div>\n  );\n}\n\nexport default MutationScreen;\n","import React from \"react\";\n// import useMouse from \"@rooks/use-mouse\";\nimport useBoundingclientrectRef from \"@rooks/use-boundingclientrect-ref\";\n\nimport \"./LookAtMouse.scss\";\nimport classNames from \"classnames\";\nimport useMousePosition from \"./useMousePosition\";\n\ninterface LookAtMouseProps {\n  zScale?: number;\n}\n\nfunction LookAtMouse(props: JSX.IntrinsicElements[\"div\"] & LookAtMouseProps) {\n  const mouse = useMousePosition();\n  const [ref, size] = useBoundingclientrectRef() as any;\n  const { children, className, zScale = 5, ...restProps } = props;\n\n  const z = window.innerWidth * zScale;\n\n  const style = React.useMemo(() => {\n    if (size != null) {\n      const midX = size.left + size.width / 2;\n      const midY = size.top + size.height / 2;\n\n      const ox = mouse.x - midX;\n      const oy = mouse.y - midY;\n      // const rotY = Math.atan((ox * 2) / clientRect.width);\n      // const rotX = Math.atan(-(oy * 2) / clientRect.height);\n\n      const rotY = Math.atan((ox * 2) / z);\n      const rotX = Math.atan(-(oy * 2) / z);\n      const s: React.CSSProperties = {\n        transform: `perspective(525px) rotateX(${rotX}rad) rotateY(${rotY}rad)`,\n      };\n      return s;\n    } else {\n      return {};\n    }\n  }, [mouse.x, mouse.y, size, z]);\n\n  return (\n    <div ref={ref} className={classNames(\"look-at-mouse\", className)} {...restProps}>\n      <div className=\"look-at-mouse-transform\" style={style}>\n        {children}\n      </div>\n    </div>\n  );\n}\n\nexport default LookAtMouse;\n","import React from \"react\";\n\nimport { Species } from \"./species\";\nimport { GeneDisplayProps } from \"./GeneDisplay\";\nimport { Button } from \"../common/Button\";\nimport GenesToTraits from \"./GenesToTraits\";\n\nimport \"./SpeciesPopoverDetails.scss\";\n\nexport interface SpeciesPopoverDetailsProps {\n  species: Species;\n  onMutate: (species: Species) => void;\n  onClick: GeneDisplayProps[\"onClick\"];\n}\n\nfunction SpeciesPopoverDetails({ species, onClick, onMutate }: SpeciesPopoverDetailsProps) {\n  return (\n    <div className=\"species-details\">\n      <GenesToTraits genes={species.genes} onClick={onClick} />\n      {species.freeMutationPoints > 0 ? (\n        <div className=\"suggestion\">{species.freeMutationPoints} Mutation Points available. Use them!</div>\n      ) : null}\n      <Button onClick={() => onMutate(species)}>Mutate</Button>\n    </div>\n  );\n}\n\nexport default SpeciesPopoverDetails;\n","import LookAtMouse from \"common/LookAtMouse\";\nimport React from \"react\";\nimport Popover from \"react-popover\";\nimport Character from \"../common/Character\";\nimport MP from \"../common/MP\";\nimport { Species } from \"./species\";\nimport \"./SpeciesNode.scss\";\nimport SpeciesPopoverDetails from \"./SpeciesPopoverDetails\";\n\nexport interface SpeciesNodeProps {\n  species: Species;\n  onMutate: (m: Species) => void;\n}\n\nfunction SpeciesNode({ species, onMutate }: SpeciesNodeProps) {\n  const handleOnMutate = (s: Species) => {\n    setPopoverIsOpen(false);\n    onMutate(s);\n  };\n\n  const [popoverIsOpen, setPopoverIsOpen] = React.useState(false);\n\n  const descendants =\n    species.descendants.length > 0 ? (\n      <div className=\"descendants-container\">\n        {species.descendants.map((s, i) => (\n          <SpeciesNode key={i} species={s} onMutate={handleOnMutate} />\n        ))}\n      </div>\n    ) : null;\n  const popoverBody = (\n    <div className=\"species-detail-popover\">\n      <SpeciesPopoverDetails species={species} onMutate={handleOnMutate} onClick={() => {}} />\n    </div>\n  );\n  return (\n    <div className=\"species-node\">\n      {descendants}\n      <Popover\n        isOpen={popoverIsOpen}\n        preferPlace=\"right\"\n        onOuterAction={() => setPopoverIsOpen(false)}\n        body={popoverBody}\n      >\n        <LookAtMouse zScale={5}>\n          <div className=\"species-info\" onClick={() => setPopoverIsOpen(!popoverIsOpen)}>\n            <div className=\"species-info-name\">{species.name}</div>\n            <div className=\"species-info-animation\">\n              <Character size=\"small\" />\n            </div>\n            <MP amount={species.freeMutationPoints} total={species.totalMutationPoints} />\n          </div>\n        </LookAtMouse>\n      </Popover>\n    </div>\n  );\n}\n\nexport default SpeciesNode;\n","import { useAppReducer } from \"app\";\nimport React from \"react\";\nimport \"./PhylogeneticTree.scss\";\nimport { Species } from \"./species\";\nimport SpeciesNode from \"./SpeciesNode\";\n\ninterface PhylogeneticTreeProps {\n  onMutate: (s: Species) => void;\n}\n\nfunction PhylogeneticTree({ onMutate }: PhylogeneticTreeProps) {\n  const [{ rootSpecies }] = useAppReducer();\n  return (\n    <div className=\"phylogenetic-tree\">\n      <div className=\"title\">Phylogenetic Tree</div>\n      <div className=\"tree-nodes\">\n        <SpeciesNode species={rootSpecies} onMutate={onMutate} />\n      </div>\n    </div>\n  );\n}\n\nexport default PhylogeneticTree;\n","import { useAppReducer } from \"app\";\nimport classNames from \"classnames\";\nimport DynamicNumber from \"common/DynamicNumber\";\nimport React, { useState } from \"react\";\nimport { GiSandsOfTime } from \"react-icons/gi\";\nimport \"./EpochUI.scss\";\nimport { HexTile } from \"./hexTile\";\n\nexport function EpochUI({ onNextEpoch, onFocusHex }: EpochUIProps) {\n  const [{ epoch, overWorld }] = useAppReducer();\n  const [transitioning, setTransitioning] = useState(false);\n  const unusedHexes = overWorld.unusedHexes();\n  const isReadyToAdvance = unusedHexes.length === 0;\n  const handleNextEpoch = () => {\n    setTransitioning(true);\n    setTimeout(() => setTransitioning(false), 5000);\n    onNextEpoch();\n  };\n  return (\n    <div className={classNames(\"epoch-display\", { \"ready-to-advance\": isReadyToAdvance, transitioning })}>\n      <span className=\"number\">\n        <DynamicNumber formatter={EPOCH_FORMATTER} value={epoch * 1e6} speed={0.08} /> Years\n      </span>\n      {unusedHexes.length > 0 ? (\n        <div onClick={() => onFocusHex(unusedHexes[0])}>{unusedHexes.length} hexes unused</div>\n      ) : null}\n      <button className=\"button-next-epoch\" onClick={handleNextEpoch} disabled={transitioning}>\n        <GiSandsOfTime className=\"icon\" />\n      </button>\n    </div>\n  );\n}\nexport interface EpochUIProps {\n  onNextEpoch: () => void;\n  onFocusHex: (hex: HexTile) => void;\n}\nconst EPOCH_FORMATTER = new Intl.NumberFormat(undefined, { useGrouping: true, maximumFractionDigits: 0 });\n","import { poissonDisc } from \"math/poissonDisc\";\nimport { Vector2 } from \"three\";\nimport { HexTile } from \"./hexTile\";\nimport { CameraState } from \"./map/OverWorldMap\";\n\n/**\n * Tiled hexes are not square - they are rectangular, where\n * the pointy-to-pointy direction is length 1 and the edge-to-edge\n * direction is length sqrt(3) / 2. Since we have flat-topped\n * hexes, the Y gets the squish factor.\n */\nexport const Y_SQUISH_FACTOR = Math.sqrt(3) / 2;\n\nexport function getClickedHexCoords(canvas: HTMLCanvasElement, camera: CameraState, event: React.MouseEvent) {\n  const { scale, dX, dY } = camera;\n  const cX = canvas.width / 2 + dX;\n  const cY = canvas.height / 2 + dY;\n\n  const e = event.nativeEvent;\n  const pxX = e.offsetX;\n  const pxY = e.offsetY;\n  const x = (pxX - cX) / scale;\n  const y = (pxY - cY) / scale;\n  // we now have a fractional cartesian coordinates\n  // now we flip the equations:\n\n  // x = 1.5i\n  // i = x / 1.5\n\n  // y = 2Cj + Ci\n  // j = (y - Ci) / (2 * C)\n\n  const i = x / 1.5;\n  const j = (y - Y_SQUISH_FACTOR * i) / (2 * Y_SQUISH_FACTOR);\n  const k = -(i + j);\n\n  return roundCubeCoordinates(i, j, k);\n}\n\nexport function roundCubeCoordinates(i: number, j: number, k: number) {\n  var rx = Math.round(i);\n  var ry = Math.round(j);\n  var rz = Math.round(k);\n\n  var x_diff = Math.abs(rx - i);\n  var y_diff = Math.abs(ry - j);\n  var z_diff = Math.abs(rz - k);\n\n  if (x_diff > y_diff && x_diff > z_diff) {\n    rx = -ry - rz;\n  } else if (y_diff > z_diff) {\n    ry = -rx - rz;\n  } else {\n    rz = -rx - ry;\n  }\n  return { i: rx, j: ry, k: rz };\n}\n\nexport function pixelPosition(tile: HexTile, camera: CameraState) {\n  const { dX, dY, scale } = camera;\n  const { x, y } = tile.cartesian;\n\n  const cX = window.innerWidth / 2 + dX;\n  const cY = window.innerHeight / 2 + dY;\n  return [cX + x * scale, cY + y * scale];\n}\n\n/**\n * Get the camera state that would center the camera on hex with the given scale.\n */\nexport function getCameraPositionCenteredOn(hex: HexTile, scale: number) {\n  const { x, y } = hex.cartesian;\n  const cX = window.innerWidth / 2 - x * scale;\n  const cY = window.innerHeight / 2 - y * scale;\n\n  const dX = cX - window.innerWidth / 2;\n  const dY = cY - window.innerHeight / 2;\n\n  return [dX, dY];\n}\n\nexport const randomPointInHexagon = (() => {\n  const vectors = [new Vector2(-1, 0), new Vector2(0.5, Y_SQUISH_FACTOR), new Vector2(0.5, -Y_SQUISH_FACTOR)];\n\n  return (scale: number) => {\n    // adapted from https://stackoverflow.com/a/3241819\n    const vIndex = Math.floor(Math.random() * 3);\n    const [v1, v2] = [vectors[vIndex], vectors[(vIndex + 1) % 3]];\n    const [v1Scale, v2Scale] = [Math.random(), Math.random()];\n    const [x, y] = [v1Scale * v1.x + v2Scale * v2.x, v1Scale * v1.y + v2Scale * v2.y];\n    return new Vector2(x * scale, y * scale);\n  };\n})();\n\nexport const generateNaturalRandomHexagonPoints = (radius: number, dropFirst = false) => {\n  const width = 2;\n  const height = Y_SQUISH_FACTOR * width;\n  // const areaAvailable = width * height;\n  // const radius = areaAvailable / maxPoints * 0.5; // technically you could get pretty close with .8; but do 0.5 for some more leeway\n  const samples = poissonDisc({ width, height, radius, initialSample: [width / 2, height / 2], max: 10000 });\n  const normSamples = samples\n    .map((s) => {\n      s.x -= width / 2;\n      s.y -= height / 2;\n      return s;\n    })\n    .filter((s) => isPointInHexagon(s.x, s.y));\n  if (dropFirst) {\n    normSamples.shift();\n  }\n  return normSamples;\n};\n\n/**\n * Return true if the point is inside a radius 1 hexagon (width 2, height sqrt(3))\n */\nexport const isPointInHexagon = (() => {\n  const RADIUS = 1;\n  const HALF_HEIGHT = RADIUS * Y_SQUISH_FACTOR;\n  // based on http://www.playchilla.com/how-to-check-if-a-point-is-inside-a-hexagon\n  return (x: number, y: number) => {\n    // transform the test point locally and to quadrant 2\n    const q2x = Math.abs(x);\n    const q2y = Math.abs(y);\n    // bounding test (since q2 is in quadrant 2 only 2 tests are needed)\n    if (q2x > RADIUS || q2y > HALF_HEIGHT) {\n      return false;\n    }\n    // dot product can be reduced to this due to the hexagon symmetry\n    // return HALF_HEIGHT * RADIUS * q2x - RADIUS * q2y >= 0;\n    return RADIUS * HALF_HEIGHT - HALF_HEIGHT * q2x - 0.5 * q2y >= 0;\n  };\n})();\n","import { Vector2 } from \"three\";\n\n// https://github.com/beaugunderson/poisson-disc-sampler/blob/master/poisson-disc-sampler.js\nexport function poissonDisc({\n  width = 1,\n  height = 1,\n  radius = 0.1,\n  max = 1000,\n  initialSample = undefined as [number, number] | undefined,\n  rng = Math.random,\n}): Vector2[] {\n  // maximum number of samples before rejection\n  var k = 30;\n  var radius2 = radius * radius;\n  var R = 3 * radius2;\n  var cellSize = radius * Math.SQRT1_2;\n\n  var gridWidth = Math.ceil(width / cellSize);\n  var gridHeight = Math.ceil(height / cellSize);\n\n  var grid = new Array(gridWidth * gridHeight);\n\n  var queue: number[][] = [];\n  var queueSize = 0;\n\n  var sampleSize = 0;\n\n  rng = rng || Math.random;\n\n  function far(x: number, y: number) {\n    var i = (x / cellSize) | 0;\n    var j = (y / cellSize) | 0;\n\n    var i0 = Math.max(i - 2, 0);\n    var j0 = Math.max(j - 2, 0);\n    var i1 = Math.min(i + 3, gridWidth);\n    var j1 = Math.min(j + 3, gridHeight);\n\n    for (j = j0; j < j1; ++j) {\n      var o = j * gridWidth;\n\n      for (i = i0; i < i1; ++i) {\n        var s;\n\n        if ((s = grid[o + i])) {\n          var dx = s[0] - x,\n            dy = s[1] - y;\n\n          if (dx * dx + dy * dy < radius2) {\n            return false;\n          }\n        }\n      }\n    }\n\n    return true;\n  }\n\n  function sample(x: number, y: number) {\n    const s = [x, y];\n\n    queue.push(s);\n\n    grid[gridWidth * ((y / cellSize) | 0) + ((x / cellSize) | 0)] = s;\n\n    sampleSize++;\n    queueSize++;\n\n    return s;\n  }\n\n  const sampler = function() {\n    if (!sampleSize) {\n      if (initialSample != null) {\n        return sample(initialSample[0], initialSample[1]);\n      } else {\n        return sample(rng() * width, rng() * height);\n      }\n    }\n\n    // Pick a random existing sample and remove it from the queue.\n    while (queueSize) {\n      var i = (rng() * queueSize) | 0;\n      var s = queue[i];\n\n      // Make a new candidate between [radius, 2 * radius] from the existing\n      // sample.\n      for (var j = 0; j < k; ++j) {\n        var a = 2 * Math.PI * rng();\n        var r = Math.sqrt(rng() * R + radius2);\n        var x = s[0] + r * Math.cos(a);\n        var y = s[1] + r * Math.sin(a);\n\n        // Reject candidates that are outside the allowed extent,\n        // or closer than 2 * radius to any existing sample.\n        if (x >= 0 && x < width && y >= 0 && y < height && far(x, y)) {\n          return sample(x, y);\n        }\n      }\n\n      queue[i] = queue[--queueSize];\n      queue.length = queueSize;\n    }\n  };\n\n  const samples: Vector2[] = [];\n  for (let i = 0; i < max; i++) {\n    const sample = sampler();\n    // we can't get any more\n    if (sample == null) {\n      break;\n    }\n    samples.push(new Vector2(sample[0], sample[1]));\n  }\n  return samples;\n}\n","import { Species } from \"evolution/species\";\nimport React from \"react\";\nimport { Button } from \"../../common/Button\";\nimport Expand from \"../../common/Expand\";\nimport MP from \"../../common/MP\";\nimport { HexTile } from \"../hexTile\";\nimport \"./HexInfo.scss\";\n\ninterface HexInfo {\n  playSpecies: Species;\n  tile: HexTile;\n  onClickPlay: () => void;\n}\n\nfunction HexInfo({ playSpecies, tile, onClickPlay }: HexInfo) {\n  const { height, flora } = tile.info;\n\n  const playButtonElement =\n    height === -1 ? null : (\n      <div className=\"play-selector\">\n        <span>{playSpecies.name}</span>\n        <Button\n          color=\"green\"\n          className=\"play-button\"\n          onClick={onClickPlay}\n          disabled={tile.info.flora && tile.info.flora.actionPoints < 1}\n        >\n          Migrate\n        </Button>\n      </div>\n    );\n\n  const header =\n    flora != null ? (\n      <div>\n        <h1>\n          Inhabited by <i>{flora.species.name}</i>\n        </h1>\n        <p>\n          <MP amount={flora.mutationPointsPerEpoch} /> per epoch\n        </p>\n        <p>Action Points: {flora.actionPoints}</p>\n      </div>\n    ) : tile.isHabitable ? (\n      <h1>Uninhabited</h1>\n    ) : (\n      <h1>Uninhabitable (Deep Water)</h1>\n    );\n\n  const stringifyInfo = { ...tile.info };\n  delete stringifyInfo.flora;\n\n  const expand = tile.isHabitable ? (\n    <Expand shrunkElements={<div className=\"details\">Details</div>}>\n      <pre style={{ fontSize: \"12px\" }}>{JSON.stringify(stringifyInfo, null, 4)}</pre>\n    </Expand>\n  ) : null;\n\n  return (\n    <div className=\"hex-info-container\">\n      {header}\n      {expand}\n      {playButtonElement}\n    </div>\n  );\n}\n\nexport default HexInfo;\n","export function sleep(time: number) {\n  return new Promise((r) => {\n    setTimeout(r, time);\n  });\n}\n","import { PopulationAttempt } from \"app\";\nimport testVignetteUrl from \"assets/images/test-vignette.png\";\nimport { sleep } from \"common/promise\";\nimport { easeExpIn } from \"d3-ease\";\nimport { scaleLinear } from \"d3-scale\";\nimport { Species } from \"evolution/species\";\nimport Ticker from \"global/ticker\";\nimport { clamp, map, sawTooth } from \"math\";\nimport { generateNaturalRandomHexagonPoints, pixelPosition } from \"overworld/hexMath\";\nimport { HexTile } from \"overworld/hexTile\";\nimport { Vector2 } from \"three\";\nimport { CameraState } from \"./OverWorldMap\";\n\nconst testVignette = new Image();\ntestVignette.src = testVignetteUrl;\n\nconst COLOR_SCALE_HEIGHT = scaleLinear<string, string>()\n  .domain([-1, 0, 1, 5, 6])\n  .range([\"rgb(0, 60, 255)\", \"lightblue\", \"yellow\", \"orange\"]);\n\nexport interface DrawingContext {\n  populationAttempt?: PopulationAttempt;\n  highlightedHex?: HexTile;\n}\n\nexport default class HexTileSprite {\n  private vignettePositions?: Vector2[];\n  private isHovered = false;\n\n  constructor(public tile: HexTile, public context: DrawingContext) {}\n\n  public get zIndex() {\n    let z = this.tile.cartesian.y;\n    if (this.tile.info.flora != null) {\n      z += 1000;\n    }\n    return z;\n  }\n\n  public get isShadowed() {\n    if (this.context.highlightedHex != null) {\n      return this.context.highlightedHex !== this.tile;\n    } else if (this.context.populationAttempt != null) {\n      return (\n        this.context.populationAttempt.sourceHex !== this.tile && this.context.populationAttempt.targetHex !== this.tile\n      );\n    } else {\n      return false;\n    }\n  }\n\n  /**\n   * This resets every draw.\n   */\n  setIsHovered() {\n    this.isHovered = true;\n  }\n\n  draw(c: CanvasRenderingContext2D, camera: CameraState) {\n    const { scale } = camera;\n    const [px, py] = pixelPosition(this.tile, camera);\n\n    c.lineWidth = (1 * scale) / 48;\n\n    if (this.isShadowed) {\n      c.globalAlpha = 0.2;\n    } else {\n      c.globalAlpha = 1;\n    }\n    if (this.tile.info.visible) {\n      // base color\n      c.fillStyle = COLOR_SCALE_HEIGHT(this.tile.info.height);\n      c.strokeStyle = \"rgb(112, 112, 112)\";\n      drawHex(c, px, py, scale);\n\n      // 0-6 number (can be covered by vignettes)\n      if (!this.isHovered) {\n        this.drawNumericHeight(c, scale, px, py);\n      }\n\n      // \"active\" pulse\n      if (this.tile.info.flora != null) {\n        if (this.tile.info.flora.actionPoints > 0) {\n          this.drawActivePulse(c, scale, px, py);\n        }\n        this.drawVignettes(c, this.tile.info.flora.species, px, py, scale);\n      }\n    } else {\n      c.strokeStyle = \"rgb(112, 112, 112)\";\n      drawHex(c, px, py, scale, false);\n    }\n\n    // hovered outline\n    if (this.isHovered) {\n      c.strokeStyle = \"rgb(112, 112, 112)\";\n      c.lineWidth = (1 * scale) / 48;\n      drawCircle(c, px, py, (scale / 48) * 12, false);\n      if (this.tile.info.visible) {\n        this.drawNumericHeight(c, scale, px, py);\n      }\n    }\n\n    this.isHovered = false;\n  }\n\n  private static easePulse = easeExpIn;\n\n  public drawActivePulse(c: CanvasRenderingContext2D, scale: number, px: number, py: number) {\n    for (let i = 0; i < 10; i++) {\n      this.drawPulse(i / 10, c, scale, px, py);\n    }\n  }\n\n  private drawPulse(tOffset: number, c: CanvasRenderingContext2D, scale: number, px: number, py: number) {\n    const thickness = map(\n      HexTileSprite.easePulse(clamp(map(sawTooth(Ticker.now / 6000 + tOffset), 0, 1, -1, 2), -Infinity, 1)),\n      0,\n      1,\n      0,\n      20\n    );\n    c.lineWidth = (thickness * scale) / 48;\n    const a = 100 / (thickness * thickness * thickness);\n    c.strokeStyle = `rgba(255, 255, 255, ${a})`;\n    drawHex(c, px, py, scale + c.lineWidth / 2, false);\n  }\n\n  private drawNumericHeight(c: CanvasRenderingContext2D, scale: number, px: number, py: number) {\n    c.font = `${(12 * scale) / 48}px serif`;\n    c.textAlign = \"center\";\n    c.textBaseline = \"middle\";\n    c.fillStyle = \"#666\";\n    c.fillText(this.tile.info.height + \"\", px, py, scale);\n  }\n\n  drawVignettes(c: CanvasRenderingContext2D, species: Species, px: number, py: number, scale: number) {\n    if (this.vignettePositions == null) {\n      const positions = generateNaturalRandomHexagonPoints(0.3, true); //.sort((a, b) => a.y - b.y);\n      this.vignettePositions = [];\n      const vignettePositions = this.vignettePositions;\n      (async function() {\n        for (const p of positions) {\n          vignettePositions.push(p);\n          await sleep(300);\n        }\n      })();\n    }\n    const sizeScale = scale / 48 / 2;\n    for (const p of this.vignettePositions) {\n      c.drawImage(\n        testVignette,\n        px + p.x * scale - (testVignette.width / 2) * sizeScale,\n        py + p.y * scale - testVignette.height * sizeScale,\n        testVignette.width * sizeScale,\n        testVignette.height * sizeScale\n      );\n    }\n  }\n}\n\nfunction drawHex(c: CanvasRenderingContext2D, x: number, y: number, r: number, fill = true) {\n  c.beginPath();\n  c.moveTo(x + r, y);\n  for (let i = 1; i < 6; i++) {\n    const angle = (i / 6) * Math.PI * 2;\n    c.lineTo(x + Math.cos(angle) * r, y + Math.sin(angle) * r);\n  }\n  c.closePath();\n  if (fill) {\n    c.fill();\n  }\n  c.stroke();\n}\n\nfunction drawCircle(c: CanvasRenderingContext2D, x: number, y: number, r: number, fill = true) {\n  c.beginPath();\n  c.moveTo(x + r, y);\n  c.arc(x, y, r, 0, Math.PI * 2);\n  // for (let i = 1; i < 6; i++) {\n  //   const angle = (i / 6) * Math.PI * 2;\n  //   c.lineTo(x + Math.cos(angle) * r, y + Math.sin(angle) * r);\n  // }\n  // c.closePath();\n  if (fill) {\n    c.fill();\n  }\n  c.stroke();\n}\n","import React from \"react\";\nimport { pixelPosition } from \"../hexMath\";\nimport { HexTile } from \"../hexTile\";\nimport { CameraState } from \"./OverWorldMap\";\nimport \"./OverWorldPopover.scss\";\n\ninterface OverWorldPopoverProps {\n  camera: CameraState;\n  tile: HexTile;\n  children: React.ReactNode;\n}\n\nfunction OverWorldPopover({ tile, camera, children }: OverWorldPopoverProps) {\n  const [px, py] = pixelPosition(tile, camera);\n  // this element is put in the center\n  const container: React.CSSProperties = {\n    left: px + camera.scale * 0.3,\n    top: py,\n  };\n  return (\n    <div className=\"overworld-popover\" style={container}>\n      <div className=\"overworld-popover-positioner\">{children}</div>\n    </div>\n  );\n}\n\nexport default OverWorldPopover;\n","import { AppReducerContext, PopulationAttempt } from \"app\";\nimport Ticker from \"global/ticker\";\nimport React from \"react\";\nimport { Vector2 } from \"three\";\nimport { getCameraPositionCenteredOn, getClickedHexCoords, pixelPosition } from \"../hexMath\";\nimport { HexTile } from \"../hexTile\";\nimport HexInfo from \"./HexInfo\";\nimport HexTileSprite, { DrawingContext } from \"./hexTileSprite\";\nimport \"./OverWorldMap.scss\";\nimport OverWorldPopover from \"./OverWorldPopover\";\n\ninterface OverWorldMapProps {\n  // TODO turn this into a trigger, or global state\n  focusedHex?: HexTile;\n}\n\nexport interface CameraState {\n  /**\n   * Multiply cartesian hex coord values by scale to get pixel coordinates.\n   * Each hex is drawn with radius `scale`.\n   */\n\n  scale: number;\n  /**\n   * dX and dY are pure pixel offsets.\n   */\n  dX: number;\n  dY: number;\n}\n\ninterface OverWorldMapState {\n  cameraState: CameraState;\n  pressedKeys: { [code: string]: boolean };\n  populationAttempt?: PopulationAttempt;\n  // TODO one of population attempt or highlighted hex can be\n  // non-null at a time\n  highlightedHex?: HexTile;\n  hoveredHex?: HexTile;\n  frame: number;\n}\n\nexport class OverWorldMap extends React.PureComponent<OverWorldMapProps, OverWorldMapState> implements DrawingContext {\n  static contextType = AppReducerContext;\n\n  context!: React.ContextType<typeof AppReducerContext>;\n\n  private hexTileSprites: Map<HexTile, HexTileSprite> = new Map();\n\n  private canvas: HTMLCanvasElement | null = null;\n\n  private rafId?: number;\n\n  get populationAttempt() {\n    return this.state.populationAttempt;\n  }\n\n  get highlightedHex() {\n    return this.state.highlightedHex;\n  }\n\n  constructor(props: OverWorldMapProps, context: any) {\n    super(props, context);\n    const scale = 96;\n    const [{ overWorld }] = context;\n    const [dX, dY] = getCameraPositionCenteredOn(overWorld.getStartTile(), scale);\n    this.state = {\n      cameraState: { scale, dX, dY },\n      pressedKeys: {},\n      frame: 0,\n    };\n    for (const tile of overWorld) {\n      const sprite = new HexTileSprite(tile, this);\n      this.hexTileSprites.set(tile, sprite);\n    }\n  }\n\n  private handleCanvasRef = (ref: HTMLCanvasElement | null) => {\n    this.canvas = ref;\n    if (ref != null) {\n      Ticker.addAnimation(() => {\n        this.setState({ frame: this.state.frame + 1 });\n        return this.canvas == null;\n      });\n      this.handleResize();\n    }\n  };\n\n  private handleCanvasClick = (e: React.MouseEvent) => {\n    if (this.state.populationAttempt != null || this.state.highlightedHex != null) {\n      this.setState({\n        populationAttempt: undefined,\n        highlightedHex: undefined,\n      });\n    } else {\n      const coords = getClickedHexCoords(this.canvas!, this.state.cameraState, e);\n      const [{ overWorld }] = this.context;\n      const clicked = overWorld.hexAt(coords.i, coords.j);\n      // simplest check - we clicked on a tile we can see\n      if (clicked != null && clicked.info.visible) {\n        // if clicked has no flora, migrate into it\n        if (clicked.info.flora == null) {\n          const target = clicked;\n          const source = overWorld.possibleMigrationSources(clicked)[0];\n          if (source != null) {\n            const populationAttempt: PopulationAttempt = {\n              targetHex: target,\n              sourceHex: source,\n              settlingSpecies: source.info.flora!.species,\n            };\n            this.setState({ populationAttempt, highlightedHex: undefined });\n          } else {\n            // TODO add a Popover for when you see a tile but can't reach it with anything\n            // this can happen in the future if earthquakes happen and destroy\n            // blocks you used to own\n          }\n        } else {\n          // clicked does have flora; just show a highlight\n          const highlightedHex = clicked;\n          this.setState({ highlightedHex, populationAttempt: undefined });\n        }\n      }\n    }\n  };\n\n  private handleCanvasMouseLeave = () => {\n    this.setState({\n      hoveredHex: undefined,\n    });\n  };\n\n  private handleCanvasMouseMove = (e: React.MouseEvent) => {\n    const coords = getClickedHexCoords(this.canvas!, this.state.cameraState, e);\n    const hex = this.context[0].overWorld.hexAt(coords.i, coords.j);\n    this.setState({ hoveredHex: hex });\n  };\n\n  private handleClickPlay = () => {\n    const [, dispatch] = this.context;\n    if (this.state.populationAttempt != null) {\n      dispatch({\n        type: \"AAStartPopulationAttempt\",\n        populationAttempt: this.state.populationAttempt,\n      });\n    } else if (this.state.highlightedHex != null) {\n      // re-populate the same tile\n      const sourceHex = this.state.highlightedHex;\n      dispatch({\n        type: \"AAStartPopulationAttempt\",\n        populationAttempt: {\n          sourceHex,\n          targetHex: sourceHex,\n          settlingSpecies: sourceHex.info.flora!.species,\n        },\n      });\n    }\n  };\n\n  private handleKeyDown = (e: KeyboardEvent) => {\n    if (!e.repeat) {\n      const newPressedKeys = { ...this.state.pressedKeys, [e.code]: true };\n      this.setState({\n        pressedKeys: newPressedKeys,\n      });\n    }\n  };\n\n  private handleKeyUp = (e: KeyboardEvent) => {\n    const newPressedKeys = { ...this.state.pressedKeys };\n    delete newPressedKeys[e.code];\n    this.setState({\n      pressedKeys: newPressedKeys,\n    });\n  };\n\n  private handleWheel = (e: WheelEvent) => {\n    const delta = -(e.deltaX + e.deltaY) / 125 / 10;\n    const scalar = Math.pow(2, delta);\n\n    const scale = this.state.cameraState.scale * scalar;\n    this.setState({\n      cameraState: {\n        ...this.state.cameraState,\n        scale,\n      },\n    });\n  };\n\n  private handleResize = () => {\n    if (this.canvas != null) {\n      this.canvas.width = window.innerWidth;\n      this.canvas.height = window.innerHeight;\n      this.updateCanvas();\n    }\n  };\n\n  private updateCamera = () => {\n    const panSpeed = 20;\n    let offset = new Vector2();\n    for (const key in this.state.pressedKeys) {\n      if (key === \"KeyW\" || key === \"ArrowUp\") {\n        offset.y += panSpeed;\n      } else if (key === \"KeyS\" || key === \"ArrowDown\") {\n        offset.y -= panSpeed;\n      } else if (key === \"KeyA\" || key === \"ArrowLeft\") {\n        offset.x += panSpeed;\n      } else if (key === \"KeyD\" || key === \"ArrowRight\") {\n        offset.x -= panSpeed;\n      }\n    }\n    offset.setLength(panSpeed);\n\n    if (offset.x !== 0 || offset.y !== 0) {\n      const cameraState = this.state.cameraState;\n\n      this.setState({\n        cameraState: {\n          ...cameraState,\n          dX: cameraState.dX + offset.x,\n          dY: cameraState.dY + offset.y,\n        },\n      });\n    }\n  };\n\n  private updateCanvas() {\n    if (this.canvas != null) {\n      const c = this.canvas.getContext(\"2d\")!;\n      this.drawMap(c);\n      this.drawMigrationArrows(c);\n      this.drawPopulationAttempt(c);\n    }\n  }\n\n  private drawMap(c: CanvasRenderingContext2D) {\n    const { hoveredHex, cameraState } = this.state;\n    c.clearRect(0, 0, c.canvas.width, c.canvas.height);\n\n    if (hoveredHex != null) {\n      this.hexTileSprites.get(hoveredHex)!.setIsHovered();\n    }\n\n    const sprites = Array.from(this.hexTileSprites.values());\n    sprites.sort((b, a) => {\n      return b.zIndex - a.zIndex;\n    });\n\n    for (const sprite of sprites) {\n      sprite.draw(c, cameraState);\n    }\n  }\n\n  private drawMigrationArrows(c: CanvasRenderingContext2D) {\n    const { hoveredHex, populationAttempt } = this.state;\n    if (hoveredHex != null && populationAttempt == null) {\n      if (hoveredHex.info.flora == null) {\n        this.drawPossibleMigrationIntoArrows(c, hoveredHex);\n      } else {\n        this.drawPossibleMigrationOutOfArrows(c, hoveredHex);\n      }\n    }\n  }\n\n  private drawPopulationAttempt(c: CanvasRenderingContext2D) {\n    const { populationAttempt } = this.state;\n    if (populationAttempt != null) {\n      this.drawMigrationArrow(c, populationAttempt.sourceHex!, populationAttempt.targetHex);\n    }\n  }\n\n  componentDidMount() {\n    document.addEventListener(\"keydown\", this.handleKeyDown);\n    document.addEventListener(\"keyup\", this.handleKeyUp);\n    document.addEventListener(\"wheel\", this.handleWheel);\n    window.addEventListener(\"resize\", this.handleResize);\n    this.rafId = Ticker.addAnimation(this.updateCamera);\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener(\"keydown\", this.handleKeyDown);\n    document.removeEventListener(\"keyup\", this.handleKeyUp);\n    document.removeEventListener(\"wheel\", this.handleWheel);\n    window.removeEventListener(\"resize\", this.handleResize);\n    Ticker.removeAnimation(this.rafId!);\n  }\n\n  componentDidUpdate(prevProps: OverWorldMapProps) {\n    if (prevProps.focusedHex !== this.props.focusedHex && this.props.focusedHex != null) {\n      this.focusHex(this.props.focusedHex);\n    }\n    this.updateCanvas();\n  }\n\n  focusHex(hex: HexTile) {\n    let tStart = 0;\n    Ticker.addAnimation((t) => {\n      if (tStart === 0) {\n        tStart = t;\n      }\n      const dt = t - tStart;\n      const [targetX, targetY] = getCameraPositionCenteredOn(hex, this.state.cameraState.scale);\n      const dX = this.state.cameraState.dX * 0.5 + targetX * 0.5;\n      const dY = this.state.cameraState.dY * 0.5 + targetY * 0.5;\n      this.setState({\n        cameraState: {\n          ...this.state.cameraState,\n          dX,\n          dY,\n        },\n      });\n      return dt > 1000 || (Math.abs(targetX - dX) < 1e-2 && Math.abs(targetY - dY) < 1e-2);\n    });\n  }\n\n  render() {\n    return (\n      <div className=\"overworld-map-container\">\n        <canvas\n          tabIndex={-1}\n          ref={this.handleCanvasRef}\n          onClick={this.handleCanvasClick}\n          onMouseLeave={this.handleCanvasMouseLeave}\n          onMouseMove={this.handleCanvasMouseMove}\n        />\n        {this.maybeRenderPopover()}\n      </div>\n    );\n  }\n\n  drawPossibleMigrationIntoArrows(c: CanvasRenderingContext2D, target: HexTile) {\n    const [{ overWorld }] = this.context;\n    for (const source of overWorld.possibleMigrationSources(target)) {\n      this.drawMigrationArrow(c, source, target);\n    }\n  }\n\n  drawPossibleMigrationOutOfArrows(c: CanvasRenderingContext2D, source: HexTile) {\n    const [{ overWorld }] = this.context;\n    for (const target of overWorld.possibleMigrationTargets(source)) {\n      this.drawMigrationArrow(c, source, target);\n    }\n  }\n\n  public drawMigrationArrow(c: CanvasRenderingContext2D, source: HexTile, target: HexTile) {\n    const isShadowed = (() => {\n      if (this.highlightedHex != null) {\n        return true;\n      } else if (this.populationAttempt != null) {\n        return source !== this.populationAttempt.sourceHex || target !== this.populationAttempt.targetHex;\n      } else {\n        return false;\n      }\n    })();\n    if (isShadowed) {\n      c.globalAlpha = 0.2;\n    } else {\n      c.globalAlpha = 1;\n    }\n    const { scale } = this.state.cameraState;\n    c.shadowBlur = (3 * scale) / 48;\n    c.shadowOffsetX = (4 * scale) / 48;\n    c.shadowOffsetY = (4 * scale) / 48;\n    c.shadowColor = \"black\";\n    c.strokeStyle = \"white\";\n\n    c.lineWidth = (3 * scale) / 48;\n    c.lineCap = \"round\";\n    c.lineJoin = \"round\";\n    const targetCenter = new Vector2(...pixelPosition(target, this.state.cameraState));\n    const sourceCenter = new Vector2(...pixelPosition(source, this.state.cameraState));\n    const arrowStart = sourceCenter.clone().lerp(targetCenter, 0.2);\n    const arrowEnd = targetCenter.clone().lerp(sourceCenter, 0.2);\n    drawArrow(c, arrowStart.x, arrowStart.y, arrowEnd.x, arrowEnd.y, (10 * scale) / 48);\n    c.shadowColor = \"transparent\";\n  }\n\n  maybeRenderPopover() {\n    const { cameraState, populationAttempt, highlightedHex } = this.state;\n    if (populationAttempt != null) {\n      return (\n        <OverWorldPopover camera={cameraState} tile={populationAttempt.targetHex}>\n          <HexInfo\n            playSpecies={populationAttempt.settlingSpecies}\n            tile={populationAttempt.targetHex}\n            onClickPlay={this.handleClickPlay}\n          />\n        </OverWorldPopover>\n      );\n    } else if (highlightedHex != null) {\n      return (\n        <OverWorldPopover camera={cameraState} tile={highlightedHex}>\n          <HexInfo\n            playSpecies={highlightedHex.info.flora!.species}\n            tile={highlightedHex}\n            onClickPlay={this.handleClickPlay}\n          />\n        </OverWorldPopover>\n      );\n    }\n  }\n}\n\nfunction drawArrow(c: CanvasRenderingContext2D, fromx: number, fromy: number, tox: number, toy: number, headlen = 10) {\n  c.beginPath();\n  var dx = tox - fromx;\n  var dy = toy - fromy;\n  var angle = Math.atan2(dy, dx);\n  c.moveTo(fromx, fromy);\n  c.lineTo(tox, toy);\n  c.lineTo(tox - headlen * Math.cos(angle - Math.PI / 6), toy - headlen * Math.sin(angle - Math.PI / 6));\n  c.moveTo(tox, toy);\n  c.lineTo(tox - headlen * Math.cos(angle + Math.PI / 6), toy - headlen * Math.sin(angle + Math.PI / 6));\n  c.stroke();\n}\n","import { useAppReducer } from \"app\";\nimport { resetGame, save } from \"app/saveLoad\";\nimport classNames from \"classnames\";\nimport { Button } from \"common/Button\";\nimport MutationScreen from \"evolution/MutationScreen\";\nimport PhylogeneticTree from \"evolution/PhylogeneticTree\";\nimport { Species } from \"evolution/species\";\nimport React, { useCallback, useEffect, useState } from \"react\";\nimport { GiFamilyTree } from \"react-icons/gi\";\nimport Modal from \"react-modal\";\nimport { EpochUI } from \"./EpochUI\";\nimport { HexTile } from \"./hexTile\";\nimport { OverWorldMap } from \"./map/OverWorldMap\";\nimport \"./OverWorldScreen.scss\";\n\nexport interface OverWorldScreenProps {\n  onNextEpoch: () => void;\n}\n\nconst OverWorldScreen = ({ onNextEpoch }: OverWorldScreenProps) => {\n  const [leftPanelOpen, setLeftPanelOpen] = useState(false);\n  const [activelyMutatingSpecies, setActivelyMutatingSpecies] = useState<Species | undefined>(undefined);\n\n  useEffect(() => {\n    function handleKeyDown(e: KeyboardEvent) {\n      if (e.code === \"Tab\") {\n        setLeftPanelOpen((open) => !open);\n        e.preventDefault();\n      }\n    }\n    document.addEventListener(\"keydown\", handleKeyDown);\n    return () => {\n      document.removeEventListener(\"keydown\", handleKeyDown);\n    };\n  }, []);\n\n  const handleStartMutate = useCallback((s: Species) => {\n    setActivelyMutatingSpecies(s);\n  }, []);\n\n  const handleCommit = useCallback(\n    (newSpecies: Species, newPool: number) => {\n      if (activelyMutatingSpecies == null) {\n        throw new Error(\"created new species with no actively mutating one!\");\n      }\n      activelyMutatingSpecies.descendants.push(newSpecies);\n      // eslint-disable-next-line react/no-direct-mutation-state\n      activelyMutatingSpecies.freeMutationPoints = newPool;\n      newSpecies.parent = activelyMutatingSpecies;\n      setActivelyMutatingSpecies(undefined);\n    },\n    [activelyMutatingSpecies]\n  );\n\n  function maybeRenderMutationModal() {\n    const maybeMutationScreen =\n      activelyMutatingSpecies != null ? (\n        <MutationScreen species={activelyMutatingSpecies} onCommit={handleCommit} />\n      ) : null;\n    return (\n      <Modal\n        ariaHideApp={false}\n        isOpen={activelyMutatingSpecies != null}\n        onRequestClose={() => setActivelyMutatingSpecies(undefined)}\n        className=\"mutation-screen-portal\"\n      >\n        {maybeMutationScreen}\n      </Modal>\n    );\n  }\n\n  function maybeRenderPhylogeneticTreePanel() {\n    return (\n      <div className={classNames(\"panel-left\", { open: leftPanelOpen })}>\n        {leftPanelOpen ? <PhylogeneticTree onMutate={handleStartMutate} /> : null}\n        <button className=\"panel-left-handle\" onClick={() => setLeftPanelOpen((open) => !open)}>\n          <GiFamilyTree className=\"icon\" />\n        </button>\n      </div>\n    );\n  }\n\n  const [focusedHex, setFocusedHex] = useState<HexTile | undefined>(undefined);\n  const handleFocusHex = useCallback((hex: HexTile) => {\n    setFocusedHex(hex);\n  }, []);\n\n  const [appState] = useAppReducer();\n\n  return (\n    <div className=\"overworld-screen\">\n      <OverWorldMap focusedHex={focusedHex} />\n      {maybeRenderPhylogeneticTreePanel()}\n      {maybeRenderMutationModal()}\n      <EpochUI onNextEpoch={onNextEpoch} onFocusHex={handleFocusHex} />\n      <div style={{ position: \"absolute\", right: \"10px\", top: \"10px\" }}>\n        <Button onClick={() => save(appState)}>Save</Button>\n      </div>\n      <div style={{ position: \"absolute\", right: \"10px\", top: \"60px\" }}>\n        <Button onClick={() => resetGame()}>Reset Game</Button>\n      </div>\n    </div>\n  );\n};\n\nexport default OverWorldScreen;\n","import * as React from \"react\";\nimport * as THREE from \"three\";\n\nexport const UI_EVENTS = {\n  click: true,\n  contextmenu: true,\n  dblclick: true,\n  mousedown: true,\n  mouseup: true,\n  mousemove: true,\n  touchstart: true,\n  touchmove: true,\n  touchend: true,\n  keyup: true,\n  keydown: true,\n  keypress: true,\n  wheel: true,\n};\n\nexport type UIEventReciever = {\n  [E in keyof typeof UI_EVENTS]?: (this: HTMLElement, ev: GlobalEventHandlersEventMap[E]) => void;\n  // [E in keyof typeof UI_EVENTS]?: (ev: Event) => void;\n};\n\nexport abstract class ISketch {\n  static id?: string;\n\n  public elements?: JSX.Element[];\n  public events?: UIEventReciever;\n  /**\n   * milliseconds since sketch started running.\n   */\n  public timeElapsed = 0;\n\n  public frameCount = 0;\n\n  constructor(public renderer: THREE.WebGLRenderer, public audioContext: SketchAudioContext) {}\n\n  /**\n   * height / width\n   */\n  get aspectRatio() {\n    return this.renderer.domElement.height / this.renderer.domElement.width;\n  }\n\n  get resolution() {\n    return new THREE.Vector2(this.renderer.domElement.width, this.renderer.domElement.height);\n  }\n\n  get canvas() {\n    return this.renderer.domElement;\n  }\n\n  abstract animate(millisElapsed: number): void;\n\n  render?(): React.ReactElement;\n\n  resize?(width: number, height: number): void;\n\n  destroy?(): void;\n}\n\nexport interface SketchConstructor {\n  new (renderer: THREE.WebGLRenderer, audioContext: SketchAudioContext, ...otherArgs: any[]): ISketch;\n\n  id?: string;\n}\n\nexport interface SketchAudioContext extends AudioContext {\n  gain: GainNode;\n}\n","import classnames from \"classnames\";\nimport * as React from \"react\";\nimport * as THREE from \"three\";\n\nimport { ISketch, SketchAudioContext, SketchConstructor, UI_EVENTS } from \"./sketch\";\n\nimport { FaVolumeOff, FaVolumeUp } from \"react-icons/fa\";\nimport Ticker from \"global/ticker\";\n\nexport interface ISketchComponentProps extends React.DOMAttributes<HTMLDivElement> {\n  eventsOnBody?: boolean;\n  errorElement?: JSX.Element;\n  sketchClass: SketchConstructor;\n  otherArgs?: any[];\n}\n\nexport interface SketchSuccess {\n  type: \"success\";\n  sketch: ISketch;\n}\n\nexport interface SketchError {\n  type: \"error\";\n  error: Error;\n}\n\nexport interface SketchLoading {\n  type: \"loading\";\n}\n\nexport type SketchStatus = SketchSuccess | SketchError | SketchLoading;\n\n// Expects sketch to be setup but not init. SketchSuccessComponent is responsible for:\n//      firing resize events\n//      attaching ui event listeners\n//      keeping focus on the canvas\ninterface SketchSuccessComponentProps {\n  sketch: ISketch;\n  eventsOnBody?: boolean;\n}\nclass SketchSuccessComponent extends React.PureComponent<SketchSuccessComponentProps, { frameCount: number }> {\n  private frameId?: number;\n  private lastTimestamp = 0;\n  private stop = false;\n\n  constructor(props: SketchSuccessComponentProps) {\n    super(props);\n    this.state = {\n      frameCount: props.sketch.frameCount,\n    };\n  }\n\n  componentDidMount() {\n    window.addEventListener(\"resize\", this.handleWindowResize);\n    this.handleWindowResize();\n\n    // canvas setup\n    const canvas = this.props.sketch.renderer.domElement;\n    canvas.tabIndex = 1;\n    (Object.keys(UI_EVENTS) as Array<keyof typeof UI_EVENTS>).forEach((eventName) => {\n      if (this.props.sketch.events != null) {\n        const callback = this.props.sketch.events[eventName] as EventListener;\n        if (callback != null) {\n          if (this.props.eventsOnBody) {\n            document.body.addEventListener(eventName, callback);\n          } else {\n            canvas.addEventListener(eventName, callback);\n          }\n        }\n      }\n    });\n    // prevent scrolling the viewport\n    // $canvas.on(\"touchmove\", (event) => {\n    //     event.preventDefault();\n    // });\n\n    this.frameId = Ticker.addAnimation(this.loop);\n  }\n\n  render() {\n    const sketchElementsWithKey: React.ReactElement[] = [];\n    if (this.props.sketch.render != null) {\n      sketchElementsWithKey.push(this.props.sketch.render());\n    }\n    if (this.props.sketch.elements != null) {\n      sketchElementsWithKey.push(...this.props.sketch.elements);\n    }\n    return (\n      <div className=\"sketch-elements\">\n        {sketchElementsWithKey.map((el, idx) => React.cloneElement(el, { key: idx }))}\n      </div>\n    );\n  }\n\n  componentWillUnmount() {\n    this.stop = true;\n\n    if (this.props.sketch.destroy) {\n      this.props.sketch.destroy();\n    }\n    if (this.frameId != null) {\n      Ticker.removeAnimation(this.frameId);\n    }\n    this.props.sketch.renderer.dispose();\n    window.removeEventListener(\"resize\", this.handleWindowResize);\n\n    const canvas = this.props.sketch.canvas;\n    (Object.keys(UI_EVENTS) as Array<keyof typeof UI_EVENTS>).forEach((eventName) => {\n      if (this.props.sketch.events != null) {\n        const callback = this.props.sketch.events[eventName] as EventListener;\n        if (callback != null) {\n          if (this.props.eventsOnBody) {\n            document.body.removeEventListener(eventName, callback);\n          } else {\n            canvas.removeEventListener(eventName, callback);\n          }\n        }\n      }\n    });\n  }\n\n  private loop = (timestamp: number) => {\n    const millisElapsed = timestamp - this.lastTimestamp;\n    this.lastTimestamp = timestamp;\n    this.props.sketch.frameCount++;\n    this.props.sketch.timeElapsed = timestamp;\n    try {\n      this.props.sketch.animate(millisElapsed);\n    } catch (e) {\n      console.error(e);\n    }\n\n    // careful - sketch.animate() might have triggered a whole React update loop\n    // and made this component unmount.\n    if (!this.stop) {\n      // force new render()\n      this.setState({\n        frameCount: this.props.sketch.frameCount,\n      });\n    } else {\n      Ticker.removeAnimation(this.frameId!);\n    }\n  };\n\n  private handleWindowResize = () => {\n    const { renderer } = this.props.sketch;\n    this.updateRendererCanvasToMatchParent(renderer);\n    if (this.props.sketch.resize != null) {\n      this.props.sketch.resize(renderer.domElement.width, renderer.domElement.height);\n    }\n  };\n\n  private updateRendererCanvasToMatchParent(renderer: THREE.WebGLRenderer) {\n    const parent = renderer.domElement.parentElement;\n    if (parent != null) {\n      renderer.setSize(parent.clientWidth, parent.clientHeight);\n    }\n  }\n}\n\nexport interface ISketchComponentState {\n  status: SketchStatus;\n  volumeEnabled: boolean;\n}\n\nexport class SketchComponent extends React.PureComponent<ISketchComponentProps, ISketchComponentState> {\n  public state: ISketchComponentState = {\n    status: { type: \"loading\" },\n    volumeEnabled: JSON.parse(window.localStorage.getItem(\"sketch-volumeEnabled\") || \"true\"),\n  };\n\n  // private renderer?: THREE.WebGLRenderer;\n  private audioContext?: SketchAudioContext;\n  private userVolume?: GainNode;\n\n  private handleContainerRef = (ref: HTMLDivElement | null) => {\n    if (ref != null) {\n      try {\n        // create dependencies, setup sketch, and move to success state\n        // we are responsible for live-updating the global user volume.\n        const AudioContextConstructor: typeof AudioContext =\n          (window as any).AudioContext || (window as any).webkitAudioContext;\n        const audioContext = (this.audioContext = new AudioContextConstructor() as SketchAudioContext);\n        (THREE.AudioContext as any).setContext(audioContext);\n        this.userVolume = audioContext.createGain();\n        this.userVolume.gain.setValueAtTime(0.8, 0);\n        this.userVolume.connect(audioContext.destination);\n        const audioContextGain = (audioContext.gain = audioContext.createGain());\n        audioContextGain.connect(this.userVolume);\n        document.addEventListener(\"visibilitychange\", this.handleVisibilityChange);\n\n        const renderer = new THREE.WebGLRenderer({\n          alpha: true,\n          preserveDrawingBuffer: true,\n          antialias: true,\n        });\n        ref.appendChild(renderer.domElement);\n\n        const otherArgs = this.props.otherArgs || [];\n        const sketch = new this.props.sketchClass(renderer, this.audioContext, ...otherArgs);\n        this.setState({ status: { type: \"success\", sketch: sketch } });\n      } catch (e) {\n        this.setState({ status: { type: \"error\", error: e } });\n        console.error(e);\n      }\n    } else {\n      if (this.state.status.type === \"success\") {\n        this.state.status.sketch.canvas.remove();\n      }\n      document.removeEventListener(\"visibilitychange\", this.handleVisibilityChange);\n      if (this.audioContext != null) {\n        this.audioContext.close();\n      }\n      this.setState({ status: { type: \"loading\" } });\n    }\n  };\n\n  public render() {\n    if (this.userVolume != null && this.audioContext != null) {\n      // this.userVolume.gain.value = this.state.volumeEnabled ? 1 : 0;\n      if (this.state.volumeEnabled && this.audioContext.state === \"suspended\") {\n        this.audioContext.resume();\n      } else if (!this.state.volumeEnabled && this.audioContext.state === \"running\") {\n        this.audioContext.suspend();\n      }\n    }\n\n    const { sketchClass, otherArgs, eventsOnBody, errorElement, ...containerProps } = this.props;\n    const className = classnames(\"sketch-component\", this.state.status.type);\n    return (\n      <div {...containerProps} id={this.props.sketchClass.id} className={className} ref={this.handleContainerRef}>\n        {this.renderSketchOrStatus()}\n        {this.renderVolumeButton()}\n      </div>\n    );\n  }\n\n  private renderSketchOrStatus() {\n    const { status } = this.state;\n    if (status.type === \"success\") {\n      // key on id to not destroy and re-create the component somehow\n      return (\n        <SketchSuccessComponent\n          key={this.props.sketchClass.id}\n          sketch={status.sketch}\n          eventsOnBody={this.props.eventsOnBody}\n        />\n      );\n    } else if (status.type === \"error\") {\n      const errorElement = this.props.errorElement || this.renderDefaultErrorElement(status.error.message);\n      return errorElement;\n    } else if (status.type === \"loading\") {\n      return null;\n    }\n  }\n\n  private renderDefaultErrorElement(message: string) {\n    return (\n      <p className=\"sketch-error\">\n        Oops - something went wrong! Make sure you're using Chrome, or are on your desktop.\n        <pre>{message}</pre>\n      </p>\n    );\n  }\n\n  private renderVolumeButton() {\n    const { volumeEnabled } = this.state;\n    return (\n      <button className=\"user-volume\" onClick={this.handleVolumeButtonClick}>\n        {volumeEnabled ? <FaVolumeUp /> : <FaVolumeOff />}\n      </button>\n    );\n  }\n\n  private handleVolumeButtonClick = () => {\n    const volumeEnabled = !this.state.volumeEnabled;\n    this.setState({ volumeEnabled });\n    window.localStorage.setItem(\"sketch-volumeEnabled\", JSON.stringify(volumeEnabled));\n  };\n\n  private handleVisibilityChange = () => {\n    if (this.audioContext != null) {\n      if (document.hidden) {\n        this.audioContext.suspend();\n      } else if (this.state.volumeEnabled) {\n        this.audioContext.resume();\n      }\n    }\n  };\n}\n","import * as React from \"react\";\n\nimport { SketchConstructor } from \"./sketch\";\nimport { SketchComponent } from \"./sketchComponent\";\n\nexport interface ISketchRouteProps {\n  sketchClass: SketchConstructor;\n  otherArgs?: any[];\n}\n\nexport class FullPageSketch extends React.PureComponent<ISketchRouteProps, {}> {\n  public render() {\n    return (\n      <div className=\"full-page-sketch\" ref={this.handleDivRef}>\n        <SketchComponent sketchClass={this.props.sketchClass} otherArgs={this.props.otherArgs} />\n      </div>\n    );\n  }\n  private handleDivRef = (div: HTMLDivElement | null) => {\n    if (div != null) {\n      // this.requestFullscreen(div);\n    } else {\n      this.exitFullscreen();\n    }\n  };\n\n  private exitFullscreen() {\n    if (document.webkitExitFullscreen) {\n      document.webkitExitFullscreen();\n    } else if (document.mozCancelFullScreen) {\n      document.mozCancelFullScreen();\n    }\n  }\n}\n","import { map } from \"math\";\nimport Mito from \"sketches/mito\";\nimport { TIME_PER_SEASON } from \"sketches/mito/game\";\nimport { GrowingCell, Tile } from \"sketches/mito/game/tile\";\n// import { createRendererFor } from \"sketches/mito/renderers/WorldRenderer\";\nimport { OrthographicCamera, Scene, Vector2, WebGLRenderTarget } from \"three\";\n\n/**\n * A Vignette is a visual snapshot of a plant at a specific stage of growth. It's actually\n * just an image.\n *\n * You can control:\n *   How big the vignette is.\n */\nclass VignetteCapturer {\n  static renderTarget = new WebGLRenderTarget(1024, 1024);\n  static rtBuffer = new Uint8Array(VignetteCapturer.renderTarget.width * VignetteCapturer.renderTarget.height * 4);\n  static rtCanvas = (() => {\n    const c = document.createElement(\"canvas\");\n    c.width = VignetteCapturer.renderTarget.width;\n    c.height = VignetteCapturer.renderTarget.height;\n    return c;\n  })();\n  private lastCaptureTime: number = 0;\n\n  public constructor(public readonly mito: Mito, public pxPerTile = 4, public captureInterval = TIME_PER_SEASON / 27) {}\n\n  isTimeForNewCapture() {\n    return this.mito.world.time - this.lastCaptureTime > this.captureInterval;\n  }\n\n  capture() {\n    const { renderTarget, rtBuffer, rtCanvas } = VignetteCapturer;\n    this.lastCaptureTime = this.mito.world.time;\n\n    // Cells that form the vignette:\n    const picturesqueCells = Array.from(this.mito.world.cells()).filter(\n      (t) => t.pos.y < 50 && !(t instanceof GrowingCell)\n    );\n\n    const [minBounds, maxBounds] = this.getBounds(picturesqueCells);\n\n    // add all renderers to a scene\n    const scene = new Scene();\n    const tileRenderers = picturesqueCells.map((c) => {\n      const renderer = this.mito.worldRenderer.createRendererFor(c);\n      renderer.update();\n      return renderer;\n    });\n\n    // webgl render to a renderTarget\n    const camera = this.cameraEncompassingBounds([minBounds, maxBounds]);\n    const { renderer } = this.mito;\n    renderer.setRenderTarget(renderTarget);\n    renderer.clear(true, true, true);\n    renderer.render(scene, camera);\n    renderer.setRenderTarget(null);\n\n    // buffer will now contain [r1, g1, b1, a1, r2, g2, b2, a2, ...]\n    renderer.readRenderTargetPixels(renderTarget, 0, 0, renderTarget.width, renderTarget.height, rtBuffer);\n\n    // copy buffer pixels into the full resolution canvas\n    const context = rtCanvas.getContext(\"2d\")!;\n    const imageData: ImageData = context.createImageData(rtCanvas.width, rtCanvas.height);\n    const imageBuffer = imageData.data;\n    for (let i = 0; i < rtBuffer.length; i++) {\n      imageBuffer[i] = rtBuffer[i];\n    }\n    context.putImageData(imageData, 0, 0);\n\n    const boundsWidth = maxBounds.x - minBounds.x;\n    const boundsHeight = maxBounds.y - minBounds.y;\n    const maxDimension = Math.max(boundsWidth, boundsHeight);\n\n    const roiWidth = map(boundsWidth, 0, maxDimension, 0, 1024);\n    const roiHeight = map(boundsHeight, 0, maxDimension, 0, 1024);\n    const roiTopLeft = new Vector2(512 - roiWidth / 2, 512 - roiHeight / 2);\n\n    const dest = document.createElement(\"canvas\");\n    dest.width = Math.ceil(boundsWidth * this.pxPerTile);\n    dest.height = Math.ceil(boundsHeight * this.pxPerTile);\n    const destContext = dest.getContext(\"2d\")!;\n    destContext.drawImage(rtCanvas, roiTopLeft.x, roiTopLeft.y, roiWidth, roiHeight, 0, 0, dest.width, dest.height);\n\n    const img = new Image();\n    img.src = dest.toDataURL();\n    document.body.appendChild(img);\n\n    tileRenderers.forEach((t) => {\n      t.destroy();\n    });\n    return dest;\n  }\n\n  getBounds(tiles: Tile[]): [Vector2, Vector2] {\n    const min = new Vector2();\n    const max = new Vector2();\n    if (tiles[0] != null) {\n      min.copy(tiles[0].pos);\n      max.copy(tiles[0].pos);\n    }\n    for (const t of tiles) {\n      min.min(t.pos);\n      max.max(t.pos);\n    }\n    // .pos is the center; pad to the edges of each tile\n    min.subScalar(0.5);\n    max.addScalar(0.5);\n    return [min, max];\n  }\n\n  private cameraEncompassingBounds([min, max]: [Vector2, Vector2]) {\n    const center = min.clone().lerp(max, 0.5);\n\n    const width = max.x - min.x;\n    const height = max.y - min.y;\n\n    // now that we know the bounding box, we want the camera to fit that bounding\n    // box perfectly while maintaining the aspect ratio of the renderTarget.\n    const largerDim = Math.max(width, height);\n    const camera = new OrthographicCamera(\n      center.x - largerDim / 2,\n      center.x + largerDim / 2,\n      center.y + largerDim / 2,\n      center.y - largerDim / 2,\n      -100,\n      100\n    );\n    return camera;\n  }\n}\n\nexport default VignetteCapturer;\n","import { Action, ActionMove } from \"./action\";\nimport { DIRECTIONS } from \"./directions\";\n\nexport const ACTION_KEYMAP: { [key: string]: Action } = {\n  KeyQ: {\n    type: \"drop\",\n    sugar: 0,\n    water: 1, // hack hack we can assume max 100 water, it's fine\n  },\n  KeyE: {\n    type: \"drop\",\n    sugar: 1,\n    water: 0, // hack hack we can assume max 100 water, it's fine\n  },\n  Space: {\n    type: \"pickup\",\n    sugar: 1,\n    water: 1,\n  },\n};\n\nexport const MOVEMENT_KEYS: { [key: string]: ActionMove } = {\n  KeyW: {\n    type: \"move\",\n    dir: DIRECTIONS.n,\n  },\n  KeyA: {\n    type: \"move\",\n    dir: DIRECTIONS.w,\n  },\n  KeyS: {\n    type: \"move\",\n    dir: DIRECTIONS.s,\n  },\n  KeyD: {\n    type: \"move\",\n    dir: DIRECTIONS.e,\n  },\n};\n\nexport const CELL_BAR_KEYS: Record<string, number> = {\n  Digit1: 0,\n  Digit2: 1,\n  Digit3: 2,\n  Digit4: 3,\n  Digit5: 4,\n};\n\nexport const MOVEMENTS = Object.keys(MOVEMENT_KEYS).map((key) => MOVEMENT_KEYS[key]);\n","export default function lazy<T>(fn: () => T): () => T {\n  let cache: T;\n  return () => {\n    if (cache === undefined) {\n      cache = fn();\n    }\n    return cache;\n  };\n}\n","import fruitSrc from \"assets/images/fruit.png\";\nimport roguelikeSheet_transparentSrc from \"assets/images/roguelikeSheet_transparent.png\";\nimport * as THREE from \"three\";\nimport lazy from \"../../common/lazy\";\n\nconst spriteSize = 16; // 16x16 sprites\nexport let spritesheetLoaded = false;\nexport const SPRITESHEET = lazy(() =>\n  new THREE.TextureLoader().load(roguelikeSheet_transparentSrc, (texture) => {\n    texture.magFilter = THREE.NearestFilter;\n    texture.flipY = true;\n    texture.wrapS = texture.wrapT = THREE.ClampToEdgeWrapping;\n    SPRITESHEET().dispatchEvent({ type: \"update\" });\n    spritesheetLoaded = true;\n  })\n);\n\nexport const fruitTexture = new THREE.TextureLoader().load(fruitSrc);\n\nconst cache: { [key: string]: THREE.Texture } = {};\n// x, y are spritesheet coordinates, starting top-left and going down/right\nexport function textureFromSpritesheet(x: number, y: number, backgroundColor = \"white\") {\n  x = Math.floor(x);\n  y = Math.floor(y);\n  const key = `${x},${y}`;\n  if (cache[key] == null) {\n    const canvas = document.createElement(\"canvas\");\n    canvas.width = spriteSize;\n    canvas.height = spriteSize;\n    const texture = new THREE.Texture(canvas);\n    texture.magFilter = THREE.NearestFilter;\n    texture.flipY = true;\n    texture.wrapS = THREE.RepeatWrapping;\n    texture.wrapT = THREE.RepeatWrapping;\n    function drawSpriteToCanvas() {\n      const image = SPRITESHEET().image;\n      const context = canvas.getContext(\"2d\")!;\n      context.fillStyle = backgroundColor;\n      context.fillRect(0, 0, spriteSize, 16);\n      // context.fillStyle = \"white\";\n      // flip the image vertically\n      context.drawImage(\n        image,\n        // sx, sy, sWidth, sHeight\n        spriteSize * x,\n        spriteSize * y,\n        spriteSize,\n        spriteSize,\n        // dx, dy, dWidth, dHeight\n        0,\n        0,\n        spriteSize,\n        spriteSize\n      );\n      texture.needsUpdate = true;\n      // devlog(\"updated spritesheet for\", x, y);\n    }\n    if (spritesheetLoaded) {\n      drawSpriteToCanvas();\n    } else {\n      SPRITESHEET().addEventListener(\"update\", () => {\n        drawSpriteToCanvas();\n      });\n    }\n    cache[key] = texture;\n  }\n  return cache[key];\n}\n","import { Scene } from \"three\";\nimport { Mito } from \"../index\";\nexport abstract class Renderer<T> {\n  constructor(public target: T, public scene: Scene, public mito: Mito) {}\n  abstract update(): void;\n  abstract destroy(): void;\n}\n","// hack - to work with vscode-glsl-literal\nconst glsl = (x: TemplateStringsArray) => x[0];\n\nexport default glsl;\n","import { BufferAttribute, BufferGeometry, Color, Points, ShaderMaterial, Texture } from \"three\";\nimport glsl from \"./glsl\";\n\nexport class ResourcePoints extends Points {\n  static BUFFER_SIZE = 100000;\n  public geometry: BufferGeometry;\n  public material: ResourcePointsMaterial;\n  static newGeometry() {\n    const geometry = new BufferGeometry();\n    const positions = new Float32Array(ResourcePoints.BUFFER_SIZE * 3);\n    const sizes = new Float32Array(ResourcePoints.BUFFER_SIZE);\n    geometry.addAttribute(\"position\", new BufferAttribute(positions, 3).setDynamic(true));\n    geometry.addAttribute(\"size\", new BufferAttribute(sizes, 1).setDynamic(true));\n    return geometry;\n  }\n  constructor(params: ResourcePointsParameters) {\n    super();\n    this.geometry = ResourcePoints.newGeometry();\n    this.material = new ResourcePointsMaterial(params);\n    this.frustumCulled = false;\n  }\n  private index = 0;\n  startFrame() {\n    this.index = 0;\n  }\n  commit(x: number, y: number, z: number, size: number) {\n    this.geometry.attributes.position.setXYZ(this.index, x, y, z);\n    this.geometry.attributes.size.setX(this.index, size);\n    this.index++;\n  }\n  endFrame() {\n    const positions = this.geometry.attributes.position as BufferAttribute;\n    positions.needsUpdate = true;\n    const sizes = this.geometry.attributes.size as BufferAttribute;\n    sizes.needsUpdate = true;\n    this.geometry.setDrawRange(0, this.index);\n  }\n}\n\nexport interface ResourcePointsParameters {\n  opacity: number;\n  color: Color;\n  size: number;\n  map?: Texture;\n}\n\nclass ResourcePointsMaterial extends ShaderMaterial {\n  public map: Texture | undefined;\n\n  constructor(public params: ResourcePointsParameters) {\n    super({\n      uniforms: {\n        opacity: { value: params.opacity },\n        sizeGlobal: { value: params.size },\n        color: { value: params.color },\n        // you have to put it here too\n        map: { value: params.map },\n      },\n      vertexShader,\n      fragmentShader,\n      depthTest: false,\n      transparent: true,\n    } as any);\n\n    // OH MY GOD you can do this. You have to do this *AFTER* the super call!\n    // This hooks into threejs WebGLProgram's built-in properties that hooks up\n    // various named textures to glsl variables and #DEFINEs.\n    this.map = params.map;\n  }\n}\n\nconst vertexShader = glsl`\nattribute float size;\nuniform float sizeGlobal;\n\nvoid main() {\n    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n    gl_PointSize = size * sizeGlobal * -projectionMatrix[1].y;\n    gl_Position = projectionMatrix * mvPosition;\n}\n`;\n\nconst fragmentShader = glsl`\nuniform vec3 color;\nuniform sampler2D texture;\nuniform float opacity;\n\n#ifdef USE_MAP\n  uniform mat3 uvTransform;\n  uniform sampler2D map;\n#endif\n\nvoid main() {\n    gl_FragColor = vec4( color, opacity );\n\n    #ifdef USE_MAP\n        vec4 mapTexel = texture2D( map, gl_PointCoord );\n        gl_FragColor *= mapTexelToLinear( mapTexel );\n    #endif\n}\n`;\n","import Ticker from \"global/ticker\";\nimport { Color, Scene, Vector2 } from \"three\";\nimport lazy from \"../../../common/lazy\";\nimport { map } from \"../../../math\";\nimport { Mito } from \"../index\";\nimport { Inventory } from \"../inventory\";\nimport { textureFromSpritesheet } from \"../spritesheet\";\nimport { Renderer } from \"./Renderer\";\nimport { ResourcePoints } from \"./resourcePoints\";\n\n// we represent Resources as dots of certain colors.\nexport class InventoryRenderer extends Renderer<Inventory> {\n  static WaterParticles = lazy(\n    () =>\n      new ResourcePoints(\n        {\n          color: new Color(\"rgb(9, 12, 255)\"),\n          size: 45,\n          opacity: 0.75,\n        }\n        // new PointsMaterial({\n        //     // map: textureFromSpritesheet(0, 1),\n        //     transparent: true,\n        //     opacity: 0.75,\n        //     // color: new Color(\"rgb(12, 41, 255)\"),\n        //     // color: new Color(\"rgb(29, 42, 255)\"),\n        //     color: new Color(\"rgb(9, 12, 255)\"),\n        //     size: .12,\n        //     side: DoubleSide,\n        // })\n      )\n  );\n\n  static SugarParticles = lazy(\n    () =>\n      new ResourcePoints(\n        {\n          color: new Color(\"yellow\"),\n          size: 85,\n          opacity: 0.9,\n          map: textureFromSpritesheet(42, 12, \"transparent\"),\n        }\n        // new PointsMaterial({\n        //     map: textureFromSpritesheet(42, 12, \"transparent\"),\n        //     transparent: true,\n        //     opacity: 0.9,\n        //     color: \"yellow\",\n        //     size: .12,\n        //     side: DoubleSide,\n        // })\n      )\n  );\n\n  static startFrame() {\n    InventoryRenderer.WaterParticles().startFrame();\n    InventoryRenderer.SugarParticles().startFrame();\n  }\n\n  static endFrame() {\n    InventoryRenderer.WaterParticles().endFrame();\n    InventoryRenderer.SugarParticles().endFrame();\n  }\n  // static geometry = new PlaneBufferGeometry(1, 1);\n  // static waterMaterial = new MeshBasicMaterial({\n  //     // map: textureFromSpritesheet(0, 1),\n  //     transparent: true,\n  //     opacity: 0.75,\n  //     // color: new Color(\"rgb(12, 41, 255)\"),\n  //     // color: new Color(\"rgb(29, 42, 255)\"),\n  //     color: new Color(\"rgb(9, 12, 255)\"),\n  //     side: DoubleSide,\n  // });\n  // static sugarMaterial = lazy(() => new MeshBasicMaterial({\n  //     map: textureFromSpritesheet(42, 12, \"transparent\"),\n  //     transparent: true,\n  //     opacity: 0.9,\n  //     color: \"yellow\",\n  //     // color: new Color(\"yellow\"),\n  //     side: DoubleSide,\n  // }));\n  public animationOffset = 0;\n  // public object = new Object3D();\n  public waters: Vector2[] = [];\n  public sugars: Vector2[] = [];\n  constructor(target: Inventory, scene: Scene, mito: Mito) {\n    super(target, scene, mito);\n    target.on(\"get\", this.handleGetResources);\n    target.on(\"give\", this.handleGiveResources);\n    // this.object.name = \"InventoryRenderer Object\";\n    // this.object.position.z = 1;\n    // this.object.updateMatrix();\n    // this.object.matrixAutoUpdate = false;\n    for (let i = 0; i < this.target.water; i++) {\n      this.waters.push(newParticle());\n    }\n    for (let i = 0; i < this.target.sugar; i++) {\n      this.sugars.push(newParticle());\n    }\n  }\n  private handleGetResources = (giver: Inventory) => {\n    let wantedMeshes = Math.ceil(this.target.water);\n    while (this.waters.length < wantedMeshes) {\n      const v = giver.carrier.pos.clone().sub(this.target.carrier.pos);\n      v.x += (Math.random() - 0.5) * 0.1;\n      v.y += (Math.random() - 0.5) * 0.1;\n      this.waters.push(v);\n    }\n\n    wantedMeshes = Math.ceil(this.target.sugar);\n    while (this.sugars.length < wantedMeshes) {\n      const v = giver.carrier.pos.clone().sub(this.target.carrier.pos);\n      v.x += (Math.random() - 0.5) * 0.1;\n      v.y += (Math.random() - 0.5) * 0.1;\n      this.sugars.push(v);\n    }\n  };\n\n  private handleGiveResources = () => {\n    let wantedMeshes = Math.ceil(this.target.water);\n    if (this.waters.length > wantedMeshes) {\n      this.waters.splice(wantedMeshes, this.waters.length - wantedMeshes);\n    }\n\n    wantedMeshes = Math.ceil(this.target.sugar);\n    if (this.sugars.length > wantedMeshes) {\n      this.sugars.splice(wantedMeshes, this.sugars.length - wantedMeshes);\n    }\n  };\n\n  private updateNumParticles(resources: number) {\n    // while (resourceArray.length < wantedMeshes) {\n    //     this.newParticle(resourceArray);\n    // }\n    // if (resourceArray.length > wantedMeshes) {\n    //     resourceArray.splice(wantedMeshes, resourceArray.length - wantedMeshes);\n    // }\n  }\n\n  private commitParticles(particles: ResourcePoints, resource: number, resourceArray: Vector2[]) {\n    if (resourceArray.length > 0) {\n      for (let i = 0; i < resourceArray.length - 1; i++) {\n        const p = resourceArray[i];\n        particles.commit(p.x + this.target.carrier.pos.x, p.y + this.target.carrier.pos.y, 10, 1);\n        resource -= 1;\n      }\n      const p = resourceArray[resourceArray.length - 1];\n      const fract = resource;\n      particles.commit(\n        p.x + this.target.carrier.pos.x,\n        p.y + this.target.carrier.pos.y,\n        10,\n        map(Math.sqrt(fract), 0, 1, 0.2, 1)\n      );\n    }\n  }\n\n  private simulateResourcePositions() {\n    const numWaters = this.waters.length;\n    const numResources = numWaters + this.sugars.length;\n    for (let i = 0; i < numResources; i++) {\n      const r = i < numWaters ? this.waters[i] : this.sugars[i - numWaters];\n      let vx = 0,\n        vy = 0;\n      const angle = Ticker.now / 3000 + this.animationOffset;\n      vx += Math.cos(angle) * 0.02;\n      const goTowardsCenterStrength = 0.1 + r.length() * 0.1;\n      vx += -r.x * goTowardsCenterStrength;\n      vy += -r.y * goTowardsCenterStrength;\n      const player = this.mito.world.player;\n      if (player.pos.equals(this.target.carrier.pos)) {\n        const playerX = player.posFloat.x - player.pos.x;\n        const playerY = player.posFloat.y - player.pos.y;\n        const offsetX = r.x - playerX;\n        const offsetY = r.y - playerY;\n        const mag2 = offsetX * offsetX + offsetY * offsetY;\n        const avoidPlayerStrength = Math.max(Math.min(map(mag2, 0, 1, 3, -5), 3), 0);\n        const accelerationX = offsetX * avoidPlayerStrength * 0.2;\n        const accelerationY = offsetY * avoidPlayerStrength * 0.2;\n        vx += accelerationX;\n        vy += accelerationY;\n      }\n      for (let j = 0; j < numResources; j++) {\n        const l = j < numWaters ? this.waters[j] : this.sugars[j - numWaters];\n        if (r === l) {\n          break;\n        }\n        const dx = r.x - l.x;\n        const dy = r.y - l.y;\n        const lengthSq = dx * dx + dy * dy;\n        if (lengthSq > 0) {\n          const strength = 0.003 / lengthSq;\n          vx += dx * strength;\n          vy += dy * strength;\n        }\n      }\n      r.x += vx;\n      r.y += vy;\n    }\n  }\n\n  update() {\n    this.updateNumParticles(this.target.water);\n    this.updateNumParticles(this.target.sugar);\n    this.simulateResourcePositions();\n    this.commitParticles(InventoryRenderer.WaterParticles(), this.target.water, this.waters);\n    this.commitParticles(InventoryRenderer.SugarParticles(), this.target.sugar, this.sugars);\n  }\n\n  destroy() {\n    // no-op\n    this.target.off(\"get\", this.handleGetResources);\n    this.target.off(\"give\", this.handleGiveResources);\n  }\n}\n\nfunction newParticle() {\n  return new Vector2((Math.random() - 0.5) * 0.01, (Math.random() - 0.5) * 0.01);\n}\n","import Ticker from \"global/ticker\";\nimport { Color, DoubleSide, Mesh, MeshBasicMaterial, PlaneBufferGeometry, Scene } from \"three\";\nimport { lerp2 } from \"../../../math\";\nimport { Player } from \"../game\";\nimport { Mito } from \"../index\";\nimport { textureFromSpritesheet } from \"../spritesheet\";\nimport { Renderer } from \"./Renderer\";\n\nexport class PlayerRenderer extends Renderer<Player> {\n  public mesh: Mesh;\n  constructor(target: Player, scene: Scene, mito: Mito) {\n    super(target, scene, mito);\n    this.mesh = new Mesh(\n      new PlaneBufferGeometry(0.75, 0.75),\n      // new THREE.CircleBufferGeometry(0.5, 20),\n      new MeshBasicMaterial({\n        transparent: true,\n        depthWrite: false,\n        depthTest: false,\n        map: textureFromSpritesheet(29, 12, \"transparent\"),\n        color: new Color(\"white\"),\n        side: DoubleSide,\n      })\n    );\n    lerp2(this.mesh.position, this.target.pos, 1);\n    this.mesh.position.z = 2;\n    this.scene.add(this.mesh);\n  }\n  update() {\n    const pos = this.target.droopPosFloat().clone();\n    pos.x += Math.cos(Ticker.now / 1000) * 0.04;\n    pos.y += Math.sin(Ticker.now / 400) * 0.08;\n    lerp2(this.mesh.position, pos, 0.5);\n    this.mesh.position.z = 2;\n    // for (const [key, keyMesh] of MOVEMENT_KEY_MESHES) {\n    //   const action = MOVEMENT_KEYS[key];\n    //   const x = this.target.pos.x + action.dir.x;\n    //   const y = this.target.pos.y + action.dir.y;\n    //   if (this.target.isBuildCandidate(this.mito.world.tileAt(x, y)) && this.mito.uiState.type === \"main\") {\n    //     this.scene.add(keyMesh);\n    //     keyMesh.position.x = x;\n    //     keyMesh.position.y = y;\n    //     keyMesh.position.z = 2;\n    //   } else {\n    //     this.scene.remove(keyMesh);\n    //   }\n    // }\n  }\n  destroy() {\n    this.scene.remove(this.mesh);\n  }\n}\n","export function mirrored(f: (t: number) => number) {\n  // https://bl.ocks.org/mbostock/3145795\n  return (t: number) => (t < 0.5 ? f(2 * t) : f(2 - 2 * t));\n}\n\nexport function reversed(f: (t: number) => number) {\n  return (t: number) => f(1 - t);\n}\n","import { lerp, map } from \"math\";\nimport { Color, DoubleSide, Mesh, MeshBasicMaterial, PlaneBufferGeometry, Scene } from \"three\";\nimport Mito from \"..\";\nimport { Cell, CellEffect, FreezeEffect } from \"../game/tile\";\nimport { textureFromSpritesheet } from \"../spritesheet\";\nimport { Renderer } from \"./Renderer\";\n\nexport class CellEffectsRenderer extends Renderer<Cell> {\n  private renderers: Renderer<CellEffect>[] = [];\n\n  update() {\n    // account for if target has more effects\n    let index;\n    for (index = 0; index < this.target.effects.length; index++) {\n      const effect = this.target.effects[index];\n      const renderer = this.renderers[index];\n      if (renderer == null) {\n        this.renderers[index] = createEffectRenderer(effect, this.scene, this.mito);\n      } else if (effect !== renderer.target) {\n        // delete and add new renderer\n        renderer.destroy();\n        this.renderers[index] = createEffectRenderer(effect, this.scene, this.mito);\n      }\n    }\n    // delete extraneous effects\n    for (; index < this.renderers.length; index++) {\n      const renderer = this.renderers[index];\n      renderer.destroy();\n    }\n\n    for (const r of this.renderers) {\n      r.update();\n    }\n  }\n\n  destroy() {\n    for (const r of this.renderers) {\n      r.destroy();\n    }\n  }\n}\n\nfunction createEffectRenderer<T extends CellEffect>(effect: T, scene: Scene, mito: Mito): Renderer<CellEffect> {\n  if (effect instanceof FreezeEffect) {\n    return new FreezeEffectRenderer(effect, scene, mito);\n  } else {\n    throw new Error(\"effect renderer not defined for\" + effect);\n  }\n}\n\nconst COLD_BLUE = new Color(\"#1E90FF\").lerp(new Color(0), 0.5);\n\nclass FreezeEffectRenderer extends Renderer<FreezeEffect> {\n  static newMesh = (() => {\n    const g = new PlaneBufferGeometry(0.75, 0.75);\n    const material = new MeshBasicMaterial({\n      map: textureFromSpritesheet(Math.floor(23 / 16), Math.floor(22 / 16)),\n      side: DoubleSide,\n      color: COLD_BLUE,\n      transparent: true,\n      opacity: 0.5,\n    });\n    const mesh = new Mesh(g, material);\n    return () => mesh.clone();\n  })();\n\n  private mesh: Mesh;\n  constructor(target: FreezeEffect, scene: Scene, mito: Mito) {\n    super(target, scene, mito);\n    this.mesh = FreezeEffectRenderer.newMesh();\n    scene.add(this.mesh);\n    this.mesh.scale.set(0.01, 0.01, 1);\n  }\n\n  update() {\n    const percentFrozen = this.target.percentFrozen;\n    const s = map(percentFrozen, 0, 1, 0.2, 1);\n    this.mesh.scale.x = lerp(this.mesh.scale.x, s, 0.2);\n    this.mesh.scale.y = lerp(this.mesh.scale.y, s, 0.2);\n    const cell = this.target.cell;\n    const pos = cell.pos;\n    this.mesh.position.set(pos.x, pos.y + cell.droopY, 2);\n  }\n\n  destroy() {\n    this.scene.remove(this.mesh);\n  }\n}\n","import { easeCubic } from \"d3-ease\";\nimport Ticker from \"global/ticker\";\nimport { clamp, lerp, lerp2, map } from \"math\";\nimport { reversed } from \"math/easing\";\nimport React from \"react\";\nimport Mito from \"sketches/mito\";\nimport { blopBuffer, suckWaterBuffer } from \"sketches/mito/audio\";\nimport { Constructor } from \"sketches/mito/constructor\";\nimport { Temperature } from \"sketches/mito/game/temperature\";\nimport {\n  Air,\n  Cell,\n  DeadCell,\n  Fountain,\n  Fruit,\n  GrowingCell,\n  hasEnergy,\n  hasTilePairs,\n  Leaf,\n  Rock,\n  Root,\n  Soil,\n  Tile,\n  Tissue,\n  Transport,\n} from \"sketches/mito/game/tile\";\nimport { hasInventory } from \"sketches/mito/inventory\";\nimport { params } from \"sketches/mito/params\";\nimport { WorldDOMElement } from \"sketches/mito/WorldDOMElement\";\nimport {\n  ArrowHelper,\n  Audio,\n  BufferGeometry,\n  Color,\n  Float32BufferAttribute,\n  Line,\n  LineBasicMaterial,\n  Object3D,\n  Scene,\n  Vector2,\n  Vector3,\n} from \"three\";\nimport { CellEffectsRenderer } from \"../CellEffectsRenderer\";\nimport { InventoryRenderer } from \"../InventoryRenderer\";\nimport { Renderer } from \"../Renderer\";\nimport TileBatcher, { BatchInstance } from \"./tileBatcher\";\n\ntype Animation = (dt: number) => boolean;\n\nclass AnimationController {\n  animation?: Animation;\n  timeStarted?: number;\n\n  set(a: Animation, now: number) {\n    this.animation = a;\n    this.timeStarted = now;\n  }\n\n  update(now: number) {\n    if (this.animation != null && this.timeStarted != null) {\n      const dt = now - this.timeStarted;\n      const ended = this.animation(dt);\n      if (ended) {\n        this.animation = undefined;\n        this.timeStarted = undefined;\n      }\n    }\n  }\n}\n\nexport class InstancedTileRenderer<T extends Tile = Tile> extends Renderer<T> {\n  public static readonly TEMPERATURE_COLORS = {\n    [Temperature.Scorching]: new Color(\"orange\"),\n    [Temperature.Hot]: new Color(\"orange\").lerp(new Color(\"white\"), 0.5),\n    [Temperature.Mild]: new Color(\"white\"),\n    [Temperature.Cold]: new Color(\"lightblue\").lerp(new Color(\"white\"), 0.5),\n    [Temperature.Freezing]: new Color(\"lightblue\"),\n  } as Record<Temperature, Color>;\n\n  private static ONE = new Vector2(1, 1);\n\n  private inventoryRenderer?: InventoryRenderer;\n  private originalColor: Color;\n  private audio?: Audio;\n  private lastAudioValueTracker = 0;\n  private pairsLines = new Object3D();\n  private worldDomElement?: WorldDOMElement;\n  private cellEffectsRenderer?: CellEffectsRenderer;\n  private animation = new AnimationController();\n\n  private scale = new Vector3(1, 1, 1);\n  private color = new Color();\n\n  private instance: BatchInstance;\n\n  get materialInfo() {\n    return getMaterialInfo(this.target);\n  }\n\n  constructor(target: T, scene: Scene, mito: Mito, batchMesh: TileBatcher) {\n    super(target, scene, mito);\n    this.instance = batchMesh.getBatchInstance(target);\n    if (this.target instanceof GrowingCell) {\n      this.scale.set(0.01, 0.01, 1);\n    }\n\n    this.originalColor = this.materialInfo.color.clone();\n    if (hasInventory(this.target)) {\n      this.inventoryRenderer = new InventoryRenderer(this.target.inventory, this.scene, this.mito);\n      this.inventoryRenderer.animationOffset = (this.target.pos.x + this.target.pos.y) / 2;\n    }\n    if (this.target instanceof Cell) {\n      // if it takes no turns to build, start it off small just for show\n      if (!(this.target.constructor as Constructor<Cell>).turnsToBuild) {\n        this.scale.set(0.01, 0.01, 1);\n      }\n    }\n    if (this.target instanceof Leaf || this.target instanceof Root) {\n      this.audio = new Audio(this.mito.audioListener);\n    }\n\n    if (this.target instanceof Fruit) {\n      const fruit = this.target;\n      this.worldDomElement = mito.addWorldDOMElement(\n        () => this.target.pos,\n        () => {\n          return (\n            <div className=\"fruit-indicator\">\n              <div>\n                {fruit.committedResources.water.toFixed(1)}/{fruit.neededResources / 2} water\n              </div>\n              <div>\n                {fruit.committedResources.sugar.toFixed(1)}/{fruit.neededResources / 2} sugar\n              </div>\n            </div>\n          );\n        }\n      );\n    }\n\n    if (this.target instanceof Cell) {\n      this.cellEffectsRenderer = new CellEffectsRenderer(this.target, this.scene, this.mito);\n    }\n\n    // TODO fix this clobbering with GrowingCell\n    this.commit();\n  }\n\n  commit() {\n    if (this.target instanceof Cell) {\n      this.instance.commitCenter(this.target.pos.x, this.target.pos.y + this.target.droopY, 1);\n    } else {\n      this.instance.commitCenter(this.target.pos.x, this.target.pos.y, 0);\n    }\n    this.instance.commitTexturePosition(this.materialInfo.texturePosition);\n    this.instance.commitColor(this.color);\n    this.instance.commitScale(this.scale);\n  }\n\n  update() {\n    const lightAmount = this.target.lightAmount();\n    this.updateVisibility(lightAmount);\n    this.updateSize();\n    this.updateColor(lightAmount);\n\n    this.respondToEvents();\n\n    if (this.cellEffectsRenderer != null) {\n      this.cellEffectsRenderer.update();\n    }\n\n    this.animation.update(Ticker.now / 1000);\n    this.commit();\n  }\n\n  updateVisibility(lightAmount: number) {\n    // TODO handle visibility. Right now it kinda just \"works\" because\n    // we render black, and black is invisible. Instead we should actually\n    // *not* commit() if we don't see it.\n    if (lightAmount > 0) {\n      if (this.inventoryRenderer != null) {\n        // will not render without an update\n        this.inventoryRenderer.update();\n      }\n    }\n  }\n\n  updateSize() {\n    if (this.target instanceof GrowingCell) {\n      const s = 1 - this.target.timeRemaining / this.target.timeToBuild;\n      lerp2(this.scale, { x: s, y: s }, 0.5);\n    } else if (this.target instanceof Fruit) {\n      const scale = map(this.target.getPercentMatured(), 0, 1, 0.2, 1);\n      const targetScale = new Vector2(scale, scale);\n      lerp2(this.scale, targetScale, 0.1);\n    } else {\n      lerp2(this.scale, InstancedTileRenderer.ONE, 0.1);\n    }\n  }\n\n  updateColor(lightAmount: number) {\n    if (this.target instanceof Air) {\n      const colorIndex = Math.max(0, map(this.target.co2(), 1 / 6, 1.001, 0, AIR_COLORSCALE.length - 1));\n      const startColorIndex = Math.floor(colorIndex);\n      const startColor = AIR_COLORSCALE[startColorIndex];\n      this.originalColor = startColor.clone();\n      if (startColorIndex !== AIR_COLORSCALE.length - 1) {\n        const alpha = colorIndex - startColorIndex;\n        const endColorIndex = startColorIndex + 1;\n        const endColor = AIR_COLORSCALE[endColorIndex];\n        this.originalColor.lerp(endColor, alpha);\n      }\n    }\n    this.color.copy(this.originalColor);\n    if (hasEnergy(this.target)) {\n      this.color.lerp(new Color(0), 1 - this.target.energy / params.cellEnergyMax);\n    }\n\n    this.color = this.lerpColorTemperature(this.color);\n    this.color = new Color(0).lerp(this.color, map(lightAmount, 0, 1, 0.2, 1));\n  }\n\n  respondToEvents() {\n    // audio\n    if (this.target instanceof Leaf && this.audio != null) {\n      const newAudioValueTracker = this.target.totalSugarProduced;\n      if (newAudioValueTracker > this.lastAudioValueTracker) {\n        this.audio.setBuffer(blopBuffer);\n        const dist = this.target.pos.distanceToSquared(this.mito.world.player.pos);\n        const volume = Math.min(1, 1 / (1 + dist / 25)) * this.target.sugarConverted * this.target.sugarConverted;\n        this.audio.setVolume(volume);\n        // this.audio.setRefDistance(2);\n        // play blop sound\n        this.audio.play();\n        this.animation.set(this.growPulseAnimation(), Ticker.now / 1000);\n      }\n      this.lastAudioValueTracker = newAudioValueTracker;\n    }\n    if (this.target instanceof Root && this.audio != null) {\n      const newAudioValueTracker = this.target.totalSucked;\n      if (newAudioValueTracker !== this.lastAudioValueTracker) {\n        this.audio.setBuffer(suckWaterBuffer);\n        // const baseVolume = this.target.waterTransferAmount / (2 + this.target.waterTransferAmount);\n        const baseVolume = 1;\n        const dist = this.target.pos.distanceToSquared(this.mito.world.player.pos);\n        const volume = Math.min(1, 1 / (1 + dist / 25)) * baseVolume;\n        this.audio.setVolume(volume);\n        if (this.audio.source != null) {\n          this.audio.stop();\n        }\n        this.audio.play();\n        this.animation.set(this.growPulseAnimation(), Ticker.now / 1000);\n      }\n      this.lastAudioValueTracker = newAudioValueTracker;\n    }\n    this.scene.remove(this.pairsLines);\n  }\n\n  private temperatureColor: Color = InstancedTileRenderer.TEMPERATURE_COLORS[Temperature.Mild];\n  private currentLerp = 0;\n  lerpColorTemperature(color: Color) {\n    const { temperature } = this.target;\n    let tColor = InstancedTileRenderer.TEMPERATURE_COLORS[temperature];\n    if (tColor !== this.temperatureColor) {\n      this.currentLerp = 0;\n    }\n    const targetLerp = temperature === Temperature.Mild ? 0 : 0.5;\n    this.temperatureColor = tColor;\n    this.currentLerp = lerp(this.currentLerp, targetLerp, 0.1);\n    color.lerp(this.temperatureColor, this.currentLerp);\n    return color;\n  }\n\n  updateHover() {\n    this.scene.add(this.pairsLines);\n    this.pairsLines.position.set(this.target.pos.x, this.target.pos.y, 1);\n    if (hasTilePairs(this.target)) {\n      const pairColor = this.target instanceof Leaf ? 0xffc90e : new Color(\"rgb(9, 12, 255)\").getHex();\n      const pairs = this.target.tilePairs;\n      if (pairs.length !== this.pairsLines.children.length) {\n        // redo pairs\n        this.pairsLines.remove(...this.pairsLines.children);\n        pairs.forEach((dir) => {\n          const length = dir.length() * 2 - 0.25;\n          const arrowDir = new Vector3(dir.x, dir.y, 0).normalize();\n          const arrowHelper = this.makeLine(arrowDir, arrowDir.clone().multiplyScalar(-length / 2), length, pairColor);\n          this.pairsLines.add(arrowHelper);\n        });\n      }\n    }\n    if (this.hasActiveNeighbors(this.target)) {\n      const color = this.target instanceof Root ? new Color(\"rgb(9, 12, 255)\").getHex() : 0xffffff;\n      const lines = this.target.activeNeighbors;\n      if (lines.length !== this.pairsLines.children.length) {\n        // redo pairs\n        this.pairsLines.remove(...this.pairsLines.children);\n        lines.forEach((dir) => {\n          const length = dir.length() - 0.25;\n          const arrowDir = new Vector3(dir.x, dir.y, 0).normalize();\n          const arrowHelper =\n            this.target instanceof Root\n              ? this.makeLine(arrowDir, new Vector3(), length, color)\n              : new ArrowHelper(arrowDir, new Vector3(0, 0, 5), length, color);\n          this.pairsLines.add(arrowHelper);\n        });\n      }\n    }\n  }\n\n  growPulseAnimation(): Animation {\n    const duration = 0.5;\n    const ease = reversed(easeCubic);\n    return (dt) => {\n      const t = clamp((dt / duration) * ((this.target as any).tempo || 1), 0, 1);\n      const scale = map(ease(t), 0, 1, 1, 1.3);\n      this.scale.setScalar(scale);\n      return t >= 1;\n    };\n  }\n\n  hasActiveNeighbors(\n    t: any\n  ): t is {\n    activeNeighbors: Vector2[];\n  } {\n    return Array.isArray(t.activeNeighbors);\n  }\n\n  static lineGeometry = (() => {\n    const g = new BufferGeometry();\n    g.addAttribute(\"position\", new Float32BufferAttribute([0, 0, 0, 0, 1, 0], 3));\n    return g;\n  })();\n  private makeLine(dir: Vector3, origin: Vector3, length: number, color: number) {\n    // copied from https://github.com/mrdoob/js/blob/master/src/helpers/ArrowHelper.js\n    const line = new Line(InstancedTileRenderer.lineGeometry, new LineBasicMaterial({ color: color }));\n    line.position.copy(origin);\n    // dir is assumed to be normalized\n    if (dir.y > 0.99999) {\n      line.quaternion.set(0, 0, 0, 1);\n    } else if (dir.y < -0.99999) {\n      line.quaternion.set(1, 0, 0, 0);\n    } else {\n      const axis = new Vector3(dir.z, 0, -dir.x).normalize();\n      const radians = Math.acos(dir.y);\n      line.quaternion.setFromAxisAngle(axis, radians);\n    }\n    line.scale.set(1, Math.max(0, length), 1);\n    line.position.z = 0.1;\n    line.updateMatrix();\n    line.matrixAutoUpdate = false;\n    return line;\n  }\n  destroy() {\n    this.instance.destroy();\n    // this.scene.remove(this.mesh);\n    if (this.worldDomElement != null) {\n      this.mito.removeWorldDOMElement(this.worldDomElement);\n    }\n    if (this.inventoryRenderer != null) {\n      this.inventoryRenderer.destroy();\n    }\n    if (this.cellEffectsRenderer != null) {\n      this.cellEffectsRenderer.destroy();\n    }\n  }\n}\n\ninterface MaterialInfo {\n  color: Color;\n  // TODO implement texturePosition\n  texturePosition: Vector2;\n}\n\nexport const materialInfoMapping = (() => {\n  const materials = new Map<Constructor<Tile>, MaterialInfo>();\n  materials.set(Air, {\n    texturePosition: new Vector2(0, 0),\n    color: new Color(\"white\"),\n  });\n  materials.set(Soil, {\n    texturePosition: new Vector2(8, 11),\n    color: new Color(\"rgb(112, 89, 44)\"),\n  });\n  materials.set(Fountain, {\n    color: new Color(\"white\"),\n    texturePosition: new Vector2(56 / 16, 38 / 16).floor(),\n  });\n  materials.set(Rock, {\n    texturePosition: new Vector2(26, 20),\n    color: new Color(\"rgb(63, 77, 84)\"),\n  });\n  materials.set(DeadCell, {\n    texturePosition: new Vector2(137 / 16, 374 / 16).floor(),\n    color: new Color(\"rgb(128, 128, 128)\"),\n  });\n  materials.set(Tissue, {\n    texturePosition: new Vector2(6, 31),\n    color: new Color(0x30ae25),\n  });\n  materials.set(Transport, materials.get(Tissue)!);\n  materials.set(Leaf, {\n    color: new Color(\"white\"),\n    texturePosition: new Vector2(55 / 16, 280 / 16).floor(),\n  });\n  materials.set(Root, {\n    color: new Color(\"white\"),\n    texturePosition: new Vector2(59 / 16, 327 / 16).floor(),\n  });\n  materials.set(Fruit, {\n    texturePosition: new Vector2(0, 0),\n    color: new Color(\"white\"),\n  });\n  return materials;\n})();\n\nfunction getMaterialInfo(tile: Tile): MaterialInfo {\n  if (tile instanceof GrowingCell) {\n    return getMaterialInfo(tile.completedCell);\n  } else {\n    return materialInfoMapping.get(tile.constructor as Constructor<Tile>)!;\n  }\n}\n\nconst AIR_COLORSCALE = [\n  new Color(\"hsl(67, 31%, 25%)\"),\n  new Color(\"hsl(180, 31%, 76%)\"),\n  new Color(\"hsl(213, 63%, 58%)\"),\n];\n","import { World } from \"sketches/mito/game\";\nimport { Cell, Tile } from \"sketches/mito/game/tile\";\nimport { fruitTexture, SPRITESHEET } from \"sketches/mito/spritesheet\";\nimport {\n  Color,\n  DoubleSide,\n  InstancedBufferAttribute,\n  InstancedBufferGeometry,\n  Mesh,\n  PlaneBufferGeometry,\n  RawShaderMaterial,\n  Vector2,\n  Vector3,\n} from \"three\";\nimport glsl from \"../glsl\";\n\nconst vertexShader = glsl`\n// the vertex shader's main goals are:\n// 1. set gl_Position to a clip-coordinate\n// 2. pass varyings along to fragment shader.\n// you can accept two types of inputs:\n//   'attribute' variables, which change per vertex\n//   'uniform' variables, which are constant for a given draw context.\n// WebGL thankfully hooks up a bunch of attributes and uniforms, see https://threejs.org/docs/index.html#api/en/renderers/webgl/WebGLProgram\n// see also my explorations: https://codesandbox.io/s/reactthreejstemplate-lwvhu\n\n\n// Comes from WebGLProgram\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\n\n// Comes from threejs Geometry\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\n\n// attributes we provide\n// these are constant per instance\nattribute vec3 instancedTileCenter;\nattribute vec3 instancedTileScale;\nattribute vec3 instancedTileColor;\nattribute vec2 instancedTexturePosition;\n\n// things we pass onto fragment\nvarying vec3 vColor;\nvarying vec2 vUv;\nvarying vec2 vTexturePosition;\n\n// based on https://github.com/mrdoob/three.js/blob/master/examples/webgl_buffergeometry_instancing_billboards.html\nvoid main() {\n  vColor = instancedTileColor;\n  vUv = uv;\n  vTexturePosition = instancedTexturePosition;\n\n  vec4 mvPosition = modelViewMatrix * vec4(instancedTileCenter, 1.);\n  mvPosition.xyz += position * instancedTileScale;\n  // mvPosition.xyz += position;\n  gl_Position = projectionMatrix * mvPosition;\n}\n`;\n\nconst fragmentShader = glsl`\n// for the fragment shader, the main goal is to set gl_FragColor. Its inputs are\n//   'varying' variables from the vertex shader, interpolated along the triangle\n//   'uniform' variables\nprecision mediump float;\n\n// these should match the corresponding section in the vertexShader exactly\nvarying vec3 vColor;\nvarying vec2 vUv;\nvarying vec2 vTexturePosition;\n\nconst vec2 roguelikeSheetSize = vec2(1024., 512.);\nuniform sampler2D roguelikeSheet;\nuniform sampler2D fruit;\n\n// uv - [0,1]x[0,1] - our local sprite (16x16) UV coords\n// texturePosition - the grid x/y where our sprite lives in our texture. NOTE:\n// for texturePosition, top-left is 0, 0 (Y is image coordinates)\n// textureSize - the pixel width/height of the full spritesheet\n// returns: a UV coordinate for this sprite, relative to the full spritesheet\nvec2 getCorrectUv(vec2 uv, vec2 texturePosition, vec2 textureSize) {\n  vec2 spriteSheetPxStart = texturePosition * vec2(16.);\n  spriteSheetPxStart.y = textureSize.y - spriteSheetPxStart.y - 16.;\n  vec2 spriteSheetUv = spriteSheetPxStart + uv * vec2(16.);\n  return spriteSheetUv / textureSize;\n}\n\nvoid main() {\n  vec2 correctUv = getCorrectUv(vUv, vTexturePosition, roguelikeSheetSize);\n  vec4 textureColor = texture2D(roguelikeSheet, correctUv);\n  if (textureColor.a < 0.5) {\n    gl_FragColor = vec4(vColor, 1.);\n  } else {\n    gl_FragColor = vec4(textureColor.rgb * vColor, textureColor.a);\n  }\n  // gl_FragColor = vec4(vColor, 1.);\n  // gl_FragColor = vec4(0.5, 0.5, 0.2, 1.);\n}\n`;\n\nconst TileShaderMaterial = new RawShaderMaterial({\n  uniforms: {\n    roguelikeSheet: { value: SPRITESHEET() },\n    fruit: { value: fruitTexture },\n  },\n  vertexShader,\n  fragmentShader,\n  side: DoubleSide,\n  depthTest: false,\n  depthWrite: false,\n});\n\nclass TileBatcher {\n  private static newGeometry() {\n    const referenceGeometry = new PlaneBufferGeometry(1, 1);\n    const geometry = new InstancedBufferGeometry();\n    // this copies:\n    // [0, 2, 1, 2, 3, 1]\n    // index has a specific and somewhat cryptic data storage format\n    // it's a flattened array of size three elements\n    // each three adjacent numbers gets interpreted as one triangle\n    // each individual number's value is an *index* into a \"virtual\n    // vertex array\" that's defined the attributes array.\n    geometry.index = referenceGeometry.index;\n    // this copies:\n    // position: BufferAttribute, 4 items, size 3\n    // normal: BufferAttribute, 4 items, size 3\n    // uv: BufferAttribute, 4 items, size 2\n    geometry.attributes = referenceGeometry.attributes;\n    return geometry;\n  }\n\n  geometry!: InstancedBufferGeometry;\n\n  public maxTiles = this.world.height * this.world.width * 2;\n  centers = new InstancedBufferAttribute(new Float32Array(3 * this.maxTiles), 3, false, 1);\n  colors = new InstancedBufferAttribute(new Float32Array(3 * this.maxTiles), 3, false, 1);\n  scales = new InstancedBufferAttribute(new Float32Array(3 * this.maxTiles), 3, false, 1);\n  texturePositions = new InstancedBufferAttribute(new Float32Array(2 * this.maxTiles), 2, false, 1);\n\n  public readonly mesh: Mesh;\n\n  constructor(public world: World) {\n    this.geometry = TileBatcher.newGeometry();\n    this.mesh = new Mesh(this.geometry, TileShaderMaterial);\n    this.mesh.frustumCulled = false;\n    this.mesh.matrixAutoUpdate = false;\n    this.mesh.updateMatrixWorld();\n    this.centers.setDynamic(true);\n    this.colors.setDynamic(true);\n    this.scales.setDynamic(true);\n    this.texturePositions.setDynamic(true);\n    this.geometry.addAttribute(\"instancedTileCenter\", this.centers);\n    this.geometry.addAttribute(\"instancedTileColor\", this.colors);\n    this.geometry.addAttribute(\"instancedTileScale\", this.scales);\n    this.geometry.addAttribute(\"instancedTexturePosition\", this.texturePositions);\n  }\n\n  private instances = new Map<string, BatchInstance>();\n\n  // getInstance(layer: number, pos: Vector2) {\n  getBatchInstance(tile: Tile) {\n    const pos = tile.pos;\n    const layer = tile instanceof Cell ? 1 : 0;\n    const layerOffset = (layer * this.maxTiles) / 2;\n    const positionOffset = pos.y * this.world.width + pos.x;\n    const index = layerOffset + positionOffset;\n    if (!Number.isInteger(index)) {\n      throw new Error(\"index \" + index + \" is not integer!\");\n    }\n    const key = String(index);\n    if (!this.instances.has(key)) {\n      this.instances.set(key, new BatchInstance(this, index));\n    }\n    const instance = this.instances.get(key)!;\n    instance.checkout();\n    return instance;\n  }\n\n  endFrame() {\n    this.centers.needsUpdate = true;\n    this.colors.needsUpdate = true;\n    this.scales.needsUpdate = true;\n    this.texturePositions.needsUpdate = true;\n  }\n}\n\nconst BLACK = new Color(0, 0, 0);\nconst ZERO = new Vector3(0, 0, 0);\nexport class BatchInstance {\n  public readonly batcher: TileBatcher;\n  public readonly index: number;\n  private static numInUse = 0;\n  private inUse = false;\n  constructor(batcher: TileBatcher, index: number) {\n    this.batcher = batcher;\n    this.index = index;\n  }\n\n  checkout() {\n    if (this.inUse) {\n      throw new Error(\"Checking out instance that's already in use!\" + this.index);\n    }\n    this.inUse = true;\n    BatchInstance.numInUse++;\n  }\n\n  commitColor(color: Color) {\n    if (!this.inUse) {\n      throw new Error(\"freed tileBatcher still in use!\");\n    }\n    this.batcher.colors.setXYZ(this.index, color.r, color.g, color.b);\n  }\n\n  commitCenter(x: number, y: number, z: number) {\n    if (!this.inUse) {\n      throw new Error(\"freed tileBatcher still in use!\");\n    }\n    this.batcher.centers.setXYZ(this.index, x, y, z);\n  }\n\n  commitScale(scale: Vector3) {\n    if (!this.inUse) {\n      throw new Error(\"freed tileBatcher still in use!\");\n    }\n    this.batcher.scales.setXYZ(this.index, scale.x, scale.y, scale.z);\n  }\n\n  commitTexturePosition(pos: Vector2) {\n    this.batcher.texturePositions.setXY(this.index, pos.x, pos.y);\n  }\n\n  destroy() {\n    console.log(\"freeing instance\", this.index);\n    this.commitColor(BLACK);\n    this.commitScale(ZERO);\n    this.inUse = false;\n    BatchInstance.numInUse--;\n  }\n}\n\nexport default TileBatcher;\n","import Mito from \"sketches/mito\";\nimport { ArrowHelper, Object3D, Scene, Vector3 } from \"three\";\nimport { Transport } from \"../../game/tile\";\nimport { InstancedTileRenderer } from \"./InstancedTileRenderer\";\nimport TileBatcher from \"./tileBatcher\";\n\nexport class TransportRenderer extends InstancedTileRenderer<Transport> {\n  private arrow: Object3D;\n  private origin: Vector3;\n  constructor(target: Transport, scene: Scene, mito: Mito, batchMesh: TileBatcher) {\n    super(target, scene, mito, batchMesh);\n    // const length = target.dir.length() - 0.25;\n    const length = 0.75;\n    const arrowDir = new Vector3(target.dir.x, target.dir.y, 0).normalize();\n    const pos = arrowDir.clone().multiplyScalar(-length / 2);\n    this.origin = new Vector3(pos.x, pos.y, 0);\n    this.arrow = new ArrowHelper(arrowDir, this.origin, length, 0xffffff, 0.1, 0.1);\n    this.scene.add(this.arrow);\n  }\n\n  update() {\n    super.update();\n    this.arrow.position.set(\n      this.target.pos.x + this.origin.x,\n      this.target.pos.y + this.target.droopY + this.origin.y,\n      1\n    );\n  }\n\n  destroy() {\n    this.scene.remove(this.arrow);\n  }\n}\n","import { createSelector } from \"reselect\";\nimport { Scene } from \"three\";\nimport Mito from \"..\";\nimport { Entity, Player, StepStats, World } from \"../game\";\nimport { Tile, Transport } from \"../game/tile\";\nimport { InventoryRenderer } from \"./InventoryRenderer\";\nimport { PlayerRenderer } from \"./PlayerRenderer\";\nimport { Renderer } from \"./Renderer\";\nimport { InstancedTileRenderer } from \"./tile/InstancedTileRenderer\";\nimport TileBatcher from \"./tile/tileBatcher\";\nimport { TransportRenderer } from \"./tile/TransportRenderer\";\n\nexport class WorldRenderer extends Renderer<World> {\n  public renderers = new Map<Entity, Renderer<Entity>>();\n  public readonly tileBatcher: TileBatcher;\n\n  constructor(target: World, scene: Scene, mito: Mito) {\n    super(target, scene, mito);\n    scene.add(InventoryRenderer.WaterParticles());\n    scene.add(InventoryRenderer.SugarParticles());\n    this.tileBatcher = new TileBatcher(this.target);\n    scene.add(this.tileBatcher.mesh);\n  }\n\n  public getOrCreateRenderer(entity: Entity) {\n    const renderer = this.renderers.get(entity);\n    if (renderer == null) {\n      const created = this.createRendererFor(entity);\n      this.renderers.set(entity, created);\n      return created;\n    } else {\n      return renderer;\n    }\n  }\n\n  public createRendererFor<E extends Entity>(object: E): Renderer<Entity> {\n    if (object instanceof Player) {\n      return new PlayerRenderer(object, this.scene, this.mito);\n    } else if (object instanceof Transport) {\n      return new TransportRenderer(object, this.scene, this.mito, this.tileBatcher);\n    } else if (object instanceof Tile) {\n      //  return new TileRenderer(object, this.scene, this.mito);\n      return new InstancedTileRenderer(object, this.scene, this.mito, this.tileBatcher);\n    } else {\n      throw new Error(`Couldn't find renderer for ${object}`);\n    }\n  }\n\n  private deleteDeadEntityRenderers = createSelector(\n    (stats: StepStats) => stats,\n    (stats) => {\n      const deletedEntities = stats.deleted;\n\n      for (const e of deletedEntities) {\n        const renderer = this.renderers.get(e);\n        if (renderer == null) {\n          throw new Error(`Couldn't find renderer for ${e}!`);\n        }\n        renderer.destroy();\n        this.renderers.delete(e);\n      }\n    }\n  );\n\n  update(): void {\n    this.deleteDeadEntityRenderers(this.target.getLastStepStats());\n\n    InventoryRenderer.startFrame();\n    this.target.entities().forEach((entity) => {\n      const renderer = this.getOrCreateRenderer(entity);\n      renderer.update();\n    });\n    InventoryRenderer.endFrame();\n    this.tileBatcher.endFrame();\n  }\n  destroy(): void {\n    throw new Error(\"Method not implemented.\");\n  }\n}\n","import * as React from \"react\";\n\nimport { params } from \"../params\";\n\ninterface InstructionsProps {\n  play: () => void;\n}\nexport class Instructions extends React.PureComponent<InstructionsProps, {}> {\n  render() {\n    return (\n      <div className=\"mito-instructions\">\n        <div className=\"mito-instructions-container\">\n          <div className=\"esc\" onClick={() => this.props.play()}>\n            Back (Esc)\n          </div>\n          <h1>Mito</h1>\n          <div className=\"play-button\" onClick={() => this.props.play()}>\n            Play\n          </div>\n          <p>\n            <ol>\n              <li>Build Tissue to expand your reach (press t and walk into empty space).</li>\n              <li>Build Roots (press r) underground to suck up adjacent water.</li>\n              <li>Build Leaves (press l) above ground and drop water (press 1) to convert water into sugar.</li>\n              <li>\n                <b>Win the game by building and loading the Fruit with 1000 sugar.</b>\n              </li>\n              <li>Click around to see the different properties of each tile.</li>\n              <li>Build leaves early.</li>\n              <li>Leaves higher up have better water/sugar ratios, determined by the co2 percentage in the air.</li>\n              <li>Explore underground for water reservoires and Fountains.</li>\n              <li>Build transports (capital T) to carry water back up the plant.</li>\n              <li>You can scroll out infinitely far.</li>\n            </ol>\n          </p>\n          <h3>You</h3>\n          <p>\n            You can carry max {params.maxResources} resources, and you automatically suck in any resources you're\n            standing over. You can only walk on Tissue (and Transport). You start at the center of the map, with soil\n            below and air above.\n          </p>\n          <h3>Soil and Underground</h3>\n          <p>\n            Underground, Soil holds water, rocks block your way, and occasionally Fountains (at the very bottom) are a\n            permanent source of water. Soil holds up to {params.soilMaxWater} water at a time. Fountains emit one water\n            per {params.fountainTurnsPerWater} turns.\n          </p>\n          <h3>Air and Aboveground</h3>\n          <p>\n            Aboveground, Air provides both sunlight and co2. Sunlight determines the ratio of waters-per-sugar at which\n            reactions happen and are affected by shadows. Co2 determines the speed of reaction and gets better as you\n            build higher up. Orange is low co2, blue is high co2. Gravity will pull down on your structures, so make\n            sure they're structurally sound. Your structures cast shadows on the leaves below in relation to the sun,\n            which gently sways left to right.\n          </p>\n          <h3>Water</h3>\n          <p>\n            Water is one of the main two resources. Water slowly diffuses from high to low densities (difference 2\n            required) at about 1 unit per {(1 / params.soilDiffusionWater).toFixed(0)} turns. Obtain water in the ground\n            through Roots. Leaves require water to photosynthesize. You require water to build.\n          </p>\n          <h3>Sugar</h3>\n          <p>\n            Sugar is the other main resource. Sugar does not diffuse. Leaves convert water into sugar. Obtain sugar by\n            putting water next to leaves. Cells require sugar to survive. You require sugar to build.\n          </p>\n          <h3>Building</h3>\n          <p>\n            Build Tissue, Leaves, Roots, and The Fruit by toggling \"build mode\" on and walking into Air or Soil. Build\n            Transport over existing tissue by walking around. Building costs 1 sugar and 1 water. You can build Tissue\n            over Leaves and Roots - be careful! When you build above ground, Cells will Droop if they're not properly\n            supported underneath them.\n          </p>\n          <h3>Cells</h3>\n          <p>\n            All cells require energy upkeep and will automatically eat sugar on their tile, or get energy from their\n            neighbors. Each cell consumes 1 sugar every {params.cellEnergyMax} turns.\n          </p>\n          <h3>Tissue</h3>\n          <p>\n            Tissue connects your plant together, you may only walk on Tissue. Each Tissue carries up to{\" \"}\n            {params.tissueInventoryCapacity} resources.\n          </p>\n          <h3>Roots</h3>\n          <p>\n            Roots are the only way to get water. Each turn Roots transport one water per neighboring soil into the\n            Tissue in the opposite direction (so the Tissue North of the root get water in the South tile). This is\n            called a Pairing.\n          </p>\n          <h3>Leaves</h3>\n          <p>\n            When exposed to Air, Leaves convert water to sugar. Leaves also use Pairings between opposite direction\n            Air/Tissue with water. In perfect co2, leave produce on average 1 sugar per{\" \"}\n            {(1 / params.leafReactionRate).toFixed(0)} turns per pair. Leaf efficiency is heavily influenced by co2 and\n            sunlight of its neighboring Air. If your leaf is in too much shadow, it will not be able to photosynthesize.\n            Leaves higher up produce sugar faster.\n          </p>\n          <h3>Transport</h3>\n          <p>\n            Transports move 1 water from its own Tile in the direction it was laid per turn, as well as moving you.\n            Transport hungers at double speed.\n          </p>\n          <h3>The Fruit</h3>\n          <p>\n            You can only build one Fruit, and it is the goal of the game to fill it up with resources. Fruit has up to\n            1000 sugar storage and aggressively pulls in every available sugar in its surrounding vicinity.\n          </p>\n          {this.renderCredit()}\n        </div>\n      </div>\n    );\n  }\n  renderCredit() {\n    return (\n      <>\n        <h2>Attribution</h2>\n        <p>\n          Tiles:{\" \"}\n          <a href=\"http://kenney.nl/assets?s=roguelike\" target=\"_blank\" rel=\"noopener noreferrer\">\n            Kenney.nl Roguelike Assets\n          </a>\n        </p>\n        <p>\n          Pop sound when leaves convert:{\" \"}\n          <a href=\"http://soundbible.com/2067-Blop.html\" target=\"_blank\" rel=\"noopener noreferrer\">\n            Blop by Mark DiAngelo\n          </a>{\" \"}\n          (<a href=\"https://creativecommons.org/licenses/by/3.0/us/\">CC BY 3.0 US</a>)\n        </p>\n        <p>\n          Perlin noise:{\" \"}\n          <a href=\"https://github.com/josephg/noisejs\" target=\"_blank\" rel=\"noopener noreferrer\">\n            josephg/noisejs\n          </a>\n        </p>\n        <p>\n          Part of 7drl 2018:{\" \"}\n          <a href=\"http://7drl.org/\" target=\"_blank\" rel=\"noopener noreferrer\">\n            http://7drl.org/\n          </a>\n        </p>\n        <p>\n          Fruit icon:{\" \"}\n          <a href=\"https://www.freepik.com/free-vector/fruits-set-pixel-icons_1001072.htm\">Designed by Freepik</a>\n        </p>\n      </>\n    );\n  }\n}\n","import * as React from \"react\";\n\nimport Mito from \"../index\";\nimport { Instructions } from \"./Instructions\";\n\nexport interface GameStackProps {\n  mito: Mito;\n}\nexport class GameStack extends React.PureComponent<GameStackProps> {\n  handlePlay = () => {\n    this.props.mito.instructionsOpen = false;\n  };\n  public render() {\n    if (this.props.mito.instructionsOpen) {\n      return <Instructions play={this.handlePlay} />;\n    } else {\n      return null;\n    }\n  }\n}\n","/* eslint-disable jsx-a11y/accessible-emoji */\nimport * as React from \"react\";\nimport { Constructor } from \"../constructor\";\nimport { Temperature } from \"../game/temperature\";\nimport { Air, Cell, CellEffect, Fountain, FreezeEffect, GrowingCell, hasEnergy, Leaf, Root, Tile } from \"../game/tile\";\nimport { hasInventory } from \"../inventory\";\nimport { params } from \"../params\";\nimport \"./TileDetails.scss\";\n\ninterface TileDetailsProps {\n  tile?: Tile;\n}\n\nexport class TileDetails extends React.Component<TileDetailsProps> {\n  public render() {\n    const { tile } = this.props;\n    if (!tile) {\n      return null;\n    }\n    return (\n      <div className=\"tile-hover\">\n        {this.tileInfo(tile)}\n        {this.inventoryInfo(tile)}\n        {this.cellInfo(tile)}\n        {this.growingCellInfo(tile)}\n        {this.rootInfo(tile)}\n        {this.leafInfo(tile)}\n        {this.airInfo(tile)}\n        {this.fountainInfo(tile)}\n      </div>\n    );\n  }\n  private rootInfo(tile: Tile) {\n    return tile instanceof Root ? (\n      <div className=\"info-root\">\n        <div>{tile.totalSucked} water collected.</div>\n        <div>{tile.cooldown.toFixed(0)} turns until next water suck.</div>\n        {/* <div>{tile.waterTransferAmount.toFixed(0)} water transfer per round.</div> */}\n      </div>\n    ) : null;\n  }\n  private leafInfo(tile: Tile) {\n    return tile instanceof Leaf ? (\n      <div className=\"info-leaf\">\n        <div>{tile.totalSugarProduced} sugar produced.</div>\n        <div>{(1 / (tile.averageSpeed * params.leafReactionRate)).toFixed(0)} turns per reaction.</div>\n        <div>{(1 / tile.averageEfficiency).toFixed(2)} water per sugar.</div>\n      </div>\n    ) : null;\n  }\n  private airInfo(tile: Tile) {\n    if (tile instanceof Air) {\n      return (\n        <div className=\"info-air\">\n          <div> {(tile.sunlight() * 100).toFixed(0)}%</div>\n          <div> {(tile.co2() * 100).toFixed(0)}%</div>\n        </div>\n      );\n    }\n  }\n\n  private fountainInfo(tile: Tile) {\n    if (tile instanceof Fountain) {\n      return (\n        <div className=\"info-fountain\">\n          <div>{tile.turnsPerWater} turns per water</div>\n        </div>\n      );\n    }\n  }\n\n  private tileInfo(tile: Tile) {\n    const energyInfo = hasEnergy(tile) ? (\n      <span className=\"info-energy\">{((tile.energy / params.cellEnergyMax) * 100).toFixed(0)}%</span>\n    ) : null;\n    return (\n      <div className=\"info-tile\">\n        <div className=\"info-tile-name\">{(tile.constructor as Constructor<Tile>).displayName}</div>\n        {this.temperatureInfo(tile)}\n        {energyInfo}\n      </div>\n    );\n  }\n\n  private temperatureInfo(tile: Tile) {\n    function Bar({ color = \"black\", left = 0 as number | string, width = 3 }) {\n      return (\n        <div\n          style={{\n            position: \"absolute\",\n            top: -1,\n            left,\n            width: 1,\n            bottom: 0,\n            borderRight: `${width}px solid ${color}`,\n          }}\n        />\n      );\n    }\n    function Text({\n      children,\n      fontWeight = \"normal\",\n      left,\n    }: {\n      children: React.ReactNode;\n      fontWeight: React.CSSProperties[\"fontWeight\"];\n      left: number | string;\n    }) {\n      return (\n        <div\n          style={{\n            position: \"absolute\",\n            left,\n            width: `${(32 / 100) * 100}%`,\n            textAlign: \"center\",\n            fontSize: 12,\n            fontWeight: fontWeight,\n            fontFamily: \"Arial\",\n          }}\n        >\n          {children}\n        </div>\n      );\n    }\n    return (\n      <div className=\"info-tile-temperature\">\n        {/* {tile.temperature} ({tile.temperatureFloat.toFixed(0)} F) */}\n        <div style={{ width: 200, height: \"1.15em\", border: \"1px solid grey\", position: \"relative\" }}>\n          <Bar left={`${(32 / 100) * 100}%`} color=\"lightblue\" />\n          <Text left={0} fontWeight={tile.temperature === Temperature.Cold ? \"bold\" : \"normal\"}>\n            {Temperature.Cold}\n          </Text>\n          <Bar left={`${(64 / 100) * 100}%`} color=\"orange\" />\n          <Text left={`${(32 / 100) * 100}%`} fontWeight={tile.temperature === Temperature.Mild ? \"bold\" : \"normal\"}>\n            {Temperature.Mild}\n          </Text>\n          <Text left={`${(64 / 100) * 100}%`} fontWeight={tile.temperature === Temperature.Hot ? \"bold\" : \"normal\"}>\n            {Temperature.Hot}\n          </Text>\n          <Bar left={`${(tile.temperatureFloat / 100) * 100}%`} color=\"black\" width={3}></Bar>\n          <div\n            style={{\n              position: \"absolute\",\n              left: `${(tile.temperatureFloat / 100) * 100}%`,\n              transform: \"translateX(-50%)\",\n              top: \"-1.5em\",\n              textAlign: \"center\",\n              fontSize: 12,\n              fontWeight: \"bold\",\n              fontFamily: \"Arial\",\n            }}\n          >\n            {tile.temperatureFloat.toFixed(0)} F\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  private inventoryInfo(tile: Tile) {\n    if (hasInventory(tile)) {\n      const waterInfo =\n        tile.inventory.water > 0 ? (\n          <div className=\"info-inventory-item\"> {tile.inventory.water.toFixed(2)}</div>\n        ) : null;\n      const sugarInfo =\n        tile.inventory.sugar > 0 ? (\n          <div className=\"info-inventory-item\">Sugar {tile.inventory.sugar.toFixed(2)}</div>\n        ) : null;\n      return (\n        <div className=\"info-inventory\">\n          {waterInfo}\n          {sugarInfo}\n        </div>\n      );\n    }\n  }\n  private cellInfo(tile: Tile) {\n    if (tile instanceof Cell) {\n      return (\n        <>\n          {tile.droopY * 200 > 1 ? <div className=\"info-cell\">{(tile.droopY * 200).toFixed(0)}% droop</div> : null}\n          {this.cellEffects(tile)}\n        </>\n      );\n    }\n  }\n\n  private cellEffects(cell: Cell) {\n    const { effects } = cell;\n    if (effects.length > 0) {\n      const descriptors = effects\n        .map((e) => {\n          const name = (e.constructor as Constructor<CellEffect>).displayName;\n          if (e instanceof FreezeEffect) {\n            return `${(e.percentFrozen * 100).toFixed(0)}% ${name}`;\n          } else {\n            return name;\n          }\n        })\n        .join(\", \");\n      return <div className=\"info-cell\">{descriptors}</div>;\n    } else {\n      return null;\n    }\n  }\n\n  private growingCellInfo(tile: Tile) {\n    if (tile instanceof GrowingCell) {\n      return (\n        <div className=\"info-growing-cell\">\n          {(100 - (tile.timeRemaining / tile.timeToBuild) * 100).toFixed(0)}% mature\n        </div>\n      );\n    }\n  }\n}\n","import { easeCubic } from \"d3-ease\";\nimport Ticker from \"global/ticker\";\nimport { reversed } from \"math/easing\";\nimport React from \"react\";\nimport {\n  ArrowHelper,\n  Audio,\n  BufferGeometry,\n  Color,\n  DoubleSide,\n  Float32BufferAttribute,\n  Line,\n  LineBasicMaterial,\n  Mesh,\n  MeshBasicMaterial,\n  Object3D,\n  PlaneBufferGeometry,\n  Scene,\n  Vector2,\n  Vector3,\n} from \"three\";\nimport lazy from \"../../../common/lazy\";\nimport { clamp, lerp, lerp2, map } from \"../../../math/index\";\nimport { blopBuffer, suckWaterBuffer } from \"../audio\";\nimport { Constructor } from \"../constructor\";\nimport { Temperature } from \"../game/temperature\";\nimport {\n  Air,\n  Cell,\n  DeadCell,\n  Fountain,\n  Fruit,\n  GrowingCell,\n  hasEnergy,\n  hasTilePairs,\n  Leaf,\n  Rock,\n  Root,\n  Soil,\n  Tile,\n  Tissue,\n  Transport,\n  Vein,\n} from \"../game/tile\";\nimport { Mito } from \"../index\";\nimport { hasInventory } from \"../inventory\";\nimport { params } from \"../params\";\nimport { fruitTexture, textureFromSpritesheet } from \"../spritesheet\";\nimport { WorldDOMElement } from \"../WorldDOMElement\";\nimport { CellEffectsRenderer } from \"./CellEffectsRenderer\";\nimport { InventoryRenderer } from \"./InventoryRenderer\";\nimport { Renderer } from \"./Renderer\";\n\ntype Animation = (dt: number) => boolean;\n\nclass AnimationController {\n  animation?: Animation;\n  timeStarted?: number;\n\n  set(a: Animation, now: number) {\n    this.animation = a;\n    this.timeStarted = now;\n  }\n\n  update(now: number) {\n    if (this.animation != null && this.timeStarted != null) {\n      const dt = now - this.timeStarted;\n      const ended = this.animation(dt);\n      if (ended) {\n        this.animation = undefined;\n        this.timeStarted = undefined;\n      }\n    }\n  }\n}\n\nexport class TileMesh extends Mesh {\n  static geometry = new PlaneBufferGeometry(1, 1);\n  constructor(public renderer: TileRenderer) {\n    super(TileMesh.geometry, getMaterial(renderer.target) as MeshBasicMaterial);\n  }\n}\n\nexport class TileRenderer<T extends Tile = Tile> extends Renderer<T> {\n  public static readonly TEMPERATURE_COLORS = {\n    [Temperature.Scorching]: new Color(\"orange\"),\n    [Temperature.Hot]: new Color(\"orange\").lerp(new Color(\"white\"), 0.5),\n    [Temperature.Mild]: new Color(\"white\"),\n    [Temperature.Cold]: new Color(\"lightblue\").lerp(new Color(\"white\"), 0.5),\n    [Temperature.Freezing]: new Color(\"lightblue\"),\n  } as Record<Temperature, Color>;\n\n  private static ONE = new Vector2(1, 1);\n\n  // public object = new Object3D();\n  public mesh: TileMesh;\n  private inventoryRenderer?: InventoryRenderer;\n  private originalColor: Color;\n  private audio?: Audio;\n  private lastAudioValueTracker = 0;\n  private pairsLines = new Object3D();\n  private worldDomElement?: WorldDOMElement;\n  private growingRenderer?: TileRenderer;\n  private cellEffectsRenderer?: CellEffectsRenderer;\n  private animation = new AnimationController();\n\n  constructor(target: T, scene: Scene, mito: Mito) {\n    super(target, scene, mito);\n    if (this.target instanceof GrowingCell) {\n      this.growingRenderer = new TileRenderer(this.target.completedCell, this.scene, this.mito);\n      this.mesh = this.growingRenderer.mesh;\n      this.mesh.scale.set(0.01, 0.01, 1);\n    } else {\n      this.mesh = new TileMesh(this);\n    }\n    // this.object.name = \"TileRenderer Object\";\n    this.originalColor = (this.mesh.material as MeshBasicMaterial).color.clone();\n    if (hasInventory(this.target)) {\n      this.inventoryRenderer = new InventoryRenderer(this.target.inventory, this.scene, this.mito);\n      this.inventoryRenderer.animationOffset = (this.target.pos.x + this.target.pos.y) / 2;\n    }\n    this.scene.add(this.mesh);\n    const zIndex = this.target instanceof Cell ? 1 : 0;\n    this.mesh.position.set(this.target.pos.x, this.target.pos.y, zIndex);\n    if (this.target instanceof Cell) {\n      // if it takes no turns to build, start it off small just for show\n      if (!(this.target.constructor as Constructor<Cell>).turnsToBuild) {\n        this.mesh.scale.set(0.01, 0.01, 1);\n      }\n    } else {\n      this.mesh.matrixAutoUpdate = false;\n    }\n    this.mesh.updateMatrix();\n    if (this.target instanceof Leaf || this.target instanceof Root) {\n      this.audio = new Audio(this.mito.audioListener);\n      this.mesh.add(this.audio);\n    }\n\n    if (this.target instanceof Fruit) {\n      const fruit = this.target;\n      this.worldDomElement = mito.addWorldDOMElement(\n        () => this.target.pos,\n        () => {\n          return (\n            <div className=\"fruit-indicator\">\n              <div>\n                {fruit.committedResources.water.toFixed(1)}/{fruit.neededResources / 2} water\n              </div>\n              <div>\n                {fruit.committedResources.sugar.toFixed(1)}/{fruit.neededResources / 2} sugar\n              </div>\n            </div>\n          );\n        }\n      );\n    }\n\n    // if (this.target instanceof Cell) {\n    //   this.cellEffectsRenderer = new CellEffectsRenderer((this as unknown) as TileRenderer<Cell>);\n    // }\n  }\n\n  steps(x: number, size: number) {\n    return Math.floor(x / size) * size;\n  }\n\n  update() {\n    const lightAmount = this.target.lightAmount();\n    this.updateVisibility(lightAmount);\n    this.updateSize();\n    this.updateColor(lightAmount);\n\n    // match position\n    if (this.target instanceof Cell) {\n      this.mesh.position.set(this.target.pos.x, this.target.pos.y + this.target.droopY, 1);\n    }\n\n    this.respondToEvents();\n\n    if (this.cellEffectsRenderer != null) {\n      this.cellEffectsRenderer.update();\n    }\n\n    this.animation.update(Ticker.now / 1000);\n  }\n\n  updateVisibility(lightAmount: number) {\n    // visibility\n    if (lightAmount > 0) {\n      if (this.mesh.parent == null) {\n        this.scene.add(this.mesh);\n      }\n      if (this.inventoryRenderer != null) {\n        // will not render without an update\n        this.inventoryRenderer.update();\n      }\n    } else if (this.mesh.parent != null) {\n      this.scene.remove(this.mesh);\n    }\n  }\n\n  updateSize() {\n    if (this.target instanceof GrowingCell) {\n      // const s = this.steps(1.001 - this.target.timeRemaining / params.cellGestationTurns, 0.05);\n      const s = 1 - this.target.timeRemaining / this.target.timeToBuild;\n      lerp2(this.mesh.scale, { x: s, y: s }, 0.5);\n      // this.mesh.scale.x = s;\n      // this.mesh.scale.y = s;\n    } else if (this.target instanceof Fruit) {\n      const scale = map(this.target.getPercentMatured(), 0, 1, 0.2, 1);\n      const targetScale = new Vector2(scale, scale);\n      lerp2(this.mesh.scale, targetScale, 0.1);\n    } else {\n      lerp2(this.mesh.scale, TileRenderer.ONE, 0.1);\n    }\n  }\n\n  updateColor(lightAmount: number) {\n    const mat = this.mesh.material as MeshBasicMaterial;\n    if (this.target instanceof Air) {\n      const colorIndex = Math.max(0, map(this.target.co2(), 1 / 6, 1.001, 0, AIR_COLORSCALE.length - 1));\n      const startColorIndex = Math.floor(colorIndex);\n      const startColor = AIR_COLORSCALE[startColorIndex];\n      this.originalColor = startColor.clone();\n      if (startColorIndex !== AIR_COLORSCALE.length - 1) {\n        const alpha = colorIndex - startColorIndex;\n        const endColorIndex = startColorIndex + 1;\n        const endColor = AIR_COLORSCALE[endColorIndex];\n        this.originalColor.lerp(endColor, alpha);\n      }\n    }\n    mat.color.copy(this.originalColor);\n    if (hasEnergy(this.target)) {\n      mat.color.lerp(new Color(0), 1 - this.target.energy / params.cellEnergyMax);\n    }\n\n    mat.color = this.lerpColorTemperature(mat.color);\n    mat.color = new Color(0).lerp(mat.color, map(lightAmount, 0, 1, 0.2, 1));\n  }\n\n  respondToEvents() {\n    // audio\n    if (this.target instanceof Leaf && this.audio != null) {\n      const newAudioValueTracker = this.target.totalSugarProduced;\n      if (newAudioValueTracker > this.lastAudioValueTracker) {\n        this.audio.setBuffer(blopBuffer);\n        const dist = this.target.pos.distanceToSquared(this.mito.world.player.pos);\n        const volume = Math.min(1, 1 / (1 + dist / 25)) * this.target.sugarConverted * this.target.sugarConverted;\n        this.audio.setVolume(volume);\n        // this.audio.setRefDistance(2);\n        // play blop sound\n        this.audio.play();\n        this.animation.set(this.growPulseAnimation(), Ticker.now / 1000);\n      }\n      this.lastAudioValueTracker = newAudioValueTracker;\n    }\n    if (this.target instanceof Root && this.audio != null) {\n      const newAudioValueTracker = this.target.totalSucked;\n      if (newAudioValueTracker !== this.lastAudioValueTracker) {\n        this.audio.setBuffer(suckWaterBuffer);\n        // const baseVolume = this.target.waterTransferAmount / (2 + this.target.waterTransferAmount);\n        const baseVolume = 1;\n        const dist = this.target.pos.distanceToSquared(this.mito.world.player.pos);\n        const volume = Math.min(1, 1 / (1 + dist / 25)) * baseVolume;\n        this.audio.setVolume(volume);\n        if (this.audio.source != null) {\n          this.audio.stop();\n        }\n        this.audio.play();\n        this.animation.set(this.growPulseAnimation(), Ticker.now / 1000);\n      }\n      this.lastAudioValueTracker = newAudioValueTracker;\n    }\n    this.mesh.remove(this.pairsLines);\n  }\n\n  private temperatureColor: Color = TileRenderer.TEMPERATURE_COLORS[Temperature.Mild];\n  private currentLerp = 0;\n  lerpColorTemperature(color: Color) {\n    const { temperature } = this.target;\n    let tColor = TileRenderer.TEMPERATURE_COLORS[temperature];\n    if (tColor !== this.temperatureColor) {\n      this.currentLerp = 0;\n    }\n    const targetLerp = temperature === Temperature.Mild ? 0 : 0.5;\n    this.temperatureColor = tColor;\n    this.currentLerp = lerp(this.currentLerp, targetLerp, 0.1);\n    color.lerp(this.temperatureColor, this.currentLerp);\n    return color;\n  }\n\n  updateHover() {\n    this.mesh.add(this.pairsLines);\n    if (hasTilePairs(this.target)) {\n      const pairColor = this.target instanceof Leaf ? 0xffc90e : new Color(\"rgb(9, 12, 255)\").getHex();\n      const pairs = this.target.tilePairs;\n      if (pairs.length !== this.pairsLines.children.length) {\n        // redo pairs\n        this.pairsLines.remove(...this.pairsLines.children);\n        pairs.forEach((dir) => {\n          const length = dir.length() * 2 - 0.25;\n          const arrowDir = new Vector3(dir.x, dir.y, 0).normalize();\n          const arrowHelper = this.makeLine(arrowDir, arrowDir.clone().multiplyScalar(-length / 2), length, pairColor);\n          this.pairsLines.add(arrowHelper);\n        });\n      }\n    }\n    if (this.hasActiveNeighbors(this.target)) {\n      const color = this.target instanceof Root ? new Color(\"rgb(9, 12, 255)\").getHex() : 0xffffff;\n      const lines = this.target.activeNeighbors;\n      if (lines.length !== this.pairsLines.children.length) {\n        // redo pairs\n        this.pairsLines.remove(...this.pairsLines.children);\n        lines.forEach((dir) => {\n          const length = dir.length() - 0.25;\n          const arrowDir = new Vector3(dir.x, dir.y, 0).normalize();\n          const arrowHelper =\n            this.target instanceof Root\n              ? this.makeLine(arrowDir, new Vector3(), length, color)\n              : new ArrowHelper(arrowDir, new Vector3(0, 0, 5), length, color);\n          this.pairsLines.add(arrowHelper);\n        });\n      }\n    }\n  }\n\n  growPulseAnimation(): Animation {\n    const duration = 0.5;\n    const ease = reversed(easeCubic);\n    return (dt) => {\n      const t = clamp((dt / duration) * ((this.target as any).tempo || 1), 0, 1);\n      const scale = map(ease(t), 0, 1, 1, 1.3);\n      this.mesh.scale.setScalar(scale);\n      return t >= 1;\n    };\n  }\n\n  hasActiveNeighbors(\n    t: any\n  ): t is {\n    activeNeighbors: Vector2[];\n  } {\n    return Array.isArray(t.activeNeighbors);\n  }\n\n  static lineGeometry = (() => {\n    const g = new BufferGeometry();\n    g.addAttribute(\"position\", new Float32BufferAttribute([0, 0, 0, 0, 1, 0], 3));\n    return g;\n  })();\n  private makeLine(dir: Vector3, origin: Vector3, length: number, color: number) {\n    // copied from https://github.com/mrdoob/js/blob/master/src/helpers/ArrowHelper.js\n    const line = new Line(TileRenderer.lineGeometry, new LineBasicMaterial({ color: color }));\n    line.position.copy(origin);\n    // dir is assumed to be normalized\n    if (dir.y > 0.99999) {\n      line.quaternion.set(0, 0, 0, 1);\n    } else if (dir.y < -0.99999) {\n      line.quaternion.set(1, 0, 0, 0);\n    } else {\n      const axis = new Vector3(dir.z, 0, -dir.x).normalize();\n      const radians = Math.acos(dir.y);\n      line.quaternion.setFromAxisAngle(axis, radians);\n    }\n    line.scale.set(1, Math.max(0, length), 1);\n    line.position.z = 0.1;\n    line.updateMatrix();\n    line.matrixAutoUpdate = false;\n    return line;\n  }\n  destroy() {\n    this.scene.remove(this.mesh);\n    if (this.worldDomElement != null) {\n      this.mito.removeWorldDOMElement(this.worldDomElement);\n    }\n    if (this.inventoryRenderer != null) {\n      this.inventoryRenderer.destroy();\n    }\n    if (this.cellEffectsRenderer != null) {\n      this.cellEffectsRenderer.destroy();\n    }\n  }\n}\n\nexport const materialMapping = lazy(() => {\n  const materials = new Map<Constructor<Tile>, MeshBasicMaterial>();\n  materials.set(\n    Air,\n    new MeshBasicMaterial({\n      side: DoubleSide,\n      depthWrite: false,\n    })\n  );\n  materials.set(\n    Soil,\n    new MeshBasicMaterial({\n      map: textureFromSpritesheet(8, 11),\n      // map: textureFromSpritesheet(41, 26),\n      // map: textureFromSpritesheet(679 / 16, 438 / 16),\n      side: DoubleSide,\n      // color: new Color(0xcccccc),\n      color: new Color(\"rgb(112, 89, 44)\"),\n      depthWrite: false,\n    })\n  );\n  materials.set(\n    Fountain,\n    new MeshBasicMaterial({\n      map: textureFromSpritesheet(56 / 16, 38 / 16),\n      side: DoubleSide,\n    })\n  );\n  materials.set(\n    Rock,\n    new MeshBasicMaterial({\n      map: textureFromSpritesheet(26, 20),\n      side: DoubleSide,\n      color: new Color(\"rgb(63, 77, 84)\"),\n    })\n  );\n  materials.set(\n    DeadCell,\n    new MeshBasicMaterial({\n      map: textureFromSpritesheet(137 / 16, 374 / 16),\n      side: DoubleSide,\n      color: new Color(\"rgb(128, 128, 128)\"),\n    })\n  );\n  materials.set(\n    Tissue,\n    new MeshBasicMaterial({\n      map: textureFromSpritesheet(6, 31),\n      side: DoubleSide,\n      color: new Color(0x30ae25),\n    })\n  );\n  materials.set(Transport, materials.get(Tissue)!);\n  // materialMapping.set(Transport, new MeshBasicMaterial({\n  //     map: arrowUpMaterial(),\n  //     side: DoubleSide,\n  //     color: new Color(\"rgb(42, 138, 25)\"),\n  // }));\n  materials.set(\n    Leaf,\n    new MeshBasicMaterial({\n      // map: textureFromSpritesheet(9, 31),\n      map: textureFromSpritesheet(55 / 16, 280 / 16),\n      // map: textureFromSpritesheet(16, 10),\n      side: DoubleSide,\n    })\n  );\n  materials.set(\n    Root,\n    new MeshBasicMaterial({\n      // map: textureFromSpritesheet(0, 31),\n      map: textureFromSpritesheet(59 / 16, 327 / 16),\n      side: DoubleSide,\n    })\n  );\n  materials.set(\n    Fruit,\n    new MeshBasicMaterial({\n      map: fruitTexture,\n      side: DoubleSide,\n      transparent: true,\n    })\n  );\n  materials.set(\n    Vein,\n    new MeshBasicMaterial({\n      map: textureFromSpritesheet(Math.floor(184 / 16), Math.floor(152 / 16)),\n      side: DoubleSide,\n    })\n  );\n\n  return materials;\n});\n\nfunction getMaterial(tile: Tile) {\n  // careful - creates a new instance per tile\n  return materialMapping()\n    .get(tile.constructor as Constructor<Tile>)!\n    .clone();\n}\n\n// const AIR_COLORSCALE = [\n//     new Color(\"rgb(91, 117, 154)\"),\n//     new Color(\"rgb(158, 179, 196)\"),\n//     new Color(\"hsv(35, 7%, 99%)\"),\n// ];\n// const AIR_COLORSCALE = [\n//     new Color(\"hsl(14, 81%, 52%)\"),\n//     new Color(\"hsl(34, 61%, 72%)\"),\n//     new Color(\"hsl(61, 54%, 87%)\"),\n//     new Color(\"hsl(67, 35%, 99%)\"),\n//     new Color(\"hsl(213, 63%, 52%)\"),\n//     // new Color(\"hsl(37, 35%, 99%)\"),\n// ];\n// const AIR_COLORSCALE = [\n//     new Color(\"hsl(34, 61%, 56%)\"),\n//     new Color(\"hsl(67, 31%, 55%)\"),\n//     new Color(\"hsl(213, 63%, 58%)\"),\n//     // new Color(\"hsl(37, 35%, 99%)\"),\n// ];\nconst AIR_COLORSCALE = [\n  // new Color(\"hsl(67, 31%, 55%)\"),\n  new Color(\"hsl(67, 31%, 25%)\"),\n  new Color(\"hsl(180, 31%, 76%)\"),\n  new Color(\"hsl(213, 63%, 58%)\"),\n];\n// const AIR_COLORSCALE = [\n//     new Color(\"rgb(146, 215, 255)\"),\n//     new Color(\"rgb(53, 125, 210)\"),\n//     new Color(\"rgb(56, 117, 154)\"),\n// ];\n","import * as React from \"react\";\n\nimport { Constructor } from \"../constructor\";\nimport { Cell } from \"../game/tile\";\nimport { materialMapping } from \"../renderers/TileRenderer\";\n\nimport \"./CellBar.scss\";\nimport classNames from \"classnames\";\nimport { spritesheetLoaded } from \"../spritesheet\";\n\nexport interface CellBarProps {\n  bar: Constructor<Cell>[];\n  index: number;\n  onIndexClicked: (index: number) => void;\n}\n\nfunction CellBar({ bar, index, onIndexClicked }: CellBarProps) {\n  return (\n    <div className=\"cell-bar\">\n      {bar.map((cellType, i) => (\n        <CellBarItem\n          key={i}\n          hotkey={String(i + 1)}\n          type={cellType}\n          isSelected={index === i}\n          onClick={() => onIndexClicked(i)}\n          spritesheetLoaded={spritesheetLoaded}\n        />\n      ))}\n    </div>\n  );\n}\n\nexport interface CellBarItemProps {\n  children?: React.ReactNode;\n  type: Constructor<Cell>;\n  isSelected: boolean;\n  onClick: () => void;\n  spritesheetLoaded: boolean;\n  hotkey: string;\n}\n\nfunction CellBarItem({ type, hotkey, isSelected, onClick, spritesheetLoaded }: CellBarItemProps) {\n  const style: React.CSSProperties = React.useMemo(() => {\n    const material = materialMapping().get(type)!;\n    const image = material.map!.image;\n    const color = material.color.getStyle();\n    const url = (() => {\n      if (image != null) {\n        if (image instanceof HTMLCanvasElement && spritesheetLoaded) {\n          return image.toDataURL();\n        } else if (image instanceof Image) {\n          return image.src;\n        } else {\n          return \"\";\n        }\n      } else {\n        return \"\";\n      }\n    })();\n    const backgroundImage = `url(${url}), linear-gradient(${color}, ${color})`;\n    return {\n      backgroundImage,\n    };\n  }, [spritesheetLoaded, type]);\n  return (\n    <div className={classNames(\"cell-bar-item\", { selected: isSelected })}>\n      <div className=\"cell-bar-item-icon\" onClick={onClick} style={style}>\n        {type.displayName}\n      </div>\n      <HotkeyButton hotkey={hotkey} onClick={onClick} />\n    </div>\n  );\n}\n\nfunction ensureCanvasFocus(e: React.SyntheticEvent<any>) {\n  e.preventDefault();\n  const canvas = document.getElementsByTagName(\"canvas\")[0];\n  canvas.focus();\n}\n\ninterface HotkeyButtonProps extends React.HTMLProps<HTMLDivElement> {\n  hotkey: string;\n}\n\nfunction HotkeyButton({ hotkey, onClick, ...restProps }: HotkeyButtonProps) {\n  const handleClick = (e: React.MouseEvent<HTMLDivElement>) => {\n    onClick && onClick(e);\n    ensureCanvasFocus(e);\n  };\n  return (\n    <div className=\"mito-hud-button mito-hud-build-item\" onClick={handleClick} {...restProps}>\n      <span className=\"mito-hud-button-hotkey\">{hotkey}</span>\n    </div>\n  );\n}\n\nexport default CellBar;\n","import * as React from \"react\";\n\nimport { TIME_PER_YEAR, Season, seasonDisplay } from \"../game\";\nimport \"./SeasonsTracker.scss\";\n\nexport default function SeasonsTracker({ time, season }: { time: number; season: Season }) {\n  const yearDonePercent = time / TIME_PER_YEAR;\n  return (\n    <div className=\"seasons-tracker\">\n      <div className=\"container\">\n        <div className=\"end-brace\" />\n        <div className=\"bar\">\n          <BarMarker percent={0.25} />\n          <BarMarker percent={0.5} />\n          <BarMarker percent={0.75} />\n          <SeasonBead percent={yearDonePercent} />\n        </div>\n        <div className=\"end-brace\" />\n      </div>\n      <div className=\"season-display\">{seasonDisplay(season)}</div>\n    </div>\n  );\n}\n\nfunction BarMarker({ percent }: { percent: number }) {\n  const style = {\n    left: `${(percent * 100).toFixed(2)}%`,\n  };\n  return <div className=\"bar-marker\" style={style} />;\n}\n\nfunction SeasonBead({ percent }: { percent: number }) {\n  const style = {\n    left: `${(percent * 100).toFixed(2)}%`,\n  };\n  return <div className=\"season-bead\" style={style} />;\n}\n","import classnames from \"classnames\";\nimport * as React from \"react\";\n\nimport Mito from \"../index\";\nimport { params } from \"../params\";\nimport CellBar from \"./CellBar\";\n\nimport TraitDisplay from \"../../../evolution/TraitDisplay\";\nimport DynamicNumber from \"common/DynamicNumber\";\nimport { isInteresting } from \"evolution/traits\";\nimport \"./HUD.scss\";\n\nimport SeasonsTracker from \"./SeasonsTracker\";\n\nexport interface HUDProps {\n  mito: Mito;\n}\n\nexport interface HUDState {\n  traitsPanelOpen: boolean;\n}\n\nexport class HUD extends React.Component<HUDProps, HUDState> {\n  state: HUDState = {\n    traitsPanelOpen: true,\n  };\n\n  get mito() {\n    return this.props.mito;\n  }\n\n  get world() {\n    return this.mito.world;\n  }\n\n  get player() {\n    return this.world.player;\n  }\n\n  get inventory() {\n    return this.player.inventory;\n  }\n\n  private isTutorialFinished() {\n    return this.mito.tutorialRef == null ? true : this.mito.tutorialRef.isFinished();\n  }\n\n  public render() {\n    const isMaxed = this.inventory.isMaxed();\n    const isMaxedEl = <div className={`mito-inventory-maxed${isMaxed ? \" is-maxed\" : \"\"}`}>maxed</div>;\n    return (\n      <>\n        <SeasonsTracker time={this.world.time} season={this.world.season} />\n        {this.maybeRenderTraits()}\n        <div className={classnames(\"mito-inventory\", { hidden: false })}>\n          {isMaxedEl}\n          <div className=\"mito-inventory-container\">\n            {this.renderInventoryBar()}\n            {this.renderInventory()}\n          </div>\n          <CellBar\n            bar={this.mito.cellBar}\n            index={this.mito.cellBarIndex}\n            onIndexClicked={(i) => this.mito.setCellBarIndex(i)}\n          />\n        </div>\n      </>\n    );\n  }\n\n  maybeRenderTraits() {\n    if (this.state.traitsPanelOpen && isInteresting(this.world.traits)) {\n      return (\n        <div className=\"hud-panel-right\">\n          <TraitDisplay traits={this.world.traits} />\n        </div>\n      );\n    }\n  }\n\n  renderInventory() {\n    return (\n      <div className=\"mito-inventory-indicator\">\n        <span className=\"mito-inventory-water\">\n          <DynamicNumber speed={0.5} value={this.inventory.water} /> water\n        </span>\n        &nbsp;\n        <span className=\"mito-inventory-sugar\">\n          <DynamicNumber speed={0.5} value={this.inventory.sugar} /> sugar\n        </span>\n      </div>\n    );\n  }\n\n  renderInventoryBar() {\n    const waterPercent = this.inventory.water / params.maxResources;\n    const sugarPercent = this.inventory.sugar / params.maxResources;\n    const emptyPercent = 1 - (this.inventory.water + this.inventory.sugar) / params.maxResources;\n    const waterStyles: React.CSSProperties = {\n      width: `${waterPercent * 100}%`,\n    };\n    const sugarStyles: React.CSSProperties = {\n      width: `${sugarPercent * 100}%`,\n    };\n    const emptyStyles: React.CSSProperties = {\n      width: `${emptyPercent * 100}%`,\n    };\n    const inventoryBar = (\n      <div className=\"mito-inventory-bar\">\n        <div style={waterStyles} className=\"mito-inventory-bar-water\"></div>\n        <div style={sugarStyles} className=\"mito-inventory-bar-sugar\"></div>\n        <div style={emptyStyles} className=\"mito-inventory-bar-empty\"></div>\n      </div>\n    );\n    return inventoryBar;\n  }\n}\n","import * as React from \"react\";\n\ninterface SceneObjectProps {\n  object: THREE.Object3D;\n  parent: THREE.Object3D;\n  // children?: SceneObject[];\n}\nexport class SceneObject extends React.PureComponent<SceneObjectProps, {}> {\n  // render() {\n  //     if (this.props.children) {\n  //         return <>\n  //             {\n  //                 this.props.children.map((child) => React.cloneElement(child, { parent: this.props.object }))\n  //             }\n  //         </>;\n  //     }\n  // }\n\n  render() {\n    return null;\n  }\n\n  componentDidMount() {\n    this.props.parent.add(this.props.object);\n  }\n\n  componentWillUnmount() {\n    this.props.parent.remove(this.props.object);\n  }\n}\n","import * as dat from \"dat.gui\";\nimport * as React from \"react\";\n\nimport { ALL_ENVIRONMENTS } from \"../game/environment\";\nimport { params, updateParamsHash } from \"../params\";\n\nexport class ParamsGUI extends React.Component {\n  private gui: dat.GUI;\n  constructor(props: any) {\n    super(props);\n    const gui = new dat.GUI({\n      closed: true,\n      width: 450,\n    });\n    gui\n      .add(params, \"environment\", Object.keys(ALL_ENVIRONMENTS))\n      .onChange(() => setTimeout(() => window.location.reload(), 100));\n    gui.add(params, \"droop\", 0, 0.5, 0.01);\n    gui.add(params, \"fountainTurnsPerWater\", 1, 100, 1);\n    gui.add(params, \"isRealtime\");\n    gui.add(params, \"leafReactionRate\", 0, 0.2, 0.0001);\n    gui.add(params, \"leafSugarPerReaction\", 0, 1, 0.01);\n    gui.add(params, \"rootTurnsPerTransfer\", 1, 100, 1);\n    gui.add(params, \"soilDarknessBase\", 0, 1, 0.01);\n    gui.add(params, \"soilDiffusionType\", [\"discrete\", \"continuous\"]);\n    gui.add(params, \"sunlightReintroduction\", 0, 1, 0.01);\n    gui.add(params, \"sunlightDiffusion\", 0, 1, 0.01);\n    gui.add(params, \"transportTurnsPerMove\", 1, 50, 1);\n    gui.add(params, \"veinDiffusion\", 0, 0.85, 0.0001);\n    const f = gui.addFolder(\"Needs Page Refresh\");\n    f.add(params, \"cellGestationTurns\", 0, 100, 1);\n    f.add(params, \"cellDiffusionSugar\", 0, 0.85, 0.0001);\n    f.add(params, \"cellDiffusionWater\", 0, 0.85, 0.0001);\n    f.add(params, \"cellEnergyMax\", 400, 10000, 100);\n    f.add(params, \"fountainAppearanceRate\", 1, 5, 0.1);\n    f.add(params, \"maxResources\", 10, 1000, 1);\n    f.add(params, \"soilDiffusionWater\", 0, 0.25, 0.00001);\n    f.add(params, \"soilMaxWater\", 1, 100, 1);\n    f.add(params, \"tissueInventoryCapacity\", 1, 100, 1);\n\n    for (const c of gui.__controllers.concat(f.__controllers)) {\n      c.onFinishChange(updateParamsHash);\n    }\n\n    this.gui = gui;\n  }\n\n  render() {\n    return null;\n  }\n}\n","import React from \"react\";\nimport Ticker from \"global/ticker\";\n\nexport class Animate extends React.Component<{\n  a: (time: number) => void;\n}> {\n  private rafid?: number;\n  private animate = (time: number) => {\n    this.props.a(time / 1000);\n  };\n  render() {\n    return null;\n  }\n  componentDidMount() {\n    this.rafid = Ticker.addAnimation(this.animate);\n  }\n  componentWillUnmount() {\n    if (this.rafid) {\n      Ticker.removeAnimation(this.rafid);\n    }\n  }\n}\n","import * as React from \"react\";\nimport * as THREE from \"three\";\n\nimport lazy from \"../../../common/lazy\";\nimport { SceneObject } from \"./sceneObject\";\nimport { Animate } from \"./Animate\";\n\nexport const TILE_HIGHLIGHT = lazy(() => {\n  const geometry = new THREE.PlaneBufferGeometry(1, 1);\n  const edgesGeometry = new THREE.EdgesGeometry(geometry, 1); // or WireframeGeometry( geometry )\n  const material = new THREE.LineBasicMaterial({\n    color: 0xffffff,\n    transparent: true,\n    opacity: 0.75,\n  });\n  const lineSegments = new THREE.LineSegments(edgesGeometry, material);\n  lineSegments.position.z = 10;\n  return lineSegments;\n});\n\nexport interface TileHighlightProps {\n  x: number;\n  y: number;\n  scene: THREE.Scene;\n}\n\nclass TileHighlight extends React.PureComponent<TileHighlightProps, {}> {\n  private object = TILE_HIGHLIGHT().clone();\n  render() {\n    this.object.position.x = this.props.x;\n    this.object.position.y = this.props.y;\n    return (\n      <>\n        <Animate a={(t) => this.object.scale.setScalar(Math.sin(t * 3.7) * 0.04 + 0.94)} />\n        <SceneObject object={this.object} parent={this.props.scene} />\n      </>\n    );\n  }\n}\n\nexport default TileHighlight;\n","import * as React from \"react\";\nimport * as THREE from \"three\";\n\nimport lazy from \"../../../common/lazy\";\nimport { SceneObject } from \"./sceneObject\";\n\nexport const POINT_HIGHLIGHT = lazy(() => {\n  const geometry = new THREE.CircleBufferGeometry(0.1, 20);\n  const material = new THREE.MeshBasicMaterial({\n    color: 0xffffff,\n    transparent: true,\n    opacity: 0.75,\n    side: THREE.DoubleSide,\n  });\n  const mesh = new THREE.Mesh(geometry, material);\n  mesh.position.z = 10;\n  return mesh;\n  // const edgesGeometry = new THREE.EdgesGeometry(geometry, 1); // or WireframeGeometry( geometry )\n  // const material = new THREE.LineBasicMaterial({ color: 0xffffff, transparent: true, opacity: 0.75 });\n  // const lineSegments = new THREE.LineSegments(edgesGeometry, material);\n  // lineSegments.position.z = 10;\n  // return lineSegments;\n});\n\nexport interface PointHighlightProps {\n  x: number;\n  y: number;\n  z?: number;\n  scene: THREE.Scene;\n}\n\nclass PointHighlight extends React.PureComponent<PointHighlightProps, {}> {\n  private object = POINT_HIGHLIGHT().clone();\n  render() {\n    this.object.position.x = this.props.x;\n    this.object.position.y = this.props.y;\n    return (\n      <>\n        {/* <Animate a={((t) => this.object.scale.setScalar(Math.sin(t * 3.7) * 0.04 + 0.94))} /> */}\n        <SceneObject object={this.object} parent={this.props.scene} />\n      </>\n    );\n  }\n}\n\nexport default PointHighlight;\n","import * as React from \"react\";\n\nimport Mito from \"..\";\nimport { Tile } from \"../game/tile\";\nimport TileHighlight from \"../tutorial/tileHighlight\";\nimport { TileDetails } from \"./TileDetails\";\nimport PointHighlight from \"../tutorial/PointHighlight\";\n\ninterface HoverProps {\n  mito: Mito;\n}\n\nexport class Hover extends React.Component<HoverProps> {\n  get scene() {\n    return this.props.mito.scene;\n  }\n  public render() {\n    const { highlightedTile } = this.props.mito;\n    const highlightedPosition = this.props.mito.getHighlightPosition();\n    return (\n      <>\n        <TileDetails tile={highlightedTile} />\n        <PointHighlight x={highlightedPosition.x} y={highlightedPosition.y} scene={this.scene} />\n        {this.maybeRenderTileHighlight(highlightedTile)}\n        {/* {this.maybeRenderPath()} */}\n      </>\n    );\n  }\n\n  public maybeRenderTileHighlight(tile?: Tile) {\n    if (tile) {\n      return <TileHighlight x={tile.pos.x} y={tile.pos.y} scene={this.scene} />;\n    }\n  }\n\n  // public maybeRenderPath() {\n  //   const { autoplace, hoveredTile, scene, world } = this.props.mito;\n  //   if (hoveredTile) {\n  //     if (autoplace != null && Mito.expansionTiles.indexOf(autoplace) !== -1) {\n  //       return <PathHighlight tile={hoveredTile} scene={scene} world={world} walkable=\"non-obstacles\" />;\n  //     }\n  //     if (autoplace === Transport) {\n  //       return <PathHighlight tile={hoveredTile} scene={scene} world={world} walkable=\"tissue\" />;\n  //     }\n  //   }\n  // }\n}\n\n// class PathHighlight extends React.PureComponent<{ world: World, tile: Tile, scene: THREE.Scene, walkable: \"tissue\" | \"non-obstacles\" }> {\n//   render() {\n//     const path = this.props.walkable === \"non-obstacles\"\n//       ? findPositionsThroughNonObstacles(this.props.world, this.props.tile.pos)\n//       : findPositionsThroughTissue(this.props.world, this.props.tile.pos);\n//     return <>\n//       {path.map(([x, y]) => <TileHighlight x={x} y={y} scene={this.props.scene} />)}\n//     </>;\n//   }\n// }\n","import React from \"react\";\nimport { Vector2 } from \"three\";\nimport { Mito } from \"./index\";\nexport class WorldDOMElement {\n  constructor(public mito: Mito, public positionFn: () => Vector2, public renderFn: () => JSX.Element) {}\n  render() {\n    const worldPosition = this.positionFn();\n    const pixelPosition = this.mito.worldToScreen(worldPosition);\n    const left = pixelPosition.x;\n    const top = pixelPosition.y;\n    const style: React.CSSProperties = {\n      left,\n      top,\n    };\n    return <div style={style}>{this.renderFn()}</div>;\n  }\n}\n","import { PopulationAttempt } from \"app\";\nimport { Button } from \"common/Button\";\nimport VignetteCapturer from \"common/vignette\";\nimport { parse } from \"query-string\";\nimport * as React from \"react\";\nimport * as THREE from \"three\";\nimport { OrthographicCamera, Scene, Vector2, Vector3, WebGLRenderer } from \"three\";\nimport { lerp2, map } from \"../../math/index\";\nimport { ISketch, SketchAudioContext } from \"../sketch\";\nimport { ActionBuild, ActionInteract, ActionMove } from \"./action\";\nimport { drums, hookUpAudio, strings } from \"./audio\";\nimport { Constructor } from \"./constructor\";\nimport { World } from \"./game\";\nimport { isInteractable } from \"./game/interactable\";\nimport { Cell, Fruit, Leaf, Root, Tile, Tissue, Transport, Vein } from \"./game/tile\";\nimport { ACTION_KEYMAP, CELL_BAR_KEYS, MOVEMENT_KEYS } from \"./keymap\";\nimport { params } from \"./params\";\nimport { TileRenderer } from \"./renderers/TileRenderer\";\nimport { WorldRenderer } from \"./renderers/WorldRenderer\";\nimport { NewPlayerTutorial } from \"./tutorial\";\nimport { GameStack, Hover, HUD } from \"./ui\";\nimport { WorldDOMElement } from \"./WorldDOMElement\";\n\nexport interface GameResult {\n  status: \"won\" | \"lost\";\n  fruits: Fruit[];\n  mutationPointsPerEpoch: number;\n  world: World;\n}\n\nexport class Mito extends ISketch {\n  static id = \"mito\";\n  public readonly world: World;\n  public scene = new Scene();\n  private camera = new OrthographicCamera(0, 0, 0, 0, -100, 100);\n  public cellBar: Constructor<Cell>[] = [Tissue, Leaf, Root, Transport, Fruit];\n  public cellBarIndex = 0;\n  public tutorialRef: NewPlayerTutorial | null = null;\n  public mouse = new THREE.Vector2();\n  public mouseDown = false;\n  public mouseButton = -1;\n  public instructionsOpen = false;\n  private firstActionTakenYet = false;\n  public audioListener = new THREE.AudioListener();\n  private keyMap = new Set<string>();\n  public highlightedTile?: Tile;\n\n  public events = {\n    contextmenu: (event: MouseEvent) => {\n      event.preventDefault();\n      return false;\n    },\n    mousemove: (event: MouseEvent) => {\n      this.mouse.x = event.clientX!;\n      this.mouse.y = event.clientY!;\n    },\n    click: () => {\n      // left-click\n      // this.handleClick(event.clientX!, event.clientY!);\n    },\n    mousedown: (event: MouseEvent) => {\n      this.mouseButton = event.button;\n      this.mouseDown = true;\n    },\n    mouseup: () => {\n      this.mouseDown = false;\n    },\n    keydown: (event: KeyboardEvent) => {\n      this.firstActionTakenYet = true;\n      const code = event.code;\n      this.keyMap.add(code);\n      if (!event.repeat) {\n        this.handleKeyDown(code);\n      }\n    },\n    keyup: (event: KeyboardEvent) => {\n      this.keyMap.delete(event.code);\n    },\n    wheel: (e: WheelEvent) => {\n      if (e.shiftKey) {\n        // on my mouse, one scroll is + or - 125\n        const delta = -(e.deltaX + e.deltaY) / 125 / 20;\n        const currZoom = this.camera.zoom;\n        const scalar = Math.pow(2, delta);\n        // console.log(currZoom);\n        // zoom of 2 is zooming in\n        // const newZoom = Math.min(Math.max(currZoom * scalar, 1), 2.5);\n        const newZoom = currZoom * scalar;\n        this.camera.zoom = newZoom;\n        this.camera.updateProjectionMatrix();\n      } else {\n        if (e.deltaX + e.deltaY < 0) {\n          this.setCellBarIndex(this.cellBarIndex - 1);\n        } else {\n          this.setCellBarIndex(this.cellBarIndex + 1);\n        }\n      }\n    },\n  };\n\n  get selectedCell() {\n    return this.cellBar[this.cellBarIndex];\n  }\n\n  public readonly worldRenderer: WorldRenderer;\n  private vignetteCapturer = new VignetteCapturer(this);\n  private vignettes: HTMLCanvasElement[] = [];\n\n  constructor(\n    renderer: WebGLRenderer,\n    context: SketchAudioContext,\n    attempt: PopulationAttempt,\n    public onWinLoss: (result: GameResult) => void\n  ) {\n    super(renderer, context);\n    this.world = new World(attempt.targetHex.info.environment!, attempt.settlingSpecies);\n\n    this.camera.position.z = 10;\n    this.camera.lookAt(new THREE.Vector3(0, 0, 0));\n    this.camera.position.x = this.world.player.pos.x;\n    this.camera.position.y = this.world.player.pos.y;\n    this.camera.zoom = 1.5;\n    this.camera.add(this.audioListener);\n\n    this.worldRenderer = new WorldRenderer(this.world, this.scene, this);\n\n    hookUpAudio(this.audioContext);\n    this.updateAmbientAudio();\n    this.attachWindowEvents();\n    (window as any).mito = this;\n    (window as any).THREE = THREE;\n  }\n\n  private attachWindowEvents() {\n    window.addEventListener(\"blur\", () => {\n      this.keyMap.clear();\n    });\n  }\n\n  handleKeyDown = (code: string) => {\n    if (code === \"Slash\") {\n      this.instructionsOpen = !this.instructionsOpen;\n      return;\n    }\n    if (this.instructionsOpen) {\n      if (code === \"Escape\") {\n        this.instructionsOpen = false;\n      }\n      return;\n    }\n\n    if (CELL_BAR_KEYS[code] != null) {\n      this.cellBarIndex = CELL_BAR_KEYS[code];\n    }\n  };\n\n  public setCellBarIndex(i: number) {\n    this.cellBarIndex = ((i % this.cellBar.length) + this.cellBar.length) % this.cellBar.length;\n  }\n\n  public render() {\n    const worldDomElementComponents: JSX.Element[] = [];\n    for (const e of this.worldDomElements) {\n      worldDomElementComponents.push(e.render());\n    }\n    const doWin = () => {\n      this.onWinLoss({\n        ...this.world.wipResult,\n        status: \"won\",\n        mutationPointsPerEpoch: 2,\n      });\n    };\n\n    const doLose = () => {\n      this.onWinLoss({\n        ...this.world.wipResult,\n        status: \"lost\",\n        mutationPointsPerEpoch: 0,\n      });\n    };\n    const endGameButtons =\n      process.env.NODE_ENV === \"development\" ? (\n        <div style={{ position: \"absolute\", top: 50, right: 10 }}>\n          <Button color=\"green\" onClick={doWin}>\n            Win\n          </Button>\n          <Button color=\"green\" onClick={doLose}>\n            Lose\n          </Button>\n        </div>\n      ) : null;\n    return (\n      <>\n        <HUD mito={this} />\n        <GameStack mito={this} />\n        {/* <NewPlayerTutorial ref={(ref) => this.tutorialRef = ref } mito={this} />, */}\n        {/* <ParamsGUI /> */}\n        <Hover mito={this} />\n        <div className=\"world-dom-components\">{worldDomElementComponents}</div>\n        {endGameButtons}\n      </>\n    );\n  }\n\n  public updateAmbientAudio() {\n    const yPos = this.world.player.pos.y;\n    const drumVolume = map(yPos, this.world.height / 2, this.world.height, 0, 0.5);\n    const stringsVolume = map(yPos, this.world.height / 2, 0, 0, 0.5);\n    drums.gain.gain.value = Math.max(0, drumVolume);\n    strings.gain.gain.value = Math.max(0, stringsVolume);\n  }\n\n  public logRenderInfo() {\n    console.log(\n      `Geometries in memory: ${this.renderer.info.memory.geometries}\nTextures in memory: ${this.renderer.info.memory.textures}\nNumber of Programs: ${this.renderer.info.programs!.length}\n# Render Calls: ${this.renderer.info.render.calls}\n# Render Lines: ${this.renderer.info.render.lines}\n# Render Points: ${this.renderer.info.render.points}\n# Render Tris: ${this.renderer.info.render.triangles}\n`\n    );\n  }\n\n  public perfDebug() {\n    // count how many have autoUpdate enabled\n    let yes = 0,\n      no = 0;\n    this.scene.traverse((o) => {\n      if (o.matrixAutoUpdate) {\n        yes++;\n      } else {\n        no++;\n      }\n    });\n    console.log(\"matrixAutoUpdate: yes\", yes, \", no\", no);\n\n    // count how many vertices of each type there are\n    const s = new Map();\n    this.scene.traverse((o) => {\n      const k = s.get(o.name || o.constructor.name) || [];\n      s.set(o.name || o.constructor.name, k);\n      k.push(o);\n    });\n    console.log(s);\n  }\n\n  public worldStep(dt: number) {\n    if (!this.firstActionTakenYet || this.instructionsOpen) {\n      return;\n    }\n\n    // this.world.player.dropWater = this.keyMap.has(\"q\");\n    // this.world.player.dropSugar = this.keyMap.has(\"e\");\n    this.world.step(dt);\n\n    // if (this.vignetteCapturer.isTimeForNewCapture()) {\n    //   const v = this.vignetteCapturer.capture();\n    //   this.vignettes.push(v);\n    // }\n\n    if (this.tutorialRef) {\n      this.tutorialRef.setState({ time: this.world.time });\n    }\n\n    const gameResult = this.world.maybeGetGameResult();\n    if (gameResult != null) {\n      this.onWinLoss(gameResult);\n    }\n\n    this.updateAmbientAudio();\n  }\n\n  private getCameraNormCoordinates(clientX: number, clientY: number) {\n    return new THREE.Vector2((clientX / this.canvas.width) * 2 - 1, (-clientY / this.canvas.height) * 2 + 1);\n  }\n\n  public getHighlightVector(clientX = this.mouse.x, clientY = this.mouse.y) {\n    const offset = new Vector2(clientX - this.canvas.width / 2, clientY - this.canvas.height / 2);\n\n    offset.setLength(0.75);\n    return offset;\n  }\n\n  public getHighlightPosition(clientX = this.mouse.x, clientY = this.mouse.y) {\n    const offset = this.getHighlightVector(clientX, clientY);\n    const { x, y } = this.world.player.posFloat;\n\n    offset.x += x;\n    offset.y += y;\n    return offset;\n  }\n\n  private getHighlightedTile(clientX = this.mouse.x, clientY = this.mouse.y) {\n    const p = this.getHighlightPosition(clientX, clientY);\n    p.round();\n\n    const tile = this.world.tileAt(p.x, p.y);\n    if (tile != null && tile.lightAmount() > 0) {\n      return tile;\n    }\n  }\n\n  worldToScreen(world: Vector2) {\n    const screen = new Vector3(world.x, world.y, 0);\n    screen.project(this.camera); // `camera` is a THREE.PerspectiveCamera\n\n    screen.x = Math.round((0.5 + screen.x / 2) * this.canvas.width);\n    screen.y = Math.round((0.5 - screen.y / 2) * this.canvas.height);\n\n    return screen;\n  }\n\n  private worldDomElements = new Set<WorldDOMElement>();\n  addWorldDOMElement(positionFn: () => THREE.Vector2, renderFn: () => JSX.Element): WorldDOMElement {\n    const e = new WorldDOMElement(this, positionFn, renderFn);\n    this.worldDomElements.add(e);\n    return e;\n  }\n\n  removeWorldDOMElement(worldDomElement: WorldDOMElement) {\n    this.worldDomElements.delete(worldDomElement);\n  }\n\n  public animate(millisElapsed: number) {\n    if (this.instructionsOpen) {\n      return;\n    }\n    // if (document.activeElement !== this.canvas && !document.querySelector(\".dg.ac\")!.contains(document.activeElement)) {\n    //     this.canvas.focus();\n    // }\n    this.canvas.focus();\n    // const dt = millisElapsed / 1000;\n    // TODO make this seconds instead of frames\n    let dt = Math.min((1 * millisElapsed) / 30, 10);\n    if (params.isRealtime) {\n      const moveAction = this.keysToMovement(this.keyMap);\n      if (moveAction) {\n        this.world.player.setAction(moveAction);\n      }\n      for (const key of this.keyMap) {\n        if (ACTION_KEYMAP[key]) {\n          this.world.player.setAction(ACTION_KEYMAP[key]);\n        }\n      }\n      if (this.mouseDown) {\n        // left\n        if (this.mouseButton === 0) {\n          this.handleLeftClick();\n        } else if (this.mouseButton === 2) {\n          this.handleRightClick();\n        }\n      }\n      this.worldStep(dt);\n    } else if (this.world.player.getAction() != null) {\n      this.worldStep(dt);\n    }\n    this.worldRenderer.update();\n\n    this.highlightedTile = this.getHighlightedTile();\n    // console.log(this.highlightedTile!.pos);\n    if (this.highlightedTile != null) {\n      (this.worldRenderer.getOrCreateRenderer(this.highlightedTile) as TileRenderer).updateHover();\n    }\n\n    const mouseNorm = this.getCameraNormCoordinates(this.mouse.x, this.mouse.y);\n    const target = new THREE.Vector2(\n      this.world.player.posFloat.x + mouseNorm.x / 2,\n      this.world.player.posFloat.y - mouseNorm.y / 2\n    );\n    lerp2(this.camera.position, target, 0.3);\n\n    this.renderer.render(this.scene, this.camera);\n    if (Boolean(parse(window.location.search).debug) && this.frameCount % 100 === 0) {\n      // this.perfDebug();\n      this.logRenderInfo();\n    }\n  }\n  public keysToMovement(keys: Set<string>): ActionMove | null {\n    const dir = new Vector2();\n    for (const key of keys) {\n      if (MOVEMENT_KEYS[key]) {\n        dir.add(MOVEMENT_KEYS[key].dir);\n      }\n    }\n    if (dir.x === 0 && dir.y === 0) {\n      return null;\n    } else {\n      return {\n        type: \"move\",\n        dir,\n      };\n    }\n  }\n\n  public resize(w: number, h: number) {\n    const aspect = h / w;\n    // at zoom 1, we see 12 pixels up and 12 pixels down\n    const cameraHeight = 12;\n    this.camera.left = -cameraHeight / aspect;\n    this.camera.right = cameraHeight / aspect;\n    this.camera.top = -cameraHeight;\n    this.camera.bottom = cameraHeight;\n    // this.camera.position.z = 1;\n    // this.camera.lookAt(new Vector3(0, 0, 0));\n    this.camera.updateProjectionMatrix();\n  }\n\n  public handleRightClick() {\n    const tile = this.getHighlightedTile();\n    if (tile != null) {\n      if (tile instanceof Fruit) {\n        return; // disallow deleting fruit\n      }\n      this.world.player.setAction({\n        type: \"deconstruct\",\n        position: tile.pos,\n      });\n    }\n    // }\n  }\n\n  public handleLeftClick() {\n    this.firstActionTakenYet = true;\n    const target = this.getHighlightedTile();\n    if (target == null) {\n      return;\n    }\n\n    // clicking a build candidate will try to build with the currently selected cell\n    if (this.world.player.isBuildCandidate(target, this.selectedCell)) {\n      const args: any[] = [];\n      if (this.selectedCell === Transport) {\n        const highlightVector = this.getHighlightVector();\n        const roundedHighlightVector = highlightVector.setLength(1).round();\n        args.push(roundedHighlightVector);\n      }\n      const action: ActionBuild = {\n        type: \"build\",\n        cellType: this.selectedCell,\n        position: target.pos.clone(),\n        args,\n      };\n      this.world.player.setAction(action);\n    } else if (isInteractable(target)) {\n      const action: ActionInteract = {\n        type: \"interact\",\n        interactable: target,\n      };\n      this.world.player.setAction(action);\n      return;\n    }\n  }\n  static expansionTiles: Array<Constructor<Cell>> = [Tissue, Root, Vein];\n}\n\nexport default Mito;\n","import fruitSrc from \"assets/images/fruit.png\";\nimport * as React from \"react\";\nimport { GameResult } from \"..\";\nimport Character from \"../../../common/Character\";\nimport { Fruit } from \"../game/tile\";\nimport { seasonDisplay } from \"../game/world\";\nimport \"./GameResultsScreen.scss\";\n\nfunction Glow() {\n  return (\n    <div className=\"glow\">\n      <span />\n    </div>\n  );\n}\n\ninterface GameResultsScreenProps {\n  onDone: () => void;\n  results: GameResult;\n}\n\nfunction FruitInfo({ fruit }: { fruit: Fruit }) {\n  return (\n    <div className=\"fruit-info\">\n      <div className=\"fruit-visual\">\n        {fruit.isMature() ? <Glow /> : null}\n        <img alt=\"\" src={fruitSrc} />\n      </div>\n      {fruit.isMature() ? (\n        <>\n          <span className=\"matured-info success\">Matured</span>&nbsp;at {fruit.timeMatured}, Mutation Points earned: 1\n        </>\n      ) : (\n        <span className=\"matured-info in-progress\">{(fruit.getPercentMatured() * 100).toFixed(0)}% maturity</span>\n      )}\n      , started {fruit.timeMade}.\n    </div>\n  );\n}\n\nfunction GameWonScreen({ results }: GameResultsScreenProps) {\n  const matureFruit = results.fruits.filter((f) => f.isMature());\n  return (\n    <>\n      <div className=\"character-party-container\">\n        <Character size=\"large\" />\n      </div>\n      <h1>You {matureFruit.length >= 3 ? \"thrived\" : \"survived\"}!</h1>\n      <h2>{results.mutationPointsPerEpoch} Mutation Points earned.</h2>\n      <h5>Fruit Made</h5>\n      <div className=\"fruit-list\">\n        {results.fruits.map((f) => (\n          <FruitInfo fruit={f} />\n        ))}\n      </div>\n    </>\n  );\n}\n\nfunction GameLostScreen({ results }: GameResultsScreenProps) {\n  return (\n    <>\n      <h1>You died!</h1>\n      <div>You survived until {seasonDisplay(results.world.season)}!</div>\n    </>\n  );\n}\n\nexport default function GameResultsScreen({ onDone, results }: GameResultsScreenProps) {\n  return (\n    <div className={`game-results-screen ${results.status}`}>\n      <div className=\"game-results-content\">\n        {results.status === \"won\" ? (\n          <GameWonScreen onDone={onDone} results={results} />\n        ) : (\n          <GameLostScreen onDone={onDone} results={results} />\n        )}\n        <button className=\"done-button\" onClick={onDone}>\n          Continue \n        </button>\n      </div>\n    </div>\n  );\n}\n","import { newBaseSpecies } from \"evolution/species\";\nimport { OverWorld } from \"overworld/overWorld\";\nimport React, { useEffect } from \"react\";\nimport { AppReducerContext, reducer } from \"./reducer\";\nimport { load, saveOnActionMiddleware } from \"./saveLoad\";\nimport { AppState } from \"./state\";\n\nexport interface AppStateProviderProps {\n  children: React.ReactNode;\n  appState: AppState;\n}\n\nexport function AppStateProvider({ children, appState }: AppStateProviderProps) {\n  const reducerWithMiddleware = React.useMemo(() => saveOnActionMiddleware(reducer), []);\n  const reducerTuple = React.useReducer(reducerWithMiddleware, appState);\n  return <AppReducerContext.Provider value={reducerTuple}>{children}</AppReducerContext.Provider>;\n}\n\nexport const LocalForageStateProvider: React.FC<{ loadingComponent: JSX.Element }> = ({\n  children,\n  loadingComponent = null,\n}) => {\n  const [state, setState] = React.useState<AppState | null>(null);\n  useEffect(() => {\n    load()\n      .then((appState) => {\n        console.log(\"loaded\", appState);\n        if (appState) setState(appState);\n      })\n      .catch(() => {\n        console.log(\"caught\");\n        setState(newInitialAppState());\n      });\n  }, []);\n\n  return state == null ? loadingComponent : <AppStateProvider appState={state}>{children}</AppStateProvider>;\n};\n\nexport function newInitialAppState(): AppState {\n  const overWorld = OverWorld.generateRectangle(100, 50);\n  const rootSpecies = newBaseSpecies(\"plantum originus\");\n  // const activeLevel = overWorld.getStartTile();\n  // rootSpecies.freeMutationPoints = 25;\n  // const s3 = newBaseSpecies(\"s3\");\n  // s3.descendants = [newBaseSpecies(\"ya\"), newBaseSpecies(\"no\"), newBaseSpecies(\"whoa\")];\n  // let s: Species;\n  // rootSpecies.descendants = [s = newBaseSpecies(\"foo\"), newBaseSpecies(\"bar\"), s3];\n  // s.descendants = [newBaseSpecies(\"1\"), newBaseSpecies(\"2\")]\n  return {\n    overWorld,\n    rootSpecies,\n    epoch: 0,\n  };\n}\n","import { MousePositionContext } from \"common/useMousePosition\";\nimport OverWorldScreen from \"overworld/OverWorldScreen\";\nimport React from \"react\";\nimport { createSelector } from \"reselect\";\nimport { FullPageSketch } from \"../sketches/fullPageSketch\";\nimport Mito, { GameResult } from \"../sketches/mito\";\nimport GameResultsScreen from \"../sketches/mito/ui/GameResultsScreen\";\nimport { LocalForageStateProvider } from \"./AppStateProvider\";\nimport { AppReducerContext } from \"./reducer\";\nimport { AppState } from \"./state\";\n\ninterface AppComponentState {\n  mousePosition: { x: number; y: number };\n}\n\nclass AppComponent extends React.PureComponent<{}, AppComponentState> {\n  static contextType = AppReducerContext;\n  context!: React.ContextType<typeof AppReducerContext>;\n\n  constructor(props: {}, context: any) {\n    super(props, context);\n    this.state = {\n      mousePosition: { x: window.innerWidth / 2, y: window.innerHeight / 2 },\n    };\n  }\n\n  handleMousePosition = (e: MouseEvent) => {\n    this.setState({\n      mousePosition: { x: e.clientX, y: e.clientY },\n    });\n  };\n\n  componentDidMount() {\n    document.addEventListener(\"mousemove\", this.handleMousePosition);\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener(\"mousemove\", this.handleMousePosition);\n  }\n\n  handleNextEpoch = () => {\n    const [, dispatch] = this.context;\n    dispatch({ type: \"AANextEpoch\" });\n  };\n\n  handleWinLoss = (result: GameResult) => {\n    const [, dispatch] = this.context;\n    dispatch({\n      type: \"AAGetGameResult\",\n      result,\n    });\n  };\n\n  handleResultsDone = () => {\n    const [, dispatch] = this.context;\n    dispatch({\n      type: \"AAGameResultDone\",\n    });\n  };\n\n  render() {\n    return (\n      <MousePositionContext.Provider value={this.state.mousePosition}>\n        <div className=\"App\">\n          {this.maybeRenderOverWorld()}\n          {this.maybeRenderInGame()}\n          {this.maybeRenderGameResult()}\n        </div>\n      </MousePositionContext.Provider>\n    );\n  }\n\n  maybeRenderOverWorld() {\n    const [state] = this.context;\n    if (state.activePopulationAttempt == null) {\n      return <OverWorldScreen onNextEpoch={this.handleNextEpoch} />;\n    }\n  }\n\n  private otherArgsSelector = createSelector(\n    (s: AppState) => s.activePopulationAttempt,\n    (activePopulationAttempt) => [activePopulationAttempt, this.handleWinLoss]\n  );\n\n  maybeRenderInGame() {\n    const [state] = this.context;\n    if (state.activePopulationAttempt != null && state.activeGameResult == null) {\n      return <FullPageSketch sketchClass={Mito} otherArgs={this.otherArgsSelector(state)} />;\n    }\n  }\n\n  maybeRenderGameResult() {\n    const [state] = this.context;\n    if (state.activeGameResult != null) {\n      return <GameResultsScreen results={state.activeGameResult} onDone={this.handleResultsDone} />;\n    }\n  }\n}\n\nconst App = () => (\n  <LocalForageStateProvider loadingComponent={<div>Loading...</div>}>\n    <AppComponent />\n  </LocalForageStateProvider>\n);\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === \"localhost\" ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === \"[::1]\" ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === \"production\" && \"serviceWorker\" in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL((process as { env: { [key: string]: string } }).env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener(\"load\", () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            \"This web app is being served cache-first by a service \" +\n              \"worker. To learn more, visit https://bit.ly/CRA-PWA\"\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === \"installed\") {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                \"New content is available and will be used when all \" +\n                  \"tabs for this page are closed. See https://bit.ly/CRA-PWA.\"\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log(\"Content is cached for offline use.\");\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch((error) => {\n      console.error(\"Error during service worker registration:\", error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then((response) => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get(\"content-type\");\n      if (response.status === 404 || (contentType != null && contentType.indexOf(\"javascript\") === -1)) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then((registration) => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\"No internet connection found. App is running in offline mode.\");\n    });\n}\n\nexport function unregister() {\n  if (\"serviceWorker\" in navigator) {\n    navigator.serviceWorker.ready.then((registration) => {\n      registration.unregister();\n    });\n  }\n}\n","import React from \"react\";\nimport { World } from \"../sketches/mito/game\";\nimport { Temperate, Environment, Rocky, Desert } from \"../sketches/mito/game/environment\";\nimport { Tile, Air, Soil, Rock, Fountain } from \"../sketches/mito/game/tile\";\nimport { hasInventory } from \"../sketches/mito/inventory\";\nimport { PlotData, Layout } from \"plotly.js\";\nimport { findBuildCandidateTiles } from \"../sketches/mito/game/worldUtils\";\nimport { newBaseSpecies } from \"../evolution/species\";\n\ntype Visitor = (tiles: Tile[], world: World) => number;\ninterface Visitors {\n  [name: string]: Visitor;\n}\n\nfunction visit(world: World, visitors: Visitors): Trial {\n  const tiles = Array.from(world.environmentTiles());\n  const results: Trial = {};\n  for (const [name, visitor] of Object.entries(visitors)) {\n    const result = visitor(tiles, world);\n    results[name] = result;\n  }\n  return results;\n}\n\ninterface Trial {\n  [key: string]: number;\n}\nclass Experiment {\n  trials: Trial[] = [];\n  constructor(public visitors: Visitors) {}\n  recordDataFor(world: World) {\n    const trial = visit(world, this.visitors);\n    this.trials.push(trial);\n  }\n  visitorNames() {\n    return Object.keys(this.visitors);\n  }\n}\n\nclass ExperimentSuite {\n  constructor(public experiments: Experiment[]) {}\n\n  recordDataFor(world: World) {\n    for (const e of this.experiments) {\n      e.recordDataFor(world);\n    }\n  }\n}\n\nfunction runTests(environmentFn: () => Environment, id: string) {\n  console.log(\"running\");\n  const suite = new ExperimentSuite([\n    new Experiment({\n      countAir: (t) => t.filter((tile) => tile.constructor === Air).length,\n    }),\n    new Experiment({\n      countSoil: (t) => t.filter((tile) => tile.constructor === Soil).length,\n    }),\n    new Experiment({\n      countRock: (t) => t.filter((tile) => tile.constructor === Rock).length,\n    }),\n    new Experiment({\n      countFountain: (t) => t.filter((tile) => tile.constructor === Fountain).length,\n    }),\n    new Experiment({\n      playerY: (_, w) => w.player.pos.y,\n    }),\n    new Experiment({\n      startAdjacentWaters: (_, w) => {\n        const adjacentTiles = findBuildCandidateTiles(w, (t) => t instanceof Soil);\n        let water = 0;\n        for (const t of adjacentTiles) {\n          if (hasInventory(t)) {\n            water += t.inventory.water;\n          }\n        }\n        return water;\n      },\n    }),\n    new Experiment({\n      countWaters: (t) => {\n        return t.reduce((w, tile) => w + (hasInventory(tile) ? tile.inventory.water : 0), 0);\n      },\n    }),\n  ]);\n  for (let i = 0; i < 20; i++) {\n    console.time(\"trial \" + i);\n    const world = new World(environmentFn(), newBaseSpecies());\n    suite.recordDataFor(world);\n    console.timeEnd(\"trial \" + i);\n  }\n\n  plotStackedBar(suite.experiments.slice(0, 4), id);\n\n  for (const e of suite.experiments) {\n    plotHistogram(e, id);\n  }\n}\n\nfunction plotStackedBar(experiments: Experiment[], divId: string) {\n  const data = [];\n  const names = experiments.map((e) => e.visitorNames().join(\"\"));\n  for (const idx in names) {\n    const name = names[idx];\n    const x = [];\n    const y = [];\n    for (let i = 0; i < experiments[0].trials.length; i++) {\n      x.push(i);\n\n      const e = experiments[idx];\n      const trial = e.trials[i];\n      const value = trial[name];\n      y.push(value);\n    }\n    const trace: Partial<PlotData> = {\n      x,\n      y,\n      name,\n      type: \"bar\",\n    };\n    data.push(trace);\n  }\n  var layout: Partial<Layout> = { barmode: \"stack\" };\n\n  const div = document.createElement(\"div\");\n  const el = document.getElementById(divId)!;\n  el.appendChild(div);\n  window.Plotly.newPlot(div, data, layout);\n}\n\nfunction plotHistogram(stats: Experiment, divId: string) {\n  const data = [];\n  const layout: Partial<Layout> = {};\n\n  for (const name of stats.visitorNames()) {\n    var trace: Partial<PlotData> = {\n      x: stats.trials.map((t) => t[name]),\n      type: \"histogram\",\n      name: name,\n    };\n    data.push(trace);\n\n    layout.title = {\n      text: name,\n    };\n  }\n  const div = document.createElement(\"div\");\n  const el = document.getElementById(divId)!;\n  el.appendChild(div);\n  div.style.height = \"240px\";\n  div.style.width = \"320px\";\n  div.style.display = \"inline-block\";\n  window.Plotly.newPlot(div, data, layout);\n}\n\nfunction TestStats() {\n  React.useEffect(() => {\n    var script = document.createElement(\"script\");\n    script.src = \"https://cdn.plot.ly/plotly-latest.min.js\";\n    script.addEventListener(\"load\", function() {\n      runTests(Temperate, \"temperate\");\n      runTests(Rocky, \"rocky\");\n      runTests(Desert, \"desert\");\n    });\n\n    document.body.appendChild(script);\n  }, []);\n\n  return (\n    <div>\n      <h1>Experiments</h1>\n      <div id=\"temperate\">\n        <h2>Temperate</h2>\n      </div>\n      <div id=\"rocky\">\n        <h2>Rocky</h2>\n      </div>\n      <div id=\"desert\">\n        <h2>Desert</h2>\n      </div>\n    </div>\n  );\n}\n\nexport default TestStats;\n","import { World } from \".\";\n\nimport { Tile, Tissue } from \"./tile\";\n\nexport function findBuildCandidateTiles(world: World, predicate?: (tile: Tile) => boolean) {\n  const entityPredicate: (tile: Tile) => boolean = (t) => world.player.isWalkable(t);\n  const candidates: Set<Tile> = new Set();\n  for (const entity of world.entities()) {\n    if (entity instanceof Tile && entityPredicate(entity)) {\n      for (const [, neighbor] of world.tileNeighbors(entity.pos)) {\n        if (!(neighbor instanceof Tissue) && !neighbor.isObstacle) {\n          if (predicate == null) {\n            candidates.add(neighbor);\n          } else if (predicate(neighbor)) {\n            candidates.add(neighbor);\n          }\n        }\n      }\n    }\n  }\n  return candidates;\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"react-dropdown/style.css\";\nimport { HashRouter, Redirect, Route, Switch } from \"react-router-dom\";\nimport App from \"./app/App\";\nimport \"./index.scss\";\nimport * as serviceWorker from \"./serviceWorker\";\nimport TestStats from \"./tests/TestStats\";\nimport { TestWinScreen } from \"./tests/TestWinScreen\";\n\nReactDOM.render(\n  <HashRouter>\n    <Switch>\n      <Route path=\"/test-win\">\n        <TestWinScreen />\n      </Route>\n      <Route path=\"/test-stats\">\n        <TestStats />\n      </Route>\n      <Route exact path=\"/\">\n        <App />\n      </Route>\n      <Route path=\"*\">\n        <Redirect to=\"/\" />\n      </Route>\n    </Switch>\n  </HashRouter>,\n\n  document.getElementById(\"root\")\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n","import React from \"react\";\nimport { Vector2 } from \"three\";\nimport { newBaseSpecies } from \"../evolution/species\";\nimport { GameResult } from \"../sketches/mito\";\nimport { World } from \"../sketches/mito/game\";\nimport { Temperate } from \"../sketches/mito/game/environment\";\nimport { Fruit } from \"../sketches/mito/game/tile\";\nimport GameResultsScreen from \"../sketches/mito/ui/GameResultsScreen\";\n\nexport function TestWinScreen() {\n  const world = new World(Temperate(), newBaseSpecies());\n  world.time = 150;\n  const f1 = new Fruit(new Vector2(0, 0), world);\n  f1.committedResources.add(50, 50);\n  f1.timeMatured = 250;\n\n  world.time = 479;\n  const f2 = new Fruit(new Vector2(0, 0), world);\n  f2.committedResources.add(25, 15);\n\n  world.time = 1296;\n  const f3 = new Fruit(new Vector2(0, 0), world);\n  f3.committedResources.add(50, 50);\n  const mockResults: GameResult = {\n    status: \"won\",\n    fruits: [f1, f2, f3],\n    mutationPointsPerEpoch: 2,\n    world,\n  };\n  return <GameResultsScreen results={mockResults} onDone={() => {}} />;\n}\n","module.exports = __webpack_public_path__ + \"static/media/fruit.e136487f.png\";","module.exports = __webpack_public_path__ + \"static/media/mito-base.28ee2cbb.mp3\";","module.exports = __webpack_public_path__ + \"static/media/mito-strings.9f30639c.mp3\";","module.exports = __webpack_public_path__ + \"static/media/mito-drums.1c82b4f4.mp3\";","module.exports = __webpack_public_path__ + \"static/media/footsteps.636605b0.wav\";","module.exports = __webpack_public_path__ + \"static/media/build.a2067d20.wav\";","module.exports = __webpack_public_path__ + \"static/media/Blop-Mark_DiAngelo-79054334.627c0e8b.mp3\";","module.exports = __webpack_public_path__ + \"static/media/suckwater.b0fe81fa.wav\";","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAQCAYAAADJViUEAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAACXBIWXMAAAsTAAALEwEAmpwYAAACC2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS40LjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyI+CiAgICAgICAgIDx0aWZmOlJlc29sdXRpb25Vbml0PjI8L3RpZmY6UmVzb2x1dGlvblVuaXQ+CiAgICAgICAgIDx0aWZmOkNvbXByZXNzaW9uPjE8L3RpZmY6Q29tcHJlc3Npb24+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiAgICAgICAgIDx0aWZmOlBob3RvbWV0cmljSW50ZXJwcmV0YXRpb24+MjwvdGlmZjpQaG90b21ldHJpY0ludGVycHJldGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KD0UqkwAAAM1JREFUKBVjYBgowIjL4v50+/8wucKZB7GqwxCEadJSkYfpZbh25yGYjW4IimaQRpimSbL8cM15jz+C2SBDkA1ggqtAYiBrBAmj82FK4TbDbF2qowSWe/vxLUwNgzC/MJgdfeUe2Asw27HajKwRpAudDzMVq2aYJCGaepr5JSH+hfkRZjOMD5OHicMDDCSAHmgwRSAaPbBAYhjOBpmehQhokBowH91WkDiKzSABWAqztHUEccHg+OH9YBoWRVBhTM0wCZghID66JpgaimgAWfxCZhIsrg0AAAAASUVORK5CYII=\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAsCAYAAABloJjNAAAFJklEQVRIS62We2xTVRzHv+e2ty0bfa223VMjMEjWTXyuBmOIsCiYIGCMRpYoiSYIGjSOmGE0gCSogcnDR0biwIQoCmqmLg4msP2xBLYYQmCj4GOKjLmue/Tlut3b3mPOvbT3di2tiTt/9fZ3ft/+fp/z7e9cgv+wpt4nFD7A9Bkl+bbn3SDshqriA/hDyJmTX7B7JSVn25XCZkOQ6YjdKyla2sEfzl0d25u1Qi0zzyflFJJKrv+VQZKLaYaguBs0le4DFteUQppWFS9wfujIzS1ZEKQEaa+5k9RGHhG7V1CcPZFiVrOoBPuqpuTn1/qNuPDQ3dCdU+PskJK5GS2roiqzo2230R19elnw7YUC6p8cJ2L34xQtP8pMtWJZGXZ13kFPBubKAkvMUTQOJABJpfBBtQFdgQI5XmcLYfmjg2nYMhhuPeaha0qikKZFtEcd+PqPsTSGa+c58ExFFJFoHB3RIuxceym7IO2x9BFvuJoJPuscg5MXcWCoGK3XxnG4JiZXtP6CCUxwc+kwAiKPowEH3n26nyRzszC0fH8maFl1KmiFw12IZYnr6IuK2HVZYbi1UkCN3Yjjo0WwOubgvrgfdfbQD6Q2/ETSGWnl0nPmhq5J+56OUbMcX2oN45fYNJqv8fLzhnIB1UWFOBUoTDFcZgltIQ9GmjIEaY/lC+INr2MtP1UcAp+I45uwC8cHRrFrnmKbRp9Bbnl9RRDBSYq2sENmmMxNa5n2WPzEG3YzwRfcAbh5EbsGS9F6fQKt90zKgqt7FYZvlg/BL/Jo8TuTDOXcTIY9ls9PBy3rToessDsLsFS6AV9UwHs+heEbCwR47Ca0jtlhsZvwgOTHcluYdVafnWGPZVtX1La9Y0xhyHx2ZVLAx38qgi9XCPAUFSLp0+XWEBPcTrzhHdkYniLecJ1sG/cECiHiSKgEx34fxUcLFdtsumSUW95YMYbxGPBt2Il31sgM5dyZDIeJN1zMBF90j8AlMyzDsZ9HcGKFiFW9JllUYXgDIyKPT/2uJEM5NwtDc/OZkHUD86G1yISH8TcuRwQ0XVVaZqvlfg5t43bMtRpRiwDqbMGDxBt5KTvDXuuezoi14aebDB+zhXA1No39A4oPN98u4AYpQTyujDPGeJkt0kRqQ1syGfZaL5La0F2s5eddo7Dp4zg4UY6vfgvgiEexTf15xTY6HYd6xwi+DLmxY/VFQm/mZrTMvmCCz7lGYdfHsX+oGMfPj0Bv06VaZoKvlg7LMbbYfzkVzHYFnO4op4yh2WbEEoxgU7+UNm2a79XjZNCKArMBkxEhtyDtMTdX91o2SII6/xoqRTT9qjB8/U4Be/8ygiY0t0TD0C3Hl3z0VftKqTSl3iGckcN3ixWGzDqE50BFNX6lcTh3y/MbnZTXMItHJOjNXApTYlKCrkB9ziuYrULtrZe3Qs+HZTQtwcCBCmpLMwWInoDGVYaEI6CaO4dU7S+jUiyRaokzcZjJMFeFGT8wv9FFeZvKJIPZPxJ0hWpcilFwc9RzYI7gDOrz7FfoOVCWZhNi5EA1rx7EQEA1viQ8ARVVhtARQOPL2a9wwVsuqp+r9RmFrkBlkohR6LTMpik4oxpn1bKqU9Nm1k+5ijHU2saogzStsZGBg5TLlzqS9t+efYaV29w0jdEUBWe6tc+oCBBl+MiLxgGi3hCY/Qq105Z9rm6uoJqXYuUtXGO7mfv7Nl7PPb6q9mbOw5zTZmueebhoZzHVMpnJiCYAol4xuJJP8P9W+C+xZd+qpRkU/AAAAABJRU5ErkJggg==\"","module.exports = __webpack_public_path__ + \"static/media/roguelikeSheet_transparent.3c15bcea.png\";"],"sourceRoot":""}