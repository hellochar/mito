{"version":3,"sources":["sketches/sketch.ts","sketches/sketchComponent.tsx","sketches/fullPageSketch.tsx","math/index.ts","sketches/mito/audio.ts","sketches/mito/inventory.ts","sketches/mito/params.ts","common/perlin.ts","sketches/mito/directions.ts","common/capitalize.ts","evolution/traits.ts","sketches/mito/game/tile.ts","sketches/mito/game/player.ts","sketches/mito/game/world.ts","sketches/mito/game/entity.ts","sketches/mito/keymap.ts","sketches/mito/ui/Instructions.tsx","sketches/mito/ui/GameStack.tsx","sketches/mito/ui/HoveredTileInfo.tsx","common/lazy.ts","sketches/mito/spritesheet.ts","sketches/mito/renderers/Renderer.tsx","sketches/mito/renderers/resourceParticles.ts","sketches/mito/renderers/InventoryRenderer.tsx","sketches/mito/renderers/TileRenderer.tsx","sketches/mito/ui/CellBar.tsx","common/Expand.tsx","evolution/TraitDisplay.tsx","sketches/mito/ui/HUD.tsx","sketches/mito/game/environment.ts","sketches/mito/tutorial/sceneObject.tsx","sketches/mito/ui/ParamsGUI.tsx","sketches/mito/tutorial/Animate.tsx","sketches/mito/tutorial/tileHighlight.tsx","sketches/mito/tutorial/PointHighlight.tsx","sketches/mito/ui/Hover.tsx","sketches/mito/renderers/PlayerRenderer.tsx","sketches/mito/renderers/TransportRenderer.tsx","sketches/mito/renderers/WorldRenderer.tsx","sketches/mito/index.tsx","overworld/hexMath.ts","overworld/OverWorldPopover.tsx","common/Button.tsx","common/MP.tsx","overworld/HexTileInfo.tsx","evolution/GeneDisplay.tsx","evolution/GenesToTraits.tsx","evolution/SpeciesPopoverDetails.tsx","common/Character.tsx","evolution/SpeciesNode.tsx","evolution/PhylogeneticTree.tsx","evolution/mutation.ts","evolution/MutationScreen.tsx","overworld/OverWorldMap.tsx","overworld/hexTile.ts","overworld/hexStore.ts","overworld/overWorld.ts","sketches/mito/ui/GameResultsScreen.tsx","evolution/species.ts","App.tsx","serviceWorker.ts","tests/TestStats.tsx","sketches/mito/game/worldUtils.ts","index.tsx","tests/TestWinScreen.tsx","assets/images/fruit.png","assets/audio/mito-base.mp3","assets/audio/mito-strings.mp3","assets/audio/mito-drums.mp3","assets/audio/footsteps.wav","assets/audio/build.wav","assets/audio/Blop-Mark_DiAngelo-79054334.mp3","assets/audio/suckwater.wav","assets/images/roguelikeSheet_transparent.png","assets/images/character.png"],"names":["UI_EVENTS","click","contextmenu","dblclick","mousedown","mouseup","mousemove","touchstart","touchmove","touchend","keyup","keydown","keypress","wheel","ISketch","renderer","audioContext","Object","classCallCheck","this","elements","events","timeElapsed","frameCount","createClass","key","get","domElement","height","width","THREE","id","SketchSuccessComponent","props","_this","possibleConstructorReturn","getPrototypeOf","call","frameId","lastTimestamp","stop","loop","timestamp","millisElapsed","sketch","animate","e","console","error","setState","requestAnimationFrame","handleWindowResize","updateRendererCanvasToMatchParent","resize","state","_this2","window","addEventListener","canvas","tabIndex","keys","forEach","eventName","callback","eventsOnBody","document","body","sketchElementsWithKey","render","push","apply","toConsumableArray","react","className","map","el","idx","React","_this3","destroy","cancelAnimationFrame","dispose","removeEventListener","parent","parentElement","setSize","clientWidth","clientHeight","SketchComponent","_React$Component2","_getPrototypeOf2","_this4","_len","arguments","length","args","Array","_key","concat","status","type","volumeEnabled","JSON","parse","localStorage","getItem","userVolume","handleContainerRef","ref","AudioContextConstructor","AudioContext","webkitAudioContext","setContext","createGain","gain","setValueAtTime","connect","destination","handleVisibilityChange","alpha","preserveDrawingBuffer","antialias","appendChild","otherArgs","construct","sketchClass","remove","close","handleVolumeButtonClick","setItem","stringify","hidden","suspend","resume","inherits","value","_this$props","containerProps","errorElement","objectWithoutProperties","classnames","assign","renderSketchOrStatus","renderVolumeButton","sketchComponent_SketchSuccessComponent","renderDefaultErrorElement","message","onClick","index_esm","FullPageSketch","_React$Component","handleDivRef","div","exitFullscreen","sketchComponent_SketchComponent","webkitExitFullscreen","mozCancelFullScreen","lerp2","v","t","l","x","y","xStart","xStop","yStart","yStop","a","b","lerp","mito","strings","drums","footsteps","build","blopBuffer","suckWaterBuffer","sourceElement","src","substr","source","createElement","makeNodeOfAudioAsset","ctx","audio","autoplay","srcs","_i","_srcs","createMediaElementSource","fpref","Math","round","Inventory","capacity","carrier","water","undefined","sugar","validate","other","amountWater","amountSugar","Error","min","spaceNeeded","spaceAvailable","space","floor","change","emit","name","fn","EventEmitter","on","off","newWater","newSugar","warn","hasInventory","obj","inventory","PARAMS_DEFAULT","isRealtime","environment","cellEnergyMax","tissueInventoryCapacity","rootTurnsPerTransfer","leafReactionRate","leafSugarPerReaction","cellGestationTurns","cellDiffusionWater","cellDiffusionSugar","soilDarknessBase","soilDiffusionType","soilDiffusionWater","veinDiffusion","soilMaxWater","droop","fountainTurnsPerWater","fountainAppearanceRate","transportTurnsPerMove","sunlightReintroduction","sunlightDiffusion","maxResources","params","objectSpread","location","hash","urlHashParams","decodeURI","updateParamsHash","nonDefaultParams","_keys","k","encodeURI","Grad","z","grad3","p","F2","sqrt","G2","G3","Noise","seed","random","perm","gradP","octaveNum","octaveFalloff","octaveMatrix2","cos","sin","i","xin","yin","i1","j1","s","j","x0","y0","x1","y1","x2","y2","gi0","gi1","gi2","t0","t1","t2","dot2","sum","scalar","simplex2","newX","newY","zin","k1","i2","j2","k2","z0","z1","z2","x3","y3","z3","gi3","t3","dot3","simplex3","X","Y","n00","n01","n10","n11","u","fade","Z","n000","n001","n010","n011","n100","n101","n110","n111","w","DIRECTIONS","nw","Vector2","sw","n","ne","se","DIRECTION_VALUES","o","capitalize","toLocaleUpperCase","TRAIT_TYPES","carryCapacity","energyEfficiency","photosynthesis","rootAbsorption","structuralStability","activeTransportSugar","activeTransportWater","walkSpeed","diffuseWater","diffuseSugar","buildTime","displayName","trait","splits","split","addTraits","modifier","traitType","getTraits","genes","traits","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","Symbol","iterator","next","done","getTraitInfluence","err","return","gene","traitDiff","traitTypePlus","dnaPairToTraitType","traitTypeMinus","dnaTuple","traitMod","val","base","exponent","pow","hasEnergy","energy","Tile","pos","world","isObstacle","darkness","Infinity","temperature","nextTemperature","timeMade","clone","time","constructor","diffusionWater","diffusionSugar","fallAmount","max","neighbors","tileNeighbors","stepDarkness","stepDiffusion","stepGravity","Cell","minDarkness","_ref3","slicedToArray","contrib","darknessFromNeighbor","Rock","cellHere","cellAt","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","_ref6","_ref5","dir","tile","canDiffuse","averageTemperature","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_step3","_iterator3","_ref9","size","season","_dir","canPullResources","giver","diffusionAmount","give","waterDiff","chanceToHappenScalar","lowerNeighbor","tileAt","receiver","recieverType","giverType","allowPull","Soil","Air","noiseCo2","_Tile","sunlightCached","_co2","assertThisInitialized","computeCo2","floorCo2","scaleX","offset","perlin3","sunlight","stepEvaporation","add","esm_get","prototype","_Tile2","waterGravityPerTurn","_this$world$environme","evaporationRate","evaporationBottom","evaporationHeightScalar","evaporationAmountScalar","_Tile3","DeadCell","_Tile4","Fountain","_Soil","turnsPerWater","cooldown","_Tile5","_getPrototypeOf3","_this5","_len3","_key3","droopY","from","values","neighborsAndSelf","_iteratorNormalCompletion4","_didIteratorError4","_iteratorError4","_step4","_iterator4","stepEat","energeticNeighbors","filter","_iteratorNormalCompletion5","_didIteratorError5","_iteratorError5","_step5","_iterator5","neighbor","energyTransfer","stepDroop","player","equals","maybeRemoveCellAt","setTileAt","Fruit","wantedEnergy","energyToSugarConversion","sugarToEat","gotEnergy","below","belowLeft","belowRight","left","right","above","aboveLeft","aboveRight","droopAmount","hasSupportBelow","_arr","cell","springNeighborCells","reduce","turnsToBuild","GrowingCell","_Cell","completedCell","_this6","timeRemaining","timeToBuild","Tissue","_Cell2","_this7","Leaf","_Cell3","_getPrototypeOf4","_this8","_len5","_key5","averageEfficiency","averageSpeed","didConvert","sugarConverted","tilePairs","numAir","_iteratorNormalCompletion6","_didIteratorError6","_iteratorError6","_step6","_iterator6","_ref12","_ref11","oppositeTile","air","tissue","speed","efficiency","co2","bestEfficiencyWater","waterToConvert","chance","Root","_Cell4","_getPrototypeOf5","_this9","_len7","_key7","waterTransferAmount","activeNeighbors","stepWaterTransfer","_iteratorNormalCompletion7","_didIteratorError7","_iteratorError7","_step7","_iterator7","_ref15","_ref14","_Cell5","_this10","committedResources","neededResources","timeMatured","handleGetResources","isMature","_iteratorNormalCompletion8","_didIteratorError8","_iteratorError8","_step8","_iterator8","_ref18","wantedWater","wantedSugar","commitResources","r","isFractional","Transport","_Tissue","_this11","cooldownWater","cooldownSugar","waterToTransport","sugarToTransport","turnsPerSugar","targetTile","getTarget","fromTile","getFrom","Vein","_Tissue2","_getPrototypeOf6","_this12","_len9","_key9","Player","posFloat","action","mapActions","actions","event","cb","mappedAction","actionSuccessful","attemptAction","maybeMoveWithTransports","currentTile","setLength","attemptStill","attemptMove","attemptBuild","attemptDeconstruct","attemptDrop","attemptPickup","attemptMultiple","target","isWalkable","isValidPosition","verifyMove","currentTime","cancelScheduledValues","linearRampToValueAtTime","context","position","cellType","newTile","exponentialRampToValueAtTime","args1","args2","every","_","index","argsEq","existingCell","isMeaningfulBuild","force","matureCell","tryConstructingNewCell","refund","multiple","allSuccess","StepStats","deleted","added","SEASON_ORDER","TIME_PER_YEAR","TIME_PER_SEASON","World","species","gridEnvironment","gridCells","neighborCache","wipResult","cachedEntities","stepStats","fruits","fill","__","fillFunction","playerX","firstSoil","find","distanceTo","computeTileNeighbors","fillCachedEntities","percent","xOrVec2","oldTile","oldCell","oldEnvironmentTile","handleTileUpdated","maybeCell","px","py","mapping","Map","DIRECTION_VALUES_RAND","set","newEntities","reverse","entities","entity","step","computeSunlight","stepWeather","climate","turnsBetweenRainfall","rainDuration","randInt","waterPerDroplet","sunAngle","PI","directionalBias","sunAmount","atan","environmentTileAt","tileUp","tileRight","tileLeft","upSunlight","rightSunlight","leftSunlight","f","self","defineProperty","regenerator_default","mark","_callee","row","wrap","_context","prev","finish","shuffle","array","temporaryValue","randomIndex","currentIndex","slice","ACTION_KEYMAP","q"," ","MOVEMENT_KEYS","d","Instructions","_React$PureComponent","play","toFixed","renderCredit","href","rel","GameStack","handlePlay","instructionsOpen","Instructions_Instructions","HoveredTileInfo","tileInfo","inventoryInfo","cellInfo","growingCellInfo","rootInfo","leafInfo","airInfo","fountainInfo","energyInfo","waterInfo","sugarInfo","lazy","cache","spriteSize","spritesheetLoaded","SPRITESHEET","load","roguelikeSheet_transparentSrc","dispatchEvent","fruitTexture","fruitSrc","textureFromSpritesheet","backgroundColor","drawSpriteToCanvas","image","getContext","fillStyle","fillRect","drawImage","texture","needsUpdate","magFilter","flipY","wrapS","wrapT","Renderer","scene","ResourceParticles","_Points","geometry","material","newGeometry","ResourceParticleMaterial","frustumCulled","BufferGeometry","positions","Float32Array","BUFFER_SIZE","sizes","addAttribute","BufferAttribute","setDynamic","attributes","setXYZ","setX","setDrawRange","Points","uniforms","opacity","sizeGlobal","color","vertexShader","fragmentShader","depthTest","transparent","ShaderMaterial","InventoryRenderer","_Renderer","animationOffset","waters","sugars","wantedMeshes","ceil","sub","handleGiveResources","splice","newParticle","WaterParticles","startFrame","SugarParticles","endFrame","resource","particles","resourceArray","commit","fract","resources","vx","vy","angle","performance","now","goTowardsCenterStrength","playerY","offsetX","offsetY","mag2","avoidPlayerStrength","dx","dy","lengthSq","strength","updateNumParticles","simulateResourcePositions","commitParticles","Color","TileMesh","_Mesh","materialMapping","Mesh","PlaneBufferGeometry","TileRenderer","mesh","inventoryRenderer","originalColor","lastAudioValueTracker","pairsLines","worldDomElement","growingRenderer","scale","zIndex","matrixAutoUpdate","updateMatrix","Audio","audioListener","fruit","addWorldDOMElement","react_default","getPercentMatured","targetScale","ONE","lightAmount","mat","colorIndex","AIR_COLORSCALE","startColorIndex","startColor","endColor","HOT_COLOR","COLD_COLOR","update","newAudioValueTracker","setBuffer","dist","distanceToSquared","volume","setVolume","baseVolume","pairColor","getHex","pairs","line","arrowDir","Vector3","normalize","arrowHelper","makeLine","multiplyScalar","hasActiveNeighbors","lines","ArrowHelper","isArray","origin","Line","lineGeometry","LineBasicMaterial","copy","quaternion","axis","radians","acos","setFromAxisAngle","removeWorldDOMElement","g","Float32BufferAttribute","materials","MeshBasicMaterial","side","DoubleSide","depthWrite","CellBarItem","_ref2","isSelected","style","getStyle","url","HTMLCanvasElement","toDataURL","Image","backgroundImage","classNames","selected","HotkeyButton","hotkey","restProps","preventDefault","getElementsByTagName","focus","ensureCanvasFocus","CellBar","_ref","bar","onIndexClicked","String","Expand","children","shrunkElements","_useState","useState","_useState2","expanded","setExpanded","TraitDisplay","nonzeroTraits","sort","nonzeroTraitEl","green","red","zeroTraits","zeroTraitEl","common_Expand","BarMarker","SeasonBead","SeasonsTracker","yearDonePercent","month","HUD","traitsPanelOpen","tutorialRef","isFinished","isMaxed","isMaxedEl","HUD_SeasonsTracker","maybeRenderTraits","renderInventoryBar","renderInventory","ui_CellBar","cellBar","cellBarIndex","setCellBarIndex","top","textAlign","background","padding","evolution_TraitDisplay","waterPercent","sugarPercent","emptyPercent","waterStyles","sugarStyles","emptyStyles","Temperate","noiseWater","noiseRock","noiseHeight","soilLevel","perlin2","rockThreshold","isRock","heightScalar","simplexValue","emitWaterScalar","Desert","Rocky","ALL_ENVIRONMENTS","SceneObject","object","Animate","rafid","Component","TILE_HIGHLIGHT","edgesGeometry","lineSegments","TileHighlight","Animate_Animate","setScalar","sceneObject_SceneObject","POINT_HIGHLIGHT","PointHighlight","Hover","highlightedTile","highlightedPosition","getHighlightPosition","HoveredTileInfo_HoveredTileInfo","tutorial_PointHighlight","maybeRenderTileHighlight","tileHighlight","PlayerRenderer","droopPosFloat","TransportRenderer","_TileRenderer","arrow","makeArrow","WorldRenderer","renderers","deleteDeadEntityRenderers","createSelector","stats","deletedEntities","delete","created","createRendererFor","getLastStepStats","getOrCreateRenderer","WorldDOMElement","positionFn","renderFn","worldPosition","pixelPosition","worldToScreen","Mito","_ISketch","level","onWinLoss","Scene","camera","OrthographicCamera","mouse","mouseDown","mouseButton","firstActionTakenYet","keyMap","Set","clientX","clientY","button","repeat","handleKeyDown","shiftKey","delta","deltaX","deltaY","newZoom","zoom","updateProjectionMatrix","worldRenderer","indexOf","charCodeAt","worldDomElements","info","lookAt","numDone","oneMoreLoaded","mitoBaseSrc","oncanplaythrough","mitoStringsSrc","mitoDrumsSrc","footstepsSrc","buildSoundSrc","loader","blopSrc","audioBuffer","xhr","suckWaterSrc","hookUpAudio","updateAmbientAudio","worldDomElementComponents","HUD_HUD","GameStack_GameStack","Hover_Hover","yPos","drumVolume","stringsVolume","log","memory","geometries","textures","programs","calls","points","triangles","yes","no","traverse","gameResult","maybeGetGameResult","getHighlightVector","_this$world$player$po","screen","project","moveAction","keysToMovement","setAction","handleLeftClick","handleRightClick","worldStep","getAction","getHighlightedTile","mouseNorm","getCameraNormCoordinates","Boolean","search","debug","logRenderInfo","h","aspect","bottom","isBuildCandidate","selectedCell","roundedHighlightVector","expansionTiles","dX","dY","_tile$cartesian","cartesian","innerWidth","innerHeight","OverWorldPopover","_pixelPosition","_pixelPosition2","container","Button","MP","amount","total","Fragment","gi_index_esm","HexTileInfo","onClickPlay","_tile$info","flora","playButtonElement","Button_Button","header","common_MP","mutationPointsPerEpoch","stringifyInfo","expand","fontSize","GeneComponent","title","alt","GeneDisplay","geneContent","GenesToTraits","useMemo","evolution_GeneDisplay","SpeciesPopoverDetails","onMutate","evolution_GenesToTraits","freeMutationPoints","Character","otherProps","characterSrc","SpeciesNode","handleOnMutate","setPopoverIsOpen","_React$useState","_React$useState2","popoverIsOpen","descendants","SpeciesNode_SpeciesNode","popoverBody","evolution_SpeciesPopoverDetails","react_popover_default","isOpen","preferPlace","onOuterAction","common_Character","PhylogeneticTree","rootSpecies","evolution_SpeciesNode","mutatePosition","geneStr","join","strToGene","old","randomDNA","randomNewDNA","charAt","str","randomDNATuple","MutationScreen","onCommit","pool","setPool","_React$useState3","_React$useState4","newSpecies","setNewSpecies","_React$useState5","_React$useState6","clickMode","setClickMode","isSwapping","isRerolling","newGeneCost","swap","gene1","position1","gene2","position2","geneIndex1","geneIndex2","newGenes","_mutateSwapDNA","gene1Str","gene2Str","dnaPosition1","dnaPosition2","newGeneStr1","newGeneStr2","mutateSwapDNA","_mutateSwapDNA2","newGene1","newGene2","isGenesChanged","genes1","genes2","some","click-mode-active","disabled","is-cancel","geneIndex","newGene","reroll","p1","onChange","C","OverWorldMap","rafId","handleCanvasRef","handleResize","handleCanvasClick","overWorld","cX","cY","nativeEvent","pxX","pxY","rounded","rx","ry","rz","x_diff","abs","y_diff","z_diff","roundCubeCoordinates","getClickedHexTile","cameraState","visible","handleStartMutate","activelyMutatingSpecies","handleCommit","newPool","onPlayLevel","toggleLeftPanelOpen","leftPanelOpen","code","newPressedKeys","pressedKeys","handleKeyUp","drawMap","updateCamera","clearRect","drawTile","maybeRenderHighlightedTile","maybeRenderPhylogeneticTreePanel","maybeRenderMutationModal","maybeMutationScreen","evolution_MutationScreen","lib_default","ariaHideApp","onRequestClose","open","evolution_PhylogeneticTree","overworld_OverWorldPopover","overworld_HexTileInfo","drawHex","c","strokeStyle","beginPath","moveTo","lineTo","closePath","stroke","colorScale","scaleLinear","domain","range","font","textBaseline","fillText","HexTile","rainfall","soilType","wind","HexStore","tiles","_Symbol$iterator","OverWorld","storage","startTile","hookUpNeighbors","magnitude","noise","noise3D","_tile$cartesian2","randomHeight","maxDist","SimplexNoise","populateLevelInfo","_tile$cartesian3","overWorld_Symbol$iterator","Glow","FruitInfo","GameWonScreen","results","matureFruit","GameLostScreen","GameResultsScreen","_ref4","onDone","newBaseSpecies","App","handlePlayLevel","activeLevel","handleWinLoss","result","activeGameResult","handleResultsDone","generateRectangle","maybeRenderOverWorldMap","maybeRenderLevel","maybeRenderGameResult","OverWorldMap_OverWorldMap","fullPageSketch_FullPageSketch","GameResultsScreen_GameResultsScreen","PureComponent","hostname","match","Experiment","visitors","trials","trial","environmentTiles","_Object$entries","entries","visitor","visit","ExperimentSuite","experiments","recordDataFor","runTests","environmentFn","suite","countAir","countSoil","countRock","countFountain","startAdjacentWaters","adjacentTiles","predicate","candidates","findBuildCandidateTiles","countWaters","timeEnd","divId","data","names","visitorNames","trace","getElementById","Plotly","newPlot","barmode","plotStackedBar","plotHistogram","layout","_loop","text","display","TestStats","useEffect","script","ReactDOM","react_router_dom","react_router","path","f1","f2","f3","mockResults","tests_TestStats","exact","src_App","to","navigator","serviceWorker","ready","then","registration","unregister","module","exports","__webpack_require__"],"mappings":"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EAAG,GAChB,IAAIA,GAAK,EAAG,GAAI,GAChB,IAAIA,GAAK,GAAI,GAAI,IAGbG,GAAI,CACR,IACA,IACA,IACA,GACA,GACA,GACA,IACA,GACA,IACA,GACA,GACA,GACA,IACA,IACA,EACA,IACA,IACA,GACA,IACA,GACA,GACA,IACA,EACA,GACA,GACA,IACA,GACA,GACA,GACA,IACA,EACA,IACA,IACA,IACA,IACA,GACA,EACA,GACA,IACA,GACA,GACA,IACA,IACA,IACA,IACA,GACA,GACA,GACA,GACA,IACA,GACA,GACA,IACA,IACA,GACA,GACA,IACA,GACA,IACA,IACA,IACA,IACA,GACA,IACA,GACA,IACA,GACA,IACA,IACA,GACA,GACA,IACA,GACA,IACA,IACA,IACA,GACA,IACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,IACA,GACA,GACA,GACA,GACA,IACA,GACA,IACA,IACA,IACA,GACA,GACA,GACA,GACA,IACA,EACA,IACA,GACA,GACA,IACA,GACA,IACA,IACA,IACA,GACA,GACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,IACA,IACA,EACA,GACA,GACA,IACA,IACA,IACA,IACA,IACA,EACA,IACA,GACA,IACA,IACA,IACA,IACA,GACA,GACA,IACA,IACA,IACA,GACA,IACA,GACA,GACA,GACA,GACA,IACA,IACA,GACA,GACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,EACA,GACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,IACA,GACA,IACA,EACA,IACA,GACA,GACA,IACA,GACA,GACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,GACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,GACA,GACA,IACA,IACA,IACA,GACA,IACA,IACA,GACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,IACA,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","file":"static/js/main.1dcf0b0d.chunk.js","sourcesContent":["import * as React from \"react\";\r\nimport * as THREE from \"three\";\r\n\r\nexport const UI_EVENTS = {\r\n  click: true,\r\n  contextmenu: true,\r\n  dblclick: true,\r\n  mousedown: true,\r\n  mouseup: true,\r\n  mousemove: true,\r\n  touchstart: true,\r\n  touchmove: true,\r\n  touchend: true,\r\n  keyup: true,\r\n  keydown: true,\r\n  keypress: true,\r\n  wheel: true,\r\n};\r\n\r\nexport type UIEventReciever = {\r\n  [E in keyof typeof UI_EVENTS]?: (this: HTMLElement, ev: GlobalEventHandlersEventMap[E]) => void;\r\n  // [E in keyof typeof UI_EVENTS]?: (ev: Event) => void;\r\n};\r\n\r\nexport abstract class ISketch {\r\n  static id?: string;\r\n\r\n  public elements?: JSX.Element[];\r\n  public events?: UIEventReciever;\r\n  /**\r\n   * milliseconds since sketch started running.\r\n   */\r\n  public timeElapsed = 0;\r\n\r\n  public frameCount = 0;\r\n\r\n  constructor(public renderer: THREE.WebGLRenderer, public audioContext: SketchAudioContext) {}\r\n\r\n  /**\r\n   * height / width\r\n   */\r\n  get aspectRatio() {\r\n    return this.renderer.domElement.height / this.renderer.domElement.width;\r\n  }\r\n\r\n  get resolution() {\r\n    return new THREE.Vector2(this.renderer.domElement.width, this.renderer.domElement.height);\r\n  }\r\n\r\n  get canvas() {\r\n    return this.renderer.domElement;\r\n  }\r\n\r\n  abstract animate(millisElapsed: number): void;\r\n\r\n  render?(): React.ReactElement;\r\n\r\n  resize?(width: number, height: number): void;\r\n\r\n  destroy?(): void;\r\n}\r\n\r\nexport interface SketchConstructor {\r\n  new (renderer: THREE.WebGLRenderer, audioContext: SketchAudioContext, ...otherArgs: any[]): ISketch;\r\n\r\n  id?: string;\r\n}\r\n\r\nexport interface SketchAudioContext extends AudioContext {\r\n  gain: GainNode;\r\n}\r\n","import classnames from \"classnames\";\r\nimport * as React from \"react\";\r\nimport * as THREE from \"three\";\r\n\r\nimport { ISketch, SketchAudioContext, SketchConstructor, UI_EVENTS } from \"./sketch\";\r\n\r\nimport { FaVolumeOff, FaVolumeUp } from \"react-icons/fa\";\r\n\r\nexport interface ISketchComponentProps extends React.DOMAttributes<HTMLDivElement> {\r\n  eventsOnBody?: boolean;\r\n  errorElement?: JSX.Element;\r\n  sketchClass: SketchConstructor;\r\n  otherArgs?: any[];\r\n}\r\n\r\nexport interface SketchSuccess {\r\n  type: \"success\";\r\n  sketch: ISketch;\r\n}\r\n\r\nexport interface SketchError {\r\n  type: \"error\";\r\n  error: Error;\r\n}\r\n\r\nexport interface SketchLoading {\r\n  type: \"loading\";\r\n}\r\n\r\nexport type SketchStatus = SketchSuccess | SketchError | SketchLoading;\r\n\r\n// Expects sketch to be setup but not init. SketchSuccessComponent is responsible for:\r\n//      firing resize events\r\n//      attaching ui event listeners\r\n//      keeping focus on the canvas\r\ninterface SketchSuccessComponentProps {\r\n  sketch: ISketch;\r\n  eventsOnBody?: boolean;\r\n}\r\nclass SketchSuccessComponent extends React.Component<SketchSuccessComponentProps, { frameCount: number }> {\r\n  private frameId?: number;\r\n  private lastTimestamp = 0;\r\n  private stop = false;\r\n\r\n  constructor(props: SketchSuccessComponentProps) {\r\n    super(props);\r\n    this.state = {\r\n      frameCount: props.sketch.frameCount,\r\n    };\r\n  }\r\n\r\n  componentDidMount() {\r\n    window.addEventListener(\"resize\", this.handleWindowResize);\r\n    this.handleWindowResize();\r\n\r\n    // canvas setup\r\n    const canvas = this.props.sketch.renderer.domElement;\r\n    canvas.tabIndex = 1;\r\n    (Object.keys(UI_EVENTS) as Array<keyof typeof UI_EVENTS>).forEach((eventName) => {\r\n      if (this.props.sketch.events != null) {\r\n        const callback = this.props.sketch.events[eventName] as EventListener;\r\n        if (callback != null) {\r\n          if (this.props.eventsOnBody) {\r\n            document.body.addEventListener(eventName, callback);\r\n          } else {\r\n            canvas.addEventListener(eventName, callback);\r\n          }\r\n        }\r\n      }\r\n    });\r\n    // prevent scrolling the viewport\r\n    // $canvas.on(\"touchmove\", (event) => {\r\n    //     event.preventDefault();\r\n    // });\r\n\r\n    this.frameId = requestAnimationFrame(this.loop);\r\n  }\r\n\r\n  render() {\r\n    const sketchElementsWithKey: React.ReactElement[] = [];\r\n    if (this.props.sketch.render != null) {\r\n      sketchElementsWithKey.push(this.props.sketch.render());\r\n    }\r\n    if (this.props.sketch.elements != null) {\r\n      sketchElementsWithKey.push(...this.props.sketch.elements);\r\n    }\r\n    return (\r\n      <div className=\"sketch-elements\">\r\n        {sketchElementsWithKey.map((el, idx) => React.cloneElement(el, { key: idx }))}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.stop = true;\r\n\r\n    if (this.props.sketch.destroy) {\r\n      this.props.sketch.destroy();\r\n    }\r\n    if (this.frameId != null) {\r\n      cancelAnimationFrame(this.frameId);\r\n    }\r\n    this.props.sketch.renderer.dispose();\r\n    window.removeEventListener(\"resize\", this.handleWindowResize);\r\n\r\n    const canvas = this.props.sketch.canvas;\r\n    (Object.keys(UI_EVENTS) as Array<keyof typeof UI_EVENTS>).forEach((eventName) => {\r\n      if (this.props.sketch.events != null) {\r\n        const callback = this.props.sketch.events[eventName] as EventListener;\r\n        if (callback != null) {\r\n          if (this.props.eventsOnBody) {\r\n            document.body.removeEventListener(eventName, callback);\r\n          } else {\r\n            canvas.removeEventListener(eventName, callback);\r\n          }\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  private loop = (timestamp: number) => {\r\n    const millisElapsed = timestamp - this.lastTimestamp;\r\n    this.lastTimestamp = timestamp;\r\n    this.props.sketch.frameCount++;\r\n    this.props.sketch.timeElapsed = timestamp;\r\n    try {\r\n      this.props.sketch.animate(millisElapsed);\r\n    } catch (e) {\r\n      console.error(e);\r\n    }\r\n\r\n    // careful - sketch.animate might have triggered a whole React update loop\r\n    // and made this component unmount.\r\n    if (!this.stop) {\r\n      // force new render()\r\n      this.setState({\r\n        frameCount: this.props.sketch.frameCount,\r\n      });\r\n      this.frameId = requestAnimationFrame(this.loop);\r\n    }\r\n  };\r\n\r\n  private handleWindowResize = () => {\r\n    const { renderer } = this.props.sketch;\r\n    this.updateRendererCanvasToMatchParent(renderer);\r\n    if (this.props.sketch.resize != null) {\r\n      this.props.sketch.resize(renderer.domElement.width, renderer.domElement.height);\r\n    }\r\n  };\r\n\r\n  private updateRendererCanvasToMatchParent(renderer: THREE.WebGLRenderer) {\r\n    const parent = renderer.domElement.parentElement;\r\n    if (parent != null) {\r\n      renderer.setSize(parent.clientWidth, parent.clientHeight);\r\n    }\r\n  }\r\n}\r\n\r\nexport interface ISketchComponentState {\r\n  status: SketchStatus;\r\n  volumeEnabled: boolean;\r\n}\r\n\r\nexport class SketchComponent extends React.Component<ISketchComponentProps, ISketchComponentState> {\r\n  public state: ISketchComponentState = {\r\n    status: { type: \"loading\" },\r\n    volumeEnabled: JSON.parse(window.localStorage.getItem(\"sketch-volumeEnabled\") || \"true\"),\r\n  };\r\n\r\n  // private renderer?: THREE.WebGLRenderer;\r\n  private audioContext?: SketchAudioContext;\r\n  private userVolume?: GainNode;\r\n\r\n  private handleContainerRef = (ref: HTMLDivElement | null) => {\r\n    if (ref != null) {\r\n      try {\r\n        // create dependencies, setup sketch, and move to success state\r\n        // we are responsible for live-updating the global user volume.\r\n        const AudioContextConstructor: typeof AudioContext =\r\n          (window as any).AudioContext || (window as any).webkitAudioContext;\r\n        const audioContext = (this.audioContext = new AudioContextConstructor() as SketchAudioContext);\r\n        (THREE.AudioContext as any).setContext(audioContext);\r\n        this.userVolume = audioContext.createGain();\r\n        this.userVolume.gain.setValueAtTime(0.8, 0);\r\n        this.userVolume.connect(audioContext.destination);\r\n        const audioContextGain = (audioContext.gain = audioContext.createGain());\r\n        audioContextGain.connect(this.userVolume);\r\n        document.addEventListener(\"visibilitychange\", this.handleVisibilityChange);\r\n\r\n        const renderer = new THREE.WebGLRenderer({\r\n          alpha: true,\r\n          preserveDrawingBuffer: true,\r\n          antialias: true,\r\n        });\r\n        ref.appendChild(renderer.domElement);\r\n\r\n        const otherArgs = this.props.otherArgs || [];\r\n        const sketch = new this.props.sketchClass(renderer, this.audioContext, ...otherArgs);\r\n        this.setState({ status: { type: \"success\", sketch: sketch } });\r\n      } catch (e) {\r\n        this.setState({ status: { type: \"error\", error: e } });\r\n        console.error(e);\r\n      }\r\n    } else {\r\n      if (this.state.status.type === \"success\") {\r\n        this.state.status.sketch.canvas.remove();\r\n      }\r\n      document.removeEventListener(\"visibilitychange\", this.handleVisibilityChange);\r\n      if (this.audioContext != null) {\r\n        this.audioContext.close();\r\n      }\r\n      this.setState({ status: { type: \"loading\" } });\r\n    }\r\n  };\r\n\r\n  public render() {\r\n    if (this.userVolume != null && this.audioContext != null) {\r\n      // this.userVolume.gain.value = this.state.volumeEnabled ? 1 : 0;\r\n      if (this.state.volumeEnabled && this.audioContext.state === \"suspended\") {\r\n        this.audioContext.resume();\r\n      } else if (!this.state.volumeEnabled && this.audioContext.state === \"running\") {\r\n        this.audioContext.suspend();\r\n      }\r\n    }\r\n\r\n    const { sketchClass, otherArgs, eventsOnBody, errorElement, ...containerProps } = this.props;\r\n    const className = classnames(\"sketch-component\", this.state.status.type);\r\n    return (\r\n      <div {...containerProps} id={this.props.sketchClass.id} className={className} ref={this.handleContainerRef}>\r\n        {this.renderSketchOrStatus()}\r\n        {this.renderVolumeButton()}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private renderSketchOrStatus() {\r\n    const { status } = this.state;\r\n    if (status.type === \"success\") {\r\n      // key on id to not destroy and re-create the component somehow\r\n      return (\r\n        <SketchSuccessComponent\r\n          key={this.props.sketchClass.id}\r\n          sketch={status.sketch}\r\n          eventsOnBody={this.props.eventsOnBody}\r\n        />\r\n      );\r\n    } else if (status.type === \"error\") {\r\n      const errorElement = this.props.errorElement || this.renderDefaultErrorElement(status.error.message);\r\n      return errorElement;\r\n    } else if (status.type === \"loading\") {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  private renderDefaultErrorElement(message: string) {\r\n    return (\r\n      <p className=\"sketch-error\">\r\n        Oops - something went wrong! Make sure you're using Chrome, or are on your desktop.\r\n        <pre>{message}</pre>\r\n      </p>\r\n    );\r\n  }\r\n\r\n  private renderVolumeButton() {\r\n    const { volumeEnabled } = this.state;\r\n    return (\r\n      <button className=\"user-volume\" onClick={this.handleVolumeButtonClick}>\r\n        {volumeEnabled ? <FaVolumeUp /> : <FaVolumeOff />}\r\n      </button>\r\n    );\r\n  }\r\n\r\n  private handleVolumeButtonClick = () => {\r\n    const volumeEnabled = !this.state.volumeEnabled;\r\n    this.setState({ volumeEnabled });\r\n    window.localStorage.setItem(\"sketch-volumeEnabled\", JSON.stringify(volumeEnabled));\r\n  };\r\n\r\n  private handleVisibilityChange = () => {\r\n    if (this.audioContext != null) {\r\n      if (document.hidden) {\r\n        this.audioContext.suspend();\r\n      } else if (this.state.volumeEnabled) {\r\n        this.audioContext.resume();\r\n      }\r\n    }\r\n  };\r\n}\r\n","import * as React from \"react\";\r\n\r\nimport { SketchConstructor } from \"./sketch\";\r\nimport { SketchComponent } from \"./sketchComponent\";\r\n\r\nexport interface ISketchRouteProps {\r\n  sketchClass: SketchConstructor;\r\n  otherArgs?: any[];\r\n}\r\n\r\nexport class FullPageSketch extends React.Component<ISketchRouteProps, {}> {\r\n  public render() {\r\n    return (\r\n      <div className=\"full-page-sketch\" ref={this.handleDivRef}>\r\n        <SketchComponent sketchClass={this.props.sketchClass} otherArgs={this.props.otherArgs} />\r\n      </div>\r\n    );\r\n  }\r\n  private handleDivRef = (div: HTMLDivElement | null) => {\r\n    if (div != null) {\r\n      // this.requestFullscreen(div);\r\n    } else {\r\n      this.exitFullscreen();\r\n    }\r\n  };\r\n\r\n  private exitFullscreen() {\r\n    if (document.webkitExitFullscreen) {\r\n      document.webkitExitFullscreen();\r\n    } else if (document.mozCancelFullScreen) {\r\n      document.mozCancelFullScreen();\r\n    }\r\n  }\r\n}\r\n","export function lerp(a: number, b: number, x: number) {\r\n  return a + (b - a) * x;\r\n}\r\n\r\nexport function lerp2(v: { x: number; y: number }, t: { x: number; y: number }, l: number) {\r\n  v.x = v.x * (1 - l) + t.x * l;\r\n  v.y = v.y * (1 - l) + t.y * l;\r\n}\r\n\r\nexport function map(x: number, xStart: number, xStop: number, yStart: number, yStop: number) {\r\n  return lerp(yStart, yStop, (x - xStart) / (xStop - xStart));\r\n}\r\n\r\nexport function sampleArray<T>(a: T[]) {\r\n  return a[Math.floor(Math.random() * a.length)];\r\n}\r\n\r\nexport function triangleWaveApprox(t: number) {\r\n  return (8 / (Math.PI * Math.PI)) * (Math.sin(t) - (1 / 9) * Math.sin(3 * t) + (1 / 25) * Math.sin(5 * t));\r\n}\r\n\r\n// mod account for negatives\r\nexport function mod(t: number, m: number) {\r\n  return ((t % m) + m) % m;\r\n}\r\n\r\n// perfect triangle wave that goes from [0, 1, 0] in x = [0, 1, 2]\r\nexport function mirroredRepeat(x: number) {\r\n  return (1 - (Math.abs(mod(x * 2, 4) - 2) - 1)) / 2;\r\n}\r\n\r\nexport function logistic(x: number) {\r\n  if (x < -6) {\r\n    return 0;\r\n  } else if (x > 6) {\r\n    return 1;\r\n  }\r\n  return 1 / (1 + Math.exp(-x));\r\n}\r\n","import * as THREE from \"three\";\r\n\r\nimport devlog from \"../../common/devlog\";\r\nimport { SketchAudioContext } from \"../sketch\";\r\n\r\nimport mitoBaseSrc from \"assets/audio/mito-base.mp3\";\r\nimport mitoStringsSrc from \"assets/audio/mito-strings.mp3\";\r\nimport mitoDrumsSrc from \"assets/audio/mito-drums.mp3\";\r\nimport footstepsSrc from \"assets/audio/footsteps.wav\";\r\nimport buildSoundSrc from \"assets/audio/build.wav\";\r\nimport blopSrc from \"assets/audio/Blop-Mark_DiAngelo-79054334.mp3\";\r\nimport suckWaterSrc from \"assets/audio/suckwater.wav\";\r\n\r\nfunction sourceElement(src: string) {\r\n  const type = src.substr(src.length - 3);\r\n  const source = document.createElement(\"source\");\r\n  source.src = src;\r\n  source.type = `audio/${type}`;\r\n  return source;\r\n}\r\nfunction makeNodeOfAudioAsset(ctx: SketchAudioContext, ...srcs: string[]): Unit {\r\n  const audio = document.createElement(\"audio\");\r\n  audio.autoplay = true;\r\n  audio.loop = true;\r\n  for (const src of srcs) {\r\n    audio.appendChild(sourceElement(src));\r\n  }\r\n  // audio.appendChild(sourceElement(assetName, \"mp3\"));\r\n  // audio.appendChild(sourceElement(assetName, \"wav\"));\r\n  const source = ctx.createMediaElementSource(audio);\r\n  const gain = ctx.createGain();\r\n  source.connect(gain);\r\n  return { audio, gain };\r\n}\r\n\r\ninterface Unit {\r\n  gain: GainNode;\r\n  audio: HTMLAudioElement;\r\n}\r\n\r\nexport let mito: Unit;\r\nexport let strings: Unit;\r\nexport let drums: Unit;\r\n\r\nexport let footsteps: Unit;\r\nexport let build: Unit;\r\n\r\nexport let blopBuffer: THREE.AudioBuffer;\r\nexport let suckWaterBuffer: THREE.AudioBuffer;\r\n\r\nexport function hookUpAudio(ctx: SketchAudioContext) {\r\n  let numDone = 0;\r\n  function oneMoreLoaded() {\r\n    numDone++;\r\n    if (numDone === 3) {\r\n      mito.audio.currentTime = 0;\r\n      strings.audio.currentTime = 0;\r\n      drums.audio.currentTime = 0;\r\n      mito.gain.connect(ctx.gain);\r\n      strings.gain.connect(ctx.gain);\r\n      drums.gain.connect(ctx.gain);\r\n    }\r\n  }\r\n  mito = makeNodeOfAudioAsset(ctx, mitoBaseSrc);\r\n  mito.audio.oncanplaythrough = oneMoreLoaded;\r\n  mito.gain.gain.value = 0.5;\r\n\r\n  strings = makeNodeOfAudioAsset(ctx, mitoStringsSrc);\r\n  strings.audio.oncanplaythrough = oneMoreLoaded;\r\n  strings.gain.gain.value = 0.0;\r\n\r\n  drums = makeNodeOfAudioAsset(ctx, mitoDrumsSrc);\r\n  drums.audio.oncanplaythrough = oneMoreLoaded;\r\n  drums.gain.gain.value = 0.0;\r\n\r\n  footsteps = makeNodeOfAudioAsset(ctx, footstepsSrc);\r\n  footsteps.gain.gain.value = 0;\r\n  footsteps.gain.connect(ctx.gain);\r\n\r\n  build = makeNodeOfAudioAsset(ctx, buildSoundSrc);\r\n  build.gain.gain.value = 0;\r\n  build.gain.connect(ctx.gain);\r\n\r\n  const loader = new THREE.AudioLoader();\r\n\r\n  loader.load(\r\n    blopSrc,\r\n    (audioBuffer: THREE.AudioBuffer) => {\r\n      blopBuffer = audioBuffer;\r\n    },\r\n    (xhr: ProgressEvent) => {\r\n      // devlog((xhr.loaded / xhr.total * 100) + '% loaded');\r\n    },\r\n    (err: any) => {\r\n      devlog(\"An error happened\");\r\n    }\r\n  );\r\n  loader.load(\r\n    suckWaterSrc,\r\n    (audioBuffer: THREE.AudioBuffer) => {\r\n      suckWaterBuffer = audioBuffer;\r\n    },\r\n    (xhr: ProgressEvent) => {\r\n      // devlog((xhr.loaded / xhr.total * 100) + '% loaded');\r\n    },\r\n    (err: any) => {\r\n      devlog(\"An error happened\");\r\n    }\r\n  );\r\n}\r\n","import { EventEmitter } from \"events\";\r\nimport { Vector2 } from \"three\";\r\n\r\n// floating point rounding error fix\r\n// without: 0.8 - 0.1 = 0.7000000000000001\r\n// with: fpref(0.8 - 0.1) = 0.7\r\nfunction fpref(x: number) {\r\n  return Math.round(x * 1e12) / 1e12;\r\n}\r\n\r\ninterface HasPosition {\r\n  pos: Vector2;\r\n}\r\n\r\nexport class Inventory {\r\n  constructor(\r\n    public capacity: number,\r\n    public carrier: HasPosition,\r\n    public water: number = 0,\r\n    public sugar: number = 0\r\n  ) {\r\n    this.validate();\r\n  }\r\n\r\n  // public exchange(other: Inventory, giveWater: number, giveSugar: number, getWater: number, getSugar: number) {\r\n  //     giveWater = Math.min(giveWater, this.water);\r\n  //     giveSugar = Math.min(giveSugar, this.sugar);\r\n  //     getWater = Math.min(getWater, other.water);\r\n  //     getSugar = Math.min(getWater, other.sugar);\r\n\r\n  //     // positive = give this amount\r\n  //     // negative = other gives this amount\r\n  //     const wantedExchangedWater = giveWater - getWater;\r\n  //     const wantedExchangedSugar = giveSugar - getSugar;\r\n\r\n  //     const mySpace = fpref(this.space() + wantedExchangedSugar + wantedExchangedWater);\r\n  //     const otherSpace = fpref(other.space() - wantedExchangedSugar - wantedExchangedWater);\r\n\r\n  //     // const mySpace = fpref(this.capacity + giveWater + giveSugar - this.water - this.sugar);\r\n\r\n  //     // const otherSpace = fpref(other.capacity - other.water - other.sugar)\r\n\r\n  //     // const mySpaceNeeded = fpref(getWater + getSugar);\r\n  //     // const otherSpaceNeeded = fpref(giveWater + giveSugar);\r\n\r\n  //     // if (mySpace < mySpaceNeeded) {\r\n  //     //     // e.g. space = 2, needed = 4\r\n  //     //     // only get half\r\n  //     //     const weightedRatio = mySpace / mySpaceNeeded;\r\n  //     //     getWater = getWater * mySpace / mySpaceNeeded;\r\n  //     //     getSugar = getSugar * mySpace / mySpaceNeeded;\r\n  //     // }\r\n\r\n  //     // if (otherSpace < otherSpaceNeeded) {\r\n  //     //     giveWater = giveWater / otherSpace;\r\n  //     //     giveSugar = giveSugar / otherSpace;\r\n  //     // }\r\n  // }\r\n\r\n  public give(other: Inventory, amountWater: number, amountSugar: number) {\r\n    if (other === this) {\r\n      throw new Error(\"shouldn't give to self\");\r\n    }\r\n    // to check:\r\n    // 1) we have enough water and sugar\r\n    //      if we don't, cap water and sugar to the amount available\r\n    // 2) other has enough space\r\n    //      if it doesn't, scale down to the amount that is available\r\n    let water = Math.min(amountWater, this.water);\r\n    let sugar = Math.min(amountSugar, this.sugar);\r\n    const spaceNeeded = fpref(water + sugar);\r\n    const spaceAvailable = other.space();\r\n    if (spaceNeeded > spaceAvailable) {\r\n      // scale down the amount to give\r\n      // give less than capacity\r\n      water = Math.floor((water / spaceNeeded) * spaceAvailable);\r\n      sugar = Math.floor((sugar / spaceNeeded) * spaceAvailable);\r\n    }\r\n    this.change(-water, -sugar);\r\n    other.change(water, sugar);\r\n    if (this.events) {\r\n      this.events.emit(\"give\", other, water, sugar);\r\n    }\r\n    if (other.events) {\r\n      other.events.emit(\"get\", this, water, sugar);\r\n    }\r\n    return { water, sugar };\r\n  }\r\n\r\n  private events?: EventEmitter;\r\n  public on(name: \"give\" | \"get\", fn: (other: Inventory, water: number, sugar: number) => void) {\r\n    this.events = this.events || new EventEmitter();\r\n    this.events.on(name, fn);\r\n  }\r\n  public off(name: \"give\" | \"get\", fn: (...args: any[]) => any) {\r\n    this.events = this.events || new EventEmitter();\r\n    this.events.off(name, fn);\r\n  }\r\n\r\n  public add(water: number, sugar: number) {\r\n    const spaceNeeded = fpref(water + sugar);\r\n    const spaceAvailable = this.space();\r\n    if (spaceNeeded > spaceAvailable) {\r\n      // scale down the amount to give\r\n      water = (water / spaceNeeded) * spaceAvailable;\r\n      sugar = (sugar / spaceNeeded) * spaceAvailable;\r\n    }\r\n    this.change(water, sugar);\r\n  }\r\n\r\n  private change(water: number, sugar: number) {\r\n    const newWater = fpref(this.water + water);\r\n    const newSugar = fpref(this.sugar + sugar);\r\n    this.validate(newWater, newSugar);\r\n    this.water = newWater;\r\n    this.sugar = newSugar;\r\n\r\n    // fixup if needed\r\n    if (this.water < 0) {\r\n      this.water = 0;\r\n    }\r\n    if (this.sugar < 0) {\r\n      this.sugar = 0;\r\n    }\r\n    if (this.water + this.sugar > this.capacity) {\r\n      if (this.water > this.sugar) {\r\n        this.water = this.capacity - this.sugar;\r\n      } else {\r\n        this.sugar = this.capacity - this.water;\r\n      }\r\n    }\r\n  }\r\n\r\n  public space() {\r\n    const { capacity, water, sugar } = this;\r\n    return fpref(capacity - water - sugar);\r\n  }\r\n\r\n  public isMaxed() {\r\n    return this.space() < 1;\r\n  }\r\n\r\n  validate(water: number = this.water, sugar: number = this.sugar) {\r\n    const { capacity } = this;\r\n    if (water < 0) {\r\n      console.warn(`water < 0: ${water}`);\r\n      // throw new Error(`water < 0: ${water}`);\r\n    }\r\n    if (sugar < 0) {\r\n      console.warn(`sugar < 0: ${sugar}`);\r\n      // throw new Error(`sugar < 0: ${sugar}`);\r\n    }\r\n    if (water + sugar > capacity) {\r\n      console.warn(`bad inventory: ${water} water + ${sugar} > ${capacity} max`);\r\n      // throw new Error(`bad inventory: ${water} water + ${sugar} > ${capacity} max`);\r\n    }\r\n  }\r\n}\r\n\r\nexport interface HasInventory {\r\n  inventory: Inventory;\r\n}\r\n\r\nexport function hasInventory<T>(obj?: T): obj is HasInventory & T {\r\n  return obj != null && (obj as any).inventory instanceof Inventory;\r\n}\r\n","import { ALL_ENVIRONMENTS } from \"./game/environment\";\r\n\r\nconst PARAMS_DEFAULT = {\r\n  isRealtime: true,\r\n  environment: \"Temperate\" as keyof typeof ALL_ENVIRONMENTS,\r\n  cellEnergyMax: 10000,\r\n  tissueInventoryCapacity: 6,\r\n  rootTurnsPerTransfer: 20,\r\n  leafReactionRate: 0.01,\r\n  leafSugarPerReaction: 1,\r\n  cellGestationTurns: 20,\r\n  cellDiffusionWater: 0.002,\r\n  cellDiffusionSugar: 0.002,\r\n  soilDarknessBase: 0.2,\r\n  soilDiffusionType: \"discrete\",\r\n  soilDiffusionWater: 0.001,\r\n  veinDiffusion: 0.5,\r\n  soilMaxWater: 20,\r\n  droop: 0.03,\r\n  fountainTurnsPerWater: 11,\r\n  fountainAppearanceRate: 1.5,\r\n  transportTurnsPerMove: 5,\r\n  sunlightReintroduction: 0.15,\r\n  sunlightDiffusion: 0.0,\r\n  maxResources: 100,\r\n};\r\n\r\ntype Params = typeof PARAMS_DEFAULT;\r\n\r\nexport const params = { ...PARAMS_DEFAULT };\r\n\r\nif (window.location.hash.length > 0) {\r\n  const urlHashParams: object = JSON.parse(decodeURI(window.location.hash.substr(1)));\r\n  Object.assign(params, urlHashParams);\r\n}\r\n\r\nexport function updateParamsHash() {\r\n  const nonDefaultParams: Partial<Params> = {};\r\n  const keys = Object.keys(PARAMS_DEFAULT) as Array<keyof Params>;\r\n  for (const key of keys) {\r\n    const k = params[key];\r\n    if (k !== PARAMS_DEFAULT[key]) {\r\n      nonDefaultParams[key] = k as any;\r\n    }\r\n  }\r\n  if (Object.keys(nonDefaultParams).length > 0) {\r\n    window.location.hash = encodeURI(JSON.stringify(nonDefaultParams));\r\n  } else {\r\n    window.location.hash = \"\";\r\n  }\r\n}\r\nupdateParamsHash();\r\n","// copy-pasted from https://raw.githubusercontent.com/josephg/noisejs/master/perlin.js\r\n// tslint:disable\r\n\r\n/*\r\n * A speed-improved perlin and simplex noise algorithms for 2D.\r\n *\r\n * Based on example code by Stefan Gustavson (stegu@itn.liu.se).\r\n * Optimisations by Peter Eastman (peastman@drizzle.stanford.edu).\r\n * Better rank ordering method by Stefan Gustavson in 2012.\r\n * Converted to Javascript by Joseph Gentle.\r\n *\r\n * Version 2012-03-09\r\n *\r\n * This code was placed in the public domain by its original author,\r\n * Stefan Gustavson. You may use it as you see fit, but\r\n * attribution is appreciated.\r\n *\r\n */\r\n\r\nclass Grad {\r\n  constructor(public x: number, public y: number, public z: number) {}\r\n\r\n  dot2(x: number, y: number) {\r\n    return this.x * x + this.y * y;\r\n  }\r\n\r\n  dot3(x: number, y: number, z: number) {\r\n    return this.x * x + this.y * y + this.z * z;\r\n  }\r\n}\r\n\r\nconst grad3 = [\r\n  new Grad(1, 1, 0),\r\n  new Grad(-1, 1, 0),\r\n  new Grad(1, -1, 0),\r\n  new Grad(-1, -1, 0),\r\n  new Grad(1, 0, 1),\r\n  new Grad(-1, 0, 1),\r\n  new Grad(1, 0, -1),\r\n  new Grad(-1, 0, -1),\r\n  new Grad(0, 1, 1),\r\n  new Grad(0, -1, 1),\r\n  new Grad(0, 1, -1),\r\n  new Grad(0, -1, -1),\r\n];\r\n\r\nconst p = [\r\n  151,\r\n  160,\r\n  137,\r\n  91,\r\n  90,\r\n  15,\r\n  131,\r\n  13,\r\n  201,\r\n  95,\r\n  96,\r\n  53,\r\n  194,\r\n  233,\r\n  7,\r\n  225,\r\n  140,\r\n  36,\r\n  103,\r\n  30,\r\n  69,\r\n  142,\r\n  8,\r\n  99,\r\n  37,\r\n  240,\r\n  21,\r\n  10,\r\n  23,\r\n  190,\r\n  6,\r\n  148,\r\n  247,\r\n  120,\r\n  234,\r\n  75,\r\n  0,\r\n  26,\r\n  197,\r\n  62,\r\n  94,\r\n  252,\r\n  219,\r\n  203,\r\n  117,\r\n  35,\r\n  11,\r\n  32,\r\n  57,\r\n  177,\r\n  33,\r\n  88,\r\n  237,\r\n  149,\r\n  56,\r\n  87,\r\n  174,\r\n  20,\r\n  125,\r\n  136,\r\n  171,\r\n  168,\r\n  68,\r\n  175,\r\n  74,\r\n  165,\r\n  71,\r\n  134,\r\n  139,\r\n  48,\r\n  27,\r\n  166,\r\n  77,\r\n  146,\r\n  158,\r\n  231,\r\n  83,\r\n  111,\r\n  229,\r\n  122,\r\n  60,\r\n  211,\r\n  133,\r\n  230,\r\n  220,\r\n  105,\r\n  92,\r\n  41,\r\n  55,\r\n  46,\r\n  245,\r\n  40,\r\n  244,\r\n  102,\r\n  143,\r\n  54,\r\n  65,\r\n  25,\r\n  63,\r\n  161,\r\n  1,\r\n  216,\r\n  80,\r\n  73,\r\n  209,\r\n  76,\r\n  132,\r\n  187,\r\n  208,\r\n  89,\r\n  18,\r\n  169,\r\n  200,\r\n  196,\r\n  135,\r\n  130,\r\n  116,\r\n  188,\r\n  159,\r\n  86,\r\n  164,\r\n  100,\r\n  109,\r\n  198,\r\n  173,\r\n  186,\r\n  3,\r\n  64,\r\n  52,\r\n  217,\r\n  226,\r\n  250,\r\n  124,\r\n  123,\r\n  5,\r\n  202,\r\n  38,\r\n  147,\r\n  118,\r\n  126,\r\n  255,\r\n  82,\r\n  85,\r\n  212,\r\n  207,\r\n  206,\r\n  59,\r\n  227,\r\n  47,\r\n  16,\r\n  58,\r\n  17,\r\n  182,\r\n  189,\r\n  28,\r\n  42,\r\n  223,\r\n  183,\r\n  170,\r\n  213,\r\n  119,\r\n  248,\r\n  152,\r\n  2,\r\n  44,\r\n  154,\r\n  163,\r\n  70,\r\n  221,\r\n  153,\r\n  101,\r\n  155,\r\n  167,\r\n  43,\r\n  172,\r\n  9,\r\n  129,\r\n  22,\r\n  39,\r\n  253,\r\n  19,\r\n  98,\r\n  108,\r\n  110,\r\n  79,\r\n  113,\r\n  224,\r\n  232,\r\n  178,\r\n  185,\r\n  112,\r\n  104,\r\n  218,\r\n  246,\r\n  97,\r\n  228,\r\n  251,\r\n  34,\r\n  242,\r\n  193,\r\n  238,\r\n  210,\r\n  144,\r\n  12,\r\n  191,\r\n  179,\r\n  162,\r\n  241,\r\n  81,\r\n  51,\r\n  145,\r\n  235,\r\n  249,\r\n  14,\r\n  239,\r\n  107,\r\n  49,\r\n  192,\r\n  214,\r\n  31,\r\n  181,\r\n  199,\r\n  106,\r\n  157,\r\n  184,\r\n  84,\r\n  204,\r\n  176,\r\n  115,\r\n  121,\r\n  50,\r\n  45,\r\n  127,\r\n  4,\r\n  150,\r\n  254,\r\n  138,\r\n  236,\r\n  205,\r\n  93,\r\n  222,\r\n  114,\r\n  67,\r\n  29,\r\n  24,\r\n  72,\r\n  243,\r\n  141,\r\n  128,\r\n  195,\r\n  78,\r\n  66,\r\n  215,\r\n  61,\r\n  156,\r\n  180,\r\n];\r\n\r\n/*\r\nfor(const i=0; i<256; i++) {\r\nperm[i] = perm[i + 256] = p[i];\r\ngradP[i] = gradP[i + 256] = grad3[perm[i] % 12];\r\n}*/\r\n\r\n// Skewing and unskewing factors for 2, 3, and 4 dimensions\r\nconst F2 = 0.5 * (Math.sqrt(3) - 1);\r\nconst G2 = (3 - Math.sqrt(3)) / 6;\r\n\r\nconst F3 = 1 / 3;\r\nconst G3 = 1 / 6;\r\n\r\nexport class Noise {\r\n  // To remove the need for index wrapping, double the permutation table length\r\n  public perm = new Array(512);\r\n  public gradP = new Array(512);\r\n\r\n  public octaveNum = 6;\r\n  public octaveFalloff = 0.5;\r\n  // rotate by 1 radians (~57 deg), scale by 2\r\n  public octaveMatrix2 = [Math.cos(1) * 2, -Math.sin(1) * 2, Math.sin(1) * 2, Math.cos(1) * 2];\r\n\r\n  // This isn't a very good seeding function, but it works ok. It supports 2^16\r\n  // different seed values. Write something better if you need more seeds.\r\n  public seed(seed: number) {\r\n    if (seed > 0 && seed < 1) {\r\n      // Scale the seed out\r\n      seed *= 65536;\r\n    }\r\n\r\n    seed = Math.floor(seed);\r\n    if (seed < 256) {\r\n      seed |= seed << 8;\r\n    }\r\n\r\n    for (let i = 0; i < 256; i++) {\r\n      let v;\r\n      if (i & 1) {\r\n        v = p[i] ^ (seed & 255);\r\n      } else {\r\n        v = p[i] ^ ((seed >> 8) & 255);\r\n      }\r\n\r\n      this.perm[i] = this.perm[i + 256] = v;\r\n      this.gradP[i] = this.gradP[i + 256] = grad3[v % 12];\r\n    }\r\n  }\r\n\r\n  constructor(seed: number = Math.random() * 2147483647) {\r\n    this.seed(seed);\r\n  }\r\n\r\n  // 2D simplex noise\r\n  public simplex2(xin: number, yin: number) {\r\n    let n0, n1, n2; // Noise contributions from the three corners\r\n    // Skew the input space to determine which simplex cell we're in\r\n    const s = (xin + yin) * F2; // Hairy factor for 2D\r\n    let i = Math.floor(xin + s);\r\n    let j = Math.floor(yin + s);\r\n    const t = (i + j) * G2;\r\n    let x0 = xin - i + t; // The x,y distances from the cell origin, unskewed.\r\n    let y0 = yin - j + t;\r\n    // For the 2D case, the simplex shape is an equilateral triangle.\r\n    // Determine which simplex we are in.\r\n    let i1, j1; // Offsets for second (middle) corner of simplex in (i,j) coords\r\n    if (x0 > y0) {\r\n      // lower triangle, XY order: (0,0)->(1,0)->(1,1)\r\n      i1 = 1;\r\n      j1 = 0;\r\n    } else {\r\n      // upper triangle, YX order: (0,0)->(0,1)->(1,1)\r\n      i1 = 0;\r\n      j1 = 1;\r\n    }\r\n    // A step of (1,0) in (i,j) means a step of (1-c,-c) in (x,y), and\r\n    // a step of (0,1) in (i,j) means a step of (-c,1-c) in (x,y), where\r\n    // c = (3-sqrt(3))/6\r\n    const x1 = x0 - i1 + G2; // Offsets for middle corner in (x,y) unskewed coords\r\n    const y1 = y0 - j1 + G2;\r\n    const x2 = x0 - 1 + 2 * G2; // Offsets for last corner in (x,y) unskewed coords\r\n    const y2 = y0 - 1 + 2 * G2;\r\n    // Work out the hashed gradient indices of the three simplex corners\r\n    i &= 255;\r\n    j &= 255;\r\n    const gi0 = this.gradP[i + this.perm[j]];\r\n    const gi1 = this.gradP[i + i1 + this.perm[j + j1]];\r\n    const gi2 = this.gradP[i + 1 + this.perm[j + 1]];\r\n    // Calculate the contribution from the three corners\r\n    let t0 = 0.5 - x0 * x0 - y0 * y0;\r\n    if (t0 < 0) {\r\n      n0 = 0;\r\n    } else {\r\n      t0 *= t0;\r\n      n0 = t0 * t0 * gi0.dot2(x0, y0); // (x,y) of grad3 used for 2D gradient\r\n    }\r\n    let t1 = 0.5 - x1 * x1 - y1 * y1;\r\n    if (t1 < 0) {\r\n      n1 = 0;\r\n    } else {\r\n      t1 *= t1;\r\n      n1 = t1 * t1 * gi1.dot2(x1, y1);\r\n    }\r\n    let t2 = 0.5 - x2 * x2 - y2 * y2;\r\n    if (t2 < 0) {\r\n      n2 = 0;\r\n    } else {\r\n      t2 *= t2;\r\n      n2 = t2 * t2 * gi2.dot2(x2, y2);\r\n    }\r\n    // Add contributions from each corner to get the final noise value.\r\n    // The result is scaled to return values in the interval [-1,1].\r\n    return 70 * (n0 + n1 + n2);\r\n  }\r\n\r\n  public octaveSimplex2(xin: number, yin: number, octaveNum = this.octaveNum, octaveFalloff = this.octaveFalloff) {\r\n    let sum = 0;\r\n    let x = xin;\r\n    let y = yin;\r\n    let scalar = 1;\r\n    for (let i = 0; i < octaveNum; i++) {\r\n      sum += this.simplex2(x, y) * scalar;\r\n      const newX = x * this.octaveMatrix2[0] + y * this.octaveMatrix2[1];\r\n      const newY = x * this.octaveMatrix2[2] + y * this.octaveMatrix2[3];\r\n      x = newX;\r\n      y = newY;\r\n      scalar *= octaveFalloff;\r\n    }\r\n    return sum;\r\n  }\r\n\r\n  // 3D simplex noise\r\n  public simplex3(xin: number, yin: number, zin: number) {\r\n    let n0, n1, n2, n3; // Noise contributions from the four corners\r\n\r\n    // Skew the input space to determine which simplex cell we're in\r\n    const s = (xin + yin + zin) * F3; // Hairy factor for 2D\r\n    let i = Math.floor(xin + s);\r\n    let j = Math.floor(yin + s);\r\n    let k = Math.floor(zin + s);\r\n\r\n    const t = (i + j + k) * G3;\r\n    const x0 = xin - i + t; // The x,y distances from the cell origin, unskewed.\r\n    const y0 = yin - j + t;\r\n    const z0 = zin - k + t;\r\n\r\n    // For the 3D case, the simplex shape is a slightly irregular tetrahedron.\r\n    // Determine which simplex we are in.\r\n    let i1, j1, k1; // Offsets for second corner of simplex in (i,j,k) coords\r\n    let i2, j2, k2; // Offsets for third corner of simplex in (i,j,k) coords\r\n    if (x0 >= y0) {\r\n      if (y0 >= z0) {\r\n        i1 = 1;\r\n        j1 = 0;\r\n        k1 = 0;\r\n        i2 = 1;\r\n        j2 = 1;\r\n        k2 = 0;\r\n      } else if (x0 >= z0) {\r\n        i1 = 1;\r\n        j1 = 0;\r\n        k1 = 0;\r\n        i2 = 1;\r\n        j2 = 0;\r\n        k2 = 1;\r\n      } else {\r\n        i1 = 0;\r\n        j1 = 0;\r\n        k1 = 1;\r\n        i2 = 1;\r\n        j2 = 0;\r\n        k2 = 1;\r\n      }\r\n    } else {\r\n      if (y0 < z0) {\r\n        i1 = 0;\r\n        j1 = 0;\r\n        k1 = 1;\r\n        i2 = 0;\r\n        j2 = 1;\r\n        k2 = 1;\r\n      } else if (x0 < z0) {\r\n        i1 = 0;\r\n        j1 = 1;\r\n        k1 = 0;\r\n        i2 = 0;\r\n        j2 = 1;\r\n        k2 = 1;\r\n      } else {\r\n        i1 = 0;\r\n        j1 = 1;\r\n        k1 = 0;\r\n        i2 = 1;\r\n        j2 = 1;\r\n        k2 = 0;\r\n      }\r\n    }\r\n    // A step of (1,0,0) in (i,j,k) means a step of (1-c,-c,-c) in (x,y,z),\r\n    // a step of (0,1,0) in (i,j,k) means a step of (-c,1-c,-c) in (x,y,z), and\r\n    // a step of (0,0,1) in (i,j,k) means a step of (-c,-c,1-c) in (x,y,z), where\r\n    // c = 1/6.\r\n    const x1 = x0 - i1 + G3; // Offsets for second corner\r\n    const y1 = y0 - j1 + G3;\r\n    const z1 = z0 - k1 + G3;\r\n\r\n    let x2 = x0 - i2 + 2 * G3; // Offsets for third corner\r\n    let y2 = y0 - j2 + 2 * G3;\r\n    let z2 = z0 - k2 + 2 * G3;\r\n\r\n    let x3 = x0 - 1 + 3 * G3; // Offsets for fourth corner\r\n    let y3 = y0 - 1 + 3 * G3;\r\n    let z3 = z0 - 1 + 3 * G3;\r\n\r\n    // Work out the hashed gradient indices of the four simplex corners\r\n    i &= 255;\r\n    j &= 255;\r\n    k &= 255;\r\n    const { gradP, perm } = this;\r\n    let gi0 = gradP[i + perm[j + perm[k]]];\r\n    let gi1 = gradP[i + i1 + perm[j + j1 + perm[k + k1]]];\r\n    let gi2 = gradP[i + i2 + perm[j + j2 + perm[k + k2]]];\r\n    let gi3 = gradP[i + 1 + perm[j + 1 + perm[k + 1]]];\r\n\r\n    // Calculate the contribution from the four corners\r\n    let t0 = 0.6 - x0 * x0 - y0 * y0 - z0 * z0;\r\n    if (t0 < 0) {\r\n      n0 = 0;\r\n    } else {\r\n      t0 *= t0;\r\n      n0 = t0 * t0 * gi0.dot3(x0, y0, z0); // (x,y) of grad3 used for 2D gradient\r\n    }\r\n    let t1 = 0.6 - x1 * x1 - y1 * y1 - z1 * z1;\r\n    if (t1 < 0) {\r\n      n1 = 0;\r\n    } else {\r\n      t1 *= t1;\r\n      n1 = t1 * t1 * gi1.dot3(x1, y1, z1);\r\n    }\r\n    let t2 = 0.6 - x2 * x2 - y2 * y2 - z2 * z2;\r\n    if (t2 < 0) {\r\n      n2 = 0;\r\n    } else {\r\n      t2 *= t2;\r\n      n2 = t2 * t2 * gi2.dot3(x2, y2, z2);\r\n    }\r\n    let t3 = 0.6 - x3 * x3 - y3 * y3 - z3 * z3;\r\n    if (t3 < 0) {\r\n      n3 = 0;\r\n    } else {\r\n      t3 *= t3;\r\n      n3 = t3 * t3 * gi3.dot3(x3, y3, z3);\r\n    }\r\n    // Add contributions from each corner to get the final noise value.\r\n    // The result is scaled to return values in the interval [-1,1].\r\n    return 32 * (n0 + n1 + n2 + n3);\r\n  }\r\n\r\n  public octaveSimplex3(\r\n    xin: number,\r\n    yin: number,\r\n    zin: number,\r\n    octaveNum = this.octaveNum,\r\n    octaveFalloff = this.octaveFalloff\r\n  ) {\r\n    let sum = 0;\r\n    let x = xin;\r\n    let y = yin;\r\n    let z = zin;\r\n    let scalar = 1;\r\n    for (let i = 0; i < octaveNum; i++) {\r\n      sum += this.simplex3(x, y, z) * scalar;\r\n      x *= 2;\r\n      y *= 2;\r\n      z *= 2;\r\n      scalar *= octaveFalloff;\r\n    }\r\n    return sum;\r\n  }\r\n\r\n  // ##### Perlin noise stuff\r\n\r\n  public fade(t: number) {\r\n    return t * t * t * (t * (t * 6 - 15) + 10);\r\n  }\r\n\r\n  public lerp(a: number, b: number, t: number) {\r\n    return (1 - t) * a + t * b;\r\n  }\r\n\r\n  // 2D Perlin Noise\r\n  public perlin2(x: number, y: number) {\r\n    // Find unit grid cell containing point\r\n    let X = Math.floor(x),\r\n      Y = Math.floor(y);\r\n    // Get relative xy coordinates of point within that cell\r\n    x = x - X;\r\n    y = y - Y;\r\n    // Wrap the integer cells at 255 (smaller integer period can be introduced here)\r\n    X = X & 255;\r\n    Y = Y & 255;\r\n\r\n    const { gradP, perm } = this;\r\n    // Calculate noise contributions from each of the four corners\r\n    let n00 = gradP[X + perm[Y]].dot2(x, y);\r\n    let n01 = gradP[X + perm[Y + 1]].dot2(x, y - 1);\r\n    let n10 = gradP[X + 1 + perm[Y]].dot2(x - 1, y);\r\n    let n11 = gradP[X + 1 + perm[Y + 1]].dot2(x - 1, y - 1);\r\n\r\n    // Compute the fade curve value for x\r\n    let u = this.fade(x);\r\n\r\n    // Interpolate the four results\r\n    return this.lerp(this.lerp(n00, n10, u), this.lerp(n01, n11, u), this.fade(y));\r\n  }\r\n\r\n  // 3D Perlin Noise\r\n  public perlin3(x: number, y: number, z: number) {\r\n    const { gradP, perm } = this;\r\n    // Find unit grid cell containing point\r\n    let X = Math.floor(x),\r\n      Y = Math.floor(y),\r\n      Z = Math.floor(z);\r\n    // Get relative xyz coordinates of point within that cell\r\n    x = x - X;\r\n    y = y - Y;\r\n    z = z - Z;\r\n    // Wrap the integer cells at 255 (smaller integer period can be introduced here)\r\n    X = X & 255;\r\n    Y = Y & 255;\r\n    Z = Z & 255;\r\n\r\n    // Calculate noise contributions from each of the eight corners\r\n    let n000 = gradP[X + perm[Y + perm[Z]]].dot3(x, y, z);\r\n    let n001 = gradP[X + perm[Y + perm[Z + 1]]].dot3(x, y, z - 1);\r\n    let n010 = gradP[X + perm[Y + 1 + perm[Z]]].dot3(x, y - 1, z);\r\n    let n011 = gradP[X + perm[Y + 1 + perm[Z + 1]]].dot3(x, y - 1, z - 1);\r\n    let n100 = gradP[X + 1 + perm[Y + perm[Z]]].dot3(x - 1, y, z);\r\n    let n101 = gradP[X + 1 + perm[Y + perm[Z + 1]]].dot3(x - 1, y, z - 1);\r\n    let n110 = gradP[X + 1 + perm[Y + 1 + perm[Z]]].dot3(x - 1, y - 1, z);\r\n    let n111 = gradP[X + 1 + perm[Y + 1 + perm[Z + 1]]].dot3(x - 1, y - 1, z - 1);\r\n\r\n    // Compute the fade curve value for x, y, z\r\n    let u = this.fade(x);\r\n    let v = this.fade(y);\r\n    let w = this.fade(z);\r\n\r\n    // Interpolate\r\n    return this.lerp(\r\n      this.lerp(this.lerp(n000, n100, u), this.lerp(n001, n101, u), w),\r\n      this.lerp(this.lerp(n010, n110, u), this.lerp(n011, n111, u), w),\r\n      v\r\n    );\r\n  }\r\n}\r\n","import { Vector2 } from \"three\";\r\n\r\nexport const DIRECTIONS = {\r\n  nw: new Vector2(-1, -1),\r\n  w: new Vector2(-1, 0),\r\n  sw: new Vector2(-1, +1),\r\n  n: new Vector2(0, -1),\r\n  // new Vector2( 0,  0),\r\n  s: new Vector2(0, +1),\r\n  ne: new Vector2(+1, -1),\r\n  e: new Vector2(+1, 0),\r\n  se: new Vector2(+1, +1),\r\n};\r\n\r\nexport type Directions = keyof typeof DIRECTIONS;\r\n\r\nexport const DIRECTION_NAMES = Object.keys(DIRECTIONS) as Directions[];\r\nexport const DIRECTION_VALUES: Vector2[] = DIRECTION_NAMES.map((o) => DIRECTIONS[o]);\r\n","function capitalize(s: String) {\r\n  return s.substr(0, 1).toLocaleUpperCase() + s.substr(1);\r\n}\r\n\r\nexport default capitalize;\r\n","import { Gene, DNATuple } from \"./gene\";\r\nimport capitalize from \"../common/capitalize\";\r\n\r\nexport type TraitValue = -3 | -2 | -1 | 0 | 1 | 2 | 3;\r\n\r\nexport type Traits = {\r\n  /**\r\n   * How fast the cell walks across this tile. Higher is faster.\r\n   */\r\n  walkSpeed: TraitValue;\r\n  /**\r\n   * How slower the cell consumes energy. Higher is lower energy usage\r\n   * for the same behavior.\r\n   */\r\n  energyEfficiency: TraitValue;\r\n  /**\r\n   * How well this cell photosynthesizes. Higher is faster photosynthesis.\r\n   */\r\n  photosynthesis: TraitValue;\r\n  /**\r\n   * How well this cell absorbs nutrients and water from roots. Higher is\r\n   * faster absorption rate.\r\n   */\r\n  rootAbsorption: TraitValue;\r\n  /**\r\n   * How many resources this cell can carry.\r\n   */\r\n  carryCapacity: TraitValue;\r\n  /**\r\n   * Whether this cell actively transports water. Higher means faster\r\n   * water transport.\r\n   */\r\n  activeTransportWater: TraitValue;\r\n  /**\r\n   * Whether this cell actively transports sugar. Higher means faster\r\n   * sugar transport.\r\n   */\r\n  activeTransportSugar: TraitValue;\r\n  /**\r\n   * How stable this cell is against gravity, weight, and wind forces.\r\n   * Higher is more stable.\r\n   */\r\n  structuralStability: TraitValue;\r\n  /**\r\n   * How easily this cell passively diffuses water. Higher means faster diffusion.\r\n   */\r\n  diffuseWater: TraitValue;\r\n  /**\r\n   * How easily this cell passively diffuses sugar. Higher means faster diffusion.\r\n   */\r\n  diffuseSugar: TraitValue;\r\n  /**\r\n   * How quickly this cell builds.\r\n   */\r\n  buildTime: TraitValue;\r\n  // /**\r\n  //  * How well this cell still works at high temperatures.\r\n  //  */\r\n  // heatTolerance: TraitValue;\r\n  // /**\r\n  //  * How well this cell still works at low temperatures.\r\n  //  */\r\n  // coldTolerance: TraitValue;\r\n  // /**\r\n  //  * How many resources a seed needs to be considered \"matured\". Lower is less resources.\r\n  //  */\r\n  // seedNeededResources: TraitValue;\r\n  // /**\r\n  //  * How quickly a seed finishes growing. Higher is faster growth.\r\n  //  */\r\n  // seedGrowthSpeed: TraitValue;\r\n  // /**\r\n  //  * How many mutation points a seed gives. Higher is more mutation.\r\n  //  */\r\n  // seedMutationPoints: TraitValue;\r\n};\r\n\r\nexport type TraitDiff = Partial<Traits> & {\r\n  [traitName: string]: TraitValue;\r\n};\r\n\r\nexport type TraitType = keyof Traits;\r\n\r\nexport function emptyTraits(): Traits {\r\n  return {\r\n    carryCapacity: 0,\r\n    energyEfficiency: 0,\r\n    photosynthesis: 0,\r\n    rootAbsorption: 0,\r\n    structuralStability: 0,\r\n    activeTransportSugar: 0,\r\n    activeTransportWater: 0,\r\n    walkSpeed: 0,\r\n    diffuseWater: 0,\r\n    diffuseSugar: 0,\r\n    buildTime: 0,\r\n  };\r\n}\r\n\r\nexport const TRAIT_TYPES = Object.keys(emptyTraits()) as TraitType[];\r\n\r\nexport function displayName(trait: TraitType) {\r\n  const splits = trait.split(/([A-Z])+/g);\r\n  let displayName = capitalize(splits[0]);\r\n  for (let i = 1; i < splits.length; i += 2) {\r\n    displayName += \" \" + splits[i] + splits[i + 1];\r\n  }\r\n  return displayName;\r\n}\r\n\r\n/**\r\n * Mutates source.\r\n * @param source source\r\n * @param modifier modifier\r\n */\r\nexport function addTraits(source: TraitDiff, modifier: TraitDiff) {\r\n  for (const traitType in modifier) {\r\n    source[traitType] = clampToTraitValue((source[traitType] || 0) + modifier[traitType]!);\r\n  }\r\n}\r\n\r\nexport function clampToTraitValue(t: number): TraitValue {\r\n  return (t < -3 ? -3 : t > 3 ? 3 : t) as TraitValue;\r\n}\r\n\r\nexport function getTraits(genes: Gene[]): Traits {\r\n  const traits: Traits = emptyTraits();\r\n  for (const gene of genes) {\r\n    const traitDiff = getTraitInfluence(gene);\r\n    addTraits(traits, traitDiff);\r\n  }\r\n  return traits;\r\n}\r\n\r\nexport function getTraitInfluence(gene: Gene): TraitDiff {\r\n  const traitDiff: TraitDiff = {};\r\n  const traitTypePlus = dnaPairToTraitType(gene[0]);\r\n  if (traitTypePlus != null) {\r\n    traitDiff[traitTypePlus] = 1;\r\n  }\r\n\r\n  const traitTypeMinus = dnaPairToTraitType(gene[1]);\r\n  if (traitTypeMinus != null) {\r\n    traitDiff[traitTypeMinus] = -1;\r\n  }\r\n  return traitDiff;\r\n}\r\n\r\nexport function dnaPairToTraitType(dnaTuple: DNATuple): TraitType | undefined {\r\n  switch (dnaTuple) {\r\n    case \"AA\":\r\n      return \"walkSpeed\";\r\n    case \"AC\":\r\n      return \"energyEfficiency\";\r\n    case \"AG\":\r\n      return \"photosynthesis\";\r\n    case \"AT\":\r\n      return \"rootAbsorption\";\r\n\r\n    case \"CA\":\r\n      return \"carryCapacity\";\r\n    case \"CC\":\r\n      return \"activeTransportSugar\";\r\n    case \"CG\":\r\n      return \"activeTransportWater\";\r\n    case \"CT\":\r\n      return \"structuralStability\";\r\n\r\n    case \"GA\":\r\n      return \"diffuseSugar\";\r\n    case \"GC\":\r\n      return \"diffuseWater\";\r\n    case \"GG\":\r\n      return \"buildTime\";\r\n    case \"GT\":\r\n\r\n    case \"TA\":\r\n    case \"TC\":\r\n    case \"TG\":\r\n    case \"TT\":\r\n\r\n    default:\r\n      return undefined;\r\n  }\r\n}\r\n\r\nexport function traitMod(val: TraitValue, base: number, exponent: number) {\r\n  return base * Math.pow(exponent, val);\r\n}\r\n","import { Vector2 } from \"three\";\r\n\r\nimport { Noise } from \"../../../common/perlin\";\r\nimport { map } from \"../../../math/index\";\r\nimport { Constructor } from \"../constructor\";\r\nimport { DIRECTIONS } from \"../directions\";\r\nimport { hasInventory, HasInventory, Inventory } from \"../inventory\";\r\nimport { params } from \"../params\";\r\nimport { World } from \"./world\";\r\nimport { Steppable } from \"./entity\";\r\nimport { traitMod } from \"../../../evolution/traits\";\r\n\r\nexport interface HasEnergy {\r\n  energy: number;\r\n}\r\n\r\nexport function hasEnergy<T>(e: T): e is HasEnergy & T {\r\n  return typeof (e as any).energy === \"number\";\r\n}\r\n\r\nexport abstract class Tile implements Steppable {\r\n  static displayName = \"Tile\";\r\n  static fallAmount = 0;\r\n  public isObstacle = false;\r\n  public darkness = Infinity;\r\n  public temperature = 50;\r\n  public nextTemperature?: number;\r\n  get diffusionWater(): number {\r\n    return (this.constructor as any).diffusionWater;\r\n  }\r\n\r\n  get diffusionSugar(): number {\r\n    return (this.constructor as any).diffusionSugar;\r\n  }\r\n\r\n  get fallAmount(): number {\r\n    return (this.constructor as any).fallAmount;\r\n  }\r\n\r\n  public readonly timeMade: number;\r\n\r\n  public pos: Vector2;\r\n  public constructor(pos: Vector2, public readonly world: World) {\r\n    this.pos = pos.clone();\r\n    if (world == null) {\r\n      throw new Error(\"null world!\");\r\n    }\r\n    this.timeMade = world.time;\r\n  }\r\n\r\n  public lightAmount() {\r\n    return Math.sqrt(Math.min(Math.max(map(1 - this.darkness, 0, 1, 0, 1), 0), 1));\r\n  }\r\n\r\n  // test tiles diffusing water around on same-type tiles\r\n  public step() {\r\n    if (this.world.time % 3 !== 0) {\r\n      return;\r\n    }\r\n    const neighbors = this.world.tileNeighbors(this.pos);\r\n    this.stepDarkness(neighbors);\r\n    this.stepDiffusion(neighbors);\r\n    // this.stepTemperature(neighbors);\r\n    this.stepGravity();\r\n  }\r\n\r\n  stepDarkness(neighbors: Map<Vector2, Tile>) {\r\n    if (this instanceof Cell) {\r\n      this.darkness = 0;\r\n    } else {\r\n      let minDarkness = this.darkness;\r\n      for (const [, t] of neighbors) {\r\n        const contrib = Math.max(\r\n          0.2,\r\n          map(this.pos.y, this.world.height / 2, this.world.height, params.soilDarknessBase, 1)\r\n        );\r\n        const darknessFromNeighbor = t instanceof Rock ? Infinity : t.darkness + contrib;\r\n        if (t instanceof Cell) {\r\n          minDarkness = 0;\r\n        } else {\r\n          minDarkness = Math.min(minDarkness, darknessFromNeighbor);\r\n        }\r\n      }\r\n      this.darkness = minDarkness;\r\n      const cellHere = this.world.cellAt(this.pos.x, this.pos.y) != null;\r\n      if (cellHere) {\r\n        console.error(\"stepping environmental tile even when a cell is on-top:\", cellHere);\r\n      }\r\n    }\r\n  }\r\n\r\n  stepDiffusion(neighbors: Map<Vector2, Tile>) {\r\n    if (hasInventory(this)) {\r\n      for (const [dir, tile] of neighbors) {\r\n        if (!this.canDiffuse(dir, tile)) {\r\n          continue;\r\n        }\r\n        // take water from neighbors that have more water than you\r\n        if (this.diffusionWater != null) {\r\n          if (tile.inventory.water > this.inventory.water) {\r\n            this.diffuseWater(tile);\r\n          }\r\n        }\r\n        if (this.diffusionSugar != null) {\r\n          if (tile.inventory.sugar > this.inventory.sugar) {\r\n            this.diffuseSugar(tile);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  stepTemperature(neighbors: Map<Vector2, Tile>) {\r\n    let averageTemperature = 0;\r\n    for (const [, tile] of neighbors) {\r\n      averageTemperature += tile.temperature;\r\n    }\r\n    averageTemperature /= neighbors.size;\r\n    this.nextTemperature = this.temperature * 0.5 + averageTemperature * 0.5;\r\n    if (this.world.season.name === \"spring\") {\r\n      this.nextTemperature -= 0.1;\r\n    }\r\n  }\r\n\r\n  canDiffuse(_dir: Vector2, tile: Tile): tile is Tile & HasInventory {\r\n    return canPullResources(this, tile);\r\n  }\r\n\r\n  diffuseWater(giver: HasInventory) {\r\n    if (hasInventory(this)) {\r\n      if (params.soilDiffusionType === \"continuous\") {\r\n        const diffusionAmount = (giver.inventory.water - this.inventory.water) * this.diffusionWater;\r\n        giver.inventory.give(this.inventory, diffusionAmount, 0);\r\n      } else {\r\n        const waterDiff = giver.inventory.water - this.inventory.water;\r\n        const chanceToHappenScalar = Math.min(waterDiff, 1);\r\n        if (Math.random() < waterDiff * this.diffusionWater * chanceToHappenScalar) {\r\n          giver.inventory.give(this.inventory, 1, 0);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  diffuseSugar(giver: HasInventory) {\r\n    if (hasInventory(this)) {\r\n      const diffusionAmount = (giver.inventory.sugar - this.inventory.sugar) * this.diffusionSugar;\r\n      giver.inventory.give(this.inventory, 0, diffusionAmount);\r\n    }\r\n  }\r\n\r\n  stepGravity() {\r\n    const fallAmount = this.fallAmount;\r\n    const lowerNeighbor = this.world.tileAt(this.pos.x, this.pos.y + 1);\r\n    if (fallAmount > 0 && this.world.time % Math.floor(1 / fallAmount) < 1) {\r\n      if (hasInventory(lowerNeighbor) && canPullResources(lowerNeighbor, this)) {\r\n        this.inventory.give(lowerNeighbor.inventory, 1, 0);\r\n      }\r\n    }\r\n    // if (hasInventory(lowerNeighbor) && fallAmount > 0 && canPullResources(lowerNeighbor, this)) {\r\n    //     this.inventory.give(lowerNeighbor.inventory,\r\n    //         params.soilDiffusionType === \"continuous\" ? fallAmount : randRound(fallAmount),\r\n    //         0);\r\n    // }\r\n  }\r\n}\r\n\r\nfunction allowPull(receiver: any, recieverType: Constructor<any>, giver: any, giverType: Constructor<any>) {\r\n  return receiver instanceof recieverType && giver instanceof giverType;\r\n}\r\n\r\nfunction canPullResources(receiver: any, giver: any): giver is HasInventory {\r\n  return (\r\n    hasInventory(receiver) &&\r\n    hasInventory(giver) &&\r\n    // allow ancestors and children to exchange resources with each other (e.g. Soil and Fountain)\r\n    (receiver instanceof giver.constructor ||\r\n      giver instanceof receiver.constructor ||\r\n      // allow all Cells to give to each other\r\n      (receiver instanceof Cell && giver instanceof Cell) ||\r\n      // allow air to give to soil\r\n      allowPull(receiver, Soil, giver, Air))\r\n  );\r\n}\r\n\r\nconst noiseCo2 = new Noise();\r\nexport class Air extends Tile {\r\n  static displayName = \"Air\";\r\n  static fallAmount = 1;\r\n  static diffusionWater = 0.1;\r\n  public sunlightCached: number = 1;\r\n  public _co2: number;\r\n  public inventory = new Inventory(20, this);\r\n  public constructor(public pos: Vector2, world: World) {\r\n    super(pos, world);\r\n    this.darkness = 0;\r\n    this._co2 = this.computeCo2();\r\n  }\r\n\r\n  private computeCo2() {\r\n    const base = map(this.pos.y, this.world.height / 2, 0, this.world.environment.floorCo2, 1.15);\r\n    const scaleX = map(this.pos.y, this.world.height / 2, 0, 4, 9);\r\n    // const offset = noiseCo2.perlin3(94.2321 - this.pos.x / scaleX, 3221 - this.pos.y / 2.5, world.time / 5 + 93.1) * 0.2;\r\n    const time = this.world == null ? 0 : this.world.time;\r\n    const offset =\r\n      noiseCo2.perlin3(\r\n        94.231 + (this.pos.x - this.world.width / 2) / scaleX,\r\n        2312 + this.pos.y / 8,\r\n        time / 1000 + 93.1\r\n      ) * 0.25;\r\n    // don't compute dark/light or water diffusion\r\n    return Math.max(Math.min(base + offset, 1), Math.min(0.4, this.world.environment.floorCo2 * 0.75));\r\n  }\r\n\r\n  public lightAmount() {\r\n    return this.sunlight();\r\n  }\r\n\r\n  step() {\r\n    if (this.world.time % 3 !== 0) {\r\n      return;\r\n    }\r\n    this.stepGravity();\r\n    const neighbors = this.world.tileNeighbors(this.pos);\r\n    this.stepDiffusion(neighbors);\r\n    this.stepEvaporation();\r\n    // this.stepTemperature(neighbors);\r\n    this._co2 = this.computeCo2();\r\n  }\r\n\r\n  stepEvaporation() {\r\n    if (Math.random() < 0.01 * this.inventory.water) {\r\n      this.inventory.add(-1, 0);\r\n    }\r\n  }\r\n\r\n  canDiffuse(dir: Vector2, tile: Tile): tile is Tile & HasInventory {\r\n    return dir !== DIRECTIONS.s && dir !== DIRECTIONS.sw && dir !== DIRECTIONS.se && super.canDiffuse(dir, tile);\r\n  }\r\n\r\n  public co2() {\r\n    return this._co2;\r\n  }\r\n\r\n  public sunlight() {\r\n    return this.sunlightCached;\r\n  }\r\n}\r\n\r\nexport class Soil extends Tile implements HasInventory {\r\n  static displayName = \"Soil\";\r\n  static diffusionWater = params.soilDiffusionWater;\r\n  public inventory = new Inventory(params.soilMaxWater, this);\r\n  // static fallAmount = params.waterGravityPerTurn;\r\n  get fallAmount() {\r\n    return this.world.environment.waterGravityPerTurn;\r\n  }\r\n\r\n  constructor(pos: Vector2, water: number = 0, world: World) {\r\n    super(pos, world);\r\n    this.inventory.add(water, 0);\r\n  }\r\n\r\n  step() {\r\n    if (this.world.time % 3 !== 0) {\r\n      return;\r\n    }\r\n    super.step();\r\n    this.stepEvaporation();\r\n  }\r\n\r\n  stepEvaporation() {\r\n    const { evaporationRate, evaporationBottom } = this.world.environment;\r\n    const evaporationHeightScalar = map(this.pos.y, this.world.height / 2, this.world.height * evaporationBottom, 1, 0);\r\n    const evaporationAmountScalar = this.inventory.water;\r\n    if (Math.random() < evaporationRate * evaporationHeightScalar * evaporationAmountScalar) {\r\n      this.inventory.add(-1, 0);\r\n    }\r\n  }\r\n}\r\n\r\nexport class Rock extends Tile {\r\n  isObstacle = true;\r\n  static displayName = \"Rock\";\r\n}\r\n\r\nexport class DeadCell extends Tile {\r\n  static displayName = \"Dead Cell\";\r\n}\r\n\r\nexport class Fountain extends Soil {\r\n  static displayName = \"Fountain\";\r\n  isObstacle = true;\r\n  private cooldown = 0;\r\n  constructor(pos: Vector2, water: number = 0, world: World, public turnsPerWater: number) {\r\n    super(pos, water, world);\r\n  }\r\n  step() {\r\n    if (this.world.time % 3 !== 0) {\r\n      return;\r\n    }\r\n    super.step();\r\n    if (this.cooldown > 0) {\r\n      this.cooldown--;\r\n    }\r\n    if (this.inventory.space() > 1 && this.cooldown <= 0) {\r\n      // just constantly give yourself water\r\n      this.inventory.add(1, 0);\r\n      this.cooldown = this.turnsPerWater;\r\n    }\r\n  }\r\n}\r\n\r\nexport class Cell extends Tile implements HasEnergy {\r\n  static displayName = \"Cell\";\r\n  static diffusionWater = params.cellDiffusionWater;\r\n  static diffusionSugar = params.cellDiffusionSugar;\r\n  static turnsToBuild = params.cellGestationTurns;\r\n  public energy: number = params.cellEnergyMax;\r\n  public darkness = 0;\r\n  // offset [-0.5, 0.5] means you're still \"inside\" this cell, going out of it will break you\r\n  // public offset = new Vector2();\r\n  public droopY = 0;\r\n  public args: any[] = [];\r\n\r\n  step() {\r\n    if (this.world.time % 3 !== 0) {\r\n      return;\r\n    }\r\n    super.step();\r\n    this.energy -= 1;\r\n    const tileNeighbors = this.world.tileNeighbors(this.pos);\r\n    const neighbors = Array.from(tileNeighbors.values());\r\n    const neighborsAndSelf = [...neighbors, this];\r\n    for (const tile of neighborsAndSelf) {\r\n      const ate = this.stepEat(tile);\r\n      if (!ate) {\r\n        break;\r\n      }\r\n    }\r\n    if (this.energy < params.cellEnergyMax) {\r\n      const energeticNeighbors = (neighborsAndSelf.filter((t) => hasEnergy(t)) as any) as HasEnergy[];\r\n      for (const neighbor of energeticNeighbors) {\r\n        if (this.energy < params.cellEnergyMax) {\r\n          let energyTransfer = 0;\r\n          // // take energy from neighbors who have more than you - this might be unstable w/o double buffering\r\n          // const targetEnergy = averageEnergy;\r\n          if (neighbor.energy > this.energy) {\r\n            // energyTransfer = Math.floor((neighbor.energy - this.energy) / energeticNeighbors.length);\r\n            energyTransfer = Math.floor((neighbor.energy - this.energy) * 0.25);\r\n            // if (neighbor.energy - energyTransfer < this.energy + energyTransfer) {\r\n            //     throw new Error(\"cell energy diffusion: result of transfer gives me more than target\");\r\n            // }\r\n            if (neighbor.energy - energyTransfer < 0) {\r\n              throw new Error(\"cell energy diffusion: taking more energy than available\");\r\n            }\r\n            if (this.energy + energyTransfer > params.cellEnergyMax) {\r\n              throw new Error(\"cell energy diffusion: taking more energy than i can carry\");\r\n            }\r\n            // const boundedEnergy = Math.min(wantedEnergy, (neighbor.energy + this.energy) / 2);\r\n            this.energy += energyTransfer;\r\n            neighbor.energy -= energyTransfer;\r\n            // console.log(`transfering ${-energyTransfer} from ${this.energy} to ${neighbor.energy}`);\r\n          }\r\n        } else {\r\n          break; // we're all full, eat no more\r\n        }\r\n      }\r\n    }\r\n\r\n    // this.stepStress(tileNeighbors);\r\n    this.stepDroop(tileNeighbors);\r\n    if (this.droopY > 0.5) {\r\n      // make the player ride the train!\r\n      if (this.world.player.pos.equals(this.pos)) {\r\n        this.world.player.pos.y += 1;\r\n      }\r\n      this.world.maybeRemoveCellAt(this.pos);\r\n      if (this.pos.y < this.world.height - 1) {\r\n        this.pos.y += 1;\r\n      }\r\n      this.droopY -= 1;\r\n      // lol whatever lets just test it out\r\n      this.world.setTileAt(this.pos, this);\r\n    }\r\n\r\n    if (this.energy <= 0) {\r\n      // die\r\n      this.world.setTileAt(this.pos, new DeadCell(this.pos, this.world));\r\n    }\r\n  }\r\n\r\n  stepEat(tile: Tile) {\r\n    if (hasInventory(tile) && !(tile instanceof Fruit)) {\r\n      // eat the sugar on your tile to stay alive\r\n      if (this.energy < params.cellEnergyMax) {\r\n        const wantedEnergy = params.cellEnergyMax - this.energy;\r\n        // normally this number is 0.0001 - AKA, 1 energy = 0.0001 sugar.\r\n        // if this number goes up, we become less energy efficient\r\n        // if this number goes down, we are more energy efficient\r\n        const energyToSugarConversion = traitMod(this.world.traits.energyEfficiency, 1 / params.cellEnergyMax, 1 / 1.5);\r\n        const sugarToEat = Math.min(wantedEnergy * energyToSugarConversion, tile.inventory.sugar);\r\n        if (wantedEnergy > 100 && sugarToEat > 0) {\r\n          tile.inventory.add(0, -sugarToEat);\r\n          const gotEnergy = sugarToEat / energyToSugarConversion;\r\n          this.energy += gotEnergy;\r\n          return true;\r\n        }\r\n      }\r\n      return false;\r\n    }\r\n  }\r\n\r\n  // stepStress(tileNeighbors: Map<Vector2, Tile>) {\r\n  //     // start with +y down for gravity\r\n  //     const totalForce = new Vector2(0, 1);\r\n  //     // pretend like you're spring connected to nearby cells,\r\n  //     // and find the equilibrium position as your offset\r\n  //     for (const [dir, neighbor] of tileNeighbors) {\r\n  //         let springTightness = 0;\r\n  //         // neighbor's world position\r\n  //         let neighborX = neighbor.pos.x,\r\n  //             neighborY = neighbor.pos.y;\r\n  //         if (neighbor instanceof Cell) {\r\n  //             neighborX += neighbor.offset.x;\r\n  //             neighborY += neighbor.offset.y;\r\n  //             springTightness = 0.1;\r\n  //         } else if (neighbor instanceof Rock || neighbor instanceof Soil) {\r\n  //             springTightness = 1;\r\n  //         }\r\n  //         const offX = this.pos.x + this.offset.x - neighborX;\r\n  //         const offY = this.pos.y + this.offset.y - neighborY;\r\n  //         // world offset\r\n  //         const offset = new Vector2(offX, offY);\r\n  //         totalForce.x += offX * springTightness;\r\n  //         totalForce.y += offY * springTightness;\r\n  //     }\r\n\r\n  //     this.offset.x += totalForce.x * 0.01;\r\n  //     this.offset.y += totalForce.y * 0.01;\r\n  // }\r\n\r\n  stepDroop(tileNeighbors: Map<Vector2, Tile>) {\r\n    const below = tileNeighbors.get(DIRECTIONS.s)!;\r\n    const belowLeft = tileNeighbors.get(DIRECTIONS.sw)!;\r\n    const belowRight = tileNeighbors.get(DIRECTIONS.se)!;\r\n\r\n    const left = tileNeighbors.get(DIRECTIONS.w)!;\r\n    const right = tileNeighbors.get(DIRECTIONS.e)!;\r\n\r\n    const above = tileNeighbors.get(DIRECTIONS.n)!;\r\n    const aboveLeft = tileNeighbors.get(DIRECTIONS.nw)!;\r\n    const aboveRight = tileNeighbors.get(DIRECTIONS.ne)!;\r\n\r\n    const droopAmount = traitMod(this.world.traits.structuralStability, params.droop, 1 / 1.5);\r\n    this.droopY += droopAmount;\r\n    if (this.energy < params.cellEnergyMax / 2) {\r\n      this.droopY += droopAmount;\r\n    }\r\n\r\n    let hasSupportBelow = false;\r\n    for (const cell of [below, belowLeft, belowRight]) {\r\n      if (cell instanceof Rock || cell instanceof Soil) {\r\n        this.droopY = Math.min(this.droopY, 0);\r\n        return;\r\n      } else if (cell instanceof Cell) {\r\n        this.droopY = Math.min(this.droopY, cell.droopY);\r\n        hasSupportBelow = true;\r\n        return;\r\n      }\r\n    }\r\n\r\n    const springNeighborCells = [aboveLeft, above, aboveRight, left, right, this].filter(\r\n      (n) => n instanceof Cell\r\n    ) as Cell[];\r\n\r\n    // special case - if there's no support and nothing below me, just start freefalling\r\n    if (!hasSupportBelow && springNeighborCells.length === 1) {\r\n      this.droopY += 1;\r\n    } else {\r\n      this.droopY = springNeighborCells.reduce((sum, n) => sum + n.droopY, 0) / springNeighborCells.length;\r\n    }\r\n  }\r\n}\r\n\r\nexport class GrowingCell extends Cell {\r\n  public isObstacle = true;\r\n  public timeRemaining: number;\r\n  public timeToBuild: number;\r\n  constructor(pos: Vector2, world: World, public completedCell: Cell) {\r\n    super(pos, world);\r\n    this.timeRemaining = this.timeToBuild = (completedCell.constructor as any).turnsToBuild || 0;\r\n  }\r\n  step() {\r\n    if (this.world.time % 3 !== 0) {\r\n      return;\r\n    }\r\n    super.step();\r\n    this.timeRemaining--;\r\n    if (this.timeRemaining <= 0) {\r\n      this.world.setTileAt(this.completedCell.pos, this.completedCell);\r\n    }\r\n  }\r\n}\r\n\r\nexport class Tissue extends Cell implements HasInventory {\r\n  static displayName = \"Tissue\";\r\n  public inventory: Inventory;\r\n  constructor(pos: Vector2, world: World) {\r\n    super(pos, world);\r\n    this.inventory = new Inventory(\r\n      Math.floor(traitMod(world.traits.carryCapacity, params.tissueInventoryCapacity, 1.5)),\r\n      this\r\n    );\r\n  }\r\n}\r\n\r\ninterface IHasTilePairs {\r\n  tilePairs: Vector2[];\r\n}\r\n\r\nexport function hasTilePairs(t: any): t is IHasTilePairs {\r\n  return t.tilePairs instanceof Array;\r\n}\r\n\r\nexport class Leaf extends Cell {\r\n  static displayName = \"Leaf\";\r\n  public isObstacle = false;\r\n  public averageEfficiency = 0;\r\n  public averageSpeed = 0;\r\n  public didConvert = false;\r\n  public sugarConverted = 0;\r\n  public tilePairs: Vector2[] = []; // implied that the opposite direction is connected\r\n\r\n  public step() {\r\n    if (this.world.time % 3 !== 0) {\r\n      return;\r\n    }\r\n    super.step();\r\n    this.didConvert = false;\r\n    const neighbors = this.world.tileNeighbors(this.pos);\r\n    this.averageEfficiency = 0;\r\n    this.averageSpeed = 0;\r\n    this.sugarConverted = 0;\r\n    let numAir = 0;\r\n    this.tilePairs = [];\r\n\r\n    for (const [dir, tile] of neighbors) {\r\n      const oppositeTile = this.world.tileAt(this.pos.x - dir.x, this.pos.y - dir.y);\r\n      if (tile instanceof Air && oppositeTile instanceof Tissue) {\r\n        numAir += 1;\r\n        this.tilePairs.push(dir);\r\n        const air = tile;\r\n        const tissue = oppositeTile;\r\n\r\n        // do the reaction slower in dark places\r\n        const speed = air.sunlight();\r\n\r\n        // gives much less sugar lower down\r\n        const efficiency = air.co2();\r\n\r\n        this.averageEfficiency += efficiency;\r\n        this.averageSpeed += speed;\r\n\r\n        const leafReactionRate = traitMod(this.world.traits.photosynthesis, 0.01, 1.5);\r\n\r\n        // in prime conditions:\r\n        //      our rate of conversion is speed * params.leafReactionRate\r\n        //      we get 1 sugar at 1/efficiencyRatio (> 1) water\r\n        // if we have less than 1/efficiencyRatio water\r\n        //      our rate of conversion scales down proportionally\r\n        //      on conversion, we use up all the available water and get the corresponding amount of sugar\r\n        const bestEfficiencyWater = params.leafSugarPerReaction / efficiency;\r\n        const waterToConvert = Math.min(tissue.inventory.water, bestEfficiencyWater);\r\n        const chance = (speed * leafReactionRate * waterToConvert) / bestEfficiencyWater;\r\n        if (Math.random() < chance) {\r\n          this.didConvert = true;\r\n          const sugarConverted = waterToConvert * efficiency;\r\n          tissue.inventory.add(-waterToConvert, sugarConverted);\r\n          this.sugarConverted += sugarConverted;\r\n        }\r\n      }\r\n    }\r\n    if (numAir > 0) {\r\n      this.averageEfficiency /= numAir;\r\n      // this.averageSpeed /= numAir;\r\n    }\r\n  }\r\n}\r\n\r\nexport class Root extends Cell {\r\n  static displayName = \"Root\";\r\n  public waterTransferAmount = 0;\r\n  public isObstacle = false;\r\n  // public tilePairs: Vector2[] = []; // implied that the opposite direction is connected\r\n  public activeNeighbors: Vector2[] = [];\r\n  public inventory = new Inventory(params.tissueInventoryCapacity, this);\r\n  cooldown = 0;\r\n\r\n  public step() {\r\n    if (this.world.time % 3 !== 0) {\r\n      return;\r\n    }\r\n    super.step();\r\n    if (this.cooldown <= 0) {\r\n      this.stepWaterTransfer();\r\n      this.cooldown += traitMod(this.world.traits.rootAbsorption, params.rootTurnsPerTransfer, 1 / 1.5);\r\n    }\r\n    this.cooldown -= 1;\r\n  }\r\n\r\n  private stepWaterTransfer() {\r\n    this.waterTransferAmount = 0;\r\n    // this.tilePairs = [];\r\n    this.activeNeighbors = [];\r\n    const neighbors = this.world.tileNeighbors(this.pos);\r\n    for (const [dir, tile] of neighbors) {\r\n      // const oppositeTile = this.world.tileAt(this.pos.x - dir.x, this.pos.y - dir.y);\r\n      if (\r\n        tile instanceof Soil\r\n        /* && oppositeTile instanceof Tissue*/\r\n      ) {\r\n        // this.tilePairs.push(dir);\r\n        // const transferAmount = Math.ceil(Math.max(0, soilWater - tissueWater) / 2);\r\n        // if (tile.inventory.water > 0) {\r\n        //     const {water: transferAmount} = tile.inventory.give(oppositeTile.inventory, 1, 0);\r\n        //     if (transferAmount > 0) {\r\n        //         this.waterTransferAmount += transferAmount;\r\n        //         // add a random to trigger the !== on water transfer audio\r\n        //         this.waterTransferAmount += Math.random() * 0.0001;\r\n        //     }\r\n        // }\r\n        this.activeNeighbors.push(dir);\r\n        // only do it once\r\n        if (this.waterTransferAmount === 0) {\r\n          const { water } = tile.inventory.give(this.inventory, 1, 0);\r\n          this.waterTransferAmount += water + Math.random() * 0.0001;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport class Fruit extends Cell {\r\n  static displayName = \"Fruit\";\r\n  public isObstacle = true;\r\n  public inventory = new Inventory(8, this);\r\n  static readonly neededResources = 100;\r\n  public committedResources = new Inventory(Fruit.neededResources, this);\r\n  public timeMatured?: number;\r\n\r\n  constructor(pos: Vector2, world: World) {\r\n    super(pos, world);\r\n    this.committedResources.on(\"get\", this.handleGetResources);\r\n  }\r\n\r\n  handleGetResources = () => {\r\n    if (this.timeMatured == null && this.isMature()) {\r\n      this.timeMatured = this.world.time;\r\n    }\r\n    this.committedResources.off(\"get\", this.handleGetResources);\r\n  };\r\n\r\n  // aggressively take the inventory from neighbors\r\n  step() {\r\n    if (this.world.time % 3 !== 0) {\r\n      return;\r\n    }\r\n    super.step();\r\n    const neighbors = this.world.tileNeighbors(this.pos);\r\n    for (const [, neighbor] of neighbors) {\r\n      if (hasInventory(neighbor) && neighbor instanceof Cell) {\r\n        const wantedWater = Fruit.neededResources / 2 - this.committedResources.water;\r\n        const wantedSugar = Fruit.neededResources / 2 - this.committedResources.sugar;\r\n\r\n        neighbor.inventory.give(this.inventory, wantedWater, wantedSugar);\r\n      }\r\n    }\r\n    this.commitResources();\r\n  }\r\n\r\n  commitResources() {\r\n    const wantedWater = Math.min(Fruit.neededResources / 2 - this.committedResources.water, 0.2);\r\n    const wantedSugar = Math.min(Fruit.neededResources / 2 - this.committedResources.sugar, 0.2);\r\n    this.inventory.give(this.committedResources, wantedWater, wantedSugar);\r\n  }\r\n\r\n  getPercentMatured() {\r\n    const r = this.committedResources;\r\n    return (r.sugar + r.water) / r.capacity;\r\n  }\r\n\r\n  isMature() {\r\n    // add 1 buffer for fp errors\r\n    return this.committedResources.water + this.committedResources.sugar >= Fruit.neededResources - 1;\r\n  }\r\n}\r\n\r\nfunction isFractional(x: number) {\r\n  return x % 1 !== 0;\r\n}\r\n\r\nexport class Transport extends Tissue {\r\n  static displayName = \"Transport\";\r\n  public cooldownWater = 0;\r\n  public cooldownSugar = 0;\r\n\r\n  constructor(pos: Vector2, world: World, public dir: Vector2) {\r\n    super(pos, world);\r\n    if (isFractional(dir.x) || isFractional(dir.y)) {\r\n      throw new Error(\"build transport with fractional dir \" + dir.x + \", \" + dir.y);\r\n    }\r\n  }\r\n\r\n  step() {\r\n    if (this.world.time % 3 !== 0) {\r\n      return;\r\n    }\r\n    // transport hungers at double speed\r\n    this.energy -= 1;\r\n    super.step();\r\n    let waterToTransport = 0;\r\n    let sugarToTransport = 0;\r\n    if (this.cooldownWater <= 0) {\r\n      waterToTransport++;\r\n      const turnsPerWater = Math.floor(traitMod(this.world.traits.activeTransportWater, 20, 1 / 1.5));\r\n      this.cooldownWater += turnsPerWater;\r\n    }\r\n    if (this.cooldownSugar <= 0) {\r\n      sugarToTransport++;\r\n      const turnsPerSugar = Math.floor(traitMod(this.world.traits.activeTransportSugar, 20, 1 / 1.5));\r\n      this.cooldownSugar += turnsPerSugar;\r\n    }\r\n\r\n    if (waterToTransport > 0 || sugarToTransport > 0) {\r\n      const targetTile = this.getTarget();\r\n      if (targetTile) {\r\n        this.inventory.give(targetTile.inventory, waterToTransport, sugarToTransport);\r\n      }\r\n\r\n      const fromTile = this.getFrom();\r\n      if (fromTile) {\r\n        fromTile.inventory.give(this.inventory, waterToTransport, sugarToTransport);\r\n      }\r\n    }\r\n    this.cooldownWater -= 1;\r\n    this.cooldownSugar -= 1;\r\n  }\r\n\r\n  public getTarget() {\r\n    const targetTile = this.world.tileAt(this.pos.x + this.dir.x, this.pos.y + this.dir.y);\r\n    if (targetTile instanceof Cell && hasInventory(targetTile)) {\r\n      return targetTile;\r\n    }\r\n  }\r\n\r\n  public getFrom() {\r\n    const fromTile = this.world.tileAt(this.pos.x - this.dir.x, this.pos.y - this.dir.y);\r\n    if (fromTile instanceof Cell && hasInventory(fromTile)) {\r\n      return fromTile;\r\n    }\r\n  }\r\n}\r\n\r\nexport class Vein extends Tissue {\r\n  static displayName = \"Vein\";\r\n  // static diffusionWater = 0;\r\n  static get diffusionWater() {\r\n    return params.veinDiffusion;\r\n  }\r\n  static get diffusionSugar() {\r\n    return params.veinDiffusion;\r\n  }\r\n  public inventory = new Inventory(8, this);\r\n  // diffusionNeighbors(neighbors: Map<Vector2, Tile>) {\r\n  //     return super.diffusionNeighbors(neighbors).filter((t) => t instanceof Vein);\r\n  // }\r\n}\r\n","import { EventEmitter } from \"events\";\r\nimport { Vector2 } from \"three\";\r\nimport {\r\n  Action,\r\n  ActionBuild,\r\n  ActionDeconstruct,\r\n  ActionDrop,\r\n  ActionMove,\r\n  ActionMultiple,\r\n  ActionPickup,\r\n} from \"../action\";\r\nimport { build, footsteps } from \"../audio\";\r\nimport { Constructor } from \"../constructor\";\r\nimport { hasInventory, Inventory } from \"../inventory\";\r\nimport { params } from \"../params\";\r\nimport { Cell, Fruit, GrowingCell, Tile, Transport } from \"./tile\";\r\nimport { World } from \"./world\";\r\nimport { Steppable } from \"./entity\";\r\nimport { traitMod } from \"../../../evolution/traits\";\r\n\r\nexport class Player implements Steppable {\r\n  public inventory = new Inventory(\r\n    params.maxResources,\r\n    this,\r\n    Math.round(params.maxResources / 3),\r\n    Math.round(params.maxResources / 3)\r\n  );\r\n  private action?: Action;\r\n  private events = new EventEmitter();\r\n  public mapActions?: (player: Player, action: Action) => Action | undefined;\r\n  public speed: number;\r\n  // public dropWater = false;\r\n  // public dropSugar = false;\r\n\r\n  get pos() {\r\n    return this.posFloat.clone().round();\r\n  }\r\n\r\n  public constructor(public posFloat: Vector2, public world: World) {\r\n    this.speed = traitMod(world.traits.walkSpeed, 0.15, 1.5);\r\n  }\r\n\r\n  public setAction(action: Action) {\r\n    if (this.action != null) {\r\n      this.action = {\r\n        type: \"multiple\",\r\n        actions: [this.action, action],\r\n      };\r\n    } else {\r\n      this.action = action;\r\n    }\r\n  }\r\n\r\n  public getAction() {\r\n    return this.action;\r\n  }\r\n\r\n  public droopY() {\r\n    const tile = this.world.tileAt(this.pos.x, this.pos.y);\r\n    if (tile instanceof Cell) {\r\n      return tile.droopY;\r\n    } else {\r\n      return 0;\r\n    }\r\n  }\r\n\r\n  public droopPosFloat() {\r\n    const droopY = this.droopY();\r\n    if (droopY !== 0) {\r\n      const t = this.posFloat.clone();\r\n      t.y += droopY;\r\n      return t;\r\n    }\r\n    return this.posFloat;\r\n  }\r\n\r\n  public currentTile() {\r\n    return this.world.tileAt(this.pos);\r\n  }\r\n\r\n  public on(event: string, cb: (...args: any[]) => void) {\r\n    this.events.on(event, cb);\r\n  }\r\n\r\n  public step() {\r\n    if (this.action === undefined) {\r\n      this.action = { type: \"none\" };\r\n    }\r\n    if (this.mapActions) {\r\n      const mappedAction = this.mapActions(this, this.action);\r\n      if (mappedAction != null) {\r\n        this.action = mappedAction;\r\n      } else {\r\n        this.action = { type: \"none\" };\r\n      }\r\n    }\r\n    const actionSuccessful = this.attemptAction(this.action);\r\n    this.maybeMoveWithTransports();\r\n    // if (this.dropWater) {\r\n    //   this.attemptAction(ACTION_KEYMAP.q);\r\n    // }\r\n    // if (this.dropSugar) {\r\n    //   this.attemptAction(ACTION_KEYMAP.e);\r\n    // }\r\n    if (actionSuccessful) {\r\n      this.events.emit(\"action\", this.action);\r\n    }\r\n    this.action = undefined;\r\n  }\r\n\r\n  private maybeMoveWithTransports() {\r\n    const tile = this.currentTile();\r\n    if (tile instanceof Transport) {\r\n      this.posFloat.add(tile.dir.clone().setLength(this.speed * 0.15));\r\n    }\r\n  }\r\n\r\n  public attemptAction(action: Action): boolean {\r\n    switch (action.type) {\r\n      case \"none\":\r\n        // literally do nothing\r\n        return true;\r\n      case \"still\":\r\n        return this.attemptStill();\r\n      case \"move\":\r\n        return this.attemptMove(action);\r\n      case \"build\":\r\n        return this.attemptBuild(action);\r\n      case \"deconstruct\":\r\n        return this.attemptDeconstruct(action);\r\n      case \"drop\":\r\n        return this.attemptDrop(action);\r\n      case \"pickup\":\r\n        return this.attemptPickup(action);\r\n      case \"multiple\":\r\n        return this.attemptMultiple(action);\r\n    }\r\n  }\r\n  public verifyMove(action: ActionMove) {\r\n    const target = this.posFloat\r\n      .clone()\r\n      .add(action.dir.clone().setLength(this.speed))\r\n      .round();\r\n    return this.isWalkable(target);\r\n  }\r\n\r\n  public isWalkable(pos: Tile | Vector2) {\r\n    if (pos instanceof Tile) {\r\n      pos = pos.pos;\r\n    }\r\n    if (!this.world.isValidPosition(pos.x, pos.y)) {\r\n      return false;\r\n    }\r\n    const targetTile = this.world.tileAt(pos.x, pos.y);\r\n    if (!(targetTile instanceof Cell) || targetTile == null || targetTile.isObstacle) {\r\n      // can't move!\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  public isBuildCandidate(tile: Tile | null): tile is Tile {\r\n    if (tile != null && !tile.isObstacle) {\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  public attemptMove(action: ActionMove) {\r\n    if (this.verifyMove(action)) {\r\n      footsteps.audio.currentTime = Math.random() * 0.05;\r\n      footsteps.gain.gain.cancelScheduledValues(0);\r\n      footsteps.gain.gain.value = 1.0;\r\n      footsteps.gain.gain.linearRampToValueAtTime(0, footsteps.gain.context.currentTime + 0.05);\r\n      // do the move\r\n      this.posFloat.add(action.dir.clone().setLength(this.speed));\r\n      // this._pos = this.posFloat.clone().round();\r\n      // this.autopickup();\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n  public attemptStill() {\r\n    // this.autopickup();\r\n    return true;\r\n  }\r\n  // private autopickup() {\r\n  //   // autopickup resources in the position as possible\r\n  //   const cell = this.currentTile();\r\n  //   if (hasInventory(cell)) {\r\n  //     const inv = cell.inventory;\r\n  //     inv.give(this.inventory, this.suckWater ? inv.water : 0, this.suckSugar ? inv.sugar : 0);\r\n  //   }\r\n  // }\r\n  public tryConstructingNewCell<T extends Cell>(position: Vector2, cellType: Constructor<T>, args: any[]) {\r\n    position = position.clone();\r\n    const targetTile = this.world.tileAt(position.x, position.y);\r\n    if (targetTile == null) {\r\n      // out of bounds/out of map\r\n      return;\r\n    }\r\n    // disallow building over a seed\r\n    if (targetTile instanceof Fruit) {\r\n      return;\r\n    }\r\n    const waterCost = 1;\r\n    const sugarCost = 1;\r\n    const tileAlreadyExists =\r\n      targetTile instanceof cellType && !((cellType as any) === Transport && targetTile instanceof Transport);\r\n    if (\r\n      !tileAlreadyExists &&\r\n      !targetTile.isObstacle &&\r\n      this.inventory.water >= waterCost &&\r\n      this.inventory.sugar >= sugarCost\r\n    ) {\r\n      this.inventory.add(-waterCost, -sugarCost);\r\n      const newTile = new cellType(position, this.world, ...args);\r\n      newTile.args = args;\r\n      build.audio.currentTime = 0;\r\n      build.gain.gain.cancelScheduledValues(0);\r\n      build.gain.gain.value = 0.2;\r\n      build.gain.gain.exponentialRampToValueAtTime(0.0001, build.gain.context.currentTime + 0.5);\r\n      return newTile;\r\n    } else {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  private argsEq(args1: any, args2: any) {\r\n    if (typeof args1 !== typeof args2) {\r\n      return false;\r\n    }\r\n    if (args1 == null && args2 == null) {\r\n      return true;\r\n    }\r\n    if (args1 instanceof Vector2 && args2 instanceof Vector2) {\r\n      return args1.equals(args2);\r\n    }\r\n    if (args1 instanceof Array && args2 instanceof Array) {\r\n      const allEq = args1.every((_, index) => this.argsEq(args1[index], args2[index]));\r\n      return allEq;\r\n    }\r\n  }\r\n\r\n  private isMeaningfulBuild(action: ActionBuild, existingCell: Cell) {\r\n    if (existingCell.constructor !== action.cellType) {\r\n      return true;\r\n    }\r\n\r\n    if (!this.argsEq(action.args, existingCell.args)) {\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  public attemptBuild(action: ActionBuild) {\r\n    const existingCell = this.world.cellAt(action.position.x, action.position.y);\r\n    if (existingCell != null && !this.isMeaningfulBuild(action, existingCell)) {\r\n      // already built, whatever.\r\n      return true;\r\n    }\r\n    if (existingCell) {\r\n      this.attemptDeconstruct({\r\n        type: \"deconstruct\",\r\n        position: action.position,\r\n        force: true,\r\n      });\r\n    }\r\n    const matureCell = this.tryConstructingNewCell(action.position, action.cellType, action.args);\r\n    if (matureCell != null) {\r\n      let cell: Cell;\r\n      if (action.cellType.turnsToBuild) {\r\n        cell = new GrowingCell(action.position, this.world, matureCell);\r\n      } else {\r\n        cell = matureCell;\r\n      }\r\n      cell.droopY = this.droopY();\r\n      this.world.setTileAt(action.position, cell);\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  public attemptDeconstruct(action: ActionDeconstruct): boolean {\r\n    if (!action.position.equals(this.pos) || action.force) {\r\n      const cell = this.world.maybeRemoveCellAt(action.position);\r\n      if (cell != null) {\r\n        // refund the resources back\r\n        const refund = cell.energy / params.cellEnergyMax;\r\n        this.inventory.add(refund, refund);\r\n        if (hasInventory(cell)) {\r\n          cell.inventory.give(this.inventory, cell.inventory.water, cell.inventory.sugar);\r\n        }\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  public attemptDrop(action: ActionDrop) {\r\n    // drop as much as you can onto the current tile\r\n    const currentTile = this.currentTile();\r\n    if (hasInventory(currentTile)) {\r\n      const { water, sugar } = action;\r\n      // first, pick up the opposite of what you can from the tile to try and make space\r\n      currentTile.inventory.give(this.inventory, sugar, water);\r\n\r\n      // give as much as you can\r\n      this.inventory.give(currentTile.inventory, water, sugar);\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  public attemptPickup(action: ActionPickup) {\r\n    const cell = this.currentTile();\r\n    if (hasInventory(cell)) {\r\n      const inv = cell.inventory;\r\n      inv.give(this.inventory, action.water, action.sugar);\r\n    }\r\n    return true;\r\n    // // drop as much as you can onto the current tile\r\n    // const currentTile = this.currentTile();\r\n    // if (hasInventory(currentTile)) {\r\n    //   const { water, sugar } = action;\r\n    //   // first, pick up the opposite of what you can from the tile to try and make space\r\n    //   currentTile.inventory.give(this.inventory, sugar, water);\r\n\r\n    //   // give as much as you can\r\n    //   this.inventory.give(currentTile.inventory, water, sugar);\r\n    //   return true;\r\n    // } else {\r\n    //   return false;\r\n    // }\r\n  }\r\n\r\n  public attemptMultiple(multiple: ActionMultiple) {\r\n    let allSuccess = true;\r\n    for (const action of multiple.actions) {\r\n      allSuccess = this.attemptAction(action) && allSuccess;\r\n    }\r\n    return allSuccess;\r\n  }\r\n}\r\n","import { Vector2 } from \"three\";\r\nimport * as THREE from \"three\";\r\n\r\nimport devlog from \"../../../common/devlog\";\r\nimport { DIRECTION_VALUES } from \"../directions\";\r\nimport { hasInventory } from \"../inventory\";\r\nimport { params } from \"../params\";\r\nimport { Environment } from \"./environment\";\r\nimport { Player } from \"./player\";\r\nimport { Air, Cell, DeadCell, hasEnergy, Rock, Soil, Tile, Tissue, Fruit } from \"./tile\";\r\nimport { Entity, isSteppable } from \"./entity\";\r\nimport { GameResult } from \"..\";\r\nimport { Traits, traitMod, getTraits } from \"../../../evolution/traits\";\r\nimport { Species } from \"../../../evolution/species\";\r\n\r\nexport class StepStats {\r\n  constructor(public deleted: Entity[] = [], public added: Entity[] = []) { }\r\n}\r\n\r\nexport interface Season {\r\n  name: \"spring\" | \"summer\" | \"fall\" | \"winter\";\r\n  percent: number;\r\n}\r\n\r\nconst SEASON_ORDER: Season[\"name\"][] = [\"spring\", \"summer\", \"fall\", \"winter\"];\r\n\r\nexport const TIME_PER_YEAR = 30 * 60 * 6; // 30 fps * 60 seconds/minute * 6 minutes\r\nexport const TIME_PER_SEASON = TIME_PER_YEAR / 4;\r\n\r\nexport class World {\r\n  public time: number = 0;\r\n  public readonly width = 50;\r\n  public readonly height = 100;\r\n  public readonly player: Player;\r\n  private readonly gridEnvironment: Tile[][];\r\n  private readonly gridCells: Array<Array<Cell | null>>;\r\n  private readonly neighborCache: Array<Array<Map<Vector2, Tile>>>;\r\n  private readonly wipResult: Omit<GameResult, \"status\">;\r\n  public readonly species: Species;\r\n  public readonly traits: Traits;\r\n\r\n  get season() {\r\n    const name = SEASON_ORDER[Math.floor(this.time / TIME_PER_SEASON)];\r\n    const percent = (this.time % TIME_PER_SEASON) / TIME_PER_SEASON;\r\n    return {\r\n      name,\r\n      percent,\r\n    };\r\n  }\r\n\r\n  constructor(public environment: Environment, species: Species) {\r\n    this.wipResult = {\r\n      fruits: [],\r\n      world: this,\r\n    };\r\n    this.species = species;\r\n    this.traits = getTraits(this.species.genes);\r\n    Cell.diffusionWater = traitMod(this.traits.diffuseWater, params.cellDiffusionWater, 2);\r\n    Cell.diffusionSugar = traitMod(this.traits.diffuseSugar, params.cellDiffusionSugar, 2);\r\n    Cell.turnsToBuild = Math.floor(traitMod(this.traits.buildTime, params.cellGestationTurns, 1 / 2));\r\n    this.player = new Player(new Vector2(this.width / 2, this.height / 2), this);\r\n    this.gridEnvironment = new Array(this.width).fill(undefined).map((_, x) =>\r\n      new Array(this.height).fill(undefined).map((__, y) => {\r\n        const pos = new Vector2(x, y);\r\n\r\n        let tile: Tile | undefined;\r\n        for (const fillFunction of environment.fill) {\r\n          const t = fillFunction(pos, this);\r\n          if (t != null) {\r\n            tile = t;\r\n            break;\r\n          }\r\n        }\r\n        if (tile == null) {\r\n          tile = new Air(pos, this);\r\n        }\r\n        return tile;\r\n      })\r\n    );\r\n\r\n    // always drop player on the Soil Air interface\r\n    const playerX = this.player.pos.x;\r\n    const firstSoil = this.gridEnvironment[playerX].find((t) => !(t instanceof Air));\r\n    if (firstSoil) {\r\n      this.player.posFloat.y = firstSoil.pos.y;\r\n    }\r\n\r\n    const radius = 2.5;\r\n    this.gridCells = new Array(this.width).fill(undefined).map((_, x) =>\r\n      new Array(this.height).fill(undefined).map((__, y) => {\r\n        const pos = new Vector2(x, y);\r\n        // add a \"seed\" of tissue around the player\r\n        if (this.player.pos.distanceTo(pos) < radius) {\r\n          // prevent Rocks underneath the seed\r\n          if (this.gridEnvironment instanceof Rock) {\r\n            this.gridEnvironment[x][y] = new Soil(new Vector2(x, y), 0, this);\r\n          }\r\n          return new Tissue(pos, this);\r\n        } else {\r\n          return null;\r\n        }\r\n      })\r\n    );\r\n    this.neighborCache = new Array(this.width).fill(undefined).map((_, x) =>\r\n      new Array(this.height).fill(undefined).map((__, y) => {\r\n        return this.computeTileNeighbors(x, y);\r\n      })\r\n    );\r\n    this.fillCachedEntities();\r\n\r\n    // // auto-add Roots\r\n    // const {x, y} = this.player.pos;\r\n    // this.newTile(x - 1, y + 2, Root);\r\n    // this.newTile(x + 1, y + 2, Root);\r\n\r\n    // // auto-add Veins\r\n    // for (let yTemp = y - 2; yTemp <= y + 2; yTemp++) {\r\n    //     this.newTile(x, yTemp, Vein);\r\n    // }\r\n    // this.newTile(x - 1, y + 2, Vein);\r\n    // this.newTile(x + 1, y + 2, Vein);\r\n    // this.newTile(x - 1, y - 1, Vein);\r\n    // this.newTile(x + 1, y - 1, Vein);\r\n\r\n    // // auto-add Leaves\r\n    // this.newTile(x, y - 2, Leaf);\r\n    // this.newTile(x + 1, y - 2, Leaf);\r\n    // this.newTile(x - 1, y - 2, Leaf);\r\n  }\r\n\r\n  public tileAt(v: Vector2): Tile | null;\r\n  public tileAt(x: number, y: number): Tile | null;\r\n  public tileAt(xOrVec2: number | Vector2, y?: number): Tile | null {\r\n    let x: number;\r\n    if (xOrVec2 instanceof Vector2) {\r\n      x = xOrVec2.x;\r\n      y = xOrVec2.y;\r\n    } else {\r\n      x = xOrVec2;\r\n      y = y!;\r\n    }\r\n\r\n    if (!this.isValidPosition(x, y)) {\r\n      return null;\r\n    }\r\n    const cell = this.gridCells[x][y];\r\n    if (cell != null) {\r\n      return cell;\r\n    } else {\r\n      return this.gridEnvironment[x][y];\r\n    }\r\n  }\r\n\r\n  public cellAt(x: number, y: number): Cell | null {\r\n    if (this.isValidPosition(x, y)) {\r\n      return this.gridCells[x][y];\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  public environmentTileAt(x: number, y: number): Tile | null {\r\n    if (this.isValidPosition(x, y)) {\r\n      return this.gridEnvironment[x][y];\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  // Rules for replacement:\r\n  // if tile is environment, clear out the gridCell and set the gridEnvironment.\r\n  // if tile is cell, set gridCell, leave gridEnvironment alone.\r\n  public setTileAt(position: Vector2, tile: Tile): any {\r\n    const { x, y } = position;\r\n    if (!this.isValidPosition(x, y)) {\r\n      throw new Error(`invalid position ${x}, ${y} `);\r\n    }\r\n    if (tile instanceof Fruit) {\r\n      this.wipResult.fruits.push(tile);\r\n    }\r\n    const oldTile = this.tileAt(x, y)!;\r\n    // if replacing a tile with inventory, try giving resources to neighbors of the same type\r\n    if (hasInventory(oldTile)) {\r\n      // one mechanic - push water to nearby tiles\r\n      // const neighbors = this.tileNeighbors(position);\r\n      // for (const neighbor of neighbors.values()) {\r\n      //     if (hasInventory(neighbor) && neighbor instanceof oldTile.constructor) {\r\n      //         oldTile.inventory.give(neighbor.inventory, oldTile.inventory.water, oldTile.inventory.sugar);\r\n      //     }\r\n      //     if (oldTile.inventory.water === 0 && oldTile.inventory.sugar === 0) {\r\n      //         // we're all done\r\n      //         break;\r\n      //     }\r\n      // }\r\n      if (hasInventory(tile)) {\r\n        oldTile.inventory.give(tile.inventory, oldTile.inventory.water, oldTile.inventory.sugar);\r\n      }\r\n      if (oldTile.inventory.water !== 0 || oldTile.inventory.sugar !== 0) {\r\n        console.warn(\"lost\", oldTile.inventory, \"resources to building\");\r\n        oldTile.inventory.add(-oldTile.inventory.water, -oldTile.inventory.sugar);\r\n      }\r\n    }\r\n\r\n    const oldCell = this.gridCells[x][y];\r\n    if (oldCell != null) {\r\n      this.stepStats.deleted.push(oldCell);\r\n    }\r\n\r\n    if (tile instanceof Cell) {\r\n      // set gridCell only\r\n      this.gridCells[x][y] = tile;\r\n    } else {\r\n      // hackhack - we should call .die() on gridCells[x][y] but we already have with the oldTile code above\r\n      this.gridCells[x][y] = null;\r\n\r\n      const oldEnvironmentTile = this.gridEnvironment[x][y];\r\n      if (oldEnvironmentTile != null) {\r\n        this.stepStats.deleted.push(oldEnvironmentTile);\r\n      }\r\n      this.gridEnvironment[x][y] = tile;\r\n    }\r\n    this.stepStats.added.push(tile);\r\n    this.handleTileUpdated(position);\r\n  }\r\n  public maybeRemoveCellAt(position: Vector2): Cell | null {\r\n    const maybeCell = this.cellAt(position.x, position.y);\r\n    if (maybeCell) {\r\n      this.gridCells[position.x][position.y] = null;\r\n      this.stepStats.deleted.push(maybeCell);\r\n    }\r\n    this.handleTileUpdated(position);\r\n    return maybeCell;\r\n  }\r\n  public isValidPosition(x: number, y: number) {\r\n    if (x >= this.width || x < 0 || y >= this.height || y < 0) {\r\n      return false;\r\n    } else {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  public tileNeighbors(pos: Vector2) {\r\n    return this.neighborCache[pos.x][pos.y];\r\n  }\r\n\r\n  private computeTileNeighbors(px: number, py: number) {\r\n    const mapping = new Map<Vector2, Tile>();\r\n    // randomize the neighbor array to reduce aliasing\r\n    const directions = DIRECTION_VALUES_RAND[this.time % DIRECTION_VALUES_RAND.length];\r\n    directions.forEach((v) => {\r\n      const x = px + v.x;\r\n      const y = py + v.y;\r\n      const tile = this.tileAt(x, y);\r\n      if (tile != null) {\r\n        mapping.set(v, tile);\r\n      }\r\n    });\r\n    return mapping;\r\n  }\r\n  // only use for rendering\r\n  // private cachedRenderableEntities?: Entity[];\r\n  // public renderableEntities() {\r\n  //     if (this.cachedRenderableEntities == null) {\r\n  //         throw new Error(\"accessed renderable entities before filling\");\r\n  //     }\r\n  //     return this.cachedRenderableEntities;\r\n  // }\r\n\r\n  private cachedEntities?: Entity[];\r\n  public entities() {\r\n    if (this.cachedEntities == null) {\r\n      throw new Error(\"accessed entities before filling\");\r\n    }\r\n    return this.cachedEntities;\r\n  }\r\n\r\n  private handleTileUpdated(pos: Vector2) {\r\n    this.neighborCache[pos.x][pos.y] = this.computeTileNeighbors(pos.x, pos.y);\r\n    for (const dir of DIRECTION_VALUES) {\r\n      const x = pos.x + dir.x;\r\n      const y = pos.y + dir.y;\r\n      if (this.isValidPosition(x, y)) {\r\n        this.neighborCache[x][y] = this.computeTileNeighbors(x, y);\r\n      }\r\n    }\r\n    this.fillCachedEntities();\r\n  }\r\n  private fillCachedEntities() {\r\n    const newEntities: Entity[] = [];\r\n    // we do this super hacky thing for performance where we only run every other entity in\r\n    // a checkerboard pattern.\r\n    //\r\n    // also, entities can interact with other entities, there is no lock-step buffer state,\r\n    // which means you can get weird artifacts like \"water suddenly moves 20 squares\".\r\n    // to combat this we alternatingly reverse the tile iteration order.\r\n    let x = 0,\r\n      y = 0;\r\n    for (x = 0; x < this.width; x++) {\r\n      for (y = (x + this.time) % 2; y < this.height; y += 2) {\r\n        // checkerboard\r\n        newEntities.push(this.tileAt(x, y)!);\r\n      }\r\n    }\r\n    for (x = 0; x < this.width; x++) {\r\n      for (y = (x + this.time + 1) % 2; y < this.height; y += 2) {\r\n        // opposite checkerboard\r\n        newEntities.push(this.tileAt(x, y)!);\r\n      }\r\n    }\r\n    if (this.time % 4 < 2) {\r\n      newEntities.reverse();\r\n    }\r\n    // add player at the end - this is important since Player is currently the only thing\r\n    // that modifies tiles. You can get into situations where tiles that should be dead\r\n    // are still left-over in the entities cache.\r\n    newEntities.push(this.player);\r\n    this.cachedEntities = newEntities;\r\n\r\n    // update renderable entities\r\n    // (() => {\r\n    //     const entities: Entity[] = [this.player];\r\n    //     for (x = 0; x < width; x++) {\r\n    //         for (y = 0; y < height; y++) {\r\n    //             entities.push(this.gridEnvironment[x][y]);\r\n    //             const cellMaybe = this.gridCells[x][y];\r\n    //             if (cellMaybe != null) {\r\n    //                 entities.push(cellMaybe);\r\n    //             }\r\n    //         }\r\n    //     }\r\n    //     this.cachedRenderableEntities = entities;\r\n    // })();\r\n  }\r\n  // iterate through all the actions\r\n  private stepStats: StepStats = new StepStats();\r\n  public step(): StepStats {\r\n    const entities = this.entities();\r\n    this.stepStats = new StepStats();\r\n    // dear god\r\n    entities.forEach((entity) => {\r\n      if (isSteppable(entity)) {\r\n        entity.step();\r\n      }\r\n    });\r\n    this.computeSunlight();\r\n    // this.computeTemperature();\r\n    this.stepWeather();\r\n    this.time++;\r\n    this.fillCachedEntities();\r\n    return this.stepStats;\r\n    // this.checkResources();\r\n  }\r\n\r\n  public getLastStepStats() {\r\n    return this.stepStats;\r\n  }\r\n\r\n  public stepWeather() {\r\n    // offset first rain event by 300 turns\r\n    const isRaining =\r\n      (this.time + this.environment.climate.turnsBetweenRainfall - 200) %\r\n      this.environment.climate.turnsBetweenRainfall <\r\n      this.environment.climate.rainDuration;\r\n    if (isRaining) {\r\n      const x = THREE.Math.randInt(0, this.width - 1);\r\n      const t = this.tileAt(x, 0);\r\n      if (t instanceof Air) {\r\n        t.inventory.add(this.environment.climate.waterPerDroplet, 0);\r\n      }\r\n    }\r\n  }\r\n\r\n  public computeSunlight() {\r\n    // sunlight is special - we step downards from the top; neighbors don't affect the calculation so we don't have buffering problems\r\n    // 0 to PI = daytime, PI to 2PI = nighttime\r\n    const sunAngle = (this.time * Math.PI * 2) / 1000;\r\n    const directionalBias = Math.sin(sunAngle + Math.PI / 2);\r\n    const sunAmount = (Math.atan(Math.sin(sunAngle) * 12) / (Math.PI / 2)) * 0.5 + 0.5;\r\n    for (let y = 0; y <= this.height * 0.6; y++) {\r\n      for (let x = 0; x < this.width; x++) {\r\n        const t = this.environmentTileAt(x, y);\r\n        if (t instanceof Air) {\r\n          let sunlight = 0;\r\n          if (y === 0) {\r\n            sunlight = 1;\r\n          } else {\r\n            const tileUp = this.tileAt(x, y - 1);\r\n            const tileRight = this.tileAt(x + 1, y - 1);\r\n            const tileLeft = this.tileAt(x - 1, y - 1);\r\n            const upSunlight = tileUp instanceof Air ? tileUp.sunlightCached / sunAmount : tileUp == null ? 1 : 0;\r\n            const rightSunlight =\r\n              tileRight instanceof Air ? tileRight.sunlightCached / sunAmount : tileRight == null ? 1 : 0;\r\n            const leftSunlight =\r\n              tileLeft instanceof Air ? tileLeft.sunlightCached / sunAmount : tileLeft == null ? 1 : 0;\r\n            if (directionalBias > 0) {\r\n              // positive light travels to the right\r\n              sunlight = rightSunlight * directionalBias + upSunlight * (1 - directionalBias);\r\n            } else {\r\n              sunlight = leftSunlight * -directionalBias + upSunlight * (1 - -directionalBias);\r\n            }\r\n            sunlight =\r\n              sunlight * (1 - params.sunlightDiffusion) +\r\n              ((upSunlight + rightSunlight + leftSunlight) / 3) * params.sunlightDiffusion;\r\n          }\r\n          // have at least a bit\r\n          sunlight = params.sunlightReintroduction + sunlight * (1 - params.sunlightReintroduction);\r\n\r\n          sunlight *= sunAmount;\r\n          t.sunlightCached = sunlight;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  public computeTemperature() {\r\n    for (const t of this.entities()) {\r\n      if (t instanceof Tile && t.nextTemperature != null) {\r\n        t.temperature = t.nextTemperature;\r\n      }\r\n    }\r\n  }\r\n\r\n  public maybeGetGameResult(): GameResult | null {\r\n    // you lose if you're standing on a dead cell\r\n    if (this.tileAt(this.player.pos.x, this.player.pos.y) instanceof DeadCell) {\r\n      return {\r\n        ...this.wipResult,\r\n        status: \"lost\",\r\n      };\r\n    }\r\n    if (this.time < TIME_PER_YEAR) {\r\n      return null;\r\n    }\r\n    // at the end of the year, we make a decision:\r\n    // you lose if you haven't made a single mature fruit\r\n    const matureFruit = this.wipResult.fruits.filter((f) => f.isMature());\r\n    if (matureFruit.length === 0) {\r\n      return {\r\n        ...this.wipResult,\r\n        status: \"lost\",\r\n      };\r\n    }\r\n    // you win if there's a seed with full capacity\r\n    return {\r\n      ...this.wipResult,\r\n      status: \"won\",\r\n    };\r\n  }\r\n\r\n  public checkResources() {\r\n    let totalSugar = 0;\r\n    let totalWater = 0;\r\n    let totalEnergy = 0;\r\n    this.entities().forEach((e) => {\r\n      if (hasInventory(e)) {\r\n        totalSugar += e.inventory.sugar;\r\n        totalWater += e.inventory.water;\r\n      }\r\n      if (hasEnergy(e)) {\r\n        totalEnergy += e.energy;\r\n      }\r\n    });\r\n    devlog(\"sugar\", totalSugar, \"water\", totalWater, \"energy\", totalEnergy);\r\n  }\r\n\r\n  public environmentTiles() {\r\n    const self = this;\r\n    return {\r\n      *[Symbol.iterator]() {\r\n        for (const row of self.gridEnvironment) {\r\n          for (const t of row) {\r\n            yield t;\r\n          }\r\n        }\r\n      },\r\n    };\r\n  }\r\n}\r\n\r\nfunction shuffle<T>(array: T[]) {\r\n  let currentIndex = array.length,\r\n    temporaryValue,\r\n    randomIndex;\r\n  // While there remain elements to shuffle...\r\n  while (0 !== currentIndex) {\r\n    // Pick a remaining element...\r\n    randomIndex = Math.floor(Math.random() * currentIndex);\r\n    currentIndex -= 1;\r\n    // And swap it with the current element.\r\n    temporaryValue = array[currentIndex];\r\n    array[currentIndex] = array[randomIndex];\r\n    array[randomIndex] = temporaryValue;\r\n  }\r\n  return array;\r\n}\r\nconst DIRECTION_VALUES_RAND = [\r\n  shuffle(DIRECTION_VALUES.slice()),\r\n  shuffle(DIRECTION_VALUES.slice()),\r\n  shuffle(DIRECTION_VALUES.slice()),\r\n  shuffle(DIRECTION_VALUES.slice()),\r\n  shuffle(DIRECTION_VALUES.slice()),\r\n];\r\n","import { Tile } from \"./tile\";\r\nimport { Player } from \"./player\";\r\n\r\nexport type Entity = Tile | Player;\r\n\r\nexport interface Steppable {\r\n  step(): void;\r\n}\r\n\r\nexport function isSteppable(obj: any): obj is Steppable {\r\n  return typeof obj.step === \"function\";\r\n}\r\n","import { Action, ActionMove } from \"./action\";\r\nimport { DIRECTIONS } from \"./directions\";\r\n\r\nexport const ACTION_KEYMAP: { [key: string]: Action } = {\r\n  q: {\r\n    type: \"drop\",\r\n    sugar: 0,\r\n    water: 1, // hack hack we can assume max 100 water, it's fine\r\n  },\r\n  e: {\r\n    type: \"drop\",\r\n    sugar: 1,\r\n    water: 0, // hack hack we can assume max 100 water, it's fine\r\n  },\r\n  \" \": {\r\n    type: \"pickup\",\r\n    sugar: 1,\r\n    water: 1,\r\n  },\r\n};\r\n\r\nexport const MOVEMENT_KEYS: { [key: string]: ActionMove } = {\r\n  w: {\r\n    type: \"move\",\r\n    dir: DIRECTIONS.n,\r\n  },\r\n  a: {\r\n    type: \"move\",\r\n    dir: DIRECTIONS.w,\r\n  },\r\n  s: {\r\n    type: \"move\",\r\n    dir: DIRECTIONS.s,\r\n  },\r\n  d: {\r\n    type: \"move\",\r\n    dir: DIRECTIONS.e,\r\n  },\r\n};\r\n\r\nexport const MOVEMENTS = Object.keys(MOVEMENT_KEYS).map((key) => MOVEMENT_KEYS[key]);\r\n","import * as React from \"react\";\r\n\r\nimport { params } from \"../params\";\r\n\r\ninterface InstructionsProps {\r\n  play: () => void;\r\n}\r\nexport class Instructions extends React.PureComponent<InstructionsProps, {}> {\r\n  render() {\r\n    return (\r\n      <div className=\"mito-instructions\">\r\n        <div className=\"mito-instructions-container\">\r\n          <div className=\"esc\" onClick={() => this.props.play()}>\r\n            Back (Esc)\r\n          </div>\r\n          <h1>Mito</h1>\r\n          <div className=\"play-button\" onClick={() => this.props.play()}>\r\n            Play\r\n          </div>\r\n          <p>\r\n            <ol>\r\n              <li>Build Tissue to expand your reach (press t and walk into empty space).</li>\r\n              <li>Build Roots (press r) underground to suck up adjacent water.</li>\r\n              <li>Build Leaves (press l) above ground and drop water (press 1) to convert water into sugar.</li>\r\n              <li>\r\n                <b>Win the game by building and loading the Fruit with 1000 sugar.</b>\r\n              </li>\r\n              <li>Click around to see the different properties of each tile.</li>\r\n              <li>Build leaves early.</li>\r\n              <li>Leaves higher up have better water/sugar ratios, determined by the co2 percentage in the air.</li>\r\n              <li>Explore underground for water reservoires and Fountains.</li>\r\n              <li>Build transports (capital T) to carry water back up the plant.</li>\r\n              <li>You can scroll out infinitely far.</li>\r\n            </ol>\r\n          </p>\r\n          <h3>You</h3>\r\n          <p>\r\n            You can carry max {params.maxResources} resources, and you automatically suck in any resources you're\r\n            standing over. You can only walk on Tissue (and Transport). You start at the center of the map, with soil\r\n            below and air above.\r\n          </p>\r\n          <h3>Soil and Underground</h3>\r\n          <p>\r\n            Underground, Soil holds water, rocks block your way, and occasionally Fountains (at the very bottom) are a\r\n            permanent source of water. Soil holds up to {params.soilMaxWater} water at a time. Fountains emit one water\r\n            per {params.fountainTurnsPerWater} turns.\r\n          </p>\r\n          <h3>Air and Aboveground</h3>\r\n          <p>\r\n            Aboveground, Air provides both sunlight and co2. Sunlight determines the ratio of waters-per-sugar at which\r\n            reactions happen and are affected by shadows. Co2 determines the speed of reaction and gets better as you\r\n            build higher up. Orange is low co2, blue is high co2. Gravity will pull down on your structures, so make\r\n            sure they're structurally sound. Your structures cast shadows on the leaves below in relation to the sun,\r\n            which gently sways left to right.\r\n          </p>\r\n          <h3>Water</h3>\r\n          <p>\r\n            Water is one of the main two resources. Water slowly diffuses from high to low densities (difference 2\r\n            required) at about 1 unit per {(1 / params.soilDiffusionWater).toFixed(0)} turns. Obtain water in the ground\r\n            through Roots. Leaves require water to photosynthesize. You require water to build.\r\n          </p>\r\n          <h3>Sugar</h3>\r\n          <p>\r\n            Sugar is the other main resource. Sugar does not diffuse. Leaves convert water into sugar. Obtain sugar by\r\n            putting water next to leaves. Cells require sugar to survive. You require sugar to build.\r\n          </p>\r\n          <h3>Building</h3>\r\n          <p>\r\n            Build Tissue, Leaves, Roots, and The Fruit by toggling \"build mode\" on and walking into Air or Soil. Build\r\n            Transport over existing tissue by walking around. Building costs 1 sugar and 1 water. You can build Tissue\r\n            over Leaves and Roots - be careful! When you build above ground, Cells will Droop if they're not properly\r\n            supported underneath them.\r\n          </p>\r\n          <h3>Cells</h3>\r\n          <p>\r\n            All cells require energy upkeep and will automatically eat sugar on their tile, or get energy from their\r\n            neighbors. Each cell consumes 1 sugar every {params.cellEnergyMax} turns.\r\n          </p>\r\n          <h3>Tissue</h3>\r\n          <p>\r\n            Tissue connects your plant together, you may only walk on Tissue. Each Tissue carries up to{\" \"}\r\n            {params.tissueInventoryCapacity} resources.\r\n          </p>\r\n          <h3>Roots</h3>\r\n          <p>\r\n            Roots are the only way to get water. Each turn Roots transport one water per neighboring soil into the\r\n            Tissue in the opposite direction (so the Tissue North of the root get water in the South tile). This is\r\n            called a Pairing.\r\n          </p>\r\n          <h3>Leaves</h3>\r\n          <p>\r\n            When exposed to Air, Leaves convert water to sugar. Leaves also use Pairings between opposite direction\r\n            Air/Tissue with water. In perfect co2, leave produce on average 1 sugar per{\" \"}\r\n            {(1 / params.leafReactionRate).toFixed(0)} turns per pair. Leaf efficiency is heavily influenced by co2 and\r\n            sunlight of its neighboring Air. If your leaf is in too much shadow, it will not be able to photosynthesize.\r\n            Leaves higher up produce sugar faster.\r\n          </p>\r\n          <h3>Transport</h3>\r\n          <p>\r\n            Transports move 1 water from its own Tile in the direction it was laid per turn, as well as moving you.\r\n            Transport hungers at double speed.\r\n          </p>\r\n          <h3>The Fruit</h3>\r\n          <p>\r\n            You can only build one Fruit, and it is the goal of the game to fill it up with resources. Fruit has up to\r\n            1000 sugar storage and aggressively pulls in every available sugar in its surrounding vicinity.\r\n          </p>\r\n          {this.renderCredit()}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n  renderCredit() {\r\n    return (\r\n      <>\r\n        <h2>Attribution</h2>\r\n        <p>\r\n          Tiles:{\" \"}\r\n          <a href=\"http://kenney.nl/assets?s=roguelike\" target=\"_blank\" rel=\"noopener noreferrer\">\r\n            Kenney.nl Roguelike Assets\r\n          </a>\r\n        </p>\r\n        <p>\r\n          Pop sound when leaves convert:{\" \"}\r\n          <a href=\"http://soundbible.com/2067-Blop.html\" target=\"_blank\" rel=\"noopener noreferrer\">\r\n            Blop by Mark DiAngelo\r\n          </a>{\" \"}\r\n          (<a href=\"https://creativecommons.org/licenses/by/3.0/us/\">CC BY 3.0 US</a>)\r\n        </p>\r\n        <p>\r\n          Perlin noise:{\" \"}\r\n          <a href=\"https://github.com/josephg/noisejs\" target=\"_blank\" rel=\"noopener noreferrer\">\r\n            josephg/noisejs\r\n          </a>\r\n        </p>\r\n        <p>\r\n          Part of 7drl 2018:{\" \"}\r\n          <a href=\"http://7drl.org/\" target=\"_blank\" rel=\"noopener noreferrer\">\r\n            http://7drl.org/\r\n          </a>\r\n        </p>\r\n        <p>\r\n          Fruit icon:{\" \"}\r\n          <a href=\"https://www.freepik.com/free-vector/fruits-set-pixel-icons_1001072.htm\">Designed by Freepik</a>\r\n        </p>\r\n      </>\r\n    );\r\n  }\r\n}\r\n","import * as React from \"react\";\r\n\r\nimport Mito from \"../index\";\r\nimport { Instructions } from \"./Instructions\";\r\n\r\nexport interface GameStackProps {\r\n  mito: Mito;\r\n}\r\nexport class GameStack extends React.PureComponent<GameStackProps> {\r\n  handlePlay = () => {\r\n    this.props.mito.instructionsOpen = false;\r\n  };\r\n  public render() {\r\n    if (this.props.mito.instructionsOpen) {\r\n      return <Instructions play={this.handlePlay} />;\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n}\r\n","/* eslint-disable jsx-a11y/accessible-emoji */\r\nimport * as React from \"react\";\r\n\r\nimport { Constructor } from \"../constructor\";\r\nimport { Air, Cell, Fountain, GrowingCell, hasEnergy, Leaf, Root, Tile } from \"../game/tile\";\r\nimport { hasInventory } from \"../inventory\";\r\nimport { params } from \"../params\";\r\n\r\ninterface HoveredTileInfoProps {\r\n  tile?: Tile;\r\n}\r\n\r\nexport class HoveredTileInfo extends React.Component<HoveredTileInfoProps> {\r\n  public render() {\r\n    const { tile } = this.props;\r\n    if (!tile) {\r\n      return null;\r\n    }\r\n    return (\r\n      <div className=\"tile-hover\">\r\n        {this.tileInfo(tile)}\r\n        {this.inventoryInfo(tile)}\r\n        {this.cellInfo(tile)}\r\n        {this.growingCellInfo(tile)}\r\n        {this.rootInfo(tile)}\r\n        {this.leafInfo(tile)}\r\n        {this.airInfo(tile)}\r\n        {this.fountainInfo(tile)}\r\n      </div>\r\n    );\r\n  }\r\n  private rootInfo(tile: Tile) {\r\n    return tile instanceof Root ? (\r\n      <div className=\"info-root\">\r\n        <div>{tile.cooldown} turns until next water suck</div>\r\n        <div>{tile.waterTransferAmount.toFixed(0)} water transfer per round</div>\r\n      </div>\r\n    ) : null;\r\n  }\r\n  private leafInfo(tile: Tile) {\r\n    return tile instanceof Leaf ? (\r\n      <div className=\"info-leaf\">\r\n        <div>{(1 / (tile.averageSpeed * params.leafReactionRate)).toFixed(0)} turns per reaction</div>\r\n        <div>{(1 / tile.averageEfficiency).toFixed(2)} water per sugar</div>\r\n      </div>\r\n    ) : null;\r\n  }\r\n  private airInfo(tile: Tile) {\r\n    if (tile instanceof Air) {\r\n      return (\r\n        <div className=\"info-air\">\r\n          <div> {(tile.sunlight() * 100).toFixed(0)}%</div>\r\n          <div> {(tile.co2() * 100).toFixed(0)}%</div>\r\n        </div>\r\n      );\r\n    }\r\n  }\r\n\r\n  private fountainInfo(tile: Tile) {\r\n    if (tile instanceof Fountain) {\r\n      return (\r\n        <div className=\"info-fountain\">\r\n          <div>{tile.turnsPerWater} turns per water</div>\r\n        </div>\r\n      );\r\n    }\r\n  }\r\n\r\n  private tileInfo(tile: Tile) {\r\n    const energyInfo = hasEnergy(tile) ? (\r\n      <span className=\"info-energy\">{((tile.energy / params.cellEnergyMax) * 100).toFixed(0)}%</span>\r\n    ) : null;\r\n    return (\r\n      <div className=\"info-tile\">\r\n        <div className=\"info-tile-name\">{(tile.constructor as Constructor<Tile>).displayName}</div>\r\n        <div className=\"info-tile-temperature\">{tile.temperature.toFixed(2)}</div>\r\n        {energyInfo}\r\n      </div>\r\n    );\r\n  }\r\n  private inventoryInfo(tile: Tile) {\r\n    if (hasInventory(tile)) {\r\n      const waterInfo =\r\n        tile.inventory.water > 0 ? (\r\n          <div className=\"info-inventory-item\"> {tile.inventory.water.toFixed(2)}</div>\r\n        ) : null;\r\n      const sugarInfo =\r\n        tile.inventory.sugar > 0 ? (\r\n          <div className=\"info-inventory-item\">Sugar {tile.inventory.sugar.toFixed(2)}</div>\r\n        ) : null;\r\n      return (\r\n        <div className=\"info-inventory\">\r\n          {waterInfo}\r\n          {sugarInfo}\r\n        </div>\r\n      );\r\n    }\r\n  }\r\n  private cellInfo(tile: Tile) {\r\n    if (tile instanceof Cell) {\r\n      if (tile.droopY * 200 > 1) {\r\n        return <div className=\"info-cell\">{(tile.droopY * 200).toFixed(0)}% droop</div>;\r\n      }\r\n    }\r\n  }\r\n  private growingCellInfo(tile: Tile) {\r\n    if (tile instanceof GrowingCell) {\r\n      return (\r\n        <div className=\"info-growing-cell\">\r\n          {(100 - (tile.timeRemaining / tile.timeToBuild) * 100).toFixed(0)}% mature\r\n        </div>\r\n      );\r\n    }\r\n  }\r\n}\r\n","export default function lazy<T>(fn: () => T): () => T {\r\n  let cache: T;\r\n  return () => {\r\n    if (cache === undefined) {\r\n      cache = fn();\r\n    }\r\n    return cache;\r\n  };\r\n}\r\n","import * as THREE from \"three\";\r\nimport lazy from \"../../common/lazy\";\r\n\r\nimport roguelikeSheet_transparentSrc from \"assets/images/roguelikeSheet_transparent.png\";\r\nimport fruitSrc from \"assets/images/fruit.png\";\r\n\r\nconst spriteSize = 16; // 16x16 sprites\r\nexport let spritesheetLoaded = false;\r\nconst SPRITESHEET = lazy(() =>\r\n  new THREE.TextureLoader().load(roguelikeSheet_transparentSrc, () => {\r\n    SPRITESHEET().dispatchEvent({ type: \"update\" });\r\n    spritesheetLoaded = true;\r\n  })\r\n);\r\n\r\nexport const fruitTexture = new THREE.TextureLoader().load(fruitSrc);\r\n\r\nconst cache: { [key: string]: THREE.Texture } = {};\r\n// x, y are spritesheet coordinates, starting top-left and going down/right\r\nexport function textureFromSpritesheet(x: number, y: number, backgroundColor = \"white\") {\r\n  x = Math.floor(x);\r\n  y = Math.floor(y);\r\n  const key = `${x},${y}`;\r\n  if (cache[key] == null) {\r\n    const canvas = document.createElement(\"canvas\");\r\n    canvas.width = spriteSize;\r\n    canvas.height = spriteSize;\r\n    const texture = new THREE.Texture(canvas);\r\n    texture.magFilter = THREE.NearestFilter;\r\n    texture.flipY = true;\r\n    texture.wrapS = THREE.RepeatWrapping;\r\n    texture.wrapT = THREE.RepeatWrapping;\r\n    function drawSpriteToCanvas() {\r\n      const image = SPRITESHEET().image;\r\n      const context = canvas.getContext(\"2d\")!;\r\n      context.fillStyle = backgroundColor;\r\n      context.fillRect(0, 0, spriteSize, 16);\r\n      // context.fillStyle = \"white\";\r\n      // flip the image vertically\r\n      context.drawImage(\r\n        image,\r\n        // sx, sy, sWidth, sHeight\r\n        spriteSize * x,\r\n        spriteSize * y,\r\n        spriteSize,\r\n        spriteSize,\r\n        // dx, dy, dWidth, dHeight\r\n        0,\r\n        0,\r\n        spriteSize,\r\n        spriteSize\r\n      );\r\n      texture.needsUpdate = true;\r\n      // devlog(\"updated spritesheet for\", x, y);\r\n    }\r\n    if (spritesheetLoaded) {\r\n      drawSpriteToCanvas();\r\n    } else {\r\n      SPRITESHEET().addEventListener(\"update\", () => {\r\n        drawSpriteToCanvas();\r\n      });\r\n    }\r\n    cache[key] = texture;\r\n  }\r\n  return cache[key];\r\n}\r\n","import { Scene } from \"three\";\r\nimport { Mito } from \"../index\";\r\nexport abstract class Renderer<T> {\r\n  constructor(public target: T, public scene: Scene, public mito: Mito) {}\r\n  abstract update(): void;\r\n  abstract destroy(): void;\r\n}\r\n","import { BufferAttribute, BufferGeometry, Color, Points, ShaderMaterial, Texture } from \"three\";\r\n\r\nexport class ResourceParticles extends Points {\r\n  static BUFFER_SIZE = 100000;\r\n  public geometry!: BufferGeometry;\r\n  public material!: ResourceParticleMaterial;\r\n  static newGeometry() {\r\n    const geometry = new BufferGeometry();\r\n    const positions = new Float32Array(ResourceParticles.BUFFER_SIZE * 3);\r\n    const sizes = new Float32Array(ResourceParticles.BUFFER_SIZE);\r\n    geometry.addAttribute(\"position\", new BufferAttribute(positions, 3).setDynamic(true));\r\n    geometry.addAttribute(\"size\", new BufferAttribute(sizes, 1).setDynamic(true));\r\n    return geometry;\r\n  }\r\n  constructor(params: MaterialParams) {\r\n    super();\r\n    this.geometry = ResourceParticles.newGeometry();\r\n    this.material = new ResourceParticleMaterial(params);\r\n    this.frustumCulled = false;\r\n  }\r\n  private index = 0;\r\n  startFrame() {\r\n    this.index = 0;\r\n  }\r\n  commit(x: number, y: number, z: number, size: number) {\r\n    this.geometry.attributes.position.setXYZ(this.index, x, y, z);\r\n    this.geometry.attributes.size.setX(this.index, size);\r\n    this.index++;\r\n  }\r\n  endFrame() {\r\n    const positions = this.geometry.attributes.position as BufferAttribute;\r\n    positions.needsUpdate = true;\r\n    const sizes = this.geometry.attributes.size as BufferAttribute;\r\n    sizes.needsUpdate = true;\r\n    this.geometry.setDrawRange(0, this.index);\r\n  }\r\n}\r\n\r\nexport interface MaterialParams {\r\n  opacity: number;\r\n  color: Color;\r\n  size: number;\r\n  map?: Texture;\r\n}\r\n\r\nclass ResourceParticleMaterial extends ShaderMaterial {\r\n  public map: Texture | undefined;\r\n\r\n  constructor(public params: MaterialParams) {\r\n    super({\r\n      uniforms: {\r\n        opacity: { value: params.opacity },\r\n        sizeGlobal: { value: params.size },\r\n        color: { value: params.color },\r\n        // you have to put it here too\r\n        map: { value: params.map },\r\n      },\r\n      vertexShader,\r\n      fragmentShader,\r\n      depthTest: false,\r\n      transparent: true,\r\n    } as any);\r\n\r\n    // OH MY GOD you can do this. You have to do this *AFTER* the super call!\r\n    this.map = params.map;\r\n  }\r\n}\r\n\r\nconst vertexShader = `\r\nattribute float size;\r\nuniform float sizeGlobal;\r\n\r\nvoid main() {\r\n    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\r\n    gl_PointSize = size * sizeGlobal * -projectionMatrix[1].y;\r\n    gl_Position = projectionMatrix * mvPosition;\r\n}\r\n`;\r\n\r\nconst fragmentShader = `\r\nuniform vec3 color;\r\nuniform sampler2D texture;\r\nuniform float opacity;\r\n\r\n#ifdef USE_MAP\r\n  uniform mat3 uvTransform;\r\n  uniform sampler2D map;\r\n#endif\r\n\r\nvoid main() {\r\n    gl_FragColor = vec4( color, opacity );\r\n\r\n    #ifdef USE_MAP\r\n        vec4 mapTexel = texture2D( map, gl_PointCoord );\r\n        gl_FragColor *= mapTexelToLinear( mapTexel );\r\n    #endif\r\n}\r\n`;\r\n","import { Color, Scene, Vector2 } from \"three\";\r\n\r\nimport lazy from \"../../../common/lazy\";\r\nimport { map } from \"../../../math\";\r\nimport { Mito } from \"../index\";\r\nimport { Inventory } from \"../inventory\";\r\nimport { textureFromSpritesheet } from \"../spritesheet\";\r\nimport { Renderer } from \"./Renderer\";\r\nimport { ResourceParticles } from \"./resourceParticles\";\r\n\r\n// we represent Resources as dots of certain colors.\r\nexport class InventoryRenderer extends Renderer<Inventory> {\r\n  static WaterParticles = lazy(\r\n    () =>\r\n      new ResourceParticles(\r\n        {\r\n          color: new Color(\"rgb(9, 12, 255)\"),\r\n          size: 45,\r\n          opacity: 0.75,\r\n        }\r\n        // new PointsMaterial({\r\n        //     // map: textureFromSpritesheet(0, 1),\r\n        //     transparent: true,\r\n        //     opacity: 0.75,\r\n        //     // color: new Color(\"rgb(12, 41, 255)\"),\r\n        //     // color: new Color(\"rgb(29, 42, 255)\"),\r\n        //     color: new Color(\"rgb(9, 12, 255)\"),\r\n        //     size: .12,\r\n        //     side: DoubleSide,\r\n        // })\r\n      )\r\n  );\r\n\r\n  static SugarParticles = lazy(\r\n    () =>\r\n      new ResourceParticles(\r\n        {\r\n          color: new Color(\"yellow\"),\r\n          size: 85,\r\n          opacity: 0.9,\r\n          map: textureFromSpritesheet(42, 12, \"transparent\"),\r\n        }\r\n        // new PointsMaterial({\r\n        //     map: textureFromSpritesheet(42, 12, \"transparent\"),\r\n        //     transparent: true,\r\n        //     opacity: 0.9,\r\n        //     color: \"yellow\",\r\n        //     size: .12,\r\n        //     side: DoubleSide,\r\n        // })\r\n      )\r\n  );\r\n\r\n  static startFrame() {\r\n    InventoryRenderer.WaterParticles().startFrame();\r\n    InventoryRenderer.SugarParticles().startFrame();\r\n  }\r\n\r\n  static endFrame() {\r\n    InventoryRenderer.WaterParticles().endFrame();\r\n    InventoryRenderer.SugarParticles().endFrame();\r\n  }\r\n  // static geometry = new PlaneBufferGeometry(1, 1);\r\n  // static waterMaterial = new MeshBasicMaterial({\r\n  //     // map: textureFromSpritesheet(0, 1),\r\n  //     transparent: true,\r\n  //     opacity: 0.75,\r\n  //     // color: new Color(\"rgb(12, 41, 255)\"),\r\n  //     // color: new Color(\"rgb(29, 42, 255)\"),\r\n  //     color: new Color(\"rgb(9, 12, 255)\"),\r\n  //     side: DoubleSide,\r\n  // });\r\n  // static sugarMaterial = lazy(() => new MeshBasicMaterial({\r\n  //     map: textureFromSpritesheet(42, 12, \"transparent\"),\r\n  //     transparent: true,\r\n  //     opacity: 0.9,\r\n  //     color: \"yellow\",\r\n  //     // color: new Color(\"yellow\"),\r\n  //     side: DoubleSide,\r\n  // }));\r\n  public animationOffset = 0;\r\n  // public object = new Object3D();\r\n  public waters: Vector2[] = [];\r\n  public sugars: Vector2[] = [];\r\n  constructor(target: Inventory, scene: Scene, mito: Mito) {\r\n    super(target, scene, mito);\r\n    target.on(\"get\", this.handleGetResources);\r\n    target.on(\"give\", this.handleGiveResources);\r\n    // this.object.name = \"InventoryRenderer Object\";\r\n    // this.object.position.z = 1;\r\n    // this.object.updateMatrix();\r\n    // this.object.matrixAutoUpdate = false;\r\n    for (let i = 0; i < this.target.water; i++) {\r\n      this.waters.push(newParticle());\r\n    }\r\n    for (let i = 0; i < this.target.sugar; i++) {\r\n      this.sugars.push(newParticle());\r\n    }\r\n  }\r\n  private handleGetResources = (giver: Inventory) => {\r\n    let wantedMeshes = Math.ceil(this.target.water);\r\n    while (this.waters.length < wantedMeshes) {\r\n      const v = giver.carrier.pos.clone().sub(this.target.carrier.pos);\r\n      v.x += (Math.random() - 0.5) * 0.1;\r\n      v.y += (Math.random() - 0.5) * 0.1;\r\n      this.waters.push(v);\r\n    }\r\n\r\n    wantedMeshes = Math.ceil(this.target.sugar);\r\n    while (this.sugars.length < wantedMeshes) {\r\n      const v = giver.carrier.pos.clone().sub(this.target.carrier.pos);\r\n      v.x += (Math.random() - 0.5) * 0.1;\r\n      v.y += (Math.random() - 0.5) * 0.1;\r\n      this.sugars.push(v);\r\n    }\r\n  };\r\n\r\n  private handleGiveResources = () => {\r\n    let wantedMeshes = Math.ceil(this.target.water);\r\n    if (this.waters.length > wantedMeshes) {\r\n      this.waters.splice(wantedMeshes, this.waters.length - wantedMeshes);\r\n    }\r\n\r\n    wantedMeshes = Math.ceil(this.target.sugar);\r\n    if (this.sugars.length > wantedMeshes) {\r\n      this.sugars.splice(wantedMeshes, this.sugars.length - wantedMeshes);\r\n    }\r\n  };\r\n\r\n  private updateNumParticles(resource: number) {\r\n    // while (resourceArray.length < wantedMeshes) {\r\n    //     this.newParticle(resourceArray);\r\n    // }\r\n    // if (resourceArray.length > wantedMeshes) {\r\n    //     resourceArray.splice(wantedMeshes, resourceArray.length - wantedMeshes);\r\n    // }\r\n  }\r\n\r\n  private commitParticles(particles: ResourceParticles, resource: number, resourceArray: Vector2[]) {\r\n    if (resourceArray.length > 0) {\r\n      for (let i = 0; i < resourceArray.length - 1; i++) {\r\n        const p = resourceArray[i];\r\n        particles.commit(p.x + this.target.carrier.pos.x, p.y + this.target.carrier.pos.y, 10, 1);\r\n        resource -= 1;\r\n      }\r\n      const p = resourceArray[resourceArray.length - 1];\r\n      const fract = resource;\r\n      particles.commit(\r\n        p.x + this.target.carrier.pos.x,\r\n        p.y + this.target.carrier.pos.y,\r\n        10,\r\n        map(Math.sqrt(fract), 0, 1, 0.2, 1)\r\n      );\r\n    }\r\n  }\r\n\r\n  private simulateResourcePositions() {\r\n    const resources = this.waters.concat(this.sugars);\r\n    for (const r of resources) {\r\n      let vx = 0,\r\n        vy = 0;\r\n      const angle = performance.now() / 3000 + this.animationOffset;\r\n      vx += Math.cos(angle) * 0.02;\r\n      // vel.y += Math.sin(performance.now() / 3000) * 0.1;\r\n      const goTowardsCenterStrength = 0.1 + r.length() * 0.1;\r\n      vx += -r.x * goTowardsCenterStrength;\r\n      vy += -r.y * goTowardsCenterStrength;\r\n      const player = this.mito.world.player;\r\n      if (player.pos.equals(this.target.carrier.pos)) {\r\n        const playerX = player.posFloat.x - player.pos.x;\r\n        const playerY = player.posFloat.y - player.pos.y;\r\n        const offsetX = r.x - playerX;\r\n        const offsetY = r.y - playerY;\r\n        const mag2 = offsetX * offsetX + offsetY * offsetY;\r\n        const avoidPlayerStrength = Math.max(Math.min(map(mag2, 0, 1, 3, -5), 3), 0);\r\n        const accelerationX = offsetX * avoidPlayerStrength * 0.2;\r\n        const accelerationY = offsetY * avoidPlayerStrength * 0.2;\r\n        vx += accelerationX;\r\n        vy += accelerationY;\r\n      }\r\n      for (const l of resources) {\r\n        if (r === l) {\r\n          break;\r\n        }\r\n        const dx = r.x - l.x;\r\n        const dy = r.y - l.y;\r\n        const lengthSq = dx * dx + dy * dy;\r\n        if (lengthSq > 0) {\r\n          const strength = 0.003 / lengthSq;\r\n          vx += dx * strength;\r\n          vy += dy * strength;\r\n        }\r\n      }\r\n      r.x += vx;\r\n      r.y += vy;\r\n    }\r\n  }\r\n\r\n  update() {\r\n    this.updateNumParticles(this.target.water);\r\n    this.updateNumParticles(this.target.sugar);\r\n    this.simulateResourcePositions();\r\n    this.commitParticles(InventoryRenderer.WaterParticles(), this.target.water, this.waters);\r\n    this.commitParticles(InventoryRenderer.SugarParticles(), this.target.sugar, this.sugars);\r\n  }\r\n  destroy() {\r\n    // no-op\r\n  }\r\n}\r\n\r\nfunction newParticle() {\r\n  return new Vector2((Math.random() - 0.5) * 0.01, (Math.random() - 0.5) * 0.01);\r\n}\r\n","import React from \"react\";\r\nimport {\r\n  ArrowHelper,\r\n  Audio,\r\n  BufferGeometry,\r\n  Color,\r\n  DoubleSide,\r\n  Float32BufferAttribute,\r\n  Line,\r\n  LineBasicMaterial,\r\n  Mesh,\r\n  MeshBasicMaterial,\r\n  Object3D,\r\n  PlaneBufferGeometry,\r\n  Scene,\r\n  Vector2,\r\n  Vector3,\r\n} from \"three\";\r\n\r\nimport lazy from \"../../../common/lazy\";\r\nimport { map, lerp2 } from \"../../../math/index\";\r\nimport { blopBuffer, suckWaterBuffer } from \"../audio\";\r\nimport { Constructor } from \"../constructor\";\r\nimport {\r\n  Air,\r\n  Cell,\r\n  DeadCell,\r\n  Fountain,\r\n  Fruit,\r\n  GrowingCell,\r\n  hasEnergy,\r\n  hasTilePairs,\r\n  Leaf,\r\n  Rock,\r\n  Root,\r\n  Soil,\r\n  Tile,\r\n  Tissue,\r\n  Transport,\r\n  Vein,\r\n} from \"../game/tile\";\r\nimport { Mito, WorldDOMElement } from \"../index\";\r\nimport { hasInventory } from \"../inventory\";\r\nimport { params } from \"../params\";\r\nimport { fruitTexture, textureFromSpritesheet } from \"../spritesheet\";\r\nimport { InventoryRenderer } from \"./InventoryRenderer\";\r\nimport { Renderer } from \"./Renderer\";\r\n\r\nexport class TileMesh extends Mesh {\r\n  static geometry = new PlaneBufferGeometry(1, 1);\r\n  constructor(public renderer: TileRenderer) {\r\n    super(TileMesh.geometry, getMaterial(renderer.target) as MeshBasicMaterial);\r\n  }\r\n}\r\n\r\nexport class TileRenderer<T extends Tile = Tile> extends Renderer<T> {\r\n  // public object = new Object3D();\r\n  public mesh: TileMesh;\r\n  private inventoryRenderer?: InventoryRenderer;\r\n  private originalColor: Color;\r\n  private audio?: Audio;\r\n  private lastAudioValueTracker = 0;\r\n  private pairsLines: Object3D[] = [];\r\n  private worldDomElement?: WorldDOMElement;\r\n\r\n  constructor(target: T, scene: Scene, mito: Mito) {\r\n    super(target, scene, mito);\r\n    if (this.target instanceof GrowingCell) {\r\n      this.growingRenderer = new TileRenderer(this.target.completedCell, this.scene, this.mito);\r\n      this.mesh = this.growingRenderer.mesh;\r\n      this.mesh.scale.set(0.01, 0.01, 1);\r\n    } else {\r\n      this.mesh = new TileMesh(this);\r\n    }\r\n    // this.object.name = \"TileRenderer Object\";\r\n\r\n    // if (this.target instanceof Air) {\r\n    //     const colorIndex = map(this.target.co2(), 0.40, 1.001, 0, AIR_COLORSCALE.length - 1);\r\n    //     const startColorIndex = Math.floor(colorIndex);\r\n    //     const startColor = AIR_COLORSCALE[startColorIndex];\r\n    //     this.originalColor = startColor.clone();\r\n    //     if (startColorIndex !== AIR_COLORSCALE.length - 1) {\r\n    //         const alpha = colorIndex - startColorIndex;\r\n    //         const endColorIndex = startColorIndex + 1;\r\n    //         const endColor = AIR_COLORSCALE[endColorIndex];\r\n    //         this.originalColor.lerp(endColor, alpha);\r\n    //     }\r\n    // } else {\r\n    this.originalColor = (this.mesh.material as MeshBasicMaterial).color.clone();\r\n    // }\r\n    // this.object.add(this.mesh);\r\n    if (hasInventory(this.target)) {\r\n      this.inventoryRenderer = new InventoryRenderer(this.target.inventory, this.scene, this.mito);\r\n      this.inventoryRenderer.animationOffset = (this.target.pos.x + this.target.pos.y) / 2;\r\n      // this.mesh.add(this.inventoryRenderer.object);\r\n    }\r\n    this.scene.add(this.mesh);\r\n    const zIndex = this.target instanceof Cell ? 1 : 0;\r\n    this.mesh.position.set(this.target.pos.x, this.target.pos.y, zIndex);\r\n    if (this.target instanceof Cell) {\r\n      // if it takes no turns to build, start it off small just for show\r\n      if (!(this.target.constructor as Constructor<Cell>).turnsToBuild) {\r\n        this.mesh.scale.set(0.01, 0.01, 1);\r\n      }\r\n    } else {\r\n      this.mesh.matrixAutoUpdate = false;\r\n    }\r\n    this.mesh.updateMatrix();\r\n    if (this.target instanceof Leaf || this.target instanceof Root) {\r\n      this.audio = new Audio(this.mito.audioListener);\r\n      this.mesh.add(this.audio);\r\n    }\r\n\r\n    if (this.target instanceof Fruit) {\r\n      const fruit = this.target;\r\n      this.worldDomElement = mito.addWorldDOMElement(\r\n        () => this.target.pos,\r\n        () => {\r\n          return (\r\n            <div className=\"fruit-indicator\">\r\n              <div>\r\n                {fruit.committedResources.water.toFixed(1)}/{Fruit.neededResources / 2} water\r\n              </div>\r\n              <div>\r\n                {fruit.committedResources.sugar.toFixed(1)}/{Fruit.neededResources / 2} sugar\r\n              </div>\r\n            </div>\r\n          );\r\n        }\r\n      );\r\n    }\r\n  }\r\n\r\n  steps(x: number, size: number) {\r\n    return Math.floor(x / size) * size;\r\n  }\r\n\r\n  private static ONE = new Vector2(1, 1);\r\n  private growingRenderer?: TileRenderer;\r\n  private static HOT_COLOR = new Color(\"orange\");\r\n  private static COLD_COLOR = new Color(\"lightblue\");\r\n  update() {\r\n    if (this.target instanceof GrowingCell) {\r\n      // const s = this.steps(1.001 - this.target.timeRemaining / params.cellGestationTurns, 0.05);\r\n      const s = 1 - this.target.timeRemaining / this.target.timeToBuild;\r\n      lerp2(this.mesh.scale, { x: s, y: s }, 0.5);\r\n      // this.mesh.scale.x = s;\r\n      // this.mesh.scale.y = s;\r\n    } else if (this.target instanceof Fruit) {\r\n      const scale = map(this.target.getPercentMatured(), 0, 1, 0.2, 1);\r\n      const targetScale = new Vector2(scale, scale);\r\n      lerp2(this.mesh.scale, targetScale, 0.1);\r\n    } else {\r\n      lerp2(this.mesh.scale, TileRenderer.ONE, 0.1);\r\n    }\r\n    const lightAmount = this.target.lightAmount();\r\n    const mat = this.mesh.material as MeshBasicMaterial;\r\n    if (this.target instanceof Air) {\r\n      const colorIndex = Math.max(0, map(this.target.co2(), 1 / 6, 1.001, 0, AIR_COLORSCALE.length - 1));\r\n      const startColorIndex = Math.floor(colorIndex);\r\n      const startColor = AIR_COLORSCALE[startColorIndex];\r\n      this.originalColor = startColor.clone();\r\n      if (startColorIndex !== AIR_COLORSCALE.length - 1) {\r\n        const alpha = colorIndex - startColorIndex;\r\n        const endColorIndex = startColorIndex + 1;\r\n        const endColor = AIR_COLORSCALE[endColorIndex];\r\n        this.originalColor.lerp(endColor, alpha);\r\n      }\r\n    }\r\n    mat.color = new Color(0).lerp(this.originalColor, map(lightAmount, 0, 1, 0.2, 1));\r\n    if (this.target instanceof Cell) {\r\n      this.mesh.position.set(this.target.pos.x, this.target.pos.y + this.target.droopY, 1);\r\n    }\r\n    if (hasEnergy(this.target)) {\r\n      mat.color.lerp(new Color(0), 1 - this.target.energy / params.cellEnergyMax);\r\n    }\r\n    if (this.target.temperature > 66) {\r\n      mat.color.lerp(TileRenderer.HOT_COLOR, map(this.target.temperature, 66, 100, 0, 1));\r\n    } else if (this.target.temperature < 33) {\r\n      mat.color.lerp(TileRenderer.COLD_COLOR, map(this.target.temperature, 33, 0, 0, 1));\r\n    }\r\n    if (this.inventoryRenderer != null) {\r\n      if (lightAmount > 0) {\r\n        // will not render without an update\r\n        this.inventoryRenderer.update();\r\n      }\r\n    }\r\n    if (this.target instanceof Leaf && this.audio != null) {\r\n      const newAudioValueTracker = this.target.didConvert ? 1 : 0;\r\n      if (newAudioValueTracker !== this.lastAudioValueTracker && newAudioValueTracker > 0) {\r\n        this.audio.setBuffer(blopBuffer);\r\n        const dist = this.target.pos.distanceToSquared(this.mito.world.player.pos);\r\n        const volume = Math.min(1, 1 / (1 + dist / 25)) * this.target.sugarConverted * this.target.sugarConverted;\r\n        this.audio.setVolume(volume);\r\n        // this.audio.setRefDistance(2);\r\n        // play blop sound\r\n        this.audio.play();\r\n      }\r\n      this.lastAudioValueTracker = newAudioValueTracker;\r\n      // this.audio.setBuffer(blopBuffer);\r\n      // this.audio.setRefDistance(2);\r\n      // play blop sound\r\n      // this.audio.play();\r\n    }\r\n    if (this.target instanceof Root && this.audio != null) {\r\n      const newAudioValueTracker = this.target.waterTransferAmount;\r\n      if (newAudioValueTracker !== this.lastAudioValueTracker) {\r\n        this.audio.setBuffer(suckWaterBuffer);\r\n        const baseVolume = this.target.waterTransferAmount / (2 + this.target.waterTransferAmount);\r\n        const dist = this.target.pos.distanceToSquared(this.mito.world.player.pos);\r\n        const volume = Math.min(1, 1 / (1 + dist / 25)) * baseVolume;\r\n        this.audio.setVolume(volume);\r\n        if (this.audio.source != null) {\r\n          this.audio.stop();\r\n        }\r\n        this.audio.play();\r\n      }\r\n      this.lastAudioValueTracker = newAudioValueTracker;\r\n    }\r\n    if (hasTilePairs(this.target)) {\r\n      const pairColor = this.target instanceof Leaf ? 0xffc90e : new Color(\"rgb(9, 12, 255)\").getHex();\r\n      const pairs = this.target.tilePairs;\r\n      if (pairs.length !== this.pairsLines.length) {\r\n        // redo pairs\r\n        this.pairsLines.forEach((line) => this.mesh.remove(line));\r\n        this.pairsLines = pairs.map((dir) => {\r\n          const length = dir.length() * 2 - 0.25;\r\n          const arrowDir = new Vector3(dir.x, dir.y, 0).normalize();\r\n          const arrowHelper = this.makeLine(arrowDir, arrowDir.clone().multiplyScalar(-length / 2), length, pairColor);\r\n          this.mesh.add(arrowHelper);\r\n          return arrowHelper;\r\n        });\r\n      }\r\n    }\r\n    if (this.hasActiveNeighbors(this.target)) {\r\n      const color = this.target instanceof Root ? new Color(\"rgb(9, 12, 255)\").getHex() : 0xffffff;\r\n      const lines = this.target.activeNeighbors;\r\n      if (lines.length !== this.pairsLines.length) {\r\n        // redo pairs\r\n        this.pairsLines.forEach((line) => this.mesh.remove(line));\r\n        this.pairsLines = lines.map((dir) => {\r\n          const length = dir.length() - 0.25;\r\n          const arrowDir = new Vector3(dir.x, dir.y, 0).normalize();\r\n          const arrowHelper =\r\n            this.target instanceof Root\r\n              ? this.makeLine(arrowDir, new Vector3(), length, color)\r\n              : new ArrowHelper(arrowDir, new Vector3(0, 0, 5), length, color);\r\n          this.mesh.add(arrowHelper);\r\n          return arrowHelper;\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  hasActiveNeighbors(\r\n    t: any\r\n  ): t is {\r\n    activeNeighbors: Vector2[];\r\n  } {\r\n    return Array.isArray(t.activeNeighbors);\r\n  }\r\n\r\n  static lineGeometry = (() => {\r\n    const g = new BufferGeometry();\r\n    g.addAttribute(\"position\", new Float32BufferAttribute([0, 0, 0, 0, 1, 0], 3));\r\n    return g;\r\n  })();\r\n  private makeLine(dir: Vector3, origin: Vector3, length: number, color: number) {\r\n    // copied from https://github.com/mrdoob/js/blob/master/src/helpers/ArrowHelper.js\r\n    const line = new Line(TileRenderer.lineGeometry, new LineBasicMaterial({ color: color }));\r\n    line.position.copy(origin);\r\n    // dir is assumed to be normalized\r\n    if (dir.y > 0.99999) {\r\n      line.quaternion.set(0, 0, 0, 1);\r\n    } else if (dir.y < -0.99999) {\r\n      line.quaternion.set(1, 0, 0, 0);\r\n    } else {\r\n      const axis = new Vector3(dir.z, 0, -dir.x).normalize();\r\n      const radians = Math.acos(dir.y);\r\n      line.quaternion.setFromAxisAngle(axis, radians);\r\n    }\r\n    line.scale.set(1, Math.max(0, length), 1);\r\n    line.position.z = 0.1;\r\n    line.updateMatrix();\r\n    line.matrixAutoUpdate = false;\r\n    return line;\r\n  }\r\n  destroy() {\r\n    this.scene.remove(this.mesh);\r\n    if (this.worldDomElement != null) {\r\n      this.mito.removeWorldDOMElement(this.worldDomElement);\r\n    }\r\n    if (this.inventoryRenderer != null) {\r\n      this.inventoryRenderer.destroy();\r\n    }\r\n  }\r\n}\r\n\r\nexport const materialMapping = lazy(() => {\r\n  const materials = new Map<Constructor<Tile>, MeshBasicMaterial>();\r\n  materials.set(\r\n    Air,\r\n    new MeshBasicMaterial({\r\n      side: DoubleSide,\r\n      depthWrite: false,\r\n    })\r\n  );\r\n  materials.set(\r\n    Soil,\r\n    new MeshBasicMaterial({\r\n      map: textureFromSpritesheet(8, 11),\r\n      // map: textureFromSpritesheet(41, 26),\r\n      // map: textureFromSpritesheet(679 / 16, 438 / 16),\r\n      side: DoubleSide,\r\n      // color: new Color(0xcccccc),\r\n      color: new Color(\"rgb(112, 89, 44)\"),\r\n      depthWrite: false,\r\n    })\r\n  );\r\n  materials.set(\r\n    Fountain,\r\n    new MeshBasicMaterial({\r\n      map: textureFromSpritesheet(56 / 16, 38 / 16),\r\n      side: DoubleSide,\r\n    })\r\n  );\r\n  materials.set(\r\n    Rock,\r\n    new MeshBasicMaterial({\r\n      map: textureFromSpritesheet(26, 20),\r\n      side: DoubleSide,\r\n      color: new Color(\"rgb(63, 77, 84)\"),\r\n    })\r\n  );\r\n  materials.set(\r\n    DeadCell,\r\n    new MeshBasicMaterial({\r\n      map: textureFromSpritesheet(137 / 16, 374 / 16),\r\n      side: DoubleSide,\r\n      color: new Color(\"rgb(128, 128, 128)\"),\r\n    })\r\n  );\r\n  materials.set(\r\n    Tissue,\r\n    new MeshBasicMaterial({\r\n      map: textureFromSpritesheet(6, 31),\r\n      side: DoubleSide,\r\n      color: new Color(0x30ae25),\r\n    })\r\n  );\r\n  materials.set(Transport, materials.get(Tissue)!);\r\n  // materialMapping.set(Transport, new MeshBasicMaterial({\r\n  //     map: arrowUpMaterial(),\r\n  //     side: DoubleSide,\r\n  //     color: new Color(\"rgb(42, 138, 25)\"),\r\n  // }));\r\n  materials.set(\r\n    Leaf,\r\n    new MeshBasicMaterial({\r\n      // map: textureFromSpritesheet(9, 31),\r\n      map: textureFromSpritesheet(55 / 16, 280 / 16),\r\n      // map: textureFromSpritesheet(16, 10),\r\n      side: DoubleSide,\r\n    })\r\n  );\r\n  materials.set(\r\n    Root,\r\n    new MeshBasicMaterial({\r\n      // map: textureFromSpritesheet(0, 31),\r\n      map: textureFromSpritesheet(59 / 16, 327 / 16),\r\n      side: DoubleSide,\r\n    })\r\n  );\r\n  materials.set(\r\n    Fruit,\r\n    new MeshBasicMaterial({\r\n      map: fruitTexture,\r\n      side: DoubleSide,\r\n      transparent: true,\r\n    })\r\n  );\r\n  materials.set(\r\n    Vein,\r\n    new MeshBasicMaterial({\r\n      map: textureFromSpritesheet(Math.floor(184 / 16), Math.floor(152 / 16)),\r\n      side: DoubleSide,\r\n    })\r\n  );\r\n\r\n  return materials;\r\n});\r\n\r\nfunction getMaterial(tile: Tile) {\r\n  // careful - creates a new instance per tile\r\n  return materialMapping()\r\n    .get(tile.constructor as Constructor<Tile>)!\r\n    .clone();\r\n}\r\n\r\n// const AIR_COLORSCALE = [\r\n//     new Color(\"rgb(91, 117, 154)\"),\r\n//     new Color(\"rgb(158, 179, 196)\"),\r\n//     new Color(\"hsv(35, 7%, 99%)\"),\r\n// ];\r\n// const AIR_COLORSCALE = [\r\n//     new Color(\"hsl(14, 81%, 52%)\"),\r\n//     new Color(\"hsl(34, 61%, 72%)\"),\r\n//     new Color(\"hsl(61, 54%, 87%)\"),\r\n//     new Color(\"hsl(67, 35%, 99%)\"),\r\n//     new Color(\"hsl(213, 63%, 52%)\"),\r\n//     // new Color(\"hsl(37, 35%, 99%)\"),\r\n// ];\r\n// const AIR_COLORSCALE = [\r\n//     new Color(\"hsl(34, 61%, 56%)\"),\r\n//     new Color(\"hsl(67, 31%, 55%)\"),\r\n//     new Color(\"hsl(213, 63%, 58%)\"),\r\n//     // new Color(\"hsl(37, 35%, 99%)\"),\r\n// ];\r\nconst AIR_COLORSCALE = [\r\n  // new Color(\"hsl(67, 31%, 55%)\"),\r\n  new Color(\"hsl(67, 31%, 25%)\"),\r\n  new Color(\"hsl(180, 31%, 76%)\"),\r\n  new Color(\"hsl(213, 63%, 58%)\"),\r\n];\r\n// const AIR_COLORSCALE = [\r\n//     new Color(\"rgb(146, 215, 255)\"),\r\n//     new Color(\"rgb(53, 125, 210)\"),\r\n//     new Color(\"rgb(56, 117, 154)\"),\r\n// ];\r\n","import * as React from \"react\";\r\n\r\nimport { Constructor } from \"../constructor\";\r\nimport { Cell } from \"../game/tile\";\r\nimport { materialMapping } from \"../renderers/TileRenderer\";\r\n\r\nimport \"./CellBar.scss\";\r\nimport classNames from \"classnames\";\r\nimport { spritesheetLoaded } from \"../spritesheet\";\r\n\r\nexport interface CellBarProps {\r\n  bar: Constructor<Cell>[];\r\n  index: number;\r\n  onIndexClicked: (index: number) => void;\r\n}\r\n\r\nfunction CellBar({ bar, index, onIndexClicked }: CellBarProps) {\r\n  return (\r\n    <div className=\"cell-bar\">\r\n      {bar.map((cellType, i) => (\r\n        <div key={i}>\r\n          <CellBarItem\r\n            type={cellType}\r\n            isSelected={index === i}\r\n            onClick={() => onIndexClicked(i)}\r\n            spritesheetLoaded={spritesheetLoaded}\r\n          />\r\n          <HotkeyButton hotkey={String(i + 1)} onClick={() => onIndexClicked(i)} />\r\n        </div>\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport interface CellBarItemProps {\r\n  children?: React.ReactNode;\r\n  type: Constructor<Cell>;\r\n  isSelected: boolean;\r\n  onClick: () => void;\r\n  spritesheetLoaded: boolean;\r\n}\r\n\r\nfunction CellBarItem({ type, isSelected, onClick, spritesheetLoaded }: CellBarItemProps) {\r\n  const style: React.CSSProperties = React.useMemo(() => {\r\n    const material = materialMapping().get(type)!;\r\n    const image = material.map!.image;\r\n    const color = material.color.getStyle();\r\n    const url = (() => {\r\n      if (image != null) {\r\n        if (image instanceof HTMLCanvasElement && spritesheetLoaded) {\r\n          return image.toDataURL();\r\n        } else if (image instanceof Image) {\r\n          return image.src;\r\n        } else {\r\n          return \"\";\r\n        }\r\n      } else {\r\n        return \"\";\r\n      }\r\n    })();\r\n    const backgroundImage = `url(${url}), linear-gradient(${color}, ${color})`;\r\n    return {\r\n      backgroundImage,\r\n    };\r\n  }, [spritesheetLoaded, type]);\r\n  return (\r\n    <div className={classNames(\"cell-bar-item\", { selected: isSelected })} onClick={onClick} style={style}>\r\n      {type.displayName}\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction ensureCanvasFocus(e: React.SyntheticEvent<any>) {\r\n  e.preventDefault();\r\n  const canvas = document.getElementsByTagName(\"canvas\")[0];\r\n  canvas.focus();\r\n}\r\n\r\ninterface HotkeyButtonProps extends React.HTMLProps<HTMLDivElement> {\r\n  hotkey: string;\r\n}\r\n\r\nfunction HotkeyButton({ hotkey, onClick, ...restProps }: HotkeyButtonProps) {\r\n  const handleClick = (e: React.MouseEvent<HTMLDivElement>) => {\r\n    onClick && onClick(e);\r\n    ensureCanvasFocus(e);\r\n  };\r\n  return (\r\n    <div className=\"mito-hud-button mito-hud-build-item\" onClick={handleClick} {...restProps}>\r\n      <span className=\"mito-hud-button-hotkey\">{hotkey}</span>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default CellBar;\r\n","import React, { useState } from \"react\";\r\n\r\nimport \"./Expand.scss\";\r\nimport classNames from \"classnames\";\r\n\r\ninterface ExpandProps {\r\n  className?: string;\r\n  children: React.ReactNode;\r\n  shrunkElements: React.ReactNode;\r\n}\r\n\r\nfunction Expand({ className, children, shrunkElements }: ExpandProps) {\r\n  const [expanded, setExpanded] = useState(false);\r\n\r\n  const handleExpandClick = () => {\r\n    setExpanded(!expanded);\r\n  };\r\n\r\n  return (\r\n    <div className={classNames(className, \"expand\")}>\r\n      <div className=\"expand-button\" onClick={handleExpandClick}>\r\n        {shrunkElements}\r\n        <div className=\"expand-caret\">{expanded ? \"\" : \"\"}</div>\r\n      </div>\r\n      {expanded ? <div>{children}</div> : null}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Expand;\r\n","import React from \"react\";\r\nimport classNames from \"classnames\";\r\n\r\nimport { Traits, TRAIT_TYPES, displayName } from \"./traits\";\r\nimport Expand from \"../common/Expand\";\r\n\r\nimport \"./TraitDisplay.scss\";\r\n\r\nfunction TraitDisplay({ traits }: { traits: Traits }) {\r\n  const nonzeroTraits = TRAIT_TYPES.filter((name) => traits[name] !== 0);\r\n  nonzeroTraits.sort((a, b) => traits[b] - traits[a]);\r\n  const nonzeroTraitEl = nonzeroTraits.length > 0 ? (\r\n    <div className=\"interesting-traits\">{nonzeroTraits.map((trait) => (\r\n      <div className={classNames(\"trait\", { green: traits[trait] > 0, red: traits[trait] < 0 })} key={trait}>\r\n        {displayName(trait)}: {traits[trait]}\r\n      </div>\r\n    ))}</div>\r\n  ) : (\r\n      <div className=\"no-interesting-traits\">All traits are zero.</div>\r\n    );\r\n\r\n  const zeroTraits = TRAIT_TYPES.filter((name) => traits[name] === 0);\r\n  const zeroTraitEl = (\r\n    <div className=\"zero-traits\">\r\n      {zeroTraits.map((trait) => (\r\n        <div className=\"trait\" key={trait}>\r\n          {displayName(trait)}: {traits[trait]}\r\n        </div>\r\n      ))}\r\n    </div>\r\n  );\r\n  return (\r\n    <div className=\"trait-display\">\r\n      {nonzeroTraitEl}\r\n      <Expand shrunkElements={<div className=\"expand-toggle\">Show All</div>}>\r\n        {zeroTraitEl}\r\n      </Expand>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default TraitDisplay;\r\n","import classnames from \"classnames\";\r\nimport * as React from \"react\";\r\n\r\nimport Mito from \"../index\";\r\nimport { params } from \"../params\";\r\nimport CellBar from \"./CellBar\";\r\nimport { TIME_PER_YEAR, Season } from \"../game\";\r\n\r\nimport \"./SeasonsTracker.scss\";\r\nimport TraitDisplay from \"../../../evolution/TraitDisplay\";\r\nimport capitalize from \"../../../common/capitalize\";\r\n\r\nfunction BarMarker({ percent }: { percent: number }) {\r\n  const style = {\r\n    left: `${(percent * 100).toFixed(2)}%`,\r\n  };\r\n  return <div className=\"bar-marker\" style={style} />;\r\n}\r\n\r\nfunction SeasonBead({ percent }: { percent: number }) {\r\n  const style = {\r\n    left: `${(percent * 100).toFixed(2)}%`,\r\n  };\r\n  return <div className=\"season-bead\" style={style} />;\r\n}\r\n\r\nfunction SeasonsTracker({ time, season }: { time: number; season: Season }) {\r\n  const yearDonePercent = time / TIME_PER_YEAR;\r\n  const month = Math.floor(season.percent * 3) + 1;\r\n  return (\r\n    <div className=\"seasons-tracker\">\r\n      <div className=\"container\">\r\n        <div className=\"end-brace\" />\r\n        <div className=\"bar\">\r\n          <BarMarker percent={0.25} />\r\n          <BarMarker percent={0.5} />\r\n          <BarMarker percent={0.75} />\r\n          <SeasonBead percent={yearDonePercent} />\r\n        </div>\r\n        <div className=\"end-brace\" />\r\n      </div>\r\n      <div>\r\n        {capitalize(season.name)}, Month {month}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport interface HUDProps {\r\n  mito: Mito;\r\n}\r\n\r\nexport interface HUDState {\r\n  traitsPanelOpen: boolean;\r\n}\r\n\r\nexport class HUD extends React.Component<HUDProps, HUDState> {\r\n  state: HUDState = {\r\n    traitsPanelOpen: true,\r\n  };\r\n\r\n  get mito() {\r\n    return this.props.mito;\r\n  }\r\n\r\n  get world() {\r\n    return this.mito.world;\r\n  }\r\n\r\n  get player() {\r\n    return this.world.player;\r\n  }\r\n\r\n  get inventory() {\r\n    return this.player.inventory;\r\n  }\r\n\r\n  private isTutorialFinished() {\r\n    return this.mito.tutorialRef == null ? true : this.mito.tutorialRef.isFinished();\r\n  }\r\n\r\n  public render() {\r\n    const isMaxed = this.inventory.isMaxed();\r\n    const isMaxedEl = <div className={`mito-inventory-maxed${isMaxed ? \" is-maxed\" : \"\"}`}>maxed</div>;\r\n    return (\r\n      <>\r\n        <SeasonsTracker time={this.world.time} season={this.world.season} />\r\n        {this.maybeRenderTraits()}\r\n        <div className={classnames(\"mito-inventory\", { hidden: false })}>\r\n          {isMaxedEl}\r\n          <div className=\"mito-inventory-container\">\r\n            {this.renderInventoryBar()}\r\n            {this.renderInventory()}\r\n          </div>\r\n          <CellBar\r\n            bar={this.mito.cellBar}\r\n            index={this.mito.cellBarIndex}\r\n            onIndexClicked={(i) => this.mito.setCellBarIndex(i)}\r\n          />\r\n        </div>\r\n      </>\r\n    );\r\n  }\r\n\r\n  maybeRenderTraits() {\r\n    if (this.state.traitsPanelOpen) {\r\n      return (\r\n        <div\r\n          style={{\r\n            position: \"absolute\",\r\n            right: 10,\r\n            top: 50,\r\n            textAlign: \"left\",\r\n            background: \"white\",\r\n            padding: 10,\r\n          }}\r\n        >\r\n          <TraitDisplay traits={this.world.traits} />\r\n        </div>\r\n      );\r\n    }\r\n  }\r\n\r\n  renderInventory() {\r\n    return (\r\n      <div className=\"mito-inventory-indicator\">\r\n        <span className=\"mito-inventory-water\">{this.inventory.water.toFixed(2)} water</span>\r\n        &nbsp;\r\n        <span className=\"mito-inventory-sugar\">{this.inventory.sugar.toFixed(2)} sugar</span>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  renderInventoryBar() {\r\n    const waterPercent = this.inventory.water / params.maxResources;\r\n    const sugarPercent = this.inventory.sugar / params.maxResources;\r\n    const emptyPercent = 1 - (this.inventory.water + this.inventory.sugar) / params.maxResources;\r\n    const waterStyles: React.CSSProperties = {\r\n      width: `${waterPercent * 100}%`,\r\n    };\r\n    const sugarStyles: React.CSSProperties = {\r\n      width: `${sugarPercent * 100}%`,\r\n    };\r\n    const emptyStyles: React.CSSProperties = {\r\n      width: `${emptyPercent * 100}%`,\r\n    };\r\n    const inventoryBar = (\r\n      <div className=\"mito-inventory-bar\">\r\n        <div style={waterStyles} className=\"mito-inventory-bar-water\"></div>\r\n        <div style={sugarStyles} className=\"mito-inventory-bar-sugar\"></div>\r\n        <div style={emptyStyles} className=\"mito-inventory-bar-empty\"></div>\r\n      </div>\r\n    );\r\n    return inventoryBar;\r\n  }\r\n}\r\n","import { Vector2 } from \"three\";\r\n\r\nimport { Noise } from \"../../../common/perlin\";\r\nimport { map } from \"../../../math\";\r\nimport { params } from \"../params\";\r\nimport { Fountain, Rock, Soil, Tile } from \"./tile\";\r\nimport { World } from \"./world\";\r\n\r\nexport interface Environment {\r\n  climate: {\r\n    turnsBetweenRainfall: number;\r\n    rainDuration: number;\r\n    waterPerDroplet: number;\r\n  };\r\n  waterGravityPerTurn: number;\r\n  evaporationRate: number;\r\n  evaporationBottom: number;\r\n  floorCo2: number;\r\n  fill: FillFunction[];\r\n}\r\n\r\nexport type FillFunction = (pos: Vector2, world: World) => Tile | undefined;\r\n\r\nexport const Temperate = () => {\r\n  const noiseWater = new Noise();\r\n  const noiseRock = new Noise();\r\n  const noiseHeight = new Noise();\r\n\r\n  const environment: Environment = {\r\n    climate: {\r\n      turnsBetweenRainfall: 800,\r\n      rainDuration: 50,\r\n      waterPerDroplet: 2,\r\n    },\r\n    evaporationRate: 0.0002,\r\n    evaporationBottom: 0.6,\r\n    floorCo2: 0.5,\r\n    waterGravityPerTurn: 0.001,\r\n    fill: [\r\n      (pos, world) => {\r\n        const { x, y } = pos;\r\n        const soilLevel =\r\n          world.height / 2 - (4 * (noiseHeight.perlin2(0, x / 5) + 1)) / 2 - 16 * noiseHeight.perlin2(10, x / 20 + 10);\r\n        const rockThreshold = map(y - world.height / 2, 0, world.height / 2, -0.7, 0.3);\r\n        const isRock = noiseRock.simplex2(x / 5, y / 5) < rockThreshold;\r\n        if (y > soilLevel) {\r\n          if (isRock) {\r\n            const rock = new Rock(pos, world);\r\n            return rock;\r\n          } else {\r\n            const heightScalar = Math.pow(map(y - world.height / 2, 0, world.height / 2, 0.5, 1), 2);\r\n            const simplexScalar = 0.2;\r\n            // this 0.1 factor makes a *huge* difference\r\n            const simplexValue = noiseWater.simplex2(x * simplexScalar, y * simplexScalar) + 0.2;\r\n            const water = Math.round(\r\n              Math.max(\r\n                1,\r\n                Math.min(\r\n                  // should be soil_max_water, isn't cuz of dependency cycles messing up instantiation\r\n                  20,\r\n                  simplexValue > 0.4 ? 20 * heightScalar : 0\r\n                )\r\n              )\r\n            );\r\n            if (heightScalar * simplexValue > 1 / params.fountainAppearanceRate) {\r\n              const emitWaterScalar = Math.min(heightScalar * simplexValue, 1);\r\n              return new Fountain(pos, water, world, Math.round(params.fountainTurnsPerWater / emitWaterScalar));\r\n            } else {\r\n              return new Soil(pos, water, world);\r\n            }\r\n          }\r\n        }\r\n      },\r\n    ],\r\n  };\r\n  return environment;\r\n};\r\n\r\nexport const Desert = () => {\r\n  const noiseHeight = new Noise();\r\n  const noiseRock = new Noise();\r\n\r\n  const e: Environment = {\r\n    climate: {\r\n      rainDuration: 220,\r\n      turnsBetweenRainfall: 3000,\r\n      waterPerDroplet: 8,\r\n    },\r\n    evaporationRate: 0.002,\r\n    evaporationBottom: 0.7,\r\n    waterGravityPerTurn: 0.02,\r\n    floorCo2: 0.95,\r\n    fill: [\r\n      (pos, world) => {\r\n        const { x, y } = pos;\r\n        const soilLevel =\r\n          world.height / 2 - (2 * (noiseHeight.perlin2(0, x / 20) + 1)) / 2 - 3 * noiseHeight.perlin2(10, x / 100 + 10);\r\n\r\n        const rockThreshold = map(y, world.height / 2, world.height, -0.8, -0.4);\r\n        const isRock = noiseRock.simplex2(x / 4, y / 4) < rockThreshold;\r\n        if (y > soilLevel) {\r\n          if (isRock) {\r\n            return new Rock(pos, world);\r\n          }\r\n          const water = Math.floor(Math.max(0, map(y, world.height * 0.75, world.height, 1, 9)));\r\n          return new Soil(pos, water, world);\r\n        }\r\n      },\r\n    ],\r\n  };\r\n  return e;\r\n};\r\n\r\nexport const Rocky = () => {\r\n  const noiseRock = new Noise();\r\n  const noiseHeight = new Noise();\r\n\r\n  const e: Environment = {\r\n    climate: {\r\n      turnsBetweenRainfall: 1200,\r\n      rainDuration: 120,\r\n      waterPerDroplet: 3,\r\n    },\r\n    waterGravityPerTurn: 0.1,\r\n    evaporationBottom: 0.6,\r\n    evaporationRate: 0.001,\r\n    floorCo2: 1,\r\n    fill: [\r\n      (pos, world) => {\r\n        const { x, y } = pos;\r\n        const soilLevel =\r\n          world.height * 0.55 -\r\n          (4 * (noiseHeight.perlin2(0, x / 5) + 1)) / 2 -\r\n          16 * noiseHeight.perlin2(10, x / 20 + 10) -\r\n          map(x, 0, world.width, 10, -10);\r\n        const rockLevel =\r\n          y - (6 * (noiseHeight.perlin2(0, x / 25) + 1)) / 2 - 20 * noiseHeight.perlin2(10, x / 150 + 10);\r\n        const rockThreshold = rockLevel < world.height * 0.5 ? -1 : -0.15;\r\n        const isRock = noiseRock.simplex2(x / 10, y / 10) < rockThreshold;\r\n        if (isRock) {\r\n          const rock = new Rock(pos, world);\r\n          return rock;\r\n        } else if (y > soilLevel) {\r\n          return new Soil(pos, 3, world);\r\n        }\r\n      },\r\n    ],\r\n  };\r\n  return e;\r\n};\r\n\r\nexport const ALL_ENVIRONMENTS = {\r\n  Temperate,\r\n  Desert,\r\n  Rocky,\r\n};\r\n","import * as React from \"react\";\r\n\r\ninterface SceneObjectProps {\r\n  object: THREE.Object3D;\r\n  parent: THREE.Object3D;\r\n  // children?: SceneObject[];\r\n}\r\nexport class SceneObject extends React.PureComponent<SceneObjectProps, {}> {\r\n  // render() {\r\n  //     if (this.props.children) {\r\n  //         return <>\r\n  //             {\r\n  //                 this.props.children.map((child) => React.cloneElement(child, { parent: this.props.object }))\r\n  //             }\r\n  //         </>;\r\n  //     }\r\n  // }\r\n\r\n  render() {\r\n    return null;\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.props.parent.add(this.props.object);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.props.parent.remove(this.props.object);\r\n  }\r\n}\r\n","import * as dat from \"dat.gui\";\r\nimport * as React from \"react\";\r\n\r\nimport { ALL_ENVIRONMENTS } from \"../game/environment\";\r\nimport { params, updateParamsHash } from \"../params\";\r\n\r\nexport class ParamsGUI extends React.Component {\r\n  private gui: dat.GUI;\r\n  constructor(props: any) {\r\n    super(props);\r\n    const gui = new dat.GUI({\r\n      closed: true,\r\n      width: 450,\r\n    });\r\n    gui\r\n      .add(params, \"environment\", Object.keys(ALL_ENVIRONMENTS))\r\n      .onChange(() => setTimeout(() => window.location.reload(), 100));\r\n    gui.add(params, \"droop\", 0, 0.5, 0.01);\r\n    gui.add(params, \"fountainTurnsPerWater\", 1, 100, 1);\r\n    gui.add(params, \"isRealtime\");\r\n    gui.add(params, \"leafReactionRate\", 0, 0.2, 0.0001);\r\n    gui.add(params, \"leafSugarPerReaction\", 0, 1, 0.01);\r\n    gui.add(params, \"rootTurnsPerTransfer\", 1, 100, 1);\r\n    gui.add(params, \"soilDarknessBase\", 0, 1, 0.01);\r\n    gui.add(params, \"soilDiffusionType\", [\"discrete\", \"continuous\"]);\r\n    gui.add(params, \"sunlightReintroduction\", 0, 1, 0.01);\r\n    gui.add(params, \"sunlightDiffusion\", 0, 1, 0.01);\r\n    gui.add(params, \"transportTurnsPerMove\", 1, 50, 1);\r\n    gui.add(params, \"veinDiffusion\", 0, 0.85, 0.0001);\r\n    const f = gui.addFolder(\"Needs Page Refresh\");\r\n    f.add(params, \"cellGestationTurns\", 0, 100, 1);\r\n    f.add(params, \"cellDiffusionSugar\", 0, 0.85, 0.0001);\r\n    f.add(params, \"cellDiffusionWater\", 0, 0.85, 0.0001);\r\n    f.add(params, \"cellEnergyMax\", 400, 10000, 100);\r\n    f.add(params, \"fountainAppearanceRate\", 1, 5, 0.1);\r\n    f.add(params, \"maxResources\", 10, 1000, 1);\r\n    f.add(params, \"soilDiffusionWater\", 0, 0.25, 0.00001);\r\n    f.add(params, \"soilMaxWater\", 1, 100, 1);\r\n    f.add(params, \"tissueInventoryCapacity\", 1, 100, 1);\r\n\r\n    for (const c of gui.__controllers.concat(f.__controllers)) {\r\n      c.onFinishChange(updateParamsHash);\r\n    }\r\n\r\n    this.gui = gui;\r\n  }\r\n\r\n  render() {\r\n    return null;\r\n  }\r\n}\r\n","import React from \"react\";\r\n\r\nexport class Animate extends React.Component<{\r\n  a: (time: number) => void;\r\n}> {\r\n  private rafid?: number;\r\n  private animate = (time: number) => {\r\n    this.props.a(time / 1000);\r\n    this.rafid = requestAnimationFrame(this.animate);\r\n  };\r\n  render() {\r\n    return null;\r\n  }\r\n  componentDidMount() {\r\n    this.rafid = requestAnimationFrame(this.animate);\r\n  }\r\n  componentWillUnmount() {\r\n    if (this.rafid) {\r\n      cancelAnimationFrame(this.rafid);\r\n    }\r\n  }\r\n}\r\n","import * as React from \"react\";\r\nimport * as THREE from \"three\";\r\n\r\nimport lazy from \"../../../common/lazy\";\r\nimport { SceneObject } from \"./sceneObject\";\r\nimport { Animate } from \"./Animate\";\r\n\r\nexport const TILE_HIGHLIGHT = lazy(() => {\r\n  const geometry = new THREE.PlaneBufferGeometry(1, 1);\r\n  const edgesGeometry = new THREE.EdgesGeometry(geometry, 1); // or WireframeGeometry( geometry )\r\n  const material = new THREE.LineBasicMaterial({\r\n    color: 0xffffff,\r\n    transparent: true,\r\n    opacity: 0.75,\r\n  });\r\n  const lineSegments = new THREE.LineSegments(edgesGeometry, material);\r\n  lineSegments.position.z = 10;\r\n  return lineSegments;\r\n});\r\n\r\nexport interface TileHighlightProps {\r\n  x: number;\r\n  y: number;\r\n  scene: THREE.Scene;\r\n}\r\n\r\nclass TileHighlight extends React.PureComponent<TileHighlightProps, {}> {\r\n  private object = TILE_HIGHLIGHT().clone();\r\n  render() {\r\n    this.object.position.x = this.props.x;\r\n    this.object.position.y = this.props.y;\r\n    return (\r\n      <>\r\n        <Animate a={(t) => this.object.scale.setScalar(Math.sin(t * 3.7) * 0.04 + 0.94)} />\r\n        <SceneObject object={this.object} parent={this.props.scene} />\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\nexport default TileHighlight;\r\n","import * as React from \"react\";\r\nimport * as THREE from \"three\";\r\n\r\nimport lazy from \"../../../common/lazy\";\r\nimport { SceneObject } from \"./sceneObject\";\r\n\r\nexport const POINT_HIGHLIGHT = lazy(() => {\r\n  const geometry = new THREE.CircleBufferGeometry(0.1, 20);\r\n  const material = new THREE.MeshBasicMaterial({\r\n    color: 0xffffff,\r\n    transparent: true,\r\n    opacity: 0.75,\r\n    side: THREE.DoubleSide,\r\n  });\r\n  const mesh = new THREE.Mesh(geometry, material);\r\n  mesh.position.z = 10;\r\n  return mesh;\r\n  // const edgesGeometry = new THREE.EdgesGeometry(geometry, 1); // or WireframeGeometry( geometry )\r\n  // const material = new THREE.LineBasicMaterial({ color: 0xffffff, transparent: true, opacity: 0.75 });\r\n  // const lineSegments = new THREE.LineSegments(edgesGeometry, material);\r\n  // lineSegments.position.z = 10;\r\n  // return lineSegments;\r\n});\r\n\r\nexport interface PointHighlightProps {\r\n  x: number;\r\n  y: number;\r\n  z?: number;\r\n  scene: THREE.Scene;\r\n}\r\n\r\nclass PointHighlight extends React.PureComponent<PointHighlightProps, {}> {\r\n  private object = POINT_HIGHLIGHT().clone();\r\n  render() {\r\n    this.object.position.x = this.props.x;\r\n    this.object.position.y = this.props.y;\r\n    return (\r\n      <>\r\n        {/* <Animate a={((t) => this.object.scale.setScalar(Math.sin(t * 3.7) * 0.04 + 0.94))} /> */}\r\n        <SceneObject object={this.object} parent={this.props.scene} />\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\nexport default PointHighlight;\r\n","import * as React from \"react\";\r\n\r\nimport Mito from \"..\";\r\nimport { Tile } from \"../game/tile\";\r\nimport TileHighlight from \"../tutorial/tileHighlight\";\r\nimport { HoveredTileInfo } from \"./HoveredTileInfo\";\r\nimport PointHighlight from \"../tutorial/PointHighlight\";\r\n\r\ninterface HoverProps {\r\n  mito: Mito;\r\n}\r\n\r\nexport class Hover extends React.Component<HoverProps> {\r\n  get scene() {\r\n    return this.props.mito.scene;\r\n  }\r\n  public render() {\r\n    const { highlightedTile } = this.props.mito;\r\n    const highlightedPosition = this.props.mito.getHighlightPosition();\r\n    return (\r\n      <>\r\n        <HoveredTileInfo tile={highlightedTile} />\r\n        <PointHighlight x={highlightedPosition.x} y={highlightedPosition.y} scene={this.scene} />\r\n        {this.maybeRenderTileHighlight(highlightedTile)}\r\n        {/* {this.maybeRenderPath()} */}\r\n      </>\r\n    );\r\n  }\r\n\r\n  public maybeRenderTileHighlight(tile?: Tile) {\r\n    if (tile) {\r\n      return <TileHighlight x={tile.pos.x} y={tile.pos.y} scene={this.scene} />;\r\n    }\r\n  }\r\n\r\n  // public maybeRenderPath() {\r\n  //   const { autoplace, hoveredTile, scene, world } = this.props.mito;\r\n  //   if (hoveredTile) {\r\n  //     if (autoplace != null && Mito.expansionTiles.indexOf(autoplace) !== -1) {\r\n  //       return <PathHighlight tile={hoveredTile} scene={scene} world={world} walkable=\"non-obstacles\" />;\r\n  //     }\r\n  //     if (autoplace === Transport) {\r\n  //       return <PathHighlight tile={hoveredTile} scene={scene} world={world} walkable=\"tissue\" />;\r\n  //     }\r\n  //   }\r\n  // }\r\n}\r\n\r\n// class PathHighlight extends React.PureComponent<{ world: World, tile: Tile, scene: THREE.Scene, walkable: \"tissue\" | \"non-obstacles\" }> {\r\n//   render() {\r\n//     const path = this.props.walkable === \"non-obstacles\"\r\n//       ? findPositionsThroughNonObstacles(this.props.world, this.props.tile.pos)\r\n//       : findPositionsThroughTissue(this.props.world, this.props.tile.pos);\r\n//     return <>\r\n//       {path.map(([x, y]) => <TileHighlight x={x} y={y} scene={this.props.scene} />)}\r\n//     </>;\r\n//   }\r\n// }\r\n","import { Color, DoubleSide, Mesh, MeshBasicMaterial, PlaneBufferGeometry, Scene } from \"three\";\r\n\r\nimport { Player } from \"../game\";\r\nimport { Mito } from \"../index\";\r\nimport { textureFromSpritesheet } from \"../spritesheet\";\r\nimport { Renderer } from \"./Renderer\";\r\nimport { lerp2 } from \"../../../math\";\r\n\r\nexport class PlayerRenderer extends Renderer<Player> {\r\n  public mesh: Mesh;\r\n  constructor(target: Player, scene: Scene, mito: Mito) {\r\n    super(target, scene, mito);\r\n    this.mesh = new Mesh(\r\n      new PlaneBufferGeometry(0.75, 0.75),\r\n      // new THREE.CircleBufferGeometry(0.5, 20),\r\n      new MeshBasicMaterial({\r\n        transparent: true,\r\n        depthWrite: false,\r\n        depthTest: false,\r\n        map: textureFromSpritesheet(29, 12, \"transparent\"),\r\n        color: new Color(\"white\"),\r\n        side: DoubleSide,\r\n      })\r\n    );\r\n    lerp2(this.mesh.position, this.target.pos, 1);\r\n    this.mesh.position.z = 2;\r\n    this.scene.add(this.mesh);\r\n  }\r\n  update() {\r\n    const pos = this.target.droopPosFloat().clone();\r\n    pos.x += Math.cos(performance.now() / 1000) * 0.04;\r\n    pos.y += Math.sin(performance.now() / 400) * 0.08;\r\n    lerp2(this.mesh.position, pos, 0.5);\r\n    this.mesh.position.z = 2;\r\n    // for (const [key, keyMesh] of MOVEMENT_KEY_MESHES) {\r\n    //   const action = MOVEMENT_KEYS[key];\r\n    //   const x = this.target.pos.x + action.dir.x;\r\n    //   const y = this.target.pos.y + action.dir.y;\r\n    //   if (this.target.isBuildCandidate(this.mito.world.tileAt(x, y)) && this.mito.uiState.type === \"main\") {\r\n    //     this.scene.add(keyMesh);\r\n    //     keyMesh.position.x = x;\r\n    //     keyMesh.position.y = y;\r\n    //     keyMesh.position.z = 2;\r\n    //   } else {\r\n    //     this.scene.remove(keyMesh);\r\n    //   }\r\n    // }\r\n  }\r\n  destroy() {\r\n    this.scene.remove(this.mesh);\r\n  }\r\n}\r\n","import { ArrowHelper, Object3D, Scene, Vector2, Vector3 } from \"three\";\r\n\r\nimport Mito from \"..\";\r\nimport { Transport } from \"../game/tile\";\r\nimport { TileRenderer } from \"./TileRenderer\";\r\n\r\nexport class TransportRenderer extends TileRenderer<Transport> {\r\n  private arrow?: Object3D;\r\n  constructor(target: Transport, scene: Scene, mito: Mito) {\r\n    super(target, scene, mito);\r\n    this.arrow = this.makeArrow(this.target.dir);\r\n    this.mesh.add(this.arrow);\r\n  }\r\n\r\n  // update() {\r\n  //     super.update();\r\n  //     const from = this.target.getFrom();\r\n  //     if (from == null && this.fromArrow != null) {\r\n  //         this.mesh.remove(this.fromArrow);\r\n  //         this.fromArrow = undefined;\r\n  //     }\r\n  //     if (from != null && this.fromArrow == null) {\r\n  //         this.fromArrow = this.makeArrow(this.target.dir, this.target.dir.clone().multiplyScalar(-1));\r\n  //         this.mesh.add(this.fromArrow);\r\n  //     }\r\n\r\n  //     const to = this.target.getTarget();\r\n  //     if (to == null && this.toArrow != null) {\r\n  //         this.mesh.remove(this.toArrow);\r\n  //         this.toArrow = undefined;\r\n  //     }\r\n  //     if (to != null && this.toArrow == null) {\r\n  //         this.toArrow = this.makeArrow(this.target.dir, this.target.dir.clone().multiplyScalar(0));\r\n  //         this.mesh.add(this.toArrow);\r\n  //     }\r\n  // }\r\n\r\n  private makeArrow(dir: Vector2) {\r\n    const length = dir.length() - 0.25;\r\n    const arrowDir = new Vector3(dir.x, dir.y, 0).normalize();\r\n    const pos = arrowDir.clone().multiplyScalar(-length / 2);\r\n    return new ArrowHelper(arrowDir, new Vector3(pos.x, pos.y, 1), length, 0xffffff, 0.1, 0.1);\r\n  }\r\n}\r\n","import { Scene } from \"three\";\r\nimport { createSelector } from \"reselect\";\r\n\r\nimport { Renderer } from \"./Renderer\";\r\nimport { World, Entity, Player, StepStats } from \"../game\";\r\nimport Mito from \"..\";\r\nimport { PlayerRenderer } from \"./PlayerRenderer\";\r\nimport { Transport, Tile } from \"../game/tile\";\r\nimport { TransportRenderer } from \"./TransportRenderer\";\r\nimport { TileRenderer } from \"./TileRenderer\";\r\nimport { InventoryRenderer } from \"./InventoryRenderer\";\r\n\r\nfunction createRendererFor<E extends Entity>(object: E, scene: Scene, mito: Mito): Renderer<Entity> {\r\n  if (object instanceof Player) {\r\n    return new PlayerRenderer(object, scene, mito);\r\n  } else if (object instanceof Transport) {\r\n    return new TransportRenderer(object, scene, mito);\r\n  } else if (object instanceof Tile) {\r\n    return new TileRenderer(object, scene, mito);\r\n  } else {\r\n    throw new Error(`Couldn't find renderer for ${object}`);\r\n  }\r\n}\r\n\r\nexport class WorldRenderer extends Renderer<World> {\r\n  public renderers = new Map<Entity, Renderer<Entity>>();\r\n  constructor(target: World, scene: Scene, mito: Mito) {\r\n    super(target, scene, mito);\r\n    scene.add(InventoryRenderer.WaterParticles());\r\n    scene.add(InventoryRenderer.SugarParticles());\r\n  }\r\n\r\n  public getOrCreateRenderer(entity: Entity) {\r\n    const renderer = this.renderers.get(entity);\r\n    if (renderer == null) {\r\n      const created = createRendererFor(entity, this.scene, this.mito);\r\n      this.renderers.set(entity, created);\r\n      return created;\r\n    } else {\r\n      return renderer;\r\n    }\r\n  }\r\n\r\n  private deleteDeadEntityRenderers = createSelector(\r\n    (stats: StepStats) => stats,\r\n    (stats) => {\r\n      const deletedEntities = stats.deleted;\r\n\r\n      for (const e of deletedEntities) {\r\n        const renderer = this.renderers.get(e);\r\n        if (renderer == null) {\r\n          throw new Error(`Couldn't find renderer for ${e}!`);\r\n        }\r\n        renderer.destroy();\r\n        this.renderers.delete(e);\r\n      }\r\n    }\r\n  );\r\n\r\n  update(): void {\r\n    this.deleteDeadEntityRenderers(this.target.getLastStepStats());\r\n\r\n    InventoryRenderer.startFrame();\r\n    this.target.entities().forEach((entity) => {\r\n      const renderer = this.getOrCreateRenderer(entity);\r\n      renderer.update();\r\n    });\r\n    InventoryRenderer.endFrame();\r\n  }\r\n  destroy(): void {\r\n    throw new Error(\"Method not implemented.\");\r\n  }\r\n}\r\n","import * as React from \"react\";\r\nimport * as THREE from \"three\";\r\nimport { OrthographicCamera, Scene, Vector2, WebGLRenderer, Vector3 } from \"three\";\r\n\r\nimport { parse } from \"query-string\";\r\n\r\nimport { map, lerp2 } from \"../../math/index\";\r\nimport { ISketch, SketchAudioContext } from \"../sketch\";\r\nimport { ActionBuild, ActionMove } from \"./action\";\r\nimport { drums, hookUpAudio, strings } from \"./audio\";\r\nimport { Constructor } from \"./constructor\";\r\nimport { World } from \"./game\";\r\nimport { Cell, Fruit, Root, Tissue, Transport, Vein, Leaf, Tile } from \"./game/tile\";\r\nimport { ACTION_KEYMAP, MOVEMENT_KEYS } from \"./keymap\";\r\nimport { params } from \"./params\";\r\nimport { NewPlayerTutorial } from \"./tutorial\";\r\nimport { GameStack, Hover, HUD } from \"./ui\";\r\nimport { WorldRenderer } from \"./renderers/WorldRenderer\";\r\nimport { HexTile } from \"../../overworld/hexTile\";\r\nimport { Species } from \"../../evolution/species\";\r\n\r\nexport interface GameResult {\r\n  status: \"won\" | \"lost\";\r\n  fruits: Fruit[];\r\n  world: World;\r\n}\r\n\r\nexport class WorldDOMElement {\r\n  constructor(public mito: Mito, public positionFn: () => Vector2, public renderFn: () => JSX.Element) { }\r\n\r\n  render() {\r\n    const worldPosition = this.positionFn();\r\n    const pixelPosition = this.mito.worldToScreen(worldPosition);\r\n    const left = pixelPosition.x;\r\n    const top = pixelPosition.y;\r\n    const style: React.CSSProperties = {\r\n      left,\r\n      top,\r\n    };\r\n    return <div style={style}>{this.renderFn()}</div>;\r\n  }\r\n}\r\n\r\nexport class Mito extends ISketch {\r\n  public readonly world: World;\r\n  public scene = new Scene();\r\n  private camera = new OrthographicCamera(0, 0, 0, 0, -100, 100);\r\n  public cellBar: Constructor<Cell>[] = [Tissue, Leaf, Root, Transport, Fruit];\r\n  public cellBarIndex = 0;\r\n  public tutorialRef: NewPlayerTutorial | null = null;\r\n  public mouse = new THREE.Vector2();\r\n  public mouseDown = false;\r\n  public mouseButton = -1;\r\n  public instructionsOpen = false;\r\n  private firstActionTakenYet = false;\r\n  public audioListener = new THREE.AudioListener();\r\n  private keyMap = new Set<string>();\r\n  public highlightedTile?: Tile;\r\n\r\n  public events = {\r\n    contextmenu: (event: MouseEvent) => {\r\n      event.preventDefault();\r\n      return false;\r\n    },\r\n    mousemove: (event: MouseEvent) => {\r\n      this.mouse.x = event.clientX!;\r\n      this.mouse.y = event.clientY!;\r\n    },\r\n    click: () => {\r\n      // left-click\r\n      // this.handleClick(event.clientX!, event.clientY!);\r\n    },\r\n    mousedown: (event: MouseEvent) => {\r\n      this.mouseButton = event.button;\r\n      this.mouseDown = true;\r\n    },\r\n    mouseup: () => {\r\n      this.mouseDown = false;\r\n    },\r\n    keydown: (event: KeyboardEvent) => {\r\n      this.firstActionTakenYet = true;\r\n      const key = event.key!;\r\n      this.keyMap.add(key);\r\n      if (!event.repeat) {\r\n        this.handleKeyDown(key);\r\n      }\r\n    },\r\n    keyup: (event: KeyboardEvent) => {\r\n      this.keyMap.delete(event.key!);\r\n    },\r\n    wheel: (e: WheelEvent) => {\r\n      if (e.shiftKey) {\r\n        // on my mouse, one scroll is + or - 125\r\n        const delta = -(e.deltaX + e.deltaY) / 125 / 20;\r\n        const currZoom = this.camera.zoom;\r\n        const scalar = Math.pow(2, delta);\r\n        // console.log(currZoom);\r\n        // zoom of 2 is zooming in\r\n        // const newZoom = Math.min(Math.max(currZoom * scalar, 1), 2.5);\r\n        const newZoom = currZoom * scalar;\r\n        this.camera.zoom = newZoom;\r\n        this.camera.updateProjectionMatrix();\r\n      } else {\r\n        if (e.deltaX + e.deltaY < 0) {\r\n          this.setCellBarIndex(this.cellBarIndex - 1);\r\n        } else {\r\n          this.setCellBarIndex(this.cellBarIndex + 1);\r\n        }\r\n      }\r\n    },\r\n  };\r\n\r\n  get selectedCell() {\r\n    return this.cellBar[this.cellBarIndex];\r\n  }\r\n\r\n  private worldRenderer: WorldRenderer;\r\n  constructor(\r\n    renderer: WebGLRenderer,\r\n    context: SketchAudioContext,\r\n    level: HexTile,\r\n    species: Species,\r\n    public onWinLoss: (result: GameResult) => void\r\n  ) {\r\n    super(renderer, context);\r\n    if (level.info.world == null) {\r\n      level.info.world = new World(level.info.environment!, species);\r\n    }\r\n    this.world = level.info.world;\r\n\r\n    this.camera.position.z = 10;\r\n    this.camera.lookAt(new THREE.Vector3(0, 0, 0));\r\n    this.camera.position.x = this.world.player.pos.x;\r\n    this.camera.position.y = this.world.player.pos.y;\r\n    this.camera.zoom = 1.5;\r\n    this.camera.add(this.audioListener);\r\n\r\n    this.worldRenderer = new WorldRenderer(this.world, this.scene, this);\r\n\r\n    // step once to get a StepStats\r\n    this.world.step();\r\n\r\n    hookUpAudio(this.audioContext);\r\n    this.updateAmbientAudio();\r\n    (window as any).mito = this;\r\n    (window as any).THREE = THREE;\r\n  }\r\n\r\n  handleKeyDown = (key: string) => {\r\n    if (key === \"?\") {\r\n      this.instructionsOpen = !this.instructionsOpen;\r\n      return;\r\n    }\r\n    if (this.instructionsOpen) {\r\n      if (key === \"Escape\") {\r\n        this.instructionsOpen = false;\r\n      }\r\n      return;\r\n    }\r\n\r\n    if ([\"1\", \"2\", \"3\", \"4\", \"5\"].indexOf(key) !== -1) {\r\n      const index = key.charCodeAt(0) - \"1\".charCodeAt(0);\r\n      this.cellBarIndex = index;\r\n    }\r\n  };\r\n\r\n  public setCellBarIndex(i: number) {\r\n    this.cellBarIndex = ((i % this.cellBar.length) + this.cellBar.length) % this.cellBar.length;\r\n  }\r\n\r\n  public render() {\r\n    const worldDomElementComponents: JSX.Element[] = [];\r\n    for (const e of this.worldDomElements) {\r\n      worldDomElementComponents.push(e.render());\r\n    }\r\n    return (\r\n      <>\r\n        <HUD mito={this} />\r\n        <GameStack mito={this} />\r\n        {/* <NewPlayerTutorial ref={(ref) => this.tutorialRef = ref } mito={this} />, */}\r\n        {/* <ParamsGUI /> */}\r\n        <Hover mito={this} />\r\n        <div className=\"world-dom-components\">{worldDomElementComponents}</div>\r\n      </>\r\n    );\r\n  }\r\n\r\n  public updateAmbientAudio() {\r\n    const yPos = this.world.player.pos.y;\r\n    const drumVolume = map(yPos, this.world.height / 2, this.world.height, 0, 0.5);\r\n    const stringsVolume = map(yPos, this.world.height / 2, 0, 0, 0.5);\r\n    drums.gain.gain.value = Math.max(0, drumVolume);\r\n    strings.gain.gain.value = Math.max(0, stringsVolume);\r\n  }\r\n\r\n  public logRenderInfo() {\r\n    console.log(\r\n      `Geometries in memory: ${this.renderer.info.memory.geometries}\r\nTextures in memory: ${this.renderer.info.memory.textures}\r\nNumber of Programs: ${this.renderer.info.programs!.length}\r\n# Render Calls: ${this.renderer.info.render.calls}\r\n# Render Lines: ${this.renderer.info.render.lines}\r\n# Render Points: ${this.renderer.info.render.points}\r\n# Render Tris: ${this.renderer.info.render.triangles}\r\n`\r\n    );\r\n  }\r\n\r\n  public perfDebug() {\r\n    // count how many have autoUpdate enabled\r\n    let yes = 0,\r\n      no = 0;\r\n    this.scene.traverse((o) => {\r\n      if (o.matrixAutoUpdate) {\r\n        yes++;\r\n      } else {\r\n        no++;\r\n      }\r\n    });\r\n    console.log(\"matrixAutoUpdate: yes\", yes, \", no\", no);\r\n\r\n    // count how many vertices of each type there are\r\n    const s = new Map();\r\n    this.scene.traverse((o) => {\r\n      const k = s.get(o.name || o.constructor.name) || [];\r\n      s.set(o.name || o.constructor.name, k);\r\n      k.push(o);\r\n    });\r\n    console.log(s);\r\n  }\r\n\r\n  public worldStep() {\r\n    if (!this.firstActionTakenYet || this.instructionsOpen) {\r\n      return;\r\n    }\r\n\r\n    // this.world.player.dropWater = this.keyMap.has(\"q\");\r\n    // this.world.player.dropSugar = this.keyMap.has(\"e\");\r\n    this.world.step();\r\n\r\n    if (this.tutorialRef) {\r\n      this.tutorialRef.setState({ time: this.world.time });\r\n    }\r\n\r\n    const gameResult = this.world.maybeGetGameResult();\r\n    if (gameResult != null) {\r\n      this.onWinLoss(gameResult);\r\n    }\r\n\r\n    this.updateAmbientAudio();\r\n  }\r\n\r\n  private getCameraNormCoordinates(clientX: number, clientY: number) {\r\n    return new THREE.Vector2((clientX / this.canvas.width) * 2 - 1, (-clientY / this.canvas.height) * 2 + 1);\r\n  }\r\n\r\n  public getHighlightVector(clientX = this.mouse.x, clientY = this.mouse.y) {\r\n    const offset = new Vector2(clientX - this.canvas.width / 2, clientY - this.canvas.height / 2);\r\n\r\n    offset.setLength(0.75);\r\n    return offset;\r\n  }\r\n\r\n  public getHighlightPosition(clientX = this.mouse.x, clientY = this.mouse.y) {\r\n    const offset = this.getHighlightVector(clientX, clientY);\r\n    const { x, y } = this.world.player.posFloat;\r\n\r\n    offset.x += x;\r\n    offset.y += y;\r\n    return offset;\r\n  }\r\n\r\n  private getHighlightedTile(clientX = this.mouse.x, clientY = this.mouse.y) {\r\n    const p = this.getHighlightPosition(clientX, clientY);\r\n    p.round();\r\n\r\n    const tile = this.world.tileAt(p.x, p.y);\r\n    if (tile != null && tile.lightAmount() > 0) {\r\n      return tile;\r\n    }\r\n  }\r\n\r\n  worldToScreen(world: Vector2) {\r\n    const screen = new Vector3(world.x, world.y, 0);\r\n    screen.project(this.camera); // `camera` is a THREE.PerspectiveCamera\r\n\r\n    screen.x = Math.round((0.5 + screen.x / 2) * this.canvas.width);\r\n    screen.y = Math.round((0.5 - screen.y / 2) * this.canvas.height);\r\n\r\n    return screen;\r\n  }\r\n\r\n  private worldDomElements = new Set<WorldDOMElement>();\r\n  addWorldDOMElement(positionFn: () => THREE.Vector2, renderFn: () => JSX.Element): WorldDOMElement {\r\n    const e = new WorldDOMElement(this, positionFn, renderFn);\r\n    this.worldDomElements.add(e);\r\n    return e;\r\n  }\r\n\r\n  removeWorldDOMElement(worldDomElement: WorldDOMElement) {\r\n    this.worldDomElements.delete(worldDomElement);\r\n  }\r\n\r\n  // private getTileAtScreenPosition(clientX: number, clientY: number) {\r\n  //   const cameraNorm = this.getCameraNormCoordinates(clientX, clientY);\r\n  //   this.raycaster.setFromCamera(cameraNorm, this.camera);\r\n\r\n  //   const { x, y } = this.raycaster.ray.origin;\r\n  //   const ix = Math.round(x);\r\n  //   const iy = Math.round(y);\r\n  //   const tile = this.world.tileAt(ix, iy);\r\n  //   if (tile != null && tile.lightAmount() > 0) {\r\n  //     return tile;\r\n  //   }\r\n  //   // }\r\n  // }\r\n\r\n  public animate() {\r\n    if (this.instructionsOpen) {\r\n      return;\r\n    }\r\n    // if (document.activeElement !== this.canvas && !document.querySelector(\".dg.ac\")!.contains(document.activeElement)) {\r\n    //     this.canvas.focus();\r\n    // }\r\n    this.canvas.focus();\r\n    if (params.isRealtime) {\r\n      const moveAction = this.keysToMovement(this.keyMap);\r\n      if (moveAction) {\r\n        this.world.player.setAction(moveAction);\r\n      }\r\n      for (const key of this.keyMap) {\r\n        if (ACTION_KEYMAP[key]) {\r\n          this.world.player.setAction(ACTION_KEYMAP[key]);\r\n        }\r\n      }\r\n      if (this.mouseDown) {\r\n        // left\r\n        if (this.mouseButton === 0) {\r\n          this.handleLeftClick();\r\n        } else if (this.mouseButton === 2) {\r\n          this.handleRightClick();\r\n        }\r\n      }\r\n      this.worldStep();\r\n    } else if (this.world.player.getAction() != null) {\r\n      this.worldStep();\r\n    }\r\n    this.worldRenderer.update();\r\n\r\n    this.highlightedTile = this.getHighlightedTile();\r\n\r\n    const mouseNorm = this.getCameraNormCoordinates(this.mouse.x, this.mouse.y);\r\n    const target = new THREE.Vector2(\r\n      this.world.player.posFloat.x + mouseNorm.x / 2,\r\n      this.world.player.posFloat.y - mouseNorm.y / 2\r\n    );\r\n    lerp2(this.camera.position, target, 0.3);\r\n\r\n    this.renderer.render(this.scene, this.camera);\r\n    if (Boolean(parse(window.location.search).debug) && this.frameCount % 100 === 0) {\r\n      // this.perfDebug();\r\n      this.logRenderInfo();\r\n    }\r\n  }\r\n  public keysToMovement(keys: Set<string>): ActionMove | null {\r\n    const dir = new Vector2();\r\n    for (const key of keys) {\r\n      if (MOVEMENT_KEYS[key]) {\r\n        dir.add(MOVEMENT_KEYS[key].dir);\r\n      }\r\n    }\r\n    if (dir.x === 0 && dir.y === 0) {\r\n      return null;\r\n    } else {\r\n      return {\r\n        type: \"move\",\r\n        dir,\r\n      };\r\n    }\r\n  }\r\n\r\n  public resize(w: number, h: number) {\r\n    const aspect = h / w;\r\n    // at zoom 1, we see 12 pixels up and 12 pixels down\r\n    const cameraHeight = 12;\r\n    this.camera.left = -cameraHeight / aspect;\r\n    this.camera.right = cameraHeight / aspect;\r\n    this.camera.top = -cameraHeight;\r\n    this.camera.bottom = cameraHeight;\r\n    // this.camera.position.z = 1;\r\n    // this.camera.lookAt(new Vector3(0, 0, 0));\r\n    this.camera.updateProjectionMatrix();\r\n  }\r\n\r\n  public handleRightClick() {\r\n    const tile = this.getHighlightedTile();\r\n    if (tile != null) {\r\n      if (tile instanceof Fruit) {\r\n        return; // disallow deleting fruit\r\n      }\r\n      this.world.player.setAction({\r\n        type: \"deconstruct\",\r\n        position: tile.pos,\r\n      });\r\n    }\r\n    // }\r\n  }\r\n\r\n  public handleLeftClick() {\r\n    this.firstActionTakenYet = true;\r\n    const target = this.getHighlightedTile();\r\n    if (target == null) {\r\n      return;\r\n    }\r\n\r\n    // clicking a build candidate will try to build with the currently selected cell\r\n    if (this.world.player.isBuildCandidate(target)) {\r\n      const args: any[] = [];\r\n      if (this.selectedCell === Transport) {\r\n        const highlightVector = this.getHighlightVector();\r\n        const roundedHighlightVector = highlightVector.setLength(1).round();\r\n        args.push(roundedHighlightVector);\r\n      }\r\n      const action: ActionBuild = {\r\n        type: \"build\",\r\n        cellType: this.selectedCell,\r\n        position: target.pos.clone(),\r\n        args,\r\n      };\r\n      this.world.player.setAction(action);\r\n    }\r\n  }\r\n  static expansionTiles: Array<Constructor<Cell>> = [Tissue, Root, Vein];\r\n}\r\n\r\nexport default Mito;\r\n","import { HexTile } from \"./hexTile\";\r\nimport { CameraState } from \"./OverWorldMap\";\r\n\r\nexport function roundCubeCoordinates(i: number, j: number, k: number) {\r\n  var rx = Math.round(i);\r\n  var ry = Math.round(j);\r\n  var rz = Math.round(k);\r\n\r\n  var x_diff = Math.abs(rx - i);\r\n  var y_diff = Math.abs(ry - j);\r\n  var z_diff = Math.abs(rz - k);\r\n\r\n  if (x_diff > y_diff && x_diff > z_diff) {\r\n    rx = -ry - rz;\r\n  } else if (y_diff > z_diff) {\r\n    ry = -rx - rz;\r\n  } else {\r\n    rz = -rx - ry;\r\n  }\r\n  return { i: rx, j: ry, k: rz };\r\n}\r\n\r\nexport function pixelPosition(tile: HexTile, camera: CameraState) {\r\n  const { dX, dY, scale } = camera;\r\n  const { x, y } = tile.cartesian;\r\n\r\n  const cX = window.innerWidth / 2 + dX;\r\n  const cY = window.innerHeight / 2 + dY;\r\n  return [cX + x * scale, cY + y * scale];\r\n}\r\n","import React from \"react\";\r\n\r\nimport { CameraState } from \"./OverWorldMap\";\r\nimport { HexTile } from \"./hexTile\";\r\nimport { pixelPosition } from \"./hexMath\";\r\n\r\nimport \"./OverWorldPopover.scss\";\r\n\r\ninterface OverWorldPopoverProps {\r\n  camera: CameraState;\r\n  tile: HexTile;\r\n  children: React.ReactNode;\r\n}\r\n\r\nfunction OverWorldPopover({ tile, camera, children }: OverWorldPopoverProps) {\r\n  const [px, py] = pixelPosition(tile, camera);\r\n  // this element is put in the center\r\n  const container: React.CSSProperties = {\r\n    left: px + camera.scale * 0.5,\r\n    top: py,\r\n  };\r\n  return (\r\n    <div className=\"overworld-popover\" style={container}>\r\n      <div className=\"overworld-popover-positioner\">{children}</div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default OverWorldPopover;\r\n","import React from \"react\";\r\nimport classNames from \"classnames\";\r\n\r\nimport \"./Button.scss\";\r\n\r\nexport function Button(props: JSX.IntrinsicElements[\"button\"] & { color?: \"purple\" | \"green\" }) {\r\n  return <button {...props} className={classNames(\"button\", props.className, props.color || \"purple\")}>{props.children}</button>;\r\n}\r\n","import React from \"react\";\r\nimport { GiDna1 } from \"react-icons/gi\";\r\n\r\nimport \"./MP.scss\";\r\nimport classNames from \"classnames\";\r\n\r\nexport type MPProps = JSX.IntrinsicElements[\"div\"] & {\r\n  amount: number;\r\n  total?: number;\r\n}\r\n\r\nfunction MP({ amount, total, ...props }: MPProps) {\r\n  return (\r\n    <div {...props} className={classNames(\"mp\", props.className)}>\r\n      {amount}\r\n      {total != null ? <>/{total}</> : null}\r\n      <GiDna1 className=\"mp-icon\" />\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default MP;\r\n","import React from \"react\";\r\n\r\nimport { HexTile } from \"./hexTile\";\r\nimport Expand from \"../common/Expand\";\r\n\r\nimport \"./HexTileInfo.scss\";\r\nimport { Button } from \"../common/Button\";\r\nimport MP from \"../common/MP\";\r\n\r\ninterface HexTileInfoProps {\r\n  tile: HexTile;\r\n  onClickPlay: (level: HexTile) => void;\r\n}\r\n\r\nfunction HexTileInfo({ tile, onClickPlay }: HexTileInfoProps) {\r\n  const handleClickPlay = () => {\r\n    onClickPlay(tile);\r\n  };\r\n\r\n  const { height, flora } = tile.info;\r\n\r\n  const playButtonElement =\r\n    (height === -1 || flora != null) ? null : (\r\n      <Button color=\"green\" className=\"play-button\" onClick={handleClickPlay}>\r\n        Populate\r\n      </Button>\r\n    );\r\n\r\n  const header = flora != null ? (\r\n    <h1>Inhabited by {flora.species}<small><MP amount={flora.mutationPointsPerEpoch} /> per epoch</small></h1>\r\n  ) : tile.info.height === -1 ? (\r\n    <h1>Deep Water</h1>\r\n  ) : (\r\n        <h1>Uninhabited</h1>\r\n      );\r\n\r\n  const stringifyInfo = { ...tile.info };\r\n  delete stringifyInfo.world;\r\n\r\n  const expand =\r\n    tile.info.height === -1 ? null : (\r\n      <Expand shrunkElements={<div className=\"details\">Details</div>}>\r\n        <pre style={{ fontSize: \"12px\" }}>{JSON.stringify(stringifyInfo, null, 4)}</pre>\r\n      </Expand>\r\n    );\r\n\r\n  return (\r\n    <div className=\"hex-tile-info-container\">\r\n      {header}\r\n      {expand}\r\n      {playButtonElement}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default HexTileInfo;\r\n","import React from \"react\";\r\nimport { Gene } from \"./gene\";\r\nimport { dnaPairToTraitType } from \"./traits\";\r\n\r\nimport \"./GeneDisplay.scss\";\r\n\r\nfunction GeneComponent({ gene, onClick }: { gene: Gene, onClick: (position: number) => void }) {\r\n  return (\r\n    <div className=\"gene\">\r\n      <div className=\"gene-number\">\r\n        <span className=\"tuple-plus\" title={dnaPairToTraitType(gene[0]) + \" +1\"}>\r\n          <span className=\"dna\" onClick={() => onClick(0)}>{gene[0][0]}</span>\r\n          <span className=\"dna\" onClick={() => onClick(1)}>{gene[0][1]}</span>\r\n        </span>\r\n        <span className=\"tuple-minus\" title={dnaPairToTraitType(gene[1]) + \" -1\"}>\r\n          <span className=\"dna\" onClick={() => onClick(2)}>{gene[1][0]}</span>\r\n          <span className=\"dna\" onClick={() => onClick(3)}>{gene[1][1]}</span>\r\n        </span>\r\n      </div>\r\n      <div className=\"gene-visual\"><img alt=\"\" src=\"https://media2.giphy.com/media/YlmI36YAWe7KScC7hK/giphy.gif\" width=\"44px\" /></div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport interface GeneDisplayProps {\r\n  genes: Gene[];\r\n  onClick: (gene: Gene, position: number) => void;\r\n}\r\n\r\nfunction GeneDisplay({ genes, onClick }: GeneDisplayProps) {\r\n  const geneContent = genes.length > 0 ? (\r\n    <div className=\"genes-container\">\r\n      {genes.map((gene, i) => (\r\n        <GeneComponent key={i} gene={gene} onClick={(p) => onClick(gene, p)} />\r\n      ))}\r\n    </div>\r\n  ) : (\r\n      <div className=\"genes-empty\">\r\n        No genes.\r\n      </div>\r\n    );\r\n  return (\r\n    <div className=\"gene-display\">\r\n      {geneContent}\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default GeneDisplay;\r\n","import React from \"react\";\r\nimport TraitDisplay from \"./TraitDisplay\";\r\nimport { getTraits } from \"./traits\";\r\nimport GeneDisplay, { GeneDisplayProps } from \"./GeneDisplay\";\r\n\r\nimport \"./GenesToTraits.scss\";\r\n\r\nimport { Gene } from \"./gene\";\r\n\r\nexport interface GenesToTraitsProps {\r\n  genes: Gene[];\r\n  onClick: GeneDisplayProps[\"onClick\"];\r\n}\r\n\r\nfunction GenesToTraits({ genes, onClick }: GenesToTraitsProps) {\r\n  const traits = React.useMemo(() => {\r\n    return getTraits(genes);\r\n  }, [genes]);\r\n\r\n  return (\r\n    <div className=\"genes-to-traits\">\r\n      <div className=\"genes-details\">\r\n        <h3>Genes</h3>\r\n        <GeneDisplay genes={genes} onClick={onClick} />\r\n      </div>\r\n      <div className=\"arrow\"></div>\r\n      <div className=\"traits-details\">\r\n        <h3>Traits</h3>\r\n        <TraitDisplay traits={traits} />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default GenesToTraits;\r\n","import React from \"react\";\r\n\r\nimport { Species } from \"./species\";\r\nimport { GeneDisplayProps } from \"./GeneDisplay\";\r\nimport { Button } from \"../common/Button\";\r\nimport GenesToTraits from \"./GenesToTraits\";\r\n\r\nimport \"./SpeciesPopoverDetails.scss\";\r\n\r\nexport interface SpeciesPopoverDetailsProps {\r\n  species: Species;\r\n  onMutate: (species: Species) => void;\r\n  onClick: GeneDisplayProps[\"onClick\"];\r\n}\r\n\r\nfunction SpeciesPopoverDetails({ species, onClick, onMutate }: SpeciesPopoverDetailsProps) {\r\n  return (\r\n    <div className=\"species-details\">\r\n      <GenesToTraits genes={species.genes} onClick={onClick} />\r\n      {species.freeMutationPoints > 0 ? <div className=\"suggestion\">{species.freeMutationPoints} Mutation Points available. Use them!</div> : null}\r\n      <Button onClick={() => onMutate(species)}>Mutate</Button>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default SpeciesPopoverDetails;\r\n","import classNames from \"classnames\";\r\nimport React from \"react\";\r\n\r\nimport characterSrc from \"assets/images/character.png\";\r\n\r\nimport \"./Character.scss\";\r\n\r\nfunction Character(props: JSX.IntrinsicElements[\"img\"] & { size?: \"xs\" | \"small\" | \"medium\" | \"large\" }) {\r\n  const { size, ...otherProps } = props;\r\n  return (\r\n    <img\r\n      className={classNames(\"character\", size)}\r\n      alt=\"\"\r\n      src={characterSrc}\r\n      {...otherProps}\r\n    />\r\n  );\r\n}\r\n\r\nexport default Character;\r\n","import React from \"react\";\r\nimport { Species } from \"./species\";\r\nimport Popover from \"react-popover\";\r\nimport SpeciesPopoverDetails from \"./SpeciesPopoverDetails\";\r\nimport Character from \"../common/Character\";\r\nimport MP from \"../common/MP\";\r\n\r\nimport \"./SpeciesNode.scss\";\r\n\r\nexport interface SpeciesNodeProps {\r\n  species: Species;\r\n  onMutate: (m: Species) => void;\r\n}\r\n\r\nfunction SpeciesNode({ species, onMutate }: SpeciesNodeProps) {\r\n  const handleOnMutate = (s: Species) => {\r\n    setPopoverIsOpen(false);\r\n    onMutate(s);\r\n  };\r\n\r\n  const [popoverIsOpen, setPopoverIsOpen] = React.useState(false);\r\n\r\n  const descendants = species.descendants.length > 0\r\n    ? (\r\n      <div className=\"descendants-container\">\r\n        {species.descendants.map((s, i) => <SpeciesNode key={i} species={s} onMutate={handleOnMutate} />)}\r\n      </div>\r\n    ) : null;\r\n  const popoverBody = (\r\n    <div className=\"species-detail-popover\">\r\n      <SpeciesPopoverDetails species={species} onMutate={handleOnMutate} onClick={() => { }} />\r\n    </div>\r\n  );\r\n  return (\r\n    <div className=\"species-node\">\r\n      {descendants}\r\n      <Popover isOpen={popoverIsOpen} preferPlace=\"right\" onOuterAction={() => setPopoverIsOpen(false)} body={popoverBody}>\r\n        <div className=\"species-info\" onClick={() => setPopoverIsOpen(!popoverIsOpen)}>\r\n          <div className=\"species-info-name\">{species.name}</div>\r\n          <div className=\"species-info-animation\">\r\n            <Character size=\"small\" />\r\n          </div>\r\n          <MP amount={species.freeMutationPoints} />\r\n        </div>\r\n      </Popover>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default SpeciesNode;\r\n","import React from \"react\";\r\n\r\nimport \"./PhylogeneticTree.scss\";\r\nimport { Species } from \"./species\";\r\nimport SpeciesNode from \"./SpeciesNode\";\r\n\r\ninterface PhylogeneticTreeProps {\r\n  rootSpecies: Species;\r\n  onMutate: (s: Species) => void;\r\n}\r\n\r\nfunction PhylogeneticTree({ rootSpecies, onMutate }: PhylogeneticTreeProps) {\r\n  return (\r\n    <div className=\"phylogenetic-tree\">\r\n      <div className=\"title\">Phylogenetic Tree</div>\r\n      <div className=\"tree-nodes\">\r\n        <SpeciesNode species={rootSpecies} onMutate={onMutate} />\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default PhylogeneticTree;\r\n","import { Gene, DNATuple, DNA } from \"./gene\";\r\n\r\nexport function mutateRandomNewGene(): Gene {\r\n  const tuplePlus = randomDNATuple();\r\n  const tupleMinus = randomDNATuple();\r\n  return [tuplePlus, tupleMinus];\r\n}\r\n\r\nexport function mutateSwapDNA(gene1: Gene, position1: number, gene2: Gene, position2: number): [Gene, Gene] {\r\n  const gene1Str = gene1.join(\"\");\r\n  const gene2Str = gene2.join(\"\");\r\n  const dnaPosition1 = gene1Str.charAt(position1);\r\n  const dnaPosition2 = gene2Str.charAt(position2);\r\n\r\n  const newGeneStr1 = gene1Str.substr(0, position1) + dnaPosition2 + gene1Str.substr(position1 + 1);\r\n  const newGeneStr2 = gene2Str.substr(0, position2) + dnaPosition1 + gene2Str.substr(position2 + 1);\r\n\r\n  const newGene1 = strToGene(newGeneStr1);\r\n  const newGene2 = strToGene(newGeneStr2);\r\n  return [newGene1, newGene2];\r\n}\r\n\r\nexport function mutatePosition(gene: Gene, position: number): Gene {\r\n  const geneStr = gene.join(\"\");\r\n  const newGeneStr = geneStr.substr(0, position) + randomNewDNA(geneStr.charAt(position) as DNA) + geneStr.substr(position + 1);\r\n  const newGene = strToGene(newGeneStr);\r\n  return newGene;\r\n}\r\n\r\nfunction strToGene(str: string): Gene {\r\n  return [str.substr(0, 2), str.substr(2)] as Gene;\r\n}\r\n\r\nfunction randomDNATuple(): DNATuple {\r\n  const dna1 = randomDNA();\r\n  const dna2 = randomDNA();\r\n  return (dna1 + dna2) as DNATuple;\r\n}\r\n\r\nfunction randomNewDNA(old: DNA) {\r\n  let d: DNA;\r\n  do {\r\n    d = randomDNA();\r\n  } while (d === old);\r\n  return d;\r\n}\r\n\r\nfunction randomDNA(): DNA {\r\n  const r = Math.random();\r\n  if (r < 0.25) {\r\n    return \"A\";\r\n  } else if (r < 0.5) {\r\n    return \"C\";\r\n  } else if (r < 0.75) {\r\n    return \"G\";\r\n  } else {\r\n    return \"T\";\r\n  }\r\n}\r\n","import React from \"react\";\r\n\r\nimport { Species } from \"./species\";\r\n\r\nimport \"./MutationScreen.scss\";\r\nimport { Button } from \"../common/Button\";\r\nimport { mutateRandomNewGene, mutatePosition, mutateSwapDNA } from \"./mutation\";\r\nimport { Gene } from \"./gene\";\r\nimport Character from \"../common/Character\";\r\nimport classNames from \"classnames\";\r\nimport MP from \"../common/MP\";\r\nimport GenesToTraits from \"./GenesToTraits\";\r\n\r\nfunction MutationScreen({ species, onCommit }: { species: Species, onCommit: (newSpecies: Species, newPool: number) => void }) {\r\n  const [pool, setPool] = React.useState(species.freeMutationPoints);\r\n\r\n  const [newSpecies, setNewSpecies] = React.useState<Species>({\r\n    descendants: [],\r\n    freeMutationPoints: 0,\r\n    genes: [...species.genes],\r\n    name: \"New species\",\r\n    parent: species,\r\n  });\r\n\r\n  type ClickModeSwap = {\r\n    type: \"swap\";\r\n    p1?: { gene: Gene; position: number; };\r\n  }\r\n  type ClickModeReroll = {\r\n    type: \"reroll\";\r\n  }\r\n  type ClickMode = ClickModeSwap | ClickModeReroll | undefined;\r\n  const [clickMode, setClickMode] = React.useState<ClickMode>();\r\n  const isSwapping = clickMode && clickMode.type === \"swap\";\r\n  const isRerolling = clickMode && clickMode.type === \"reroll\";\r\n\r\n  const newGeneCost = newSpecies.genes.length + 1;\r\n\r\n  const handleNewGene = () => {\r\n    setPool(p => p - newGeneCost);\r\n    setNewSpecies((species) => ({\r\n      ...species,\r\n      genes: [...species.genes, mutateRandomNewGene()],\r\n    }));\r\n  };\r\n\r\n  const startSwapClickMode = () => {\r\n    if (isSwapping) {\r\n      setClickMode(undefined);\r\n    } else {\r\n      setClickMode({ type: \"swap\" });\r\n    }\r\n  };\r\n\r\n  const startRerollClickMode = () => {\r\n    if (isRerolling) {\r\n      setClickMode(undefined);\r\n    } else {\r\n      setClickMode({ type: \"reroll\" });\r\n    }\r\n  };\r\n\r\n  function reroll(gene: Gene, position: number) {\r\n    setPool(p => p - 1);\r\n    setNewSpecies((species) => {\r\n      const geneIndex = species.genes.indexOf(gene);\r\n      const newGene = mutatePosition(gene, position);\r\n      const newGenes = [...species.genes.slice(0, geneIndex), newGene, ...species.genes.slice(geneIndex + 1)];\r\n      return {\r\n        ...species,\r\n        genes: newGenes,\r\n      };\r\n    });\r\n    setClickMode(undefined);\r\n  }\r\n\r\n  function swap(gene1: Gene, position1: number, gene2: Gene, position2: number) {\r\n    setPool(p => p - 2);\r\n    setNewSpecies((species) => {\r\n      const geneIndex1 = species.genes.indexOf(gene1);\r\n      const geneIndex2 = species.genes.indexOf(gene2);\r\n\r\n      const newGenes = [...species.genes];\r\n\r\n      const [newGene1, newGene2] = mutateSwapDNA(gene1, position1, gene2, position2);\r\n      newGenes[geneIndex1] = newGene1;\r\n      newGenes[geneIndex2] = newGene2;\r\n\r\n      return {\r\n        ...species,\r\n        genes: newGenes\r\n      };\r\n    });\r\n    setClickMode(undefined);\r\n  }\r\n\r\n  const handleGeneClick = (gene: Gene, position: number) => {\r\n    if (clickMode) {\r\n      if (clickMode.type === \"reroll\") {\r\n        reroll(gene, position);\r\n      } else if (clickMode.type === \"swap\") {\r\n        if (clickMode.p1 == null) {\r\n          clickMode.p1 = { gene, position };\r\n        } else {\r\n          swap(clickMode.p1.gene, clickMode.p1.position, gene, position);\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleNewSpeciesName = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    setNewSpecies(s => ({\r\n      ...s,\r\n      name: e.target.value,\r\n    }));\r\n  }\r\n\r\n  const handleCommit = () => {\r\n    onCommit(newSpecies, pool);\r\n  };\r\n\r\n  const isGenesChanged = React.useMemo(() => {\r\n    const genes1 = species.genes;\r\n    const genes2 = newSpecies.genes;\r\n\r\n    const isDifferentLengths = genes1.length !== genes2.length;\r\n    return isDifferentLengths || genes1.some((_, i) => genes1[i] !== genes2[i]);\r\n  }, [newSpecies.genes, species.genes]);\r\n\r\n  return (\r\n    <div className={classNames(\"mutation-screen\", { \"click-mode-active\": clickMode != null })}>\r\n      <div className=\"mutation-screen-content\">\r\n        <h1><Character size=\"medium\" /><span className=\"name\">{species.name}</span></h1>\r\n\r\n        <div className=\"buttons\">\r\n          <MP className=\"pool\" amount={pool} total={species.freeMutationPoints} />\r\n          <Button\r\n            onClick={handleNewGene}\r\n            disabled={pool < newGeneCost}\r\n          >\r\n            New Gene (<MP amount={newGeneCost} />)\r\n          </Button>\r\n\r\n          <Button\r\n            className={classNames({ \"is-cancel\": isSwapping })}\r\n            onClick={startSwapClickMode}\r\n            disabled={(!isSwapping && pool < 2) || newSpecies.genes.length === 0}\r\n          >\r\n            {isSwapping ? \"Cancel\" : <>Swap DNA (<MP amount={2} />)</>}\r\n          </Button>\r\n\r\n          <Button\r\n            className={classNames({ \"is-cancel\": isRerolling })}\r\n            onClick={startRerollClickMode}\r\n            disabled={(!isRerolling && pool < 1) || newSpecies.genes.length === 0}\r\n          >\r\n            {isRerolling ? \"Cancel\" : <>Re-roll DNA (<MP amount={1} />)</>}\r\n          </Button>\r\n        </div>\r\n\r\n        <GenesToTraits genes={newSpecies.genes} onClick={handleGeneClick} />\r\n        {isGenesChanged ? (\r\n          <>\r\n            <div className=\"arrow\"></div>\r\n            <h1><Character size=\"medium\" /><input type=\"text\" className=\"name\" value={newSpecies.name} onChange={handleNewSpeciesName} /></h1>\r\n            <Button className=\"commit\" color=\"green\" onClick={handleCommit}>Commit</Button>\r\n          </>\r\n        ) : null}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default MutationScreen;\r\n","import { scaleLinear } from \"d3-scale\";\r\nimport React from \"react\";\r\nimport Modal from \"react-modal\";\r\n\r\nimport { HexTile } from \"./hexTile\";\r\nimport { roundCubeCoordinates, pixelPosition } from \"./hexMath\";\r\nimport { OverWorld } from \"./overWorld\";\r\n\r\nimport \"./OverWorldMap.scss\";\r\nimport { Vector2 } from \"three\";\r\nimport OverWorldPopover from \"./OverWorldPopover\";\r\nimport HexTileInfo from \"./HexTileInfo\";\r\nimport PhylogeneticTree from \"../evolution/PhylogeneticTree\";\r\nimport { Species } from \"../evolution/species\";\r\nimport MutationScreen from \"../evolution/MutationScreen\";\r\nimport { GiFamilyTree } from \"react-icons/gi\";\r\nimport classNames from \"classnames\";\r\n\r\nconst C = Math.sqrt(3) / 2;\r\n\r\ninterface OverWorldMapProps {\r\n  rootSpecies: Species;\r\n  overWorld: OverWorld;\r\n  onPlayLevel: (level: HexTile) => void;\r\n}\r\n\r\nexport interface CameraState {\r\n  scale: number;\r\n  dX: number;\r\n  dY: number;\r\n}\r\n\r\ninterface OverWorldMapState {\r\n  cameraState: CameraState;\r\n  pressedKeys: { [code: string]: boolean };\r\n  highlightedTile?: HexTile;\r\n  leftPanelOpen?: boolean;\r\n  activelyMutatingSpecies?: Species;\r\n}\r\n\r\nexport class OverWorldMap extends React.Component<OverWorldMapProps, OverWorldMapState> {\r\n\r\n  constructor(props: OverWorldMapProps) {\r\n    super(props);\r\n    this.state = {\r\n      cameraState: { scale: 48, dX: 0, dY: 0 },\r\n      pressedKeys: {},\r\n      leftPanelOpen: true,\r\n      // activelyMutatingSpecies: props.rootSpecies,\r\n    };\r\n  }\r\n\r\n  private canvas: HTMLCanvasElement | null = null;\r\n  private rafId?: number;\r\n\r\n  private handleCanvasRef = (ref: HTMLCanvasElement | null) => {\r\n    this.canvas = ref;\r\n    if (ref != null) {\r\n      this.handleResize();\r\n    }\r\n  };\r\n\r\n  private handleCanvasClick = (e: React.MouseEvent) => {\r\n    if (this.canvas != null) {\r\n      if (this.state.highlightedTile != null) {\r\n        this.setState({ highlightedTile: undefined });\r\n      } else {\r\n        const level = getClickedHexTile(this.props.overWorld, this.canvas, this.state.cameraState, e);\r\n        if (level != null && level.info.visible) {\r\n          this.setState({ highlightedTile: level });\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  private handleStartMutate = (s: Species) => {\r\n    this.setState({\r\n      activelyMutatingSpecies: s\r\n    });\r\n  };\r\n\r\n  private handleCommit = (newSpecies: Species, newPool: number) => {\r\n    if (this.state.activelyMutatingSpecies == null) {\r\n      throw new Error(\"created new species with no actively mutating one!\");\r\n    }\r\n    this.state.activelyMutatingSpecies.descendants.push(newSpecies);\r\n    // eslint-disable-next-line react/no-direct-mutation-state\r\n    this.state.activelyMutatingSpecies.freeMutationPoints = newPool;\r\n    newSpecies.parent = this.state.activelyMutatingSpecies;\r\n    this.setState({\r\n      activelyMutatingSpecies: undefined,\r\n    });\r\n  };\r\n\r\n  private onPlayLevel = (level: HexTile) => {\r\n    this.props.onPlayLevel(level);\r\n  };\r\n\r\n  private toggleLeftPanelOpen = () => {\r\n    this.setState({\r\n      leftPanelOpen: !this.state.leftPanelOpen\r\n    });\r\n  };\r\n\r\n  private handleKeyDown = (e: KeyboardEvent) => {\r\n    if (!e.repeat) {\r\n      if (e.code === \"Tab\") {\r\n        this.toggleLeftPanelOpen();\r\n        e.preventDefault();\r\n      }\r\n      const newPressedKeys = { ...this.state.pressedKeys, [e.code]: true };\r\n      this.setState({\r\n        pressedKeys: newPressedKeys,\r\n      });\r\n    }\r\n  };\r\n\r\n  private handleKeyUp = (e: KeyboardEvent) => {\r\n    const newPressedKeys = { ...this.state.pressedKeys };\r\n    delete newPressedKeys[e.code];\r\n    this.setState({\r\n      pressedKeys: newPressedKeys,\r\n    });\r\n  };\r\n\r\n  private handleResize = () => {\r\n    if (this.canvas != null) {\r\n      this.canvas.width = window.innerWidth;\r\n      this.canvas.height = window.innerHeight;\r\n      this.drawMap();\r\n    }\r\n  };\r\n\r\n  private updateCamera = () => {\r\n    const panSpeed = 20;\r\n    let offset = new Vector2();\r\n    for (const key in this.state.pressedKeys) {\r\n      if (key === \"KeyW\" || key === \"ArrowUp\") {\r\n        offset.y += panSpeed;\r\n      } else if (key === \"KeyS\" || key === \"ArrowDown\") {\r\n        offset.y -= panSpeed;\r\n      } else if (key === \"KeyA\" || key === \"ArrowLeft\") {\r\n        offset.x += panSpeed;\r\n      } else if (key === \"KeyD\" || key === \"ArrowRight\") {\r\n        offset.x -= panSpeed;\r\n      }\r\n    }\r\n    offset.setLength(panSpeed);\r\n\r\n    if (offset.x !== 0 || offset.y !== 0) {\r\n      const cameraState = this.state.cameraState;\r\n\r\n      this.setState({\r\n        cameraState: {\r\n          ...cameraState,\r\n          dX: cameraState.dX + offset.x,\r\n          dY: cameraState.dY + offset.y,\r\n        },\r\n      });\r\n    }\r\n    this.rafId = requestAnimationFrame(this.updateCamera);\r\n  };\r\n\r\n  private drawMap() {\r\n    if (this.canvas != null) {\r\n      const context = this.canvas.getContext(\"2d\")!;\r\n      context.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n      for (const tile of this.props.overWorld) {\r\n        drawTile(this.canvas, this.state.cameraState, tile);\r\n      }\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    document.addEventListener(\"keydown\", this.handleKeyDown);\r\n    document.addEventListener(\"keyup\", this.handleKeyUp);\r\n    window.addEventListener(\"resize\", this.handleResize);\r\n    this.rafId = requestAnimationFrame(this.updateCamera);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    document.removeEventListener(\"keydown\", this.handleKeyDown);\r\n    document.removeEventListener(\"keyup\", this.handleKeyUp);\r\n    window.removeEventListener(\"resize\", this.handleResize);\r\n    cancelAnimationFrame(this.rafId!);\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    this.drawMap();\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"overworld-map-container\">\r\n        <canvas tabIndex={-1} ref={this.handleCanvasRef} onClick={this.handleCanvasClick} />\r\n        {this.maybeRenderHighlightedTile()}\r\n        {this.maybeRenderPhylogeneticTreePanel()}\r\n        {this.maybeRenderMutationModal()}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  maybeRenderMutationModal() {\r\n    const maybeMutationScreen = this.state.activelyMutatingSpecies != null ? (\r\n      <MutationScreen species={this.state.activelyMutatingSpecies} onCommit={this.handleCommit} />\r\n    ) : null;\r\n    return (\r\n      <Modal\r\n        ariaHideApp={false}\r\n        isOpen={this.state.activelyMutatingSpecies != null}\r\n        onRequestClose={() => this.setState({ activelyMutatingSpecies: undefined })}\r\n        className=\"mutation-screen-portal\"\r\n      >\r\n        {maybeMutationScreen}\r\n      </Modal>\r\n    );\r\n  }\r\n\r\n  maybeRenderPhylogeneticTreePanel() {\r\n    return (\r\n      <div className={classNames(\"panel-left\", { open: this.state.leftPanelOpen })}>\r\n        {this.state.leftPanelOpen ? (\r\n          <PhylogeneticTree onMutate={this.handleStartMutate} rootSpecies={this.props.rootSpecies} />\r\n        ) : null}\r\n        <button className=\"panel-left-handle\" onClick={this.toggleLeftPanelOpen}><GiFamilyTree className=\"icon\" /></button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  maybeRenderHighlightedTile() {\r\n    if (this.state.highlightedTile != null) {\r\n      return (\r\n        <OverWorldPopover camera={this.state.cameraState} tile={this.state.highlightedTile}>\r\n          <HexTileInfo tile={this.state.highlightedTile} onClickPlay={this.onPlayLevel} />\r\n        </OverWorldPopover>\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\nfunction getClickedHexTile(\r\n  overWorld: OverWorld,\r\n  canvas: HTMLCanvasElement,\r\n  camera: CameraState,\r\n  event: React.MouseEvent\r\n) {\r\n  const { scale, dX, dY } = camera;\r\n  const cX = canvas.width / 2 + dX;\r\n  const cY = canvas.height / 2 + dY;\r\n\r\n  const e = event.nativeEvent;\r\n  const pxX = e.offsetX;\r\n  const pxY = e.offsetY;\r\n  const x = (pxX - cX) / scale;\r\n  const y = (pxY - cY) / scale;\r\n  // we now have a fractional cartesian coordinates\r\n  // now we flip the equations:\r\n\r\n  // x = 1.5i\r\n  // i = x / 1.5\r\n\r\n  // y = 2Cj + Ci\r\n  // j = (y - Ci) / (2 * C)\r\n\r\n  const i = x / 1.5;\r\n  const j = (y - C * i) / (2 * C);\r\n  const k = -(i + j);\r\n\r\n  const rounded = roundCubeCoordinates(i, j, k);\r\n\r\n  return overWorld.tileAt(rounded.i, rounded.j);\r\n}\r\n\r\nfunction drawHex(c: CanvasRenderingContext2D, x: number, y: number, r: number) {\r\n  c.strokeStyle = \"rgb(112, 112, 112)\";\r\n  c.beginPath();\r\n  c.moveTo(x + r, y);\r\n  for (let i = 1; i < 6; i++) {\r\n    const angle = (i / 6) * Math.PI * 2;\r\n    c.lineTo(x + Math.cos(angle) * r, y + Math.sin(angle) * r);\r\n  }\r\n  c.closePath();\r\n  c.fill();\r\n  c.stroke();\r\n}\r\n\r\nconst colorScale = scaleLinear<string, string>()\r\n  .domain([-1, 0, 1, 5, 6])\r\n  .range([\"rgb(0, 60, 255)\", \"lightblue\", \"yellow\", \"orange\"]);\r\n\r\n// const FOREST_IMAGE = (() => {\r\n//   const img = new Image();\r\n//   img.src = \"/assets/crusades/forest.png\";\r\n//   return img;\r\n// })();\r\n// const WATER_IMAGE = (() => {\r\n//   const img = new Image();\r\n//   img.src = \"/assets/crusades/water.png\";\r\n//   return img;\r\n// })();\r\n// const PLAINS_IMAGE = (() => {\r\n//   const img = new Image();\r\n//   img.src = \"/assets/crusades/plains.png\";\r\n//   return img;\r\n// })();\r\n// const MOUNTAIN_IMAGE = (() => {\r\n//   const img = new Image();\r\n//   img.src = \"/assets/crusades/mountain.png\";\r\n//   return img;\r\n// })();\r\n\r\n// const TYPE_TO_IMG_MAP = {\r\n//   \"forest\": FOREST_IMAGE,\r\n//   \"mountain\": MOUNTAIN_IMAGE,\r\n//   \"plains\": PLAINS_IMAGE,\r\n//   \"water\": WATER_IMAGE,\r\n// };\r\n\r\nfunction drawTile(canvas: HTMLCanvasElement, camera: CameraState, tile: HexTile) {\r\n  const { scale } = camera;\r\n  const [px, py] = pixelPosition(tile, camera);\r\n\r\n  const c = canvas.getContext(\"2d\")!;\r\n\r\n  // const sourceWidth = 1280;\r\n  // const sourceHeight = 1110;\r\n  // const ratio = sourceHeight / sourceWidth;\r\n  // const img = TYPE_TO_IMG_MAP[tile.crusaderType];\r\n  // c.drawImage(img, px, py, scale * 2, scale * ratio * 2);\r\n\r\n  if (tile.info.visible) {\r\n    c.fillStyle = colorScale(tile.info.height);\r\n    drawHex(c, px, py, scale);\r\n    c.font = \"12px serif\";\r\n    c.textAlign = \"center\";\r\n    c.textBaseline = \"middle\";\r\n    c.fillStyle = \"#666\";\r\n    c.fillText(tile.info.height + \"\", px, py, scale);\r\n  } else {\r\n    c.fillStyle = \"grey\";\r\n    drawHex(c, px, py, scale);\r\n  }\r\n}\r\n","import { LevelInfo } from \"./levelInfo\";\r\n\r\nconst C = Math.sqrt(3) / 2;\r\n\r\nexport class HexTile {\r\n  /**\r\n   * store neighbors at angles [30, 90, 150, 210, 270, 330]\r\n   *\r\n   * 30: (1, 0, -1)\r\n   *\r\n   * 90: (0, 1, -1)\r\n   *\r\n   * 150: (-1, 1, 0)\r\n   *\r\n   * 210: (-1, 0, 1)\r\n   *\r\n   * 270: (0, -1, 1)\r\n   *\r\n   * 330: (1, -1, 0)\r\n   */\r\n  neighbors: HexTile[] = new Array(6);\r\n  info: LevelInfo = {\r\n    height: 0,\r\n    rainfall: \"medium\",\r\n    soilType: \"average\",\r\n    temperature: \"temperate\",\r\n    wind: \"low\",\r\n    visible: false,\r\n  };\r\n  get crusaderType(): \"forest\" | \"plains\" | \"mountain\" | \"water\" {\r\n    if (this.info.height < -2) {\r\n      return \"water\";\r\n    }\r\n    if (this.info.height < 2.5) {\r\n      return \"plains\";\r\n    }\r\n    if (this.info.height < 4) {\r\n      return \"forest\";\r\n    }\r\n    return \"mountain\";\r\n  }\r\n\r\n  get k() {\r\n    return -(this.i + this.j);\r\n  }\r\n  get magnitude() {\r\n    return Math.abs(this.i) + Math.abs(this.j) + Math.abs(this.k);\r\n  }\r\n  get cartesian() {\r\n    const { i, j } = this;\r\n    // simplified version:\r\n    // x = i - 0.5j - 0.5*-(i + j)\r\n    // x = i - 0.5j + 0.5i + 0.5j\r\n    // x = 1.5i\r\n    // y = Cj - C*-(i + j)\r\n    // y = Cj + Ci + Cj\r\n    // y = 2Cj + Ci\r\n    return {\r\n      x: 1.5 * i,\r\n      y: 2 * C * j + C * i,\r\n    };\r\n  }\r\n  constructor(public i: number, public j: number) { }\r\n}\r\n","import { HexTile } from \"./hexTile\";\r\n\r\nexport class HexStore {\r\n  tiles: { [k: string]: HexTile } = {};\r\n\r\n  private hash(i: number, j: number) {\r\n    return `${i},${j}`;\r\n  }\r\n\r\n  get(i: number, j: number) {\r\n    return this.tiles[this.hash(i, j)];\r\n  }\r\n\r\n  set(i: number, j: number, tile: HexTile) {\r\n    this.tiles[this.hash(i, j)] = tile;\r\n  }\r\n\r\n  hookUpNeighbors() {\r\n    for (const tile of this) {\r\n      const { i, j } = tile;\r\n      tile.neighbors[0] = this.get(i + 1, j);\r\n      tile.neighbors[1] = this.get(i, j + 1);\r\n      tile.neighbors[2] = this.get(i - 1, j + 1);\r\n      tile.neighbors[3] = this.get(i - 1, j);\r\n      tile.neighbors[4] = this.get(i, j - 1);\r\n      tile.neighbors[5] = this.get(i + 1, j - 1);\r\n    }\r\n  }\r\n\r\n  *[Symbol.iterator]() {\r\n    for (const key in this.tiles) {\r\n      yield this.tiles[key];\r\n    }\r\n  }\r\n}\r\n","import SimplexNoise from \"simplex-noise\";\r\n\r\nimport { HexTile } from \"./hexTile\";\r\nimport { HexStore } from \"./hexStore\";\r\nimport { Temperate, Desert, Rocky } from \"../sketches/mito/game/environment\";\r\n\r\nexport class OverWorld {\r\n  private static randomHeight(tile: HexTile, noise: SimplexNoise) {\r\n    const { x, y } = tile.cartesian;\r\n    let height = 0;\r\n    height += (noise.noise3D(x / 24, y / 24, 0) - 0.2) * 6;\r\n    height += noise.noise3D(x / 24, y / 24, 1.453) * 6;\r\n    height += noise.noise3D(x / 6, y / 6, 1.453) * 1.5;\r\n    height += 1;\r\n    // info.height += 4 - Math.abs(tile.magnitude * tile.magnitude) * 0.02;\r\n    height -= Math.abs(y * y) * 0.025;\r\n    if (height < 0 && height >= -1) {\r\n      height = 0;\r\n    }\r\n    height = Math.round(Math.max(Math.min(height, 6), -1));\r\n    return height;\r\n  }\r\n\r\n  private static randomCrusaderHeight(tile: HexTile, noise: SimplexNoise) {\r\n    const { x, y } = tile.cartesian;\r\n    let height = 0;\r\n    // height += (noise.noise3D(x / 24, y / 24, 0) - 0.2) * 6;\r\n    // height += noise.noise3D(x / 24, y / 24, 1.453) * 6;\r\n    // height += noise.noise3D(x / 6, y / 6, 1.453) * 1.5;\r\n    height = noise.noise3D(x / 8, y / 8, 0) * 6;\r\n    height += 1;\r\n    // info.height += 4 - Math.abs(tile.magnitude * tile.magnitude) * 0.02;\r\n    // height -= Math.abs(y * y) * 0.025;\r\n    // if (height < 0 && height >= -1) {\r\n    //   height = 0;\r\n    // }\r\n    // height = Math.round(Math.max(Math.min(height, 6), -1));\r\n    height = Math.round(height);\r\n    return height;\r\n  }\r\n  private static populateLevelInfo(tile: HexTile, noise: SimplexNoise) {\r\n    const { info } = tile;\r\n    info.height = OverWorld.randomHeight(tile, noise);\r\n\r\n    info.environment = info.height < 2 ? Temperate() : info.height < 4 ? Rocky() : Desert();\r\n  }\r\n\r\n  static generateFilledHex(maxDist: number = 20): OverWorld {\r\n    const storage = new HexStore();\r\n    const noise = new SimplexNoise();\r\n    // the rule is: i + j + k = 0\r\n    // abs(i) <= maxDist\r\n    // abs(j) <= maxDist\r\n    // abs(k) <= maxDist\r\n    for (let i = -maxDist; i <= maxDist; i++) {\r\n      for (let j = -maxDist; j <= maxDist; j++) {\r\n        let k = -(i + j);\r\n        if (Math.abs(k) > maxDist) {\r\n          continue;\r\n        }\r\n        const tile = new HexTile(i, j);\r\n        OverWorld.populateLevelInfo(tile, noise);\r\n        storage.set(i, j, tile);\r\n      }\r\n    }\r\n    return new OverWorld(storage);\r\n  }\r\n\r\n  static generateRectangle(width: number = 50, height: number = 25): OverWorld {\r\n    const storage = new HexStore();\r\n    const noise = new SimplexNoise();\r\n    // the rule is: i + j + k = 0\r\n    // abs(i) <= maxDist\r\n    // abs(j) <= maxDist\r\n    // abs(k) <= maxDist\r\n    const maxDist = Math.max(width / 2, height / 2);\r\n\r\n    for (let i = -maxDist; i <= maxDist; i++) {\r\n      for (let j = -maxDist; j <= maxDist; j++) {\r\n        let k = -(i + j);\r\n        if (Math.abs(k) > maxDist) {\r\n          continue;\r\n        }\r\n        const tile = new HexTile(i, j);\r\n        const { x, y } = tile.cartesian;\r\n        if (x < -width / 2 || x > width / 2 || y < -height / 2 || y > height / 2) {\r\n          continue;\r\n        }\r\n\r\n        OverWorld.populateLevelInfo(tile, noise);\r\n        storage.set(i, j, tile);\r\n      }\r\n    }\r\n\r\n    return new OverWorld(storage);\r\n  }\r\n\r\n  private startTile: HexTile;\r\n\r\n  constructor(private storage: HexStore) {\r\n    // hook up neighbors\r\n    storage.hookUpNeighbors();\r\n\r\n    // make an initial tile visible\r\n    const tiles = Array.from(storage);\r\n    this.startTile = tiles.filter((t) => t.info.height === 0).sort((t1, t2) => t1.magnitude - t2.magnitude)[0];\r\n    this.startTile.info.visible = true;\r\n  }\r\n\r\n  public getStartTile() {\r\n    return this.startTile;\r\n  }\r\n\r\n  public tileAt(i: number, j: number) {\r\n    return this.storage.get(i, j);\r\n  }\r\n\r\n  *[Symbol.iterator]() {\r\n    for (const tile of this.storage) {\r\n      yield tile;\r\n    }\r\n  }\r\n}\r\n","import * as React from \"react\";\r\n\r\nimport { GameResult } from \"..\";\r\nimport { Fruit } from \"../game/tile\";\r\n\r\nimport \"./GameResultsScreen.scss\";\r\nimport Character from \"../../../common/Character\";\r\n\r\nimport fruitSrc from \"assets/images/fruit.png\";\r\n\r\nfunction Glow() {\r\n  return (\r\n    <div className=\"glow\">\r\n      <span />\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface GameResultsScreenProps {\r\n  onDone: () => void;\r\n  results: GameResult;\r\n}\r\n\r\nfunction FruitInfo({ fruit }: { fruit: Fruit }) {\r\n  return (\r\n    <div className=\"fruit-info\">\r\n      <div className=\"fruit-visual\">\r\n        {fruit.isMature() ? <Glow /> : null}\r\n        <img alt=\"\" src={fruitSrc} />\r\n      </div>\r\n      {fruit.isMature() ? (\r\n        <>\r\n          <span className=\"matured-info success\">Matured</span>&nbsp;at {fruit.timeMatured}, Mutation Points earned: 1\r\n        </>\r\n      ) : (\r\n          <span className=\"matured-info in-progress\">{(fruit.getPercentMatured() * 100).toFixed(0)}% maturity</span>\r\n        )}\r\n      , started {fruit.timeMade}.\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction GameWonScreen({ results }: GameResultsScreenProps) {\r\n  const matureFruit = results.fruits.filter((f) => f.isMature());\r\n  return (\r\n    <>\r\n      <div className=\"character-party-container\">\r\n        <Character size=\"large\" />\r\n      </div>\r\n      <h1>You {matureFruit.length >= 3 ? \"thrived\" : \"survived\"}!</h1>\r\n      <h2>{matureFruit.length} Mutation Points earned.</h2>\r\n      <h5>Fruit Made</h5>\r\n      <div className=\"fruit-list\">\r\n        {results.fruits.map((f) => (\r\n          <FruitInfo fruit={f} />\r\n        ))}\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n\r\nfunction GameLostScreen({ results }: GameResultsScreenProps) {\r\n  return (\r\n    <>\r\n      <h1>You died!</h1>\r\n      <div>You survived until {results.world.season.name}!</div>\r\n    </>\r\n  );\r\n}\r\n\r\nexport default function GameResultsScreen({ onDone, results }: GameResultsScreenProps) {\r\n  return (\r\n    <div className={`game-results-screen ${results.status}`}>\r\n      <div className=\"game-results-content\">\r\n        {results.status === \"won\" ? (\r\n          <GameWonScreen onDone={onDone} results={results} />\r\n        ) : (\r\n            <GameLostScreen onDone={onDone} results={results} />\r\n          )}\r\n        <button className=\"done-button\" onClick={onDone}>\r\n          Continue \r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import { Gene } from \"./gene\";\r\n\r\nexport interface Species {\r\n  name: string;\r\n  genes: Gene[];\r\n  // cells: Cell[];\r\n  freeMutationPoints: number;\r\n  descendants: Species[];\r\n  parent?: Species;\r\n}\r\n\r\nexport function newBaseSpecies(name = \"newBaseSpecies\"): Species {\r\n  return {\r\n    name,\r\n    // genes: [mutateRandomNewGene(), mutateRandomNewGene(), mutateRandomNewGene()],\r\n    genes: [],\r\n    freeMutationPoints: 0,\r\n    descendants: [],\r\n  };\r\n}\r\n\r\nexport interface Cell {\r\n  genes: Gene[];\r\n}\r\n","import React from \"react\";\r\n\r\nimport { FullPageSketch } from \"./sketches/fullPageSketch\";\r\nimport Mito, { GameResult } from \"./sketches/mito\";\r\nimport { OverWorldMap } from \"./overworld/OverWorldMap\";\r\nimport { OverWorld } from \"./overworld/overWorld\";\r\nimport { HexTile } from \"./overworld/hexTile\";\r\nimport GameResultsScreen from \"./sketches/mito/ui/GameResultsScreen\";\r\nimport { Species, newBaseSpecies } from \"./evolution/species\";\r\n\r\nexport interface AppState {\r\n  overWorld: OverWorld;\r\n  activeLevel?: HexTile;\r\n  activeGameResult?: GameResult;\r\n  rootSpecies: Species;\r\n}\r\n\r\nclass App extends React.PureComponent<{}, AppState> {\r\n  // static contextType = AppContext;\r\n  // context!: React.ContextType<typeof AppContext>;\r\n\r\n  constructor(props: {}) {\r\n    super(props);\r\n    const overWorld = OverWorld.generateRectangle(100, 50);\r\n    // const activeLevel = overWorld.getStartTile();\r\n    const rootSpecies = newBaseSpecies(\"plantum originus\");\r\n    rootSpecies.freeMutationPoints = 25;\r\n    // const s3 = newBaseSpecies(\"s3\");\r\n    // s3.descendants = [newBaseSpecies(\"ya\"), newBaseSpecies(\"no\"), newBaseSpecies(\"whoa\")];\r\n    // let s: Species;\r\n    // rootSpecies.descendants = [s = newBaseSpecies(\"foo\"), newBaseSpecies(\"bar\"), s3];\r\n    // s.descendants = [newBaseSpecies(\"1\"), newBaseSpecies(\"2\")]\r\n    this.state = {\r\n      overWorld,\r\n      activeLevel: undefined,\r\n      rootSpecies,\r\n    };\r\n  }\r\n\r\n  handlePlayLevel = (level: HexTile) => {\r\n    if (level.info.visible) {\r\n      this.setState({ activeLevel: level });\r\n    }\r\n  };\r\n\r\n  handleWinLoss = (result: GameResult) => {\r\n    this.setState({ activeGameResult: result });\r\n    if (result.status === \"won\" && this.state.activeLevel != null) {\r\n      const { activeLevel } = this.state;\r\n      activeLevel.info.flora = {\r\n        species: result.world.species,\r\n        mutationPointsPerEpoch: result.fruits.filter((x) => x.isMature()).length,\r\n      };\r\n\r\n      for (const n of activeLevel.neighbors) {\r\n        n.info.visible = true;\r\n      }\r\n    }\r\n  };\r\n\r\n  handleResultsDone = () => {\r\n    this.setState({\r\n      activeLevel: undefined,\r\n      activeGameResult: undefined,\r\n    });\r\n  };\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"App\">\r\n        {this.maybeRenderOverWorldMap()}\r\n        {this.maybeRenderLevel()}\r\n        {this.maybeRenderGameResult()}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  maybeRenderOverWorldMap() {\r\n    if (this.state.activeLevel == null) {\r\n      return <OverWorldMap overWorld={this.state.overWorld} rootSpecies={this.state.rootSpecies} onPlayLevel={this.handlePlayLevel} />;\r\n    }\r\n  }\r\n\r\n  maybeRenderLevel() {\r\n    if (this.state.activeLevel != null && this.state.activeGameResult == null) {\r\n      return <FullPageSketch sketchClass={Mito} otherArgs={[this.state.activeLevel, this.state.rootSpecies, this.handleWinLoss]} />;\r\n    }\r\n  }\r\n\r\n  maybeRenderGameResult() {\r\n    if (this.state.activeGameResult != null) {\r\n      return <GameResultsScreen results={this.state.activeGameResult} onDone={this.handleResultsDone} />;\r\n    }\r\n  }\r\n}\r\n\r\nexport default App;\r\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === \"localhost\" ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === \"[::1]\" ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === \"production\" && \"serviceWorker\" in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL((process as { env: { [key: string]: string } }).env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener(\"load\", () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            \"This web app is being served cache-first by a service \" +\n              \"worker. To learn more, visit https://bit.ly/CRA-PWA\"\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === \"installed\") {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                \"New content is available and will be used when all \" +\n                  \"tabs for this page are closed. See https://bit.ly/CRA-PWA.\"\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log(\"Content is cached for offline use.\");\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch((error) => {\n      console.error(\"Error during service worker registration:\", error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then((response) => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get(\"content-type\");\n      if (response.status === 404 || (contentType != null && contentType.indexOf(\"javascript\") === -1)) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then((registration) => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\"No internet connection found. App is running in offline mode.\");\n    });\n}\n\nexport function unregister() {\n  if (\"serviceWorker\" in navigator) {\n    navigator.serviceWorker.ready.then((registration) => {\n      registration.unregister();\n    });\n  }\n}\n","import React from \"react\";\r\nimport { World } from \"../sketches/mito/game\";\r\nimport { Temperate, Environment, Rocky, Desert } from \"../sketches/mito/game/environment\";\r\nimport { Tile, Air, Soil, Rock, Fountain } from \"../sketches/mito/game/tile\";\r\nimport { hasInventory } from \"../sketches/mito/inventory\";\r\nimport { PlotData, Layout } from \"plotly.js\";\r\nimport { findBuildCandidateTiles } from \"../sketches/mito/game/worldUtils\";\r\nimport { newBaseSpecies } from \"../evolution/species\";\r\n\r\ntype Visitor = (tiles: Tile[], world: World) => number;\r\ninterface Visitors {\r\n  [name: string]: Visitor;\r\n}\r\n\r\nfunction visit(world: World, visitors: Visitors): Trial {\r\n  const tiles = Array.from(world.environmentTiles());\r\n  const results: Trial = {};\r\n  for (const [name, visitor] of Object.entries(visitors)) {\r\n    const result = visitor(tiles, world);\r\n    results[name] = result;\r\n  }\r\n  return results;\r\n}\r\n\r\ninterface Trial {\r\n  [key: string]: number;\r\n}\r\nclass Experiment {\r\n  trials: Trial[] = [];\r\n  constructor(public visitors: Visitors) { }\r\n  recordDataFor(world: World) {\r\n    const trial = visit(world, this.visitors);\r\n    this.trials.push(trial);\r\n  }\r\n  visitorNames() {\r\n    return Object.keys(this.visitors);\r\n  }\r\n}\r\n\r\nclass ExperimentSuite {\r\n  constructor(public experiments: Experiment[]) { }\r\n\r\n  recordDataFor(world: World) {\r\n    for (const e of this.experiments) {\r\n      e.recordDataFor(world);\r\n    }\r\n  }\r\n}\r\n\r\nfunction runTests(environmentFn: () => Environment, id: string) {\r\n  console.log(\"running\");\r\n  const suite = new ExperimentSuite([\r\n    new Experiment({\r\n      countAir: (t) => t.filter((tile) => tile.constructor === Air).length,\r\n    }),\r\n    new Experiment({\r\n      countSoil: (t) => t.filter((tile) => tile.constructor === Soil).length,\r\n    }),\r\n    new Experiment({\r\n      countRock: (t) => t.filter((tile) => tile.constructor === Rock).length,\r\n    }),\r\n    new Experiment({\r\n      countFountain: (t) => t.filter((tile) => tile.constructor === Fountain).length,\r\n    }),\r\n    new Experiment({\r\n      playerY: (_, w) => w.player.pos.y,\r\n    }),\r\n    new Experiment({\r\n      startAdjacentWaters: (_, w) => {\r\n        const adjacentTiles = findBuildCandidateTiles(w, (t) => t instanceof Soil);\r\n        let water = 0;\r\n        for (const t of adjacentTiles) {\r\n          if (hasInventory(t)) {\r\n            water += t.inventory.water;\r\n          }\r\n        }\r\n        return water;\r\n      },\r\n    }),\r\n    new Experiment({\r\n      countWaters: (t) => {\r\n        return t.reduce((w, tile) => w + (hasInventory(tile) ? tile.inventory.water : 0), 0);\r\n      },\r\n    }),\r\n  ]);\r\n  for (let i = 0; i < 20; i++) {\r\n    console.time(\"trial \" + i);\r\n    const world = new World(environmentFn(), newBaseSpecies());\r\n    suite.recordDataFor(world);\r\n    console.timeEnd(\"trial \" + i);\r\n  }\r\n\r\n  plotStackedBar(suite.experiments.slice(0, 4), id);\r\n\r\n  for (const e of suite.experiments) {\r\n    plotHistogram(e, id);\r\n  }\r\n}\r\n\r\nfunction plotStackedBar(experiments: Experiment[], divId: string) {\r\n  const data = [];\r\n  const names = experiments.map((e) => e.visitorNames().join(\"\"));\r\n  for (const idx in names) {\r\n    const name = names[idx];\r\n    const x = [];\r\n    const y = [];\r\n    for (let i = 0; i < experiments[0].trials.length; i++) {\r\n      x.push(i);\r\n\r\n      const e = experiments[idx];\r\n      const trial = e.trials[i];\r\n      const value = trial[name];\r\n      y.push(value);\r\n    }\r\n    const trace: Partial<PlotData> = {\r\n      x,\r\n      y,\r\n      name,\r\n      type: \"bar\",\r\n    };\r\n    data.push(trace);\r\n  }\r\n  var layout: Partial<Layout> = { barmode: \"stack\" };\r\n\r\n  const div = document.createElement(\"div\");\r\n  const el = document.getElementById(divId)!;\r\n  el.appendChild(div);\r\n  window.Plotly.newPlot(div, data, layout);\r\n}\r\n\r\nfunction plotHistogram(stats: Experiment, divId: string) {\r\n  const data = [];\r\n  const layout: Partial<Layout> = {};\r\n\r\n  for (const name of stats.visitorNames()) {\r\n    var trace: Partial<PlotData> = {\r\n      x: stats.trials.map((t) => t[name]),\r\n      type: \"histogram\",\r\n      name: name,\r\n    };\r\n    data.push(trace);\r\n\r\n    layout.title = {\r\n      text: name,\r\n    };\r\n  }\r\n  const div = document.createElement(\"div\");\r\n  const el = document.getElementById(divId)!;\r\n  el.appendChild(div);\r\n  div.style.height = \"240px\";\r\n  div.style.width = \"320px\";\r\n  div.style.display = \"inline-block\";\r\n  window.Plotly.newPlot(div, data, layout);\r\n}\r\n\r\nfunction TestStats() {\r\n  React.useEffect(() => {\r\n    var script = document.createElement(\"script\");\r\n    script.src = \"https://cdn.plot.ly/plotly-latest.min.js\";\r\n    script.addEventListener(\"load\", function () {\r\n      runTests(Temperate, \"temperate\");\r\n      runTests(Rocky, \"rocky\");\r\n      runTests(Desert, \"desert\");\r\n    });\r\n\r\n    document.body.appendChild(script);\r\n  }, []);\r\n\r\n  return (\r\n    <div>\r\n      <h1>Experiments</h1>\r\n      <div id=\"temperate\">\r\n        <h2>Temperate</h2>\r\n      </div>\r\n      <div id=\"rocky\">\r\n        <h2>Rocky</h2>\r\n      </div>\r\n      <div id=\"desert\">\r\n        <h2>Desert</h2>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default TestStats;\r\n","import { World } from \".\";\r\n\r\nimport { Tile, Tissue } from \"./tile\";\r\n\r\nexport function findBuildCandidateTiles(world: World, predicate?: (tile: Tile) => boolean) {\r\n  const entityPredicate: (tile: Tile) => boolean = (t) => world.player.isWalkable(t);\r\n  const candidates: Set<Tile> = new Set();\r\n  for (const entity of world.entities()) {\r\n    if (entity instanceof Tile && entityPredicate(entity)) {\r\n      for (const [, neighbor] of world.tileNeighbors(entity.pos)) {\r\n        if (!(neighbor instanceof Tissue) && !neighbor.isObstacle) {\r\n          if (predicate == null) {\r\n            candidates.add(neighbor);\r\n          } else if (predicate(neighbor)) {\r\n            candidates.add(neighbor);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  return candidates;\r\n}\r\n","import React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport { BrowserRouter, Switch, Route, Redirect } from \"react-router-dom\";\r\n\r\nimport App from \"./App\";\r\nimport * as serviceWorker from \"./serviceWorker\";\r\n\r\nimport \"./index.scss\";\r\nimport { TestWinScreen } from \"./tests/TestWinScreen\";\r\nimport TestStats from \"./tests/TestStats\";\r\n\r\nReactDOM.render(\r\n  <BrowserRouter>\r\n    <Switch>\r\n      <Route path=\"/test-win\">\r\n        <TestWinScreen />\r\n      </Route>\r\n      <Route path=\"/test-stats\">\r\n        <TestStats />\r\n      </Route>\r\n      <Route exact path=\"/\">\r\n        <App />\r\n      </Route>\r\n      <Route path=\"*\">\r\n        <Redirect to=\"/\" />\r\n      </Route>\r\n    </Switch>\r\n  </BrowserRouter>,\r\n\r\n  document.getElementById(\"root\")\r\n);\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n","import React from \"react\";\r\nimport GameResultsScreen from \"../sketches/mito/ui/GameResultsScreen\";\r\nimport { GameResult } from \"../sketches/mito\";\r\nimport { World } from \"../sketches/mito/game\";\r\nimport { Temperate } from \"../sketches/mito/game/environment\";\r\nimport { Fruit } from \"../sketches/mito/game/tile\";\r\nimport { Vector2 } from \"three\";\r\nimport { newBaseSpecies } from \"../evolution/species\";\r\n\r\nexport function TestWinScreen() {\r\n  const world = new World(Temperate(), newBaseSpecies());\r\n  world.time = 150;\r\n  const f1 = new Fruit(new Vector2(0, 0), world);\r\n  f1.committedResources.add(50, 50);\r\n  f1.timeMatured = 250;\r\n\r\n  world.time = 479;\r\n  const f2 = new Fruit(new Vector2(0, 0), world);\r\n  f2.committedResources.add(25, 15);\r\n\r\n  world.time = 1296;\r\n  const f3 = new Fruit(new Vector2(0, 0), world);\r\n  f3.committedResources.add(50, 50);\r\n  const mockResults: GameResult = {\r\n    status: \"won\",\r\n    fruits: [f1, f2, f3],\r\n    world,\r\n  };\r\n  return <GameResultsScreen results={mockResults} onDone={() => { }} />;\r\n}\r\n","module.exports = __webpack_public_path__ + \"static/media/fruit.e136487f.png\";","module.exports = __webpack_public_path__ + \"static/media/mito-base.28ee2cbb.mp3\";","module.exports = __webpack_public_path__ + \"static/media/mito-strings.9f30639c.mp3\";","module.exports = __webpack_public_path__ + \"static/media/mito-drums.1c82b4f4.mp3\";","module.exports = __webpack_public_path__ + \"static/media/footsteps.636605b0.wav\";","module.exports = __webpack_public_path__ + \"static/media/build.a2067d20.wav\";","module.exports = __webpack_public_path__ + \"static/media/Blop-Mark_DiAngelo-79054334.627c0e8b.mp3\";","module.exports = __webpack_public_path__ + \"static/media/suckwater.b0fe81fa.wav\";","module.exports = __webpack_public_path__ + \"static/media/roguelikeSheet_transparent.3c15bcea.png\";","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAQCAYAAADJViUEAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAACXBIWXMAAAsTAAALEwEAmpwYAAACC2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS40LjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyI+CiAgICAgICAgIDx0aWZmOlJlc29sdXRpb25Vbml0PjI8L3RpZmY6UmVzb2x1dGlvblVuaXQ+CiAgICAgICAgIDx0aWZmOkNvbXByZXNzaW9uPjE8L3RpZmY6Q29tcHJlc3Npb24+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiAgICAgICAgIDx0aWZmOlBob3RvbWV0cmljSW50ZXJwcmV0YXRpb24+MjwvdGlmZjpQaG90b21ldHJpY0ludGVycHJldGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KD0UqkwAAAM1JREFUKBVjYBgowIjL4v50+/8wucKZB7GqwxCEadJSkYfpZbh25yGYjW4IimaQRpimSbL8cM15jz+C2SBDkA1ggqtAYiBrBAmj82FK4TbDbF2qowSWe/vxLUwNgzC/MJgdfeUe2Asw27HajKwRpAudDzMVq2aYJCGaepr5JSH+hfkRZjOMD5OHicMDDCSAHmgwRSAaPbBAYhjOBpmehQhokBowH91WkDiKzSABWAqztHUEccHg+OH9YBoWRVBhTM0wCZghID66JpgaimgAWfxCZhIsrg0AAAAASUVORK5CYII=\""],"sourceRoot":""}